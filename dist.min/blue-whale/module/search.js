define("Search",["require","exports","Modal","Spinner","BwRule"],function(e,n,t,r,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var s=G.d,o=BW.CONF,c=BW.sys,a=function(){function e(e){this.para=e,this.ajax=new i.BwRule.Ajax,this.searchInit(e)}return e.prototype.searchInit=function(e){var a=this;s.on(e.searchBtn,"click",function(){if(a.modal)a.modal.isShow=!0;else{a.modal=new t.Modal({header:"查询",footer:{},body:a.searchTpl()}),a.modal.bodyWrapper.classList.add("modal-search");var n=s.query(".searchInput",a.modal.bodyWrapper),i=n.nextElementSibling;a.input(n,i),n&&setTimeout(function(){s.on(i,"click",function(e){n.value="",i.classList.add("mui-hidden")})},1e3),a.modal.bodyWrapper.appendChild(a.contentTpl()),s.on(s.query("#menuSearch"),"click","li.mui-table-view-cell[data-href]",function(){c.window.open({url:o.siteUrl+this.dataset.href})})}})},e.prototype.input=function(n,i){var a=this,t=null;s.on(n,"input",function(){var e=n.value;""!==e?i.classList.remove("mui-hidden"):i.classList.add("mui-hidden"),t&&clearTimeout(t),t=setTimeout(function(){a.search(e),t=null},300)})},e.prototype.uiMake=function(e,n){var i=this,a=s.query("#menuSearch",this.modal.bodyWrapper),t=document.createDocumentFragment();e&&e[0]?e.forEach(function(e){t.appendChild(i.liTpl(e))}):t.appendChild(s.create('<li class="no-data">暂无数据</li>')),a.appendChild(t)},e.prototype.search=function(e){var i=this;if(console.log("sear"),""===e);else{var n=s.query("#menuSearch",this.modal.bodyWrapper);n.innerHTML=null,this.spinner||(this.spinner=new r.Spinner({el:n,type:r.Spinner.SHOW_TYPE.append})),this.spinner.show();var a=o.siteUrl+this.para.baseUrl+"currentNode="+this.para.nodeId+"&keywords="+e;this.ajax.fetch(a,{type:"POST",cache:!0}).then(function(e){var n=e.response;i.uiMake(n.body.bodyList,n.msg)}).finally(function(){i.spinner.hide()})}},e.prototype.searchTpl=function(){return s.create('<div class="search-input mui-input-row">\n        <label><span class="mui-icon mui-icon-search grey"></span></label>\n        <input type="text" placeholder="搜索功能名称" class="searchInput mui-input-clear mui-input" autocapitalize="off" autocorrect="off">\n        <span class="mui-icon mui-icon-clear mui-hidden"></span>\n        </div>')},e.prototype.contentTpl=function(){return s.create('<div class="mui-content  mui-scroll-wrapper search-content">\n             <div class="mui-scroll search-scroll">\n               <ul id="menuSearch" class="mui-table-view mui-grid-view mui-grid-9">\n              \n               </ul>\n           </div>\n    </div>')},e.prototype.liTpl=function(e){var n=e.menuItem.menuPath;return s.create(' <li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3" data-href="'+n.dataAddr+'" data-gps="'+n.needGps+'" data-favid="'+e.menuItem.favid+'">\n                    <a href="javascript:void(0)">\n                        <span class="mui-icon '+e.menuItem.menuIcon+'">\n                        </span>\n                        <div class="mui-media-body">'+e.menuItem.menuName+"</div>\n                    </a>\n                </li>")},e}();n.Search=a});