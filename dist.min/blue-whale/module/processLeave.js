define("ProcessLeave",["require","exports","BasicPage","Button","Modal","TextInput","EditModule","BwRule"],function(t,e,a,s,r,l,u,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=BW.CONF,p=G.d,n=function(a){function o(t){var e=a.call(this,t)||this;return e.para=t,e.but={},e.container=t.dom,e.getLeaveData(),e}return __extends(o,a),o.prototype.initPage=function(){var t,e,a,n=this.resultData.body.elements[0],i="",s="";for(t=0;t<n.fields.length;t++)i+='<li class="list-group-item col-xs-12 col-md-3 col-sm-4 col-lg-4" data-href="" data-var-list="">\n                            <div class="list-left">\n                                <div>'+n.fields[t].caption+'<span class="colon">：</span></div>\n                            </div>\n                            <div data-col='+n.fields[t].name+' class="list-right ellipsis-row3 fold">                  \n                            </div>\n                            </li>';for(e='<div class="expense-footer" style="border: 1px solid #ddd;">\n                                     <ul class="list-group full-height has-footer row" style="border: 1px solid #ddd;">\n                                        '+i+"\n                                     </ul>\n                           </div>",t=0;t<n.subButtons.length;t++)s+='<div data-name = "'+o.butName[n.subButtons[t].title]+'" data-caption="'+n.subButtons[t].caption+'" class="but'+t+'"></div>';a='<div class="detailPage">\n                    '+('<div class="expense-header">\n                                   '+s+"\n                                    <h1>"+this.resultData.caption+'</h1>\n                                    <p>\n                                        <span style="margin-left: 15px;">申请人:<a>'+n.createUserName+"("+n.createUser+")/"+n.createUserPhone+'</a></span>\n                                        <span style="float: right; margin-right: 15px;">表单号: '+n.formNo+" &nbsp;&nbsp;申请日期:"+n.createTime+" </span>\n                                    </p>\n                             </div>")+" \n                    <div class=\"auditMemo\" data-name = 'auditMemo'></div>\n                    "+e+"           \n                </div>",this.container.innerHTML=a,this.replaceType()},o.prototype.replaceType=function(){var e=this,a=this,n=[],i=0;p.queryAll("[data-name]",this.container).forEach(function(t){switch(t.dataset.name){case"saveButton":e.but.saveButton=new s.Button({container:t,content:"保存",type:"primary",onClick:function(t){a.butAction(this.parentElement.dataset.caption)}});break;case"subButton":e.but.subButton=new s.Button({container:t,content:"提交",type:"primary",onClick:function(t){a.butAction(this.parentElement.dataset.caption)}});break;case"backButton":e.but.backButton=new s.Button({container:t,content:"退回",type:"primary",onClick:function(t){a.butAction(this.parentElement.dataset.caption)}});break;case"passButton":e.but.passButton=new s.Button({container:t,content:"通过",type:"primary",onClick:function(t){a.butAction(this.parentElement.dataset.caption)}});break;case"auditMemo":a.auditMemo=new l.TextInput({container:t,placeholder:"请输入操作备注"})}}),p.queryAll("[data-col]",p.query(".expense-footer",this.container)).forEach(function(t){n.push({dom:t,field:e.resultData.body.elements[0].fields[i]}),i++}),new u.EditModule({fields:n}).set(this.detailData.data[0])},o.prototype.dealResData=function(t){for(var e=t.body.elements[0],a=t.uiType,n=e.fields,i=0,s=0,o=void 0;s<n.length;s++)(o=n[s]).noShow&&o.noShow||(o.valueLists=o.atrrs.valueLists,o.noSum=o.atrrs.noSum,o.dataType=o.atrrs.dataType,o.displayFormat=o.atrrs.displayFormat,o.trueExpr=o.atrrs.trueExpr,o.displayWidth=o.atrrs.displayWidth,"drill"==a?i=1:"web"==a||"webdrill"==a?i=1:s<2&&o.name==e.nameField&&(i+=1),"lookup"==o.elementType?o.comType="selectInput":"treepick"==o.elementType||"pick"==o.elementType?(o.comType="tagsInput",o.multiValue=o.atrrs.multValue):o.assignAddr?o.comType="assignText":"43"==o.atrrs.dataType?o.comType="file":"30"==o.atrrs.dataType?o.comType="richText":"17"==o.atrrs.dataType?o.comType="toggle":"12"==o.atrrs.dataType?o.comType="datetime":o.comType="input");e.fixedNum=0<i?i:1,e.pageLen=0==e.multPage?0:20},o.prototype.butAction=function(t){for(var e,a=this.resultData.body.elements[0].subButtons,n={},i=0;i<a.length;i++)if(a[i].caption===t){e=a[i];break}p.queryAll("[data-col]",p.query(".expense-footer",this.container)).forEach(function(t){var e=t.dataset.col,a=p.query("input",t).value;n[e]=a});var s=d.BwRule.reqAddr(e.actionAddr,n);d.BwRule.Ajax.fetch(c.siteUrl+s,{data:"提交"===e.caption||"保存"===e.caption?null:{audit_memo:this.auditMemo.get()}}).then(function(t){var e=t.response;r.Modal.alert(e.msg)})},o.prototype.getLeaveData=function(){var a=this;this.dealResData(this.para.ui),this.resultData=this.para.ui;d.BwRule.Ajax.fetch(c.siteUrl+a.resultData.body.elements[0].dataAddr.dataAddr).then(function(t){var e=t.response;a.detailData=e,a.initPage()})},o.butName={"提交":"subButton","保存":"saveButton","退回":"backButton","通过":"passButton"},o}(a.default);e.ProcessLeave=n});