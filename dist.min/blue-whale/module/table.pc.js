define("BasicTable",["require","exports","CheckBox"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var E=G.tools,R=G.d,o=function(){function e(e){var C,l,t,p,h,n,o,a,i,r,s,c,d,u,f,b,m,v,g,y,w=this;this.tbodyLength=0,this.startIndex=0,this.trSelected=[],this.draging=!1,this.styleList={},this.styleListReady=!1,this.theadHeight=0,this.cellHeight=30,this.lockCol={table:null,Container:null},this.lockRow={table:null,fixed:null,Container:null,ContainInner:null,fixedContainer:null,fixedTable:null},this.indexCol={width:0,show:!0,col:null},this.pseudoCol={width:30,show:!0,Container:null,fixedCol:null,confList:[]},this.colResize={dragging:!1,column:null,resizeProxy:null},this.move={col:null,hoverCol:null,hoverRow:null,moving:!1,timeout:null},this.colHide={ready:!1,status:{}},this.treegrid={data:[]},this.movingColumn=null,this.movingHoverColumn=null,this.movingHoverRow=null,this.moving=!1,this.dragSelect={selected:{}},this.dragRows={selected:{}},this.dragControl={dragging:!1},this.expand={toggler:{},Container:null},this.tableStatus=!0,this.treegridFunc=function(u){var f={hitInfo:function(e){return{hit:R.query(".tree-hit",e),icon:u.conf.treegrid.icon}},iconOpen:function(e){var t=this.hitInfo(e);t.hit.classList.remove(c(!1)),t.hit.classList.add(c(!0)),t.hit.classList.remove(c("loading"))},iconClose:function(e){var t=this.hitInfo(e);t.hit.classList.remove(c(!0)),t.hit.classList.add(c(!1)),t.hit.classList.remove(c("loading"))},iconLoading:function(e){var t=this.hitInfo(e);t.hit.classList.remove(c(!1)),t.hit.classList.add(c("loading"))},sysOpen:function(e){var t=h.getRootIndex(e);if(null!=t){var n,o=R.query('tr[data-index="'+t+'"]',u.table),a=R.query('tr[data-index="'+(t+1)+'"]',u.table),i=o.offsetTop;n=(a?a.offsetTop:u.table.offsetHeight)-i,u.sysColOpen(t,n)}},sysClose:function(e){if(/^\d+$/.test(e)){var t=h.getRootIndex(e);null!=t&&u.sysColClose(t)}else this.sysOpen(e)}},p={getNodeIndex:function(e){return function e(t,n){if(1===t.length)return n[t[0]];var o=t.shift();return n[o]&&n[o].children?e(t,n[o].children):null}(e.split("-"),u.treegrid.data)},addNodes:function(e,t,n){var o=[];t.forEach(function(e){o.push({data:e,level:n,open:!1})}),e.children=o},init:function(e){u.treegrid.data=[],e.forEach(function(e,t){u.treegrid.data[t]={open:!1,level:0,data:e}})}},h={addChilds:function(a,e){var t,i,n=R.query('tr[data-index="'+a+'"]',u.table),l=n.nextSibling?n.nextSibling:null;0<u.conf.lockColNum&&(t=R.query('tr[data-index="'+a+'"]',u.lockCol.table),i=t.nextSibling?t.nextSibling:null),e.forEach(function(e,t){var n=u.rowCreate(e,a+"-"+t);if(l?u.table.tBodies[0].insertBefore(n,l):u.table.tBodies[0].appendChild(n),0<u.conf.lockColNum){var o=u.lock.rowCreate(n);i?u.lockCol.table.tBodies[0].insertBefore(o,i):u.lockCol.table.tBodies[0].appendChild(o)}})},getRootIndex:function(e){var t,n=e.indexOf("-");return t=~n?e.substring(0,n):e,parseInt(t)},getParentIndex:function(e){var t=e.toString().lastIndexOf("-");return~t?e.substring(0,t):e},getNextIndex:function(e){var t,n=e.toString().match(/(.*)-(\d+)/);n?t=n[1]+"-"+(parseInt(n[2])+1):t=parseInt(e)+1;if(R.query('tr[data-index="'+t+'"]',u.table))return t;if(n){var o=this.getParentIndex(t);return this.getNextIndex(o)}return""},hideChilds:function(e,t){if(void 0===t&&(t=!1),e)for(var n=R.query('tr[data-index="'+e+'"]',u.table),o=this.getNextIndex(e),a=n;a=t?a.nextSibling:n.nextSibling;){var i=a.dataset.index;if(i===o.toString())break;if(t){if(a.style.display="none",0<u.conf.lockColNum)(l=R.query('tr[data-index="'+i+'"]',u.lockCol.table)).style.display="none"}else if(R.remove(a),0<u.conf.lockColNum){var l=R.query('tr[data-index="'+i+'"]',u.lockCol.table);R.remove(l)}}}};function e(e){var t,n,o,a,i,l,r,s=u.getEvent(e),c=R.closest(s.target,"tr").dataset.index;if(c){var d=R.closest(s.target,"td");p.getNodeIndex(c).open?(a=d,i=c,l=p.getNodeIndex(i),r=u.conf.treegrid.cache,l.open=!1,f.iconClose(a),h.hideChilds(i,r),f.sysClose(i)):(t=d,n=c,o=p.getNodeIndex(n),f.iconLoading(t),u.conf.treegrid.render(o,n,function(e){o.open=!0,e&&0<e.length&&(p.addNodes(o,e,o.level+1),h.addChilds(n,e),f.sysOpen(n)),f.iconOpen(t)}))}}function c(e){var t;switch(e){case!1:t=u.conf.treegrid.icon[0];break;case!0:t=u.conf.treegrid.icon[1];break;case"loading":t="shuaxin1"}return"icon-"+t}function n(e,t){if(u.conf.treegrid.enabled&&t&&"TD"===t.tagName){var n=p.getNodeIndex(e.toString());if(n){for(var o="",a=parseInt(n.level),i=t.innerHTML,l=c(n.open),r="",s=0;s<a;s++)o+='<span class="tree-indent"></span>';r=u.conf.treegrid.expand(n,e)?'<i class="tree-hit iconfont '+l+'"></i>':'<i class="tree-hit-blank"></i>',t.innerHTML='<div class="treegrid">'+o+r+'<span class="tree-title">'+i+"</span></div>"}}}function t(e){if(u.conf.treegrid.enabled&&R.query(".treegrid",e)){var t=R.query(".tree-title");e.innerHTML=t.innerHTML}}function o(e){void 0===e&&(e=u.tableData),p.init(e)}return{init:function(){o(),R.on(u.tableContainer,u.mousedownName,".treegrid",e)},addBtn:n,add:function(e){u.conf.treegrid.enabled&&(e[1]&&R.query(".treegrid",e[1])||e.forEach(function(e,t){n(t,e)}))},removeBtn:t,remove:function(e){u.conf.treegrid.enabled&&e[1]&&R.query(".treegrid",e[1])&&e.forEach(function(e){t(e)})},update:o,exchangeTd:function(e,t){if(u.conf.treegrid.enabled&&t&&"TD"===t.tagName){var n=t.innerHTML;t.innerHTML=e.innerHTML,e.innerHTML=t.querySelector(".tree-title").innerHTML,t.querySelector(".tree-title").innerHTML=n}}}}(this),this.expandFunc=function(p){var i="icon-arrow-right",l="icon-arrow-down",t="icon-shuaxin1",c={show:function(e){e.classList.remove(i),e.classList.add(l),e.dataset.status="1"},hide:function(e,t,n){var o,a=u(t);a&&(o=f(t),a.style.display="none",o.forEach(function(e){e.style.display="none"}),n.classList.add(i),n.classList.remove(l),n.dataset.status="0",p.sysColClose(t),c.ContainerUpdate())},loading:function(e){e.classList.remove(i,l),e.classList.add(t)},unloading:function(e){e.classList.remove(t),e.classList.add(l)},ContainerUpdate:function(){R.queryAll(".tableExpandContainer").forEach(function(e){var t=e.dataset.expandIndex,n=R.query('tr[data-index="'+t+'"]',p.table),o=E.offset.top(n)+n.offsetHeight-E.offset.top(p.tableContainer);e.style.top=o+"px"})}};function d(e,t,n){void 0===n&&(n=p.table);var o=p.rowGet(e+1,n);o?n.tBodies[0].insertBefore(t,o):n.tBodies[0].appendChild(t)}function u(e){return R.query('div[data-expand-index="'+e+'"]',p.tableContainer)}function f(e){return R.queryAll('tr[data-expand-index="'+e+'"]',p.tableContainer)}function h(e,t,n){var o,a,i=f(t),l=u(t);if(0<i.length)i.forEach(function(e){e.style.display="table-row"}),l.style.display="block";else{var r=document.createElement("tr");if(r.setAttribute("data-expand-index",t),d(t,r),l=R.create('<div class="tableExpandContainer" data-expand-index="'+t+'"></div>'),p.tableContainer.appendChild(l),i.push(r),0<p.conf.lockColNum){var s=r.cloneNode(!0);d(t,s,p.lockCol.table),i.push(s)}}l.innerHTML=n,p.expand.toggler[t]=n,a=(o=l.offsetHeight)+p.cellHeight,i.forEach(function(e){e.style.height=o+"px"}),p.sysColOpen(t,a),c.ContainerUpdate()}function b(e,t,n){var o,a,i,l,r,s;o=t,a=n,i=function(){c.show(n)},r=p.conf.expand,s=p.tableData[o],r.cache&&(l=p.expand.toggler[o]),void 0===l?r.render?(c.loading(a),r.render(s,o,function(e,t){if(e||(e=s),"object"==typeof e){var n=function(e,t){void 0===t&&(t="dl");var n="null";switch(t){case"dl":n=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push('<dl class="tableExpandDl"><dt>'+n+"</dt><dd>"+e[n]+"</dd></dl>");return t.join("")}(e)}return n}(e,t);h(0,o,n)}else h(0,o,e);i(),c.unloading(a)})):h(0,o,"error"):(h(0,o,l),i())}function m(e,t,n){c.hide(e,t,n)}function e(e,t){var n,o,a,i,l,r,s,c,d,u=p.getEvent(t),f=R.closest(u.target,".pseudoCol");if(f)switch(n=f.dataset.pseudo,e=parseInt(e),p.conf.expand.mode){case"toggler":r=n,s=e,(d=(c=u).target.dataset.status)&&("0"===d?b(0,s,c.target):m(r,s,c.target));break;case"accordion":o=n,a=e,l=(i=u).target.dataset.status,R.queryAll('.pseudoCol[data-pseudo="'+o+'"] [data-status="1"]',p.pseudoCol.Container).forEach(function(e){var t=R.closest(e,".pseudoCol-item"),n=parseInt(t.dataset.index);n!=a&&t&&m(o,n,R.query(".tableExpand",t))}),l&&("0"===l?b(0,a,i.target):m(o,a,i.target))}}return{init:function(){var t;t=p.conf.expand,p.pseudoColFun.init({render:function(e){return'<i class="iconfont tableExpand icon-'+t.icon[0]+'" data-status="0"></i>'},click:e})}}}(this),this.moveEvent=(C=this,{col:function(){R.on(C.tableContainer,C.mousedownName,"th",function(e){var t,n,l,r,o,a=this,i=e.target,s=document.body.scrollWidth,c=null,d=null,u=!1,f=!1,p=0,h=0;if(1===e.which){var b=function(){R.queryAll(".col-disabled",a.tableWrapper).forEach(function(e){e.classList.remove("col-disabled")}),y(),R.remove(C.movingHoverColumn),R.off(document,C.mousemoveName,w),R.off(document,C.mouseupName,b),document.onselectstart=null,document.ondragstart=null,C.movingColumn=null,C.moving=!1,d=c=null,C.unlockScreen(),C.conf.colGroup&&C.colGroup.on()};C.conf.Container?(p=E.offset.left(C.conf.Container),h=p+C.conf.Container.offsetWidth):(p=E.offset.left(C.tableWrapper),h=p+C.tableWrapper.offsetWidth),C.movingHoverColumn=R.query(".tableMovingContainer")||R.create('<div class="tableMovingContainer"></div>'),C.lockScreen(),document.onselectstart=function(){return!1},document.ondragstart=function(){return!1},C.timeOut=setTimeout(function(){if(!C.colResize.dragging){for(;i&&"TH"!==i.tagName;)i=i.parentNode;var o,a;C.movingColumn=i,C.movingColumn&&(d=m(),n=C.colName2index(C.movingColumn.dataset.col),C.colGet(n,C.table).forEach(function(e){e.classList.add("col-disabled")}),0<C.conf.lockColNum&&C.colGet(n,C.lockCol.table).forEach(function(e){e.classList.add("col-disabled")}),C.conf.lockRow&&C.colGet(n,C.lockRow.table).forEach(function(e){e.classList.add("col-disabled")}),0<C.conf.lockColNum&&C.conf.lockRow&&C.colGet(n,C.lockRow.fixedTable).forEach(function(e){e.classList.add("col-disabled")}),o=C.table.tHead.cloneNode(),a=C.table.tBodies.item(0).cloneNode(),(t=C.table.cloneNode()).removeAttribute("id"),t.classList.remove("hideLock"),t.appendChild(o),t.appendChild(a),C.movingHoverColumn.appendChild(t),C.tableWrapper.appendChild(C.movingHoverColumn),C.colGet(n,C.table).forEach(function(e){var t=document.createElement("tr"),n=e.cloneNode(!0);n.classList.remove("col-disabled"),t.appendChild(n),"TH"===e.tagName?o.appendChild(t):"TD"===e.tagName&&a.appendChild(t),c||((c={}).left=E.offset.left(e),c.right=c.left+e.offsetWidth,c.width=e.offsetWidth),C.movingHoverColumn.setAttribute("data-index",C.colName2index(e.dataset.col)+"")}),C.moving=!0,R.on(document,C.mousemoveName,w),R.on(document,C.mouseupName,b))}},300)}function m(){var n={locktable:[],table:[]};return 0<C.conf.lockColNum&&R.queryAll("th",C.lockCol.table.tHead).forEach(function(e){var t=e.getBoundingClientRect();n.locktable.push([t.left,t.right])}),R.queryAll("th",C.table.tHead).forEach(function(e){var t=e.getBoundingClientRect();n.table.push([t.left,t.right])}),n}function v(){var e=C.tableMiddle.scrollLeft;C.tableMiddle.scrollLeft=0<e?e-5:0,y(),o=setTimeout(v)}function g(){C.tableMiddle.scrollLeft+=5,y(),o=setTimeout(g)}function y(){o&&clearTimeout(o)}function w(e){var t;e.preventDefault(),e=C.getEvent(e),clearTimeout(C.move.timeout),(t=e).clientX<p?v():t.clientX>h?g():y();var n,o=e.clientX-10-p,a=parseInt(C.movingHoverColumn.dataset.index),i=s-c.width-10;e.clientX>i&&(o=i),n=function(e,t){var n=0,o=null;if(e>t.left&&e<t.right||!d||e<d.table[0][0]||e>d.table[d.table.length-1][1]||s<e)return null;for(var a=0,i=d.locktable.length;a<i;a++)if(n=d.locktable[a][1],e>d.locktable[a][0]&&e<d.locktable[a][1])return o=a;if(null===o){for(a=o=0,i=d.table.length;a<i;a++)if(d.table[a][1]>n&&e>d.table[a][0]&&e<d.table[a][1])return o=a;if(0===o)return null}return o}(e.clientX,c),C.movingHoverColumn.style.top="0px",C.movingHoverColumn.style.left=o+"px",!u&&(C.movingHoverColumn.style.display="block"),u=!0,null===a||null===n||l===n&&f||(l=a,f=!0,r&&clearTimeout(r),r=setTimeout(function(){f=!1},1e3),C.colInsertTo(a,n),C.movingHoverColumn.dataset.index=n,d=m(),(c={left:d.table[n][0],right:d.table[n][1]}).width=c.right-c.left)}}),R.on(C.tableContainer,C.mouseupName,"th",function(){document.onselectstart=null,document.ondragstart=null,C.timeOut&&clearTimeout(C.timeOut)})},row:function(){var r,s,c,d,u,f,p=0,h=0,b=0,m=0,v=function(){var e,t=parseInt(C.trMoveSelected.dataset.index);C.trMoveSelected.classList.add("col-disabled"),(e=C.rowGet(t,C.lockCol.table))&&e.classList.add("col-disabled"),(e=C.rowGet(t,C.lockRow.fixedTable))&&e.classList.add("col-disabled"),(e=C.rowGet(t,C.lockRow.table))&&e.classList.add("col-disabled")};R.on(C.tableWrapper,C.mousedownName,"div.indexCol-item",function(){var a=this;function i(e){var t,n=(e=C.getEvent(e)).pageY-d-15,o=C.movingHoverRow.dataset.index;m=0,clearTimeout(C.move.timeout),C.conf.Container&&(n+=m=C.conf.Container.scrollTop),e.pageY>p-m&&(n=p-d-m),e.pageY<b-m&&(n=b-d-m),t=function(e,t){var n=0,o=null,a=C.conf.colGroup?-1:0;if(t){if(e>t.top&&e<t.bottom||!c||e<c.table[0][0]||e>c.table[c.table.length-1][1]||f<e)return null;for(var i=0,l=c.locktable.length;i<l;i++)if(n=c.locktable[i][1],e>c.locktable[i][0]&&e<c.locktable[i][1])return(o=i)+a;if(null===o){for(i=o=0,l=c.table.length;i<l;i++)if(c.table[i][1]>n&&e>c.table[i][0]&&e<c.table[i][1])return(o=i)+a;if(0===o)return null}return o+a}}(e.pageY+m,s),C.movingHoverRow.style.left=h-u+"px",C.movingHoverRow.style.top=n+"px",C.movingHoverRow.style.display="block",null!==t&&(C.rowInsertTo(parseInt(o),t),C.movingHoverRow.dataset.index=t,s={top:c.table[t][0],bottom:c.table[t][1]})}function l(){C.unlockScreen(),R.queryAll(".col-disabled",C.tableWrapper).forEach(function(e){e.classList.remove("col-disabled")}),R.remove(C.movingHoverRow),R.off(document,C.mousemoveName,i),R.off(document,C.mouseupName,l),document.onselectstart=null,document.ondragstart=null,C.trMoveSelected=null,c=s=null,setTimeout(function(){C.moving=!1},10)}b=C.table.tHead.getBoundingClientRect().bottom,C.conf.colGroup&&(b+=30),C.conf.Container?(d=E.offset.top(C.conf.Container),b-=m):d=E.offset.top(C.tableContainer),C.lockScreen(),u=E.offset.left(C.tableContainer),C.movingHoverRow=document.querySelector(".tableMovingContainer")||R.create('<div class="tableMovingContainer"></div>'),document.onselectstart=function(){return!1},document.ondragstart=function(){return!1},C.timeOut=setTimeout(function(){var o,e,t,n=a.dataset.index?parseInt(a.dataset.index):-1;C.trMoveSelected=C.rowGet(n),f=document.body.scrollHeight,o={locktable:[],table:[]},R.queryAll("tr",C.table.tBodies.item(0)).forEach(function(e){var t=E.offset.top(e),n=E.offset.left(e);o.table.push([t,t+e.offsetHeight]),p=t+m,h=n}),c=o,v(),e=C.trMoveSelected.cloneNode(!0),(t=C.table.tBodies.item(0).cloneNode()).appendChild(e),(r=C.table.cloneNode()).removeAttribute("id"),r.classList.remove("hideLock"),r.appendChild(t),C.movingHoverRow.appendChild(r),C.tableContainer.appendChild(C.movingHoverRow),s||(s={top:E.offset.top(C.trMoveSelected),bottom:C.trMoveSelected.offsetHeight}),C.movingHoverRow.setAttribute("data-index",e.dataset.index),C.moving=!0,R.on(document,C.mousemoveName,i),R.on(document,C.mouseupName,l)},300)}),R.on(C.tableWrapper,C.mouseupName,"div.indexCol-item",function(){document.onselectstart=null,document.ondragstart=null,C.timeOut&&clearTimeout(C.timeOut)})}}),this.unlockScreen=function(){var e=this.conf.Container,t=document.body;e&&(e.style.overflowY="auto"),this.tableMiddle.style.overflowX="auto",this.tableMiddle.style.width="",t.style.overflow="",t.style.height=""},this.indexColFun=(t=null,{render:function(e,t,n){var o=e;n&&(l.indexCol.col.innerHTML="",e=0);var a="select"===l.conf.indexCol?function(){return M(l.ssid)}:null,i=l.createSysCol({Container:l.indexCol.col,offset:o,len:t,start:e,colType:"index",childNode:a});null!==l.table.tBodies.item(0).firstElementChild&&(l.indexCol.show=!0),l.indexCol.col.appendChild(i)},refreshIndex:function(){R.queryAll("div:not(.hide)",l.indexCol.col).forEach(function(e,t){e.innerHTML=0===t?"":t.toString()})},init:function(){function a(e,t){var n=R.query(".select-box input",e);n&&(n.checked=t)}l.indexCol.col=R.create('<div class="indexCol"></div>'),l.tableWrapper.appendChild(l.indexCol.col),l.tableWrapper.classList.add("hasIndexCol"),l.indexCol.width=l.indexCol.col.getBoundingClientRect().width,R.on(l.tableWrapper,l.eventClickName,"div.indexCol > div",function(){var e=this.dataset.index?parseInt(this.dataset.index):-1,t=l.rowGetAll();if(-1===e&&l.conf.indexColMulti){var n=t.length===l.trSelected.length;return"select"===l.conf.indexCol&&a(this,!n),t.forEach(function(e){n?l.rowDeselect(e):l.rowSelect(e,!0)}),void(this.innerHTML=n?"全选":"取消")}var o=l.rowGet(e);l.conf.indexColMulti?l.rowToggle(o):l.trSelected[0]===o?l.rowDeselect(o):l.rowSelect(o),a(l.indexCol.col.firstChild,t.length===l.trSelected.length)}),"select"===l.conf.indexCol&&l.on("rowSelect",function(e){var t=e.detail;setTimeout(function(){t.indexes.forEach(function(e){a(R.query('div[data-index="'+e+'"]',l.indexCol.col),t.select)})},10)})},show:function(e){l.indexCol.col&&(l.indexCol.show=e,l.indexCol.col.classList[e?"remove":"add"]("hide"),l.tableWrapper.classList[e?"add":"remove"]("hasIndexCol"),l.pseudoColFun.resize(),l.resize())},fixedRender:function(){var e=R.create("<div>全选</div>");t||(t=l.indexCol.col.cloneNode()),t.innerHTML="",t.appendChild(e),l.lockRow.fixed.querySelector(".Container").appendChild(t)},divGet:(l=this).indexColDivGet}),this.pseudoColFun=function(r){function n(){var e=0,t=0;return r.indexCol.show&&r.indexCol.col&&(e=r.indexCol.col.offsetWidth),r.pseudoCol.show&&r.pseudoCol.Container&&(t=r.pseudoCol.Container.offsetWidth),{indexWidth:e,pseudoWidth:t,tableLeft:e+t}}function s(){var e=n();if(r.tableContainer.style.left=0===e.tableLeft?"":e.tableLeft+"px",r.tableContainer.style.width=0===e.tableLeft?"":"calc(100% - "+e.tableLeft+"px)",r.pseudoCol.Container&&(r.pseudoCol.Container.style.left=e.indexWidth+"px"),r.lockRow.fixedTable&&r.lockRow.Container){var t=R.query(".pseudoContainer",r.lockRow.Container);t&&(t.style.left=e.indexWidth+"px")}r.lockRow.Container&&(r.lockRow.Container.style.width=r.tableContainer.offsetWidth-e.tableLeft+"px")}return{init:function(e){var t=r.conf;!e&&(e=t.pseudoCol),e.width||(e.width=r.pseudoCol.width),e.index=r.pseudoCol.confList.length,r.pseudoCol.confList.push(e),r.pseudoCol.Container||(r.pseudoCol.Container=R.create('<div class="pseudoContainer"></div>'),r.tableWrapper.appendChild(r.pseudoCol.Container),r.tableWrapper.classList.add("hasPseudoCol"),R.on(r.tableWrapper,r.mousedownName,"div.pseudoCol-item",function(e){var t=r.getEvent(e),n=parseInt(R.closest(t.target,".pseudoCol").dataset.pseudo),o=r.pseudoCol.confList[n].click;o&&o(this.dataset.index,e)})),e.col=R.create('<div class="pseudoCol" data-pseudo="'+e.index+'"></div>'),e.col.style.width=e.width+"px",r.pseudoCol.Container.appendChild(e.col),s(),this.fixedRender(),r.theadSizeSync()},fixedRender:function(){if(r.lockRow.fixed){var e=r.pseudoCol.confList.length;r.pseudoCol.fixedCol||(r.pseudoCol.fixedCol=r.pseudoCol.Container.cloneNode(),r.lockRow.fixed.querySelector(".Container").appendChild(r.pseudoCol.fixedCol)),r.pseudoCol.fixedCol.innerHTML="";for(var t=0;t<e;t++){var n=R.create('<div class="pseudoCol"><div></div></div>');r.pseudoCol.fixedCol.appendChild(n)}}},width:n,render:function(o,a,i){var l=o;r.pseudoCol.confList.forEach(function(e){var t=e.render;i&&(e.col.innerHTML="",l=0);var n=r.createSysCol({Container:e.col,offset:l,len:a,start:o,colType:"pseudo",childNode:t});e.col.appendChild(n)}),s()},destroy:function(){R.remove(r.pseudoCol.fixedCol),r.pseudoCol.fixedCol=null},resize:s}}(this),this.menu=(h=(p=this).menuConfGet(),{row:(n=function(){var u=function(){},f=function(){};return{on:u,off:f,init:function(e,t){void 0===t&&(t=function(e){});var n="row"===e?h.rowConfGet():h.colConfGet();if(n.btns[0]){var o,a,i,l,r,s,c,d=(a=t,r=(o=n).identifier,s=o.btns,c=function(e){a(this),"eventHandle"in o&&o.eventHandle(this,e),i=o.targetGet(this),l=e.target,p.popMenuDom.dataset.identifier===r?p.popMenu.show(r):(p.popMenu.show(r,s,function(e,t){"function"==typeof e.callback&&e.callback(e,i,l)}),p.popMenuDom.dataset.identifier=r)},{on:function(){R.on(p.tableWrapper,p.menuEventName,o.targetSelector,c)},off:function(){R.off(p.tableWrapper,p.menuEventName,o.targetSelector,c)}});f=d.off,(u=d.on)()}}}})(),col:n(),popInit:function(){var l,r=null,s=[],c='data-action="tableMenuBtn"';p.popMenuDom=h.popDomGet(),r=h.listDomGet(p.popMenuDom),h.init();var e=function(){var e,t=parseInt(this.dataset.index),o=[];!function e(t){var n=t.parentElement.parentElement;n.classList.contains("listItem")&&(o.unshift(parseInt(n.dataset.index)),e(n))}(this),o.push(t),e=s[o[0]];for(var n=1;n<o.length;n++)e.children&&(e=e.children[o[n]]);this.classList.contains("disabled")||(l(e,this),h.hide())};R.on(r,p.eventClickName,"["+c+"]",e),p.popMenu={show:function(e,t,n){var o,a;void 0===t&&(t=null),void 0===n&&(n=null),Array.isArray(t)&&"function"==typeof n&&(o=t,a=h.btnHtmlGet(o),r.innerHTML=a,l=n,s=t);var i=p.trSelected[1];s.forEach(function(e,t){if(!e.multi){var n=r.querySelector("["+c+'][data-index="'+t+'"]');i?n.classList.add("disabled"):n.classList.remove("disabled")}}),h.show()},hide:function(){h.hide()}}}}),this.noData=(o=null,a=function(e){w.pseudoCol.show&&w.indexCol.col&&w.pseudoCol.Container&&(w.pseudoCol.Container.classList[e?"remove":"add"]("hide"),w.tableWrapper.classList[e?"add":"remove"]("hasPseudoCol"))},{isShow:function(){null===w.table.tBodies.item(0).firstElementChild?o||(o=R.create('<div class="nodata no-padding"><span class="iconfont icon-gongyongwushuju"></span></div>'),R.after(w.table,o),a(!1)):o&&(R.remove(o),a(!(o=null)))}}),this.colGroup=(i={},r={},s=[],c=function(e,t){if(Array.isArray(t)){var o=document.createElement("select");return t.sort(function(e,t){return t-e}),o.appendChild(R.create("<option></option>")),t.forEach(function(e){if(""!=e){var t=document.createElement("option"),n=document.createTextNode(e);t.appendChild(n),t.setAttribute("value",e),o.appendChild(t)}}),o.setAttribute("data-col",e),o}},{on:function(){var e=R.queryAll(".colGroup select",w.tableWrapper),n=w;function o(){var e=this.dataset.col,o=[];i[e]=this.value,s.forEach(function(e){var t=!0;for(var n in i)e[n]&&""!=i[n]&&e[n].toString()!=i[n]&&(t=!1);t&&o.push(E.obj.merge({},e))});var t=o.length;n.tableData=o,n.indexColFun.render(0,t,!0),n.pseudoColFun.render(0,t,!0),n.tbodyRender(n.tableData,!0)}e.forEach(function(e){var t=e.dataset.col;e.selectedIndex=-1,R.off(e,"change",o),R.on(e,"change",o),i&&t in i&&E.selVal(e,i[t])})},clear:function(){s=[],i={},r={}},rowCreate:function(e){var t,i,l;return t=e,s[0]||(t.forEach(function(e){for(var t in e)r[t]=r[t]||[],~r[t].indexOf(e[t])||r[t].push(e[t])}),s=t),i=r,(l=document.createElement("tr")).classList.add("colGroup"),w.conf.cols.forEach(function(e){var t=e.name;if(!w.colHide.ready||w.colHide.status[e.name]){t in i||(i[t]=null);var n=i[t],o=document.createElement("td"),a=c(t,n);o.dataset.col=t,o.classList.add("td-select",w.cellClass(t)),a&&o.appendChild(a),l.appendChild(o)}}),l}}),this.colSort=function(){var r=[],s={};function c(e){return e||0===e?e:"number"===typeof e?-1/0:""}return{sort:function(e,t){var n,o,a=w,i=s[t];a.tableData[0]&&(i=i&&"desc"===i?"asc":"desc",e?(s[t]=i,~r.indexOf(t)||r.push(t)):(o=".sort-desc,.sort-asc",R.queryAll(o,w.table).forEach(function(e){e.classList.remove("sort-desc","sort-asc")}),0<w.conf.lockColNum&&R.queryAll(o,w.lockCol.table).forEach(function(e){e.classList.remove("sort-desc","sort-asc")}),w.conf.lockRow&&R.queryAll(o,w.lockRow.table).forEach(function(e){e.classList.remove("sort-desc","sort-asc")}),E.keysVal(w.conf,"multi","enabled")||0<w.conf.lockColNum&&w.conf.lockRow&&w.lockRow.fixedTable&&R.queryAll(o,w.lockRow.fixedTable).forEach(function(e){e.classList.remove("sort-desc","sort-asc")}),(n={})[t]=i,s=n,r=[t]),function(e,t){var n,o,a=w,i=a.table.querySelector('th[data-col="'+e+'"]');if("desc"===t?(n="sort-desc",o="sort-asc"):(n="sort-asc",o="sort-desc"),i.classList.remove(o),i.classList.add(n),0<a.conf.lockColNum){var l=a.lockCol.table.querySelector('th[data-col="'+e+'"]');l&&(l.classList.remove(o),l.classList.add(n))}if(a.conf.lockRow){var r=a.lockRow.table.querySelector('th[data-col="'+e+'"]');r.classList.remove(o),r.classList.add(n)}if(!E.keysVal(w.conf,"multi","enabled")&&0<a.conf.lockColNum&&a.conf.lockRow){var s=a.lockRow.fixedTable.querySelector('th[data-col="'+e+'"]');s&&(s.classList.remove(o),s.classList.add(n))}}(t,i),1===a.conf.sort&&(a.tableData.sort(function(e,t){return function e(t,n,o){var a;void 0===o&&(o=0);var i=c(t[r[o]]),l=c(n[r[o]]);return i="--"===i?Number.NEGATIVE_INFINITY:i,0==(a=(l="--"===l?Number.NEGATIVE_INFINITY:l)<i?1:i===l?0:-1)&&o<r.length-1?e(t,n,++o):"desc"===s[r[o]]?-a:a}(e,t)}),a.render(w.startIndex,w.tbodyLength+w.startIndex,!0)))}}}(),this.theadSort=function(t){var e=null;function n(){null===e&&(e=function(e){this.classList.contains("disabled")||t.colResize.dragging||t.moving||t.colSort.sort(e.ctrlKey||e.shiftKey,this.dataset.col)}),R.on(t.tableWrapper,t.eventClickName,"th",e)}var o=function(){R.queryAll("tr th",t.table.tHead).forEach(function(e){e.classList.add("sort")}),n(),o=n};return{on:o,off:function(){e&&(R.off(t.tableWrapper,t.eventClickName,"th",e),e=null)}}}(this),this.lock=function(r){var s=null,c=null,d=null;function o(){s=r.table,c=s.cloneNode();var e=s.tHead.cloneNode(!0),t=e.querySelector("tr"),n=R.queryAll("th",t),o=R.queryAll("tr",s.tBodies.item(0)),a=n.length,i=r.conf.lockColNum;c.classList.add("mobileTableLock","hide"),c.removeAttribute("id");for(var l=0;l<a;l++)i<=l&&R.remove(n[l]);c.tHead?c.replaceChild(e,c.tHead):c.appendChild(e),c.appendChild(function(){for(var e=s.tBodies.item(0).cloneNode(),t=0,n=null;n=o[t];t++)e.appendChild(n.cloneNode());return e}()),null===d?(d=R.create('<div class="mobileTableLeftLock"></div>'),r.tableContainer.insertBefore(d,r.tableContainer.firstElementChild)):d.innerHTML="",d.appendChild(c),r.lockCol.table=c,r.lockCol.Container=d,s.dataset.lockNum=r.conf.lockColNum.toString()}function n(e){var t=e.cloneNode(!0);return R.queryAll("td",t).forEach(function(e,t){t>=r.conf.lockColNum&&R.remove(e)}),t}function a(e){var t=r.colInsertTo(e,r.conf.lockColNum,!0);r.colAdd(r.conf.lockColNum,t,c),r.conf.lockColNum++,r.theadSizeSync(),r.theadSizeCache(e)}function i(e){r.colInsertTo(e,r.conf.lockColNum-1,!0),r.colDel(e,c),r.lockRow.fixedTable&&r.colDel(e,r.lockRow.fixedTable),r.theadSizeSync(),r.theadSizeCache(e),r.conf.lockColNum--}return{init:o,render:function(e,t){s&&c&&(s.classList.remove("hideLock"),c.classList.add("hide"),t&&(c.tBodies.item(0).innerHTML=""),e.forEach(function(e){c.tBodies.item(0).appendChild(n(e))}),c&&c.classList.remove("hide"),s.classList.add("hideLock"))},rowCreate:n,rowGet:function(e){return c?c.querySelector('tr[data-index="'+e.dataset.index+'"]'):null},hide:function(){d.classList.add("hide"),s.dataset.lockNum="0"},show:function(){d.classList.remove("hide"),s.dataset.lockNum=r.conf.lockColNum+""},destroy:function(){R.remove(d),d=c=null,s.dataset.lockNum="0"},colToggle:function(e){var t=-1,n=-1;if(-1!==(t="string"==typeof e?r.colName2index(e):e))return null===c&&(o(),s.classList.add("hideLock"),c.classList.remove("hide")),t>r.conf.lockColNum-1?(a(t),n=1):(i(t),n=0),s.dataset.lockNum=r.conf.lockColNum.toString(),n},colLock:a,colUnlock:i}}(this),this.col=function(u){function t(e){return e in u.colHide.status&&u.colHide.status[e]}function n(e,t){!function(e,t){var n,o=p(e),a=f(e);t?(l=h(i=o),b(r=function(e){for(var t=0,n=u.conf.cols,o=0;o<=e;o++)u.colHide.status[n[o].name]&&t++;return t}(i),l),u.conf.lockRow&&b(r,l,u.lockRow.table)):(u.colDel(a),u.conf.lockRow&&u.colDel(a,u.lockRow.table));var i,l,r;0<(n=u.colGet(0))&&u.resize(!0);if(0<u.conf.lockColNum&&a<u.conf.lockColNum){if(0===n.length)return u.colDel(a,u.lockCol.table),u.lockRow.fixedTable&&u.colDel(a,u.lockRow.fixedTable);var s=u.lockCol.table.querySelectorAll("th").length;if(0!==s)return u.lockColReplace(a,u.colGet(a));for(var c=0;c<u.conf.lockColNum;c++){var d=h(o);b(a,d,u.lockCol.table),u.lockRow.fixedTable&&b(a,d,u.lockRow.fixedTable)}}u.theadSizeSync()}(e,t),u.colHide.status[e]=t}function f(e){l();for(var t=0,n=u.conf.cols,o=0,a=n.length;o<a;o++){var i=n[o].name;if(e===i)return t;u.colHide.status[i]&&t++}return-1}function p(e){for(var t=0,n=void 0;n=u.conf.cols[t];t++)if(n.name===e)return t;return-1}function l(){u.colHide.ready||(u.conf.cols.forEach(function(e){u.colHide.status[e.name]=!0}),u.colHide.ready=!0)}function h(e){var n=u.conf.cols[e],o=[];return o.push(u.col.theadCell(n)),u.tableData.forEach(function(e,t){o.push(function(e,t,n){var o="function"==typeof u.conf.textFormat?u.conf.textFormat:null,a={},i=o?o(e,t,n):e[t.name],l=document.createElement("td");for(var r in a["data-col"]=t.name,a.class=a.class?a.class+" "+u.cellClass(t.name):u.cellClass(t.name),a)a.hasOwnProperty(r)&&l.setAttribute(r,a[r]);return l.innerHTML=i,l}(e,n,t))}),o}function b(e,n,t){void 0===t&&(t=u.table);var o=u.colGet(0===e?0:e,t);o[0]?o.forEach(function(e,t){R.before(e,n[t].cloneNode(!0))}):R.queryAll("tr",t).forEach(function(e,t){e.appendChild(n[t].cloneNode(!0))})}u.colHide.ready=!1;return{show:function(e){l(),!1===t(e)&&n(e,!0)},hide:function(e){l(),!0===t(e)&&n(e,!1)},getIndex:p,getHideIndex:f,hideIndex2Index:function(e){for(var t=0,n=u.conf.cols,o=0,a=n.length;o<a;o++)if(u.colHide.status[n[o].name]){if(e===t)return o;t++}},theadCell:function(e){var t=u.cellClass(e.name),n={"data-col":e.name};return u.conf.sort&&(n.class="sort"),e.colspan&&(n.colspan=e.colspan,delete e.width,delete e.name),e.rowspan&&(n.rowspan=e.rowspan),e.name||(e.name=(new Date).getTime().toString()),!e.colspan&&e.width&&u.conf.colResize&&(u.styleList[t]=e.width),R.create("<th"+E.obj.toAttr(n)+">"+function(e,t,n){void 0===n&&(n=!0);var o=document.createElement("div");return n&&o.classList.add("td-content",u.cellClass(e)),o.innerHTML=E.str.toEmpty(t),o}(e.name,e.title,!e.colspan).outerHTML+"</th>","tr")},titleSet:function(e,t){R.queryAll('thead th[data-col="'+e+'"]').forEach(function(e){e.querySelector("div").innerText=t});for(var n=0,o=void 0;o=u.conf.cols[n];n++)if(o.name===e){o.title=t;break}u.resize(!0)}}}(this),this.tableStyle=(d=this,f="tableTempStyle",{add:function(n){var o="."+f+"-"+d.ssid;u||((u=document.createElement("style")).setAttribute("type","text/css"),d.tableContainer.classList.add(f+"-"+d.ssid),d.tableContainer.appendChild(u)),n.forEach(function(e,t){n[t]=o+" "+e,n[t]=n[t].replace(/,/g,","+o+" ")}),u.innerHTML=n.join("")},del:function(){R.remove(u),u=null}}),this.colResizeFun=function(m){function t(){m.resize(!0)}function n(e){var t,n=e.target;for(m.styleListReady||m.initStyleList(),R.queryAll("th",m.table.tHead).forEach(function(e){m.styleList[m.cellClass(e.dataset.name)]=e.offsetWidth});n&&"TH"!==n.tagName;)n=n.parentNode;12<(t=n.getBoundingClientRect()).width&&t.right-e.pageX<15&&!m.colResize.dragging?(n.style.cursor="col-resize",m.colResize.column=n,m.colResize.column=n):m.colResize.dragging||(n.style.cursor="",m.colResize.column=null)}function o(e){var l,r,s,t=m.tableMiddle.scrollLeft,c=m.table.getBoundingClientRect().left+t,n=function(e){var t=e.clientX-s.startMouseLeft,n=s.startLeft-s.tableLeft+t,o=r.left-c+m.conf.cellWidth,a=Math.max(o,n),i=a-(r.left-s.tableLeft);m.colResize.resizeProxy.style.left=a+"px",function(e,t,n){var o,a=0,i=m.cellClass(t.dataset.col);for(var l in m.styleList)m.styleList[l];if(m.table.offsetWidth===m.tableContainer.offsetWidth){var r=m.colName2index(t.dataset.col),s=m.table.tHead.querySelector("tr > *:nth-child("+(r+1)+")"),c=s.nextElementSibling,d=m.styleList[i],u=void 0;if(s.style.width=e+"px",s.offsetWidth>e&&(e=d),s.style.width="",c){var f,p=m.table.tHead.querySelector('tr th[data-col="'+c.dataset.col+'"]');o=c.dataset.col,f=m.cellClass(o),a=(u=m.styleList[f])+(d-e),p.style.width=a+"px",p.offsetWidth>a+1&&(a=u),p.style.width="",m.styleList[f]=a}}m.styleList[i]=e;for(var h=0,b=m.conf.cols.length;h<b;h++)m.conf.cols[h].name===t.dataset.col&&(m.conf.cols[h].width=e),o&&m.conf.cols[h].name===o&&(m.conf.cols[h].width=a)}(i,l),m.theadSizeSync()},o=function(e){m.colResize.resizeProxy.style.display="none",R.off(document,m.mousemoveName,n),R.off(document,m.mouseupName,o),R.queryAll("th",m.table.tHead).forEach(function(e,t){e.style.cursor=""}),document.onselectstart=null,document.ondragstart=null,s=null,setTimeout(function(){m.colResize.dragging=!1},10)};m.colResize.column&&(m.colResize.dragging=!0,document.onselectstart=function(){return!1},document.ondragstart=function(){return!1},l=m.colResize.column,r=l.getBoundingClientRect(),s={startMouseLeft:e.clientX,startLeft:r.right,startColumnLeft:r.left,tableLeft:c},m.colResize.resizeProxy.style.display="block",m.colResize.resizeProxy.style.left=s.startLeft-s.tableLeft+"px",R.on(document,m.mousemoveName,n),R.on(document,m.mouseupName,o))}return{init:function(){var e=document.createElement("div");e.classList.add("resize-proxy"),m.tableContainer.appendChild(e),m.colResize.resizeProxy=e,R.on(m.tableContainer,m.mousedownName,"th",o),R.on(m.tableContainer,m.mousemoveName,"th",n),R.on(window,"resize",t)},off:function(){R.off(window,"resize",t)}}}(this),this.theadLock=function(l){var e,t,n=null,o=null,r=!1,s=null;function a(){if(l.lockRow.Container){var e=l.lockRow.Container.style,t=E.offset.top(l.tableWrapper),n=l.scrollTop()+E.offset.top(l.conf.Container),o=n+l.theadHeight+l.conf.lockRowTop,a=l.tableWrapper.offsetHeight+t;if(t<n?(e.position="fixed",e.width=l.tableContainer.offsetWidth+"px",l.conf.Container?0<s.lockRowTop?e.top=s.lockRowTop+"px":e.top="initial":e.top=s.lockRowTop+"px",l.indexCol.col||l.pseudoCol.Container||(e.overflow="hidden"),e.left=E.offset.left(l.table)+"px"):(e.position="absolute",e.top="",e.left="0px"),a<o){var i=l.theadHeight-(o-a);i=i<0?0:i,l.lockRow.fixedContainer&&(l.lockRow.fixedContainer.style.height=i+1+"px"),l.lockRow.ContainInner.style.height=i+"px",r=!0}else r&&(l.lockRow.fixedContainer&&(l.lockRow.fixedContainer.style.height=l.theadHeight+1+"px"),l.lockRow.ContainInner.style.height=l.theadHeight+"px",r=!1)}}function i(){l.lockRow.ContainInner.scrollLeft=l.tableMiddle.scrollLeft}function c(){n=l.table,s=l.conf,(o=n.cloneNode()).removeAttribute("id"),e=n.tHead.cloneNode(!0),t=n.tBodies.item(0).cloneNode(),o.classList.add("mobileTableRowLock"),o.classList.remove("hideLock"),o.tHead?o.replaceChild(e,o.tHead):o.appendChild(e),o.tBodies.item(0)?o.replaceChild(t,o.tBodies.item(0)):o.appendChild(t),null===l.lockRow.Container&&(l.lockRow.Container=R.create('<div class="mobileTableTopLock"></div>'),l.lockRow.ContainInner=R.create('<div class="mobileTableTopLock-inner"></div>'),l.lockRow.Container.appendChild(l.lockRow.ContainInner)),l.lockRow.ContainInner.appendChild(o),l.tableContainer.insertBefore(l.lockRow.Container,l.tableContainer.firstElementChild),l.lockRow.table=o,R.on(window,"scroll",a),l.conf.Container&&R.on(l.conf.Container,"scroll",a),R.on(l.tableMiddle,"scroll",i)}function d(){l.lockCol.table&&(l.lockRow.fixedTable&&R.remove(l.lockRow.fixedTable),l.lockRow&&l.lockRow.fixedContainer&&(l.lockRow.fixedTable=l.lockCol.table.cloneNode(!0),l.lockRow.fixedTable.removeAttribute("id"),l.lockRow.fixedContainer.appendChild(l.lockRow.fixedTable),l.lockRow.fixedTable.tBodies.item(0).innerHTML=""))}function u(){n&&(!l.lockRow.fixed&&l.lockRow.Container&&(l.lockRow.fixedContainer=R.create('<div class="Container"></div>'),l.lockRow.fixed=R.create('<div class="mobileTableTopFixedLock"></div>'),l.lockRow.fixed.appendChild(l.lockRow.fixedContainer),l.lockRow.Container.insertBefore(l.lockRow.fixed,l.lockRow.Container.firstElementChild),d(),l.indexCol.col&&l.indexColFun.fixedRender(),l.pseudoCol.Container&&l.pseudoColFun.fixedRender(),l.theadSizeSync()),l.lockRow.fixedContainer.style.height=e.offsetHeight+1+"px")}function f(){c(),u()}function p(){h()}function h(){R.off(window,"scroll",a),l.pseudoColFun.destroy(),l.conf.Container&&R.off(l.conf.Container,"scroll",a),R.off(l.tableMiddle,"scroll",i),R.remove(l.lockRow.Container),R.remove(l.lockRow.fixed),o=null,l.lockRow.Container=null,l.lockRow.fixed=null}return{init:c,render:u,rowCreate:function(e){return e.cloneNode(!0)},hide:function(){l.lockRow.table.classList.add("hideLock")},show:function(){l.lockRow.table.classList.remove("hideLock")},destroy:h,rowToggle:function(){return l.conf.lockRow=!l.conf.lockRow,l.conf.lockRow?f():p(),l.conf.lockRow},rowLock:f,rowUnlock:p,fixedTableRefresh:d}}(this),this.cell={setText:function(e,t,n){R.queryAll('table tr[data-index="'+t+'"] td[data-col="'+e+'"]',w.tableWrapper).forEach(function(e){e.innerText=E.str.toEmpty(n)})}},this.data={get:function(e,t){return void 0===e&&(e=0),w.tableData.slice(e,t)},add:function(e){Array.isArray(e)&&(w.tableData=w.tableData.concat(e))},set:function(e){Array.isArray(e)&&(w.tableData=e)}},this.clickEvent=(m=!(b={}),{add:function(e,t){b[e]||(b[e]=[]),b[e].push(t),m&&R.on(w.tableContainer,"click",e,t)},remove:function(e,t){if(t&&b[e]){for(var n=0;n<b[e].length;n++)if(b[e][n]===t){b[e].splice(n,1);break}0===b[e].length&&delete b[e],m&&R.off(w.tableContainer,"click",e,t)}},off:v=function(){m=!1;var e=function(t){b[t].forEach(function(e){R.off(w.tableContainer,"click",t,e)})};for(var t in b)e(t)},on:function(){v(),m=!0;var e=function(t){b[t].forEach(function(e){R.on(w.tableContainer,"click",t,e)})};for(var t in b)e(t)}}),this.copy=(g="__BasicTableCopyLocal__",y="__BasicTableCopyLocalOrigin__",{col:function(e,t){void 0===t&&(t=!1);var n,o,a=w.colDataGet(e).map(function(e){return E.str.toEmpty(e)});n=[],o={},a.forEach(function(e){o[e]||(o[e]=!0,n.push(e))}),a=n;var i=Array.isArray(a)?a.join("\r\n"):"";if(t)return i;E.copy(i)},row:function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=null);var o=null;o=Array.isArray(n)?n.map(function(e){return w.nameCol[e]}):w.conf.cols;var a=e.map(function(e){return w.rowDataGet(e)}),i=a.map(function(t){return o.map(function(e){return E.str.toEmpty(t[e.name])}).join("\t")});i[0]&&i.unshift(o.map(function(e){return e.title}).join("\t"));var l,r,s=i.join("\r\n");if(l=s,r=a,window.localStorage.setItem(g,l),window.localStorage.setItem(y,JSON.stringify(r)),t)return s;E.copy(s)},selectedRow:function(e){void 0===e&&(e=!1);var t=w.trSelected.map(function(e){return parseInt(e.dataset.index)});return w.copy.row(t,e)},match:function(e,n){void 0===n&&(n=[]);var t,i,o,l,a=function(e){if(e===window.localStorage.getItem(g)){var t=window.localStorage.getItem(y);return JSON.parse(t)}return null}(e);return null===a&&(t=e,i=w.conf.cols,o=t.split("\r\n").filter(function(e){return!!e}),l=[],a=o.length<=1?null:(o.shift().split("\t").forEach(function(e,t){for(var n=0,o=i;n<o.length;n++){var a=o[n];if(a.title===e){l[t]=a.name;break}}}),0===l.length?null:o.map(function(e){var o={};return e.split("\t").forEach(function(e,t){var n=l[t];n&&(o[n]=e)}),o}))),Array.isArray(a)&&a.forEach(function(e){for(var t in e)(E.isEmpty(e[t])||0<=n.indexOf(t))&&delete e[t]}),a}}),this.edit=function(){var r,e,s=null,c={td:null,col:null,index:-1,data:null},i=[],o=0,d=[],t=(r=w,e=function(){var e=s.canInit,t=s.canRowInit,n=r.nameCol[this.dataset.col],o=R.closest(this,"tr"),a=parseInt(o.dataset.index),i=r.rowDataGet(a);if(h(),"function"==typeof t&&!t(i))return!1;if("function"!=typeof e||e(n,o.classList.contains("added")?1:0)){var l=E.obj.merge(i,d[a]);this.classList.add("editing"),s.comInit(this,l,n),c.td=this,c.index=a,c.col=n,c.data=l}},{on:function(){R.on(w.tableWrapper,"click","tr td:not(.editing)",e)},off:function(){R.off(w.tableWrapper,"click","tr td:not(.editing)",e)}});function a(e){e&&e.classList.add("col-disabled")}var n,l,u=function(e){var t=s.defData;o=0<o?o:w.tableData.length,e=e?E.obj.merge(t,e):t;var n=w.rowCreate(e,o);n.classList.add("added"),w.conf.cols.forEach(function(e){s.canInit(e,1)||a(R.query('td[data-col="'+e.name+'"]',n))}),R.prepend(w.table.tBodies[0],n),w.indexCol.col&&(R.after(w.indexCol.col.firstElementChild,w.indexColFun.divGet(o)),w.indexColFun.refreshIndex()),d[o]=e,o++,w.noData.isShow(),1===o&&w.resize(!0)},f=function(e,t){var n,o,a=R.closest(e,"tr"),i=e.dataset.col,l=parseInt(a.dataset.index),r=w.nameCol[i],s="function"==typeof w.conf.textFormat?w.conf.textFormat:null,c=w.rowDataGet(l)[i];e.innerHTML=s?s(((n={})[i]=t,n),r,l):t,e.classList.remove("editing"),E.str.toEmpty(c)!=E.str.toEmpty(t)?(p(l,((o={})[i]=t,o)),e.classList.add("edited")):e.classList.remove("edited")},p=function(e,t){var n=d[e]||{};if(!t)return n;d[e]=E.obj.merge(n,t)},h=function(){if(c.col){var e=E.obj.merge,t=c.data,n=s.valGet(c.col);s.validate&&s.validate(c.td,c.col,e(t,n),function(e,t){t?e.classList.remove("error"):e.classList.add("error")}),s.comDestroy(c.col),f(c.td,n[c.col.name]),c={td:null,col:null,index:-1,data:null}}},b=(n=function(e){var t=e.clipboardData.getData("Text"),n=w.copy.match(t,s.pasteExceptCols);Array.isArray(n)&&n.forEach(function(e){u(e)})},{on:function(){return R.on(w.tableWrapper,"paste",n)},off:function(){return R.off(w.tableWrapper,"paste",n)}}),m=(l=function(e){if(e.ctrlKey&&"I"===String.fromCharCode(e.keyCode)){var t=w.rowSelectDataGet();t[0]||(t=[s.defData]),t.forEach(function(e){return u(e)})}},{on:function(){return R.on(w.tableWrapper,"keydown",l)},off:function(){return R.off(w.tableWrapper,"keydown",l)}});return{errorLen:function(){return R.queryAll("td.edited.error",w.table).length},init:function(){w.theadSort.off(),w.conf.lockColNum&&w.lock.destroy(),w.conf.lockRow&&w.theadLock.rowUnlock(),w.clickEvent.off(),w.menu&&(w.menu.col.off(),w.menu.row.off()),w.fire("editChange",{status:1}),w.tableWrapper.classList.add("stand-text")},initModify:function(e){s=e,t.on(),b.on(),m.on(),w.conf.cols.forEach(function(e,t){s.canInit(e,0)||w.colGet(t).forEach(function(e,t){0<t&&a(e)})}),w.colGet(0).forEach(function(e,t){0!==t&&(s.canRowInit(w.rowDataGet(t-1))?e.parentElement.classList.remove("col-disabled"):e.parentElement.classList.add("col-disabled"))})},addRow:u,deleteRow:function(n){var o=null;s&&(o=s.canRowInit),w.trSelected.forEach(function(e){var t=parseInt(e.dataset.index);return!(n&&!n(w.rowDataGet(t)))&&!(o&&!o(w.rowDataGet(t)))&&(w.rowHide(t),w.tableData[t]&&i.push(t),void delete d[t])})},reshowEditing:h,cancel:function(){w.conf.lockRow&&w.theadLock.rowLock(),o=0,i=[],d=[],c={td:s=null,col:null,index:-1,data:null},w.theadSort.on(),w.conf.lockColNum&&(w.lock.init(),w.lock.render(R.queryAll("tbody tr",w.table),!0)),w.clickEvent.on(),w.menu&&(w.menu.col.on(),w.menu.row.on()),m.off(),b.off(),w.theadSizeCache(),w.theadSizeSync(),w.tableWrapper.classList.remove("stand-text"),t.off(),w.render(w.startIndex,w.startIndex+w.tbodyLength,!0)},getData:function(){var o=w.tableData.length,a={update:[],insert:[],delete:[]};return d.forEach(function(e,t){var n=w.tableData[t];E.isEmpty(n)&&E.isEmpty(e)||(t<=o-1?a.update.push(E.obj.merge(n,e)):E.isEmpty(e)||a.insert.push(E.obj.merge(n,e)))}),i.forEach(function(e){a.delete.push(w.tableData[e])}),a},modifyTd:f,rowData:p,getEditing:function(){return c}}}();var x={Container:null,cols:[],data:[],table:null,sort:1,move:!1,indexColMulti:!0,indexCol:null,pseudoCol:null,lockColNum:0,lockRow:!1,lockRowTop:0,colResize:!1,dragRows:!1,expand:{enabled:!1,cache:!1,icon:["arrow-right","arrow-down"],mode:"toggler",render:function(e,t,n){n()}},multi:{enabled:!1,cols:[]},treegrid:{enabled:!1,cache:!1,icon:["arrow-right","arrow-down"],expand:function(e,t){return!0},render:function(e,t,n){n([])}},thead:!1,colMenu:[],rowMenu:[],colGroup:!1,textFormat:null,beforeShow:null,onComplete:function(){},cellWidth:70,cellMaxWidth:null};this.ssid=E.getGuid(""),e.expand&&(e.expand=E.obj.merge(x.expand,e.expand)),e.treegrid&&(e.treegrid=E.obj.merge(x.treegrid,e.treegrid)),this.conf=E.obj.merge(x,e);var k=this.conf;this.table=k.table,this.tableData=[],this.tableWrapper=null,this.lockCol.table=null,this.table.classList.add("mobileTable"),this.table.tBodies.item(0)||R.append(this.table,document.createElement("tbody"));var T=this.getEventConf();this.menuEventName=T.menuName,this.eventClickName=T.clickName,this.mousemoveName=T.mousemoveName,this.mouseoutName=T.mouseoutName,this.mousedownName=T.mousedownName,this.mouseupName=T.mouseupName,this.nameCol={},E.keysVal(k,"multi","enabled")?k.multi.cols.forEach(function(e){e.forEach(function(e){w.nameCol[e.name]=e})}):k.cols.forEach(function(e){w.nameCol[e.name]=e}),(k.thead||null===this.table.tHead)&&this.theadRender(),this.wrapperInit(),k.indexCol&&this.indexColFun.init(),k.expand.enabled&&this.expandFunc.init(),k.pseudoCol&&this.pseudoColFun.init(),k.treegrid.enabled&&this.treegridFunc.init(),k.sort&&0!==k.sort&&this.theadSort.on(),0<k.lockColNum&&this.lock.init(),k.lockRow&&this.theadLock.init(),k.colResize&&this.colResizeFun.init(),this.conf.move&&this.moveOn();var L=k.colMenu,S=k.rowMenu;(L&&L[0]||S&&S[0])&&(this.menu.popInit(),this.menu.col.init("col"),E.isMb||this.menu.row.init("row",function(e){w.trSelected[0]&&w.trSelected[1]||w.rowSelect(e)})),Array.isArray(k.data)&&k.data[0]&&(this.data.set(k.data),this.render(0,k.data.length))}return e.prototype.getVisibleCol=function(){for(var e=[],t=this.colHide.status,n=0,o=this.conf.cols;n<o.length;n++){var a=o[n].name;a in t?t[a]&&e.push(a):e.push(a)}return e},e.prototype.sysColOpen=function(e,t){if(R.queryAll('div[data-index="'+e+'"]',this.pseudoCol.Container).forEach(function(e){e.style.height=t+"px"}),this.conf.indexCol){var n=R.query('div[data-index="'+e+'"]',this.indexCol.col);n&&(n.style.height=t+"px")}},e.prototype.sysColClose=function(e){var t=this;if(R.queryAll('div[data-index="'+e+'"]',this.pseudoCol.Container).forEach(function(e){e.style.height=t.cellHeight+"px"}),this.conf.indexCol){var n=R.query('div[data-index="'+e+'"]',this.indexCol.col);n&&(n.style.height=this.cellHeight+"px")}},e.prototype.getEvent=function(e){return e.changedTouches?e.changedTouches[0]:e},e.prototype.checkHidden=function(){return this.tableStatus=0!==this.table.offsetWidth,this.tableStatus},e.prototype.moveOn=function(){this.moveEvent.col(),this.moveEvent.row()},e.prototype.createSysCol=function(e){var t=this,n=document.createDocumentFragment();if(null===e.Container.firstElementChild){var o=R.create("<div>全选</div>");t.theadHeight&&(o.style.height=t.theadHeight+"px",o.style.lineHeight=t.theadHeight+"px"),n.appendChild(o),"select"===this.conf.indexCol&&R.append(o,M(t.ssid)),t.conf.colGroup&&n.appendChild(document.createElement("div"))}for(var a=0;a<e.len;a++){var i=a,l=void 0;if(e.childNode)if(i+=e.start,"function"==typeof e.childNode)l=e.childNode(i);else l=e.childNode.toString();else l=((i+=e.offset)+1).toString();n.appendChild(t.indexColDivGet(i,l,e.colType))}return n},e.prototype.indexColDivGet=function(e,t,n){void 0===t&&(t=""),void 0===n&&(n="index");var o=document.createElement("div");return o.classList.add(n+"Col-item"),"string"==typeof t?(o.innerHTML=t,o.title=t):o.appendChild(t),o.dataset.index=e+"",o},e.prototype.tbodyRender=function(e,t,n,o){var a=this;void 0===n&&(n=0),void 0===o&&(o="");var i=[],l=document.createDocumentFragment();t&&(this.table.tBodies[0].innerHTML=""),(e=Array.isArray(e)?e:[]).forEach(function(e,t){i.push(a.rowCreate(e,t+n,o))}),this.conf.colGroup&&i.unshift(this.colGroup.rowCreate(e)),i.forEach(function(e){l.appendChild(e)});var r=0;R.queryAll("td > span.red",l).forEach(function(e){var t=R.closest(e,"td");!t||"highIndex"in t.dataset||(t.dataset.highIndex=r+"",r++)}),this.table.tBodies[0].appendChild(l),E.keysVal(this.conf,"multi","enabled")||(0<this.conf.lockColNum&&this.lock.render(i,t),this.conf.lockRow&&this.theadLock.render()),this.conf.colGroup&&this.colGroup.on(),this.noData.isShow(),this.theadSizeSync()},e.prototype.wrapperInit=function(){var e=this.table,t=R.create('<div class="mobileTableWrapper" tabindex="'+this.ssid+'"><div class="tableContainer"><div class="mobileTableMiddle"></div></div></div>');this.table.parentNode.replaceChild(t,this.table),this.tableContainer=t.querySelector(".tableContainer"),this.tableMiddle=this.tableContainer.querySelector(".mobileTableMiddle"),this.tableMiddle.appendChild(e),this.tableWrapper=t},e.prototype.colGet=function(e,t){return void 0===t&&(t=this.conf.table),t?R.queryAll("tr > *:nth-child("+(e+1)+")",t):null},e.prototype.colDel=function(e,t){void 0===t&&(t=this.table);for(var n=this.colGet(e,t),o=0,a=n;o<a.length;o++){var i=a[o];R.remove(i)}return n},e.prototype.colAdd=function(e,n,t){void 0===t&&(t=this.table);var o=this.colGet(e+1,t);o[0]?o.forEach(function(e,t){e.parentNode.insertBefore(e.cloneNode(!0),n[t])}):Array.prototype.forEach.call(t.querySelectorAll("tr"),function(e,t){e.appendChild(n[t].cloneNode(!0))})},e.prototype.colInsertTo=function(n,o,e){void 0===e&&(e=!1);var a=this,t=this.conf.cols,i=t.length;if(this.colHide.ready){var l=0,r=this.colHide.status;for(var s in r)r.hasOwnProperty(s)&&r[s]&&l++;i=l}if(!(0<=n&&n<i&&0<=o&&o<i))return[];var c=this.colGet(n);if(n==o)return c;var d,u=this.colGet(n,this.lockRow.table),f=this.col.hideIndex2Index(n),p=this.col.hideIndex2Index(o),h=t.splice(f,1);a.conf.treegrid.enabled&&(d=this.colGet(0)),t.splice(p,0,h[0]);var b=this.colGet(o+(n<o?1:0)),m=this.colGet(o+(n<o?1:0),this.lockRow.table);return o===i-1?(c.forEach(function(e,t){e.parentNode.appendChild(e),a.conf.treegrid.enabled&&(0!==n&&0!==o||a.treegridFunc.exchangeTd(d[t],e.parentNode.firstChild))}),Array.isArray(u)&&u.forEach(function(e){e.parentNode.appendChild(e)})):(b.forEach(function(e,t){e.parentNode.insertBefore(c[t],e),a.conf.treegrid.enabled&&(0!==n&&0!==o||a.treegridFunc.exchangeTd(d[t],e.parentNode.firstChild))}),Array.isArray(m)&&m.forEach(function(e,t){e.parentNode.insertBefore(u[t],e)})),e?n<this.conf.lockColNum-1&&o<this.conf.lockColNum-1&&(this.lockColReplace(n,this.colGet(n)),this.lockColReplace(o,this.colGet(o)),this.theadSizeSync()):(n<this.conf.lockColNum&&this.lockColReplace(n,this.colGet(n)),o<this.conf.lockColNum&&this.lockColReplace(o,this.colGet(o)),this.theadSizeSync()),c},e.prototype.lockColReplace=function(e,t){var n=this.colGet(e,this.lockCol.table),o=this.colGet(e,this.lockRow.fixedTable),a=t;n.forEach(function(e,t){e.parentNode.replaceChild(a[t].cloneNode(!0),e)}),Array.isArray(o)&&o.forEach(function(e,t){e.parentNode.replaceChild(a[t].cloneNode(!0),e)}),this.theadSizeSync()},e.prototype.colName2index=function(e){return this.col.getHideIndex(e)},e.prototype.colToggleLock=function(e){var t=this.lock.colToggle(e);return this.theadLock.fixedTableRefresh(),t},e.prototype.rowToggleLock=function(){this.theadLock.rowToggle()},e.prototype.theadSizeSync=function(){var o=this,e=R.queryAll("tr th",this.table.tHead),a=g(e[0]),t=this.indexCol,n=this.lockRow,i=this.lockCol.table;if(this.initStyleList(),this.updateStyle(),this.theadSizeCache(),!E.keysVal(this.conf,"multi","enabled")&&t.col&&t.show&&t.col.firstChild){var l=t.col.firstChild,r=this.theadHeight+1;if(l.style.height=r+"px",l.style.lineHeight=r+"px",this.conf.lockRow&&n.fixed){var s=n.fixed.querySelector(".indexCol").firstChild;s&&(s.style.height=r+"px",s.style.lineHeight=r+"px")}}if(0<this.pseudoCol.confList.length&&this.pseudoCol.show){var c=this.theadHeight+1;this.pseudoCol.confList.forEach(function(e){e.col.firstChild&&(e.col.firstChild.style.height=c+"px",e.col.firstChild.style.lineHeight=c+"px")}),this.conf.lockRow&&n.fixed&&(n.fixed.querySelector(".pseudoCol")||(this.pseudoColFun.fixedRender(),this.theadSizeSync()),R.queryAll(".pseudoCol div",n.fixed).forEach(function(e){e.style.height=c+"px"}))}if((t.col||this.pseudoCol.Container)&&n.fixed){var d=R.query(".Container",n.fixed),u=this.tableContainer.offsetLeft;d.style.left=-1*u+"px",d.style.paddingLeft=u+"px"}if(!E.keysVal(this.conf,"multi","enabled")&&0<this.conf.lockColNum&&i){var f=R.queryAll("tr th div",i.tHead);R.queryAll("tr th",this.table.tHead).forEach(function(e,t){var n=f[t];n&&(n.style.width=e.offsetWidth-a+"px",o.theadHeight&&(n.style.height=o.theadHeight-12+"px"))}),i.classList.remove("hide")}if(this.conf.lockRow){if(n.table){var p=R.queryAll("tr th div",n.table.tHead);(e=e||R.queryAll("tr th",this.table.tHead)).forEach(function(e,t){var n=p[t];n&&(n.style.width=e.offsetWidth-a+"px")})}if(n.fixedTable){var h=n.fixedTable.tHead,b=R.query("tr th",h),m=R.queryAll("tr th div",h);e=e||R.queryAll("tr th",this.table.tHead),b&&(b.style.height=this.theadHeight+"px"),e.forEach(function(e,t){var n=m[t];n&&(n.style.width=e.offsetWidth-a+"px")})}var v=this.theadHeight+1+"px";n.fixedContainer&&(n.fixedContainer.style.height=v),n.ContainInner&&(n.ContainInner.style.height=v)}},e.prototype.theadSizeCache=function(e){void 0===e&&(e=-1);this.theadHeight=this.table.tHead.offsetHeight},e.prototype.theadRender=function(){var t,n,o=this,e=o.conf;if(null===(t=this.table.tHead)&&(t=R.create("<thead></thead>","table"),this.table.insertBefore(t,this.table.tBodies.item(0))),t.innerHTML="",E.keysVal(e,"multi","enabled")){(a=this.conf.multi.cols).forEach(function(e){n=document.createElement("tr"),e.forEach(function(e){n.appendChild(o.col.theadCell(e))}),t.appendChild(n)})}else{var a=this.conf.cols;n=document.createElement("tr"),a.forEach(function(e){o.colHide.ready&&!o.colHide.status[e.name]||(n.appendChild(o.col.theadCell(e)),t.appendChild(n))})}},e.prototype.rowsGetWithLock=function(e){var t=this.tableWrapper||this.table;return R.queryAll('tr[data-index="'+e.dataset.index+'"]',t)},e.prototype.rowSelect=function(e,t){void 0===t&&(t=!1),t||this.rowDeselect(null,!0),e=this.getMainTr(e),-1<this.trSelected.indexOf(e)||(this.lockRowApply(e,function(e){e.classList.add("selected")}),this.trSelected.push(e),this.fire("rowSelect",{indexes:[parseInt(e.dataset.index)],select:!0}))},e.prototype.getMainTr=function(e){return this.table.contains(e)?e:R.query('tbody tr[data-index="'+e.dataset.index+'"]',this.table)},e.prototype.rowToggle=function(e){e=this.getMainTr(e),-1<this.trSelected.indexOf(e)?this.rowDeselect(e):this.rowSelect(e,!0)},e.prototype.rowDeselect=function(e,t){void 0===e&&(e=null),void 0===t&&(t=!1);var n=this;if(null===e){var o=[];n.trSelected.forEach(function(e){n.lockRowApply(e,function(e){e.classList.remove("selected")}),o.push(parseInt(e.dataset.index))}),n.trSelected=[],t||this.fire("rowSelect",{indexes:o,select:!1})}else{e=this.getMainTr(e),n.lockRowApply(e,function(e){e.classList.remove("selected")});for(var a=0,i=null;i=n.trSelected[a];a++)if(i===e){n.trSelected.splice(a,1);break}t||this.fire("rowSelect",{indexes:[parseInt(e.dataset.index)],select:!1})}},e.prototype.rowSelectDataGet=function(){var t=this;return this.trSelected.map(function(e){return t.rowDataGet(parseInt(e.dataset.index))})},e.prototype.rowUnselectDataGet=function(){var t=this;return R.queryAll("tbody tr",this.table).filter(function(e){return!t.trSelected.includes(e)}).map(function(e){return t.rowDataGet(parseInt(e.dataset.index))})},e.prototype.rowCreate=function(l,r,s){void 0===s&&(s="");var c,d=this;(c="function"==typeof d.conf.beforeShow?d.conf.beforeShow(l,d.conf.cols):{tr:{},td:[]}).tr["data-index"]=r;var u=document.createElement("tr");for(var e in c.tr)u.setAttribute(e,c.tr[e]);var f="function"==typeof d.conf.textFormat?d.conf.textFormat:null;return d.conf.cols.forEach(function(e,t){if(!d.colHide.ready||d.colHide.status[e.name]){e.name in l||(l[e.name]=null);var n=c.td[t]||{},o=f?f(l,e,r):l[e.name],a=document.createElement("td");for(var i in o=E.highlight(o,s,"red"),n["data-col"]=e.name,n.class=n.class?n.class+" "+d.cellClass(e.name):d.cellClass(e.name),n)a.setAttribute(i,n[i]);a.innerHTML=o,u.appendChild(a),0===t&&d.treegridFunc.addBtn(r,a)}}),u},e.prototype.rowHide=function(e){R.queryAll('table tbody > tr[data-index="'+e+'"]',this.tableWrapper).forEach(function(e){return e.classList.add("hide")});var t=this.indexCol.col;t&&(R.query('div[data-index="'+e+'"]',t).classList.add("hide"),"number"===this.conf.indexCol&&this.indexColFun.refreshIndex())},e.prototype.cellClass=function(e){return"td-"+this.ssid+"-"+e},e.prototype.groutCreate=function(e,t){var n=document.createElement("div"),o=document.createElement("select");return t.sort(function(e,t){return t-e}),n.classList.add("td-content","td-select",this.cellClass(e)),o.appendChild(R.create("<option></option>")),t.forEach(function(e){if(""!=e){var t=document.createElement("option"),n=document.createTextNode(e);t.appendChild(n),t.setAttribute("value",e),o.appendChild(t)}}),o.setAttribute("data-col",e),n.appendChild(o),n},e.prototype.rowReplace=function(e,t){this.lockCol.table&&this.lockCol.table.tBodies[0].replaceChild(this.lock.rowCreate(e),this.lock.rowGet(t)),this.table.tBodies[0].replaceChild(e,t)},e.prototype.rowGet=function(e,t){return void 0===t&&(t=this.table),t?t.tBodies.item(0).querySelector('[data-index="'+e+'"]'):null},e.prototype.rowGetAll=function(e){return void 0===e&&(e=this.table),R.queryAll("tbody > tr:not(.hide)",e)},e.prototype.dataGet=function(e){void 0===e&&(e="data");var t=null;switch(e){case"data":case"display":t=this.tableData}return t},e.prototype.onLoad=function(e){},e.prototype.lockRowApply=function(e,n){this.rowsGetWithLock(e).forEach(function(e,t){n(e,t)})},e.prototype.attr=function(e,t){if(void 0===t)return this.conf[e];this.conf[e]=t},e.prototype.wrapperGet=function(){return this.tableWrapper},e.prototype.updateStyle=function(){var e=this;if(this.conf.colResize&&e.tableContainer&&e.checkHidden()){var t=[],n=document.querySelector('style[y-ui="table-'+e.ssid+'"]');for(var o in n||((n=document.createElement("style")).setAttribute("type","text/css"),n.setAttribute("y-ui","table-"+e.ssid),e.tableContainer.appendChild(n)),e.styleList){var a=e.styleList[o];t.push("."+o+"{ width: "+(a-1)+"px; max-width: "+(a-1)+"px;}")}n.innerHTML=t.join("")}},e.prototype.scrollTop=function(){return this.conf.Container?this.conf.Container.scrollTop||window.scrollY:E.scrollTop()},e.prototype.initStyleList=function(){var t=this;if(!t.styleListReady){var e=R.queryAll("th",t.table.tHead);if(!e[0])return;var n=g(e[0]);if(E.keysVal(t.conf,"multi","enabled")){var o=[];e.forEach(function(e){e.getAttribute("colspan")||o.push(e)}),e=o}t.conf.cellMaxWidth&&t.tableStyle.add(["table th, table td{width:${self.conf.cellMaxWidth - padding}px;max-width:"+(t.conf.cellMaxWidth-n)+"px;}"]),t.conf.cellMaxWidth&&!t.conf.colResize?e[0].offsetWidth>t.conf.cellMaxWidth&&t.tableStyle.del():t.conf.colResize&&(e.forEach(function(e){t.styleList[t.cellClass(e.dataset.col)]=e.offsetWidth-n}),t.conf.cellMaxWidth&&t.tableStyle.del()),t.styleListReady=!0}},e.prototype.resize=function(e){void 0===e&&(e=!1);var t=this;function n(){t.styleListReady=!1,t.styleList={},t.updateStyle(),t.initStyleList(),t.updateStyle(),t.lockRow.Container&&(t.lockRow.Container.style.width=t.tableContainer.offsetWidth+"px"),t.theadSizeSync()}t.tableStatus||e?e&&t.checkHidden()&&n():n()},e.prototype.setTableWidth=function(e){this.table.style.width=e+"px",this.lockRow.table.style.width=e+"px"},e.prototype.rowInsertTo=function(e,t){var n,o=this,a=o.tbodyLength;if(!(0<=e&&e<a&&0<=t&&t<a))return null;var i=o.rowGet(e);if(e==t)return i;var l=o.rowGet(e,o.lockCol.table);n=t+(e<t?1:0);var r=o.rowGet(n),s=o.rowGet(n,o.lockCol.table);t===a-1?(o.table.tBodies[0].appendChild(i),o.lockCol.table&&o.lockCol.table.tBodies[0].appendChild(l)):(o.table.tBodies[0].insertBefore(i,r),o.lockCol.table&&o.lockCol.table.tBodies[0].insertBefore(l,s)),o.updateRowIndex(o.table),o.updateRowIndex(o.lockCol.table)},e.prototype.updateRowIndex=function(e){var n=this;e&&R.queryAll("tbody tr",e).forEach(function(e,t){n.conf.colGroup?e.dataset.index=0<t?(t-1).toString():"":e.dataset.index=t.toString()})},e.prototype.destroy=function(){this.theadLock.destroy(),this.colResizeFun.off(),R.remove(this.tableWrapper)},e.prototype.colDataGet=function(e,t){void 0===t&&(t="data");var n,o=null;return"string"==typeof e&&(e=this.col.getIndex(e)),(n=this.conf.cols[e])&&("data"===t?o=this.dataGet().map(function(e){return e[n.name]}):"display"===t&&(o=this.colGet(e).map(function(e){return E.str.removeHtmlTags(e.innerHTML)}))),o},e.prototype.rowDataGet=function(e){return E.obj.copy(this.dataGet()[e])},e.prototype.on=function(e,t){R.on(this.tableWrapper,"bt."+e,t)},e.prototype.fire=function(e,t){E.event.fire("bt."+e,t,this.tableWrapper)},e.prototype.getSearchData=function(a,e){var i=this;void 0===e&&(e=this.tableData);var l=this.conf,r=[],s=this.getVisibleCol();if(!E.isEmpty(a))return e.forEach(function(e,t){for(var n in r.push({}),e){var o=l.cols[i.col.getIndex(n)];o&&-1<s.indexOf(n)&&(r[t][n]=l.textFormat(e,o,t))}}),e.filter(function(e,t){var n=r[t];for(var o in n){if(-1<E.str.removeHtmlTags(n[o]+"").toLowerCase().indexOf(a.toLowerCase()))return!0}return!1});this.render(0,this.tbodyLength)},e.prototype.search=function(e,t){void 0===t&&(t=this.tableData);var n=this.getSearchData(e,t);if(!E.isEmpty(n)){var o=n.length,a=o<this.tbodyLength?o:this.tbodyLength;this.tbodyRender(n,!0,0,e),this.indexColFun.render(0,a,!0),this.pseudoColFun.render(0,a,!0),this.resize(!0)}},e.prototype.render=function(e,t,n){void 0===n&&(n=!0);var o=this.tableData.slice(e,t),a=o.length;n&&(this.trSelected=[],this.colGroup.clear()),this.tbodyRender(o,n,e),this.indexColFun.render(e,a,n),this.pseudoColFun.render(e,a,n),this.startIndex=n?e:this.startIndex,this.tbodyLength=n?a:this.tbodyLength+a,this.resize(!0),this.fire("render")},e.prototype.highlight=function(i){var l=this,r=0;R.queryAll("tbody td",this.table).forEach(function(e){var t,n,o,a=!1;(t=e,n=t.parentElement.dataset.index,o=t.dataset.col,R.queryAll('tbody tr[data-index="'+n+'"] td[data-col="'+o+'"]',l.tableWrapper)).forEach(function(e){e.dataset.highIndex&&(delete e.dataset.highIndex,e.innerHTML=E.str.removeHtmlTags(e.innerHTML));var t=e.innerHTML,n=E.highlight(t,i,"red");t!==n&&(e.innerHTML=n,e.dataset.highIndex=r+"",a=!0)}),a&&r++})},e.prototype.tableELGet=function(){return this.table},e}();function g(e){var t=getComputedStyle(e,null);return parseInt(t.paddingLeft.replace("px",""))+parseInt(t.paddingRight.replace("px",""))}function M(e){var t=n.CheckBox.initCom(e);return t.classList.add("circle"),R.off(R.query(".check-span",t)),t}t.BasicTable=o}),define("PcTable",["require","exports","BasicTable"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var T=G.tools,L=G.d,o=function(r){function e(e){var a,i,t,n,o=r.call(this,e)||this;o.wrapperRect=null,o.hoverFun=(i=(a=o).tableWrapper,t=function(){!function(e){var t=a.colName2index(e.dataset.col),n=e.classList.contains("col-hover"),o=L.closest(e,".mobileTableLock")?a.lockTable:a.table;L.queryAll(".col-hover",i).forEach(function(e,t){e.classList.remove("col-hover")}),a.colGet(t,o).forEach(function(e){n||e.classList.add("col-hover")}),a.conf.lockRow&&a.colGet(t,a.lockRow.table).forEach(function(e){n||e.classList.add("col-hover")});0<a.conf.lockColNum&&a.colGet(t,a.lockCol.table).forEach(function(e){n||e.classList.add("col-hover")});L.closest(e,".mobileTableTopFixedLock")&&a.colGet(t,a.lockRow.fixedTable).forEach(function(e){n||e.classList.add("col-hover")})}(this)},n=function(){var e,t;(t=(e=this).classList.contains("col-hover"))?e.classList.remove("col-hover"):e.classList.add("col-hover"),a.lockRowApply(e,function(e){t?e.classList.remove("col-hover"):e.classList.add("col-hover")})},{row:{on:function(){L.on(i,"mouseover","tbody tr",n),L.on(i,"mouseout","tbody tr",n)},off:function(){L.off(i,"mouseover","tbody tr",n),L.off(i,"mouseout","tbody tr",n)}},col:{on:function(){L.on(i,"mouseover","thead th",t),L.on(i,"mouseout","thead th",t)},off:function(){L.off(i,"mouseover","thead th",t),L.off(i,"mouseout","thead th",t)}}}),o.drag=function(u){var f,p,h,b,m,v,g,y,w,s,C=[];function c(e){return{x:e.pageX,y:e.pageY}}function x(e){var t,n,o,a,i,l,r;e=u.getEvent(e),u.dragControl.dragging&&(y=c(e),(10<Math.abs(y.x-g.x)||10<Math.abs(y.y-g.y))&&(w||(w=document.getElementById("tableDragSelect"+u.ssid))||((w=document.createElement("div")).classList.add("tableDragSelect"),w.setAttribute("id","tableDragSelect"+u.ssid),u.tableWrapper.appendChild(w)),t=g.x<y.x?g.x:y.x,n=g.y<y.y?g.y:y.y,o=Math.abs(y.x-g.x),a=Math.abs(y.y-g.y),i=G.tools.offset.top(u.tableWrapper),l=G.tools.offset.left(u.tableWrapper),r=u.conf.Container?u.conf.Container.scrollTop:0,!1,t<s.left&&(t=s.left,o=Math.abs(t-g.x),!0),n<s.top&&(n=s.top,a=Math.abs(n-g.y),!0),t+o>s.right&&(o=s.right-t,!0),n+a>s.bottom&&(a=s.bottom-n,!0),w.style.left=t-l+"px",w.style.top=n-i+r+"px",w.style.width=o+"px",w.style.height=a+"px"))}function t(e){var t,n,o,a;L.closest(e.target,".colGroup")||(e=u.getEvent(e),(m=L.closest(e.target,"td"))&&(v=m.dataset.col,g=c(e),t=u.tableContainer,n=u.table.tBodies.item(0),o=T.offset.top(n),a=T.offset.left(t),s={top:o+(u.conf.colGroup?30:0),left:a,right:a+t.offsetWidth,bottom:o+n.offsetHeight},u.dragControl.dragging=!0,document.onselectstart=function(){return!1},document.ondragstart=function(){return!1},L.on(document,u.mousemoveName,x),L.on(document,u.mouseupName,k)))}function k(e){if(document.onselectstart=null,document.ondragstart=null,L.off(document,u.mousemoveName,x),L.off(document,u.mouseupName,k),u.dragControl.dragging){var t=L.closest(m,"tr");if(w){var n=e.changedTouches?e.changedTouches[0]:e,o=L.queryAll("tr th",u.table.tHead),a=o.length,i=void 0,l=void 0;if(o[a-1].getBoundingClientRect().right<n.clientX){var r=o[a-1];p=r.dataset.col,i=a-1}else for(var s=0;s<a;s++){if(o[s].getBoundingClientRect().right>n.clientX){r=o[s];p=r.dataset.col,i=s;break}}if((l=u.colGet(i))[l.length-1].getBoundingClientRect().bottom<n.clientY)b=l[l.length-1].parentNode.dataset.index;else{s=0;for(var c=l.length;s<c;s++){if(!(u.conf.colGroup&&s<2))if(l[s].getBoundingClientRect().bottom>n.clientY){b=l[s].parentNode.dataset.index;break}}}if(f=v,h=parseInt(t.dataset.index),b<h){var d=h;h=b,b=d}if(f!=p&&g.x>y.x){d=f;f=p,p=d}}else f=p=v,h=b=t.dataset.index;if(w&&L.remove(w),v=m=g=w=null,u.dragControl.dragging=!1,h===b&&2===e.button)return;C.forEach(function(e){e(f,p,h,b)})}}return{on:function(e){0===C.length&&L.on(u.tableContainer,u.mousedownName,t),C.push(e)},off:function(){L.off(u.tableContainer,u.mousedownName,t),C=[],L.queryAll("td.cellSelect",u.tableContainer).forEach(function(e){e.classList.remove("cellSelect");for(var t=["topBorder","bottomBorder","leftBorder","rightBorder"],n=0,o=t.length;n<o;n++)e.classList.contains(t[n])&&e.classList.remove(t[n])})},getData:function(){return u.dragSelectFunc.getResult()}}}(o),o.dragSelectFunc=function(h){var b={};function e(e,t,n,o){if(!~n.toString().indexOf("-")&&!~o.toString().indexOf("-")){!function(a,i,l,r){var s=!1;if(L.queryAll("td.cellSelect",h.tableContainer).forEach(function(e){e.classList.remove("cellSelect");for(var t=["topBorder","bottomBorder","leftBorder","rightBorder"],n=0,o=t.length;n<o;n++)e.classList.contains(t[n])&&e.classList.remove(t[n])}),0<h.conf.lockColNum)for(var e=0,t=h.conf.cols;e<t.length;e++)if(t[e].name===a){s=!0;break}for(var n=function(t){var e=h.rowGet(t),n=!1;if(L.queryAll("td",e).forEach(function(e){e.dataset.col===a&&(e.classList.add("leftBorder"),n=!0),n&&e.classList.add("cellSelect"),n&&t==l&&e.classList.add("topBorder"),n&&t==r&&e.classList.add("bottomBorder"),e.dataset.col===i&&(e.classList.add("rightBorder"),n=!1)}),0<h.conf.lockColNum&&s){var o=h.rowGet(t,h.lockCol.table);L.queryAll("td",o).forEach(function(e){e.dataset.col===a&&(e.classList.add("leftBorder"),n=!0),n&&e.classList.add("cellSelect"),n&&t==l&&e.classList.add("topBorder"),n&&t==r&&e.classList.add("bottomBorder"),e.dataset.col===i&&(e.classList.add("rightBorder"),n=!1)})}},o=l;o<=r;o++)n(o)}(e,t,n,o);for(var a=[],i=[],l=n;l<=o;l++){for(var r=!1,s={},c=0,d=h.conf.cols;c<d.length;c++){var u=d[c];u.name===e&&(r=!0),r&&(l===n&&a.push(T.obj.merge(u,{})),s[u.name]=h.tableData[l][u.name]),u.name===t&&(r=!1)}i.push(s)}var f={cols:a,data:i};h.dragSelect.selected=f;var p=[parseInt(n),parseInt(o)];b={indexes:p,cols:a}}}return{on:function(){h.dragSelect.selected={},h.drag.on(e)},off:function(){h.dragSelect.selected={},h.drag.off()},getResult:function(){return b}}}(o),o.dragRowsFunc=function(l){function e(e,t){var n=l.getEvent(t).target,o=n.checked?"add":"remove",a=[];if("INPUT"===n.tagName){if(l.rowGet(e).classList[o]("selected"),0<l.conf.lockColNum)l.rowGet(e,l.lockCol.table).classList[o]("selected");L.queryAll('input[name="checkedrows"]',l.pseudoCol.Container).forEach(function(e){if(e.checked){var t=e.parentNode.dataset.index;a.push(l.tableData[t])}}),l.dragRows.selected=a,l.conf.dragRows&&l.conf.dragRows(a)}}function t(e,t,n,o){if(!~n.toString().indexOf("-")&&!~o.toString().indexOf("-")){!function(e,t,n,o){L.queryAll("tr.selected",l.tableContainer).forEach(function(e,t){e.classList.remove("selected")}),L.queryAll('input[type="checkbox"]',l.pseudoCol.Container).forEach(function(e){e.checked=!1});for(var a=n;a<=o;a++){l.rowGet(a).classList.add("selected"),0<l.conf.lockColNum&&l.rowGet(a,l.lockCol.table).classList.add("selected");var i=l.pseudoCol.Container.querySelector('.pseudoCol-item[data-index="'+a+'"] input[type="checkbox"]');i&&(i.checked=!0)}}(0,0,n,o);var a=[];if(n)for(var i=n;i<=o;i++)a.push(l.tableData[i]);l.dragRows.selected=a,l.conf.dragRows&&l.conf.dragRows(a)}}return{init:function(){l.pseudoColFun.init({render:function(e){return'<input type="checkbox" name="checkedrows" class="checkedRows" />'},click:e}),l.drag.on(t)}}}(o);o.conf=T.obj.merge(!0,{colReorder:!1},o.conf),T.keysVal(o.conf,"multi","enabled")||(o.hoverFun.col.on(),o.hoverFun.row.on());var l=o;return o.clickEvent.add("tbody tr",function(e){e.ctrlKey&&l.conf.indexColMulti?l.rowToggle(this):l.rowSelect(this)}),o.on("editChange",function(e){1===e.detail.status?(o.hoverFun.row.off(),o.hoverFun.col.off(),o.dragSelectFunc.off()):(o.hoverFun.row.on(),o.hoverFun.col.on(),o.dragSelectFunc.on())}),o.conf.onComplete&&o.conf.onComplete(),o.dragSelectFunc.on(),o}return __extends(e,r),e.prototype.getEventConf=function(){return{menuName:"contextmenu",clickName:"click",mousemoveName:"mousemove",mouseoutName:"mouseout",mousedownName:"mousedown",mouseupName:"mouseup"}},e.prototype.wrapperRectGet=function(){return this.wrapperRect||(this.wrapperRect=this.tableWrapper.getBoundingClientRect()),this.wrapperRect},e.prototype.menuConfGet=function(){var a=this;return{colConfGet:function(){return{identifier:"col",targetGet:function(e){return[e]},targetSelector:"thead tr th",btns:a.conf.colMenu,eventHandle:function(e,t){t.preventDefault();var n=a.tableWrapper.getBoundingClientRect(),o=[t.clientX-n.left,t.clientY-n.top];a.popMenuDom.style.left=o[0]+"px",a.popMenuDom.style.top=o[1]+"px"}}},rowConfGet:function(){return{identifier:"row",targetGet:function(e){return a.trSelected},targetSelector:"tbody tr",btns:a.conf.rowMenu,eventHandle:function(e,t){t.preventDefault();var n=a.tableWrapper.getBoundingClientRect(),o=[t.clientX-n.left,t.clientY-n.top];a.popMenuDom.style.left=o[0]+"px",a.popMenuDom.style.top=o[1]+"px"}}},popDomGet:function(){return L.create('<ul class="pcTableMenu list-group col-menu" style="position: absolute;z-index: 3"></ul>')},listDomGet:function(e){return e},btnHtmlGet:function(e){var t={val:""},i='data-action="tableMenuBtn"';return function e(t,n){if(t&&0<t.length)for(var o=0;o<t.length;o++){var a='data-index="'+o+'" '+i;n.val+='<li class="list-group-item listItem" '+a+">"+t[o].title,t[o].children&&0<t[o].children.length&&(n.val+='<span style="position:absolute; top: 8px; right: 4px;">></span>',n.val+='<ul class="pcTableMenu list-group col-menu ul-list">',e(t[o].children,n),n.val+="</ul>"),n.val+="</li>"}}(e,t),t.val},show:function(){a.popMenuDom.style.display="block"},hide:function(){a.popMenuDom.style.display="none"},init:function(){a.tableWrapper.appendChild(a.popMenuDom),L.on(document,"click",function(){a.popMenu.hide()})}}},e.prototype.lockScreen=function(){},e.prototype.destroy=function(){r.prototype.destroy.call(this)},e}(n.BasicTable);t.PcTable=o}),define("Scrollbar",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=G.tools,l=G.d,n=function(){function e(e){this.scrollType="",this.bindEvent=function(r){var e,s;function t(){var e,t,n,o,a,i,l;r.conf.Container?(n=!0,o=r.conf.Container.scrollHeight,a=r.conf.Container.offsetHeight,i=o-r.conf.marginBottom,l=r.conf.Container.scrollTop+a,(i<a||l-r.conf.bottom>i)&&(n=!1),n?(r.panelWrapper.style.width=s.offsetWidth+"px",r.panelWrapper.style.top=l-12-r.conf.bottom+"px",r.panelWrapper.style.display="block",r.panelWrapper.scrollLeft=s.scrollLeft):r.panelWrapper.style.display="none"):(e=!0,((t=c.scrollTop()+document.documentElement.clientHeight-r.conf.bottom)>r.elOffsetTop+r.elHeight||t<r.elOffsetTop)&&(e=!1),r.panelWrapper.style.display=e?"block":"none")}function n(e){void 0===e&&(e=!1),r.styleThrottle||(r.styleThrottle=r.throttle(1e3,function(e){r.panelInner.style.width=s.scrollWidth+"px",r.conf.Container?(r.elOffsetTop=0,r.elHeight=s.offsetHeight-r.conf.marginBottom,r.panelWrapper.style.left=c.offset.left(s)-c.offset.left(r.conf.Container)+"px"):(r.elOffsetTop=c.offset.top(s),r.elHeight=s.offsetHeight),e||t()})),e&&t(),r.styleThrottle(e)}function o(){""!==r.scrollType&&"def"!==r.scrollType||(r.scrollType="def",e&&clearTimeout(e),e=setTimeout(function(){r.scrollType=""},100),n(),"block"===r.panelWrapper.style.display&&(r.panelWrapper.scrollLeft=s.scrollLeft))}function a(){""!==r.scrollType&&"bar"!==r.scrollType||(r.scrollType="bar",e&&clearTimeout(e),e=setTimeout(function(){r.scrollType=""},100),s.scrollLeft=r.panelWrapper.scrollLeft)}var i=function(){n(!0)};return{scrollYHandle:i,init:function(){s=r.conf.el,l.on(s,"scroll",o),l.on(r.panelWrapper,"scroll",a),r.conf.Container?(setTimeout(function(){i()},0),l.on(r.conf.Container,"scroll",i),l.on(window,"resize",function(){i()})):l.on(window,"scroll",i)}}}(this);this.conf=c.obj.merge({el:null,Container:null,bottom:0,marginBottom:0},e),this.create(),this.bindEvent.init()}return e.prototype.throttle=function(t,n){var o=0;return function(){var e=+new Date;t<e-o&&(n.apply(this,arguments),o=e)}},e.prototype.updateStyle=function(){this.bindEvent.scrollYHandle()},e.prototype.setConfBottom=function(e){this.conf.bottom=e,this.updateStyle()},e.prototype.create=function(){var e,t,n=this;(e=document.createElement("style")).setAttribute("type","text/css"),e.innerHTML="\n            .sbarWrapper{ height: 12px; position: fixed; overflow-x: auto; overflow-y: hidden; z-index:10;}\n            .sbarWrapper::-webkit-scrollbar{ width: 8px; height: 8px;}\n            .sbarWrapper::-webkit-scrollbar-thumb{ width: 8px; height: 8px;border-radius: 4px;background-color: #7f7f7f;}\n            .sbarWrapper div{height:12px;}\n        ",n.conf.Container&&(n.conf.Container.style.position="relative"),document.body.appendChild(e),t=n.conf.el,n.panelInner=document.createElement("div"),n.panelWrapper=l.create('<div class="sbarWrapper"></div>'),n.panelWrapper.style.width=t.offsetWidth+"px",n.panelInner.style.width=t.scrollWidth+"px",n.panelWrapper.appendChild(n.panelInner),n.conf.Container?(n.panelWrapper.style.position="absolute",n.panelWrapper.style.paddingTop="0px",n.panelWrapper.style.paddingBottom="0px",n.conf.Container.appendChild(n.panelWrapper)):(n.panelWrapper.style.left=c.offset.left(t)+"px",n.panelWrapper.style.bottom=n.conf.bottom+"px",document.body.appendChild(n.panelWrapper))},e}();t.Scrollbar=n}),define("TableImgEdit",["require","exports","Modal","UploadModule","Button"],function(e,t,a,s,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d=G.d,u=G.tools,f=BW.CONF,n=function(){function e(e){this.modal=null,this.imgs=[],this.fields=e.fields,this.thumbField=e.thumbField,this.deletable=e.deletable,this.updatable=e.updatable,this.onUploaded=e.onUploaded,this.onSave=e.onSave,this.modalInit()}return e.prototype.modalInit=function(){var n=this,o=document.createDocumentFragment();this.fields.forEach(function(e,t){o.appendChild(n.imgWrapperGet(e,t))}),this.imgs=d.queryAll("img",o),this.modal=new a.Modal({header:"图片查看",width:"700px",body:o})},e.prototype.imgWrapperGet=function(e,t){var i=this,l=e.name,n=d.create('<div class="table-img-wrapper" data-field="'+l+'"><div class="table-img-wrapper-btns"></div><div class="table-img"><img data-index="'+t+'" style="max-height:500px;max-width:700px"></div></div>');if(!this.updatable&&!this.deletable)return n;var o=d.query(".table-img-wrapper-btns",n),r=d.query("img",n);if(this.updatable){var a=d.create('<div class="table-img-uploader"></div>');d.append(o,a),new s.default({nameField:l,thumbField:this.thumbField,container:a,text:"选择图片",accept:{title:"图片",extensions:"jpg,png,gif",mimeTypes:"image/*"},uploadUrl:f.ajaxUrl.fileUpload,showNameOnComplete:!1,onComplete:function(e,t){var n=e.data,o={};for(var a in n)o[n[a].key]=n[a].value;r.src=i.imgUrlCreate(o[l]),u.isFunction(i.onUploaded)&&i.onUploaded(o)}})}return this.deletable&&new c.Button({content:"删除图片",container:o,onClick:function(){var e;r.src="",u.isFunction(i.onUploaded)&&i.onUploaded(((e={})[l]="",e))}}),n},e.prototype.imgUrlCreate=function(e){return u.url.addObj(f.ajaxUrl.fileDownload,{md5_field:"FILE_ID",file_id:e,down:"allow"})},Object.defineProperty(e.prototype,"isShow",{get:function(){return this._isShow},set:function(e){this._isShow=!!e,this.modal&&(this.modal.isShow=this._isShow)},enumerable:!0,configurable:!0}),e.prototype.showImg=function(n,o){var a=this;this.imgs.forEach(function(e,t){e.src=o[t]?a.imgUrlCreate(o[t]):n[t]})},e}();t.TableImgEdit=n}),define("TableEdit",["require","exports","Modal","Tooltip","Loading","BwRule"],function(t,e,o,u,a,f){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=G.d,p=G.tools,h=BW.CONF,i=BW.sys,n=function(){function e(e){this.p=e,this.isEditing=!1,this.inMain=!0,this.tm=e.tm}return e.prototype.canRowInit=function(e,t){if(e)return!(t&&0===t.EDITEXPRESS);var n=this.tm.table.rowSelectDataGet()[0];return this.canRowInit(!0,n)},Object.defineProperty(e.prototype,"subTm",{get:function(){return this._subTm},set:function(e){var n=this;e&&(this._subTm=e,this.mainSub(function(e,t){r.on(e.table.wrapperGet(),"click",function(){n.inMain=t,"function"==typeof n.onFocusChangeHandler&&n.onFocusChangeHandler(t)})}))},enumerable:!0,configurable:!0}),e.prototype.init=function(e){var t=b(this.p.tableAddr),n=t.mainVarList,o=t.subVarList;s(n,["update","insert"])||s(o,["update","insert"])?this.editModuleLoad(e):"function"==typeof e&&e()},e.prototype.editModuleLoad=function(e){var l=this;this.mainSub(function(e){e.table.edit.init(),e.table.wrapperGet().classList.add("disabled")}),t(["EditModule"],function(a){var i=[];l.mainSub(function(e,t,n,o){i.push(l.initEditModule(a.EditModule,e).then(function(){e.table.wrapperGet().classList.remove("disabled")}))}),Promise.all(i).then(function(){"function"==typeof e&&e()}),p.event.fire("editChange",{status:1},l.tm.wrapper),l.isEditing=!0})},e.prototype.initEditModule=function(s,t){var n=this,c=t.table,o=t.defaultData,a=[t.getKeyField()],i=t.getDefAddr(),l=function(e){var r=new s({auto:!1,type:"table",fields:n.p.cols.map(function(e){return{dom:null,field:e}})});c.edit.initModify({defData:e,pasteExceptCols:a,comInit:function(i,e,l){var t;i.innerHTML="",r.init(l.name,{dom:i,data:e,field:l,onExtra:function(a,e,t){void 0===t&&(t=!1),p.isEmpty(a)&&t?c.edit.modifyTd(i,""):e.forEach(function(e){var t;if(e!==l.name){var n=d(i,e),o=p.str.toEmpty(a[e]);n?c.edit.modifyTd(n,o):c.edit.rowData(parseInt(i.parentElement.dataset.index),((t={})[e]=o,t))}})}}),r.set(((t={})[l.name]=e[l.name],t));var n=i.querySelector("input");n&&n.select()},validate:function(n,e,t,o){var a=e.name,i=r.validate.start(a),l=function(e,t,n){var o=c.getVisibleCol(),a=o.indexOf(e)>o.length/2;new u.Tooltip({visible:!1,errorMsg:n,el:t,length:"medium",pos:a?"left":"right"})};i&&i[a]?(l(a,d(n,a),i[a].errMsg),o(n,!1)):e.chkAddr&&!p.isEmpty(t[e.name])?s.checkValue(e,t,function(){return c.edit.modifyTd(n,"")}).then(function(e){e.errors&&e.errors.forEach(function(e){var t=d(n,e.name);t&&(l(e.name,t,e.msg),o(t,!1))}),e.okNames&&e.okNames.forEach(function(e){var t=d(n,e);t&&(u.Tooltip.clear(t),o(t,!0))})}):o(n,!0)},comDestroy:function(e){var t,n=e.name;r.set(((t={})[n]=r.get(n)[n],t)),r.destroy(n)},valGet:function(e){return r.get(e.name)},canInit:function(e,t){return 1===t?!e.noModify:!e.noEdit},canRowInit:function(e){return n.canRowInit(!t.isSub,t.isSub?null:e)}})};function d(e,t){return r.query('td[data-col="'+t+'"]',e.parentElement)}return new Promise(function(e,t){if(p.isNotEmpty(i)){var n={};Promise.all(i.map(function(e){return f.BwRule.Ajax.fetch(h.siteUrl+f.BwRule.reqAddr(e)).then(function(e){var t=e.response;n=Object.assign(n,o,t.data[0]||{})})})).then(function(){l(n),e()})}else l(o),e()})},e.prototype.mainSub=function(e,t){void 0===t&&(t=!0);var n=0,o=!1,a=!1,i=t?b(this.p.tableAddr):{mainVarList:null,subVarList:null},l=i.mainVarList,r=i.subVarList;!this.tm||t&&!s(l,["insert","update"])||(o=!0,n++),!this.subTm||t&&!s(r,["insert","update"])||(n++,a=!0),o&&e(this.tm,!0,0,n),a&&e(this.subTm,!1,o?1:0,n)},e.prototype.checkError=function(){var e=this.tm.table,t=this.subTm?this.subTm.table:null,n=e.edit.errorLen();return 0<n?(o.Modal.alert((t?"主表":"")+"有"+n+"个错误需要修改"),!1):!(t&&0<(n=t.edit.errorLen()))||(o.Modal.alert("从表有"+n+"个错误需要修改"),!1)},e.prototype.getData=function(o,a){var i={};return a&&["update","delete","insert"].forEach(function(e){var t=a[e+"Type"];if(a[e]&&o[t][0]){var n=f.BwRule.varList(a[e],o[t],!0);n&&(i[e]=n)}}),p.isEmpty(i)||(i.itemId=a.itemId),i},Object.defineProperty(e.prototype,"ctm",{get:function(){return this.inMain?this.tm:this.subTm},enumerable:!0,configurable:!0}),e.prototype.cancel=function(){this.isEditing&&(this.mainSub(function(e){return e.table.edit.cancel()}),this.isEditing=!1,this.tm.wrapper.classList.remove("disabled"),p.event.fire("editChange",{status:0},this.tm.wrapper))},e.prototype.save=function(n){var r=this,s={param:[]},e=b(this.p.tableAddr),c=e.mainVarList,d=e.subVarList;if(this.mainSub(function(e){return e.table.edit.reshowEditing()}),this.checkError()){var t=new a.Loading({msg:"保存中",disableEl:this.tm.wrapper});setTimeout(function(){r.mainSub(function(e,t){var o=r.tm.table.rowSelectDataGet()[0],a=e.table.edit.getData();if(!t){var n=function(n){a[n][0]&&a[n].forEach(function(e,t){a[n][t]=p.obj.merge(o,e)})};for(var i in a)n(i)}var l=r.getData(a,t?c:d);e.table.edit.reshowEditing(),p.isEmpty(l)||s.param.push(l)},!1),p.isEmpty(s.param)?(t.destroy(),r.cancel(),o.Modal.toast("没有数据改变"),n&&n()):f.BwRule.Ajax.fetch(h.siteUrl+r.p.tableAddr.dataAddr,{type:"POST",data:s}).then(function(e){var t=e.response;f.BwRule.checkValue(t,s,function(){r.mainSub(function(e){document.body.classList.contains("mui-android-4")?i.window.load(location.href):e.tableData.refresh(null,function(){e.aggregate.get(),p.event.fire("table-edit-saved",null,r.tm.wrapper)})}),o.Modal.toast(t.msg),n&&n(),r.cancel()})}).finally(function(){t.destroy()})},1800)}},e.prototype.add=function(e){this.inMain?this.tm.table.edit.addRow(e):this.subTm.table.edit.addRow(e)},e.prototype.del=function(){var t=this,e=this.subTm?this.subTm.table:null;!e||p.isEmpty(e.data.get())?this.tm.table.edit.deleteRow(function(e){return t.canRowInit(t.tm.isSub,t.tm.isSub?null:e)}):e&&!p.isEmpty(e.rowSelectDataGet())?e.edit.deleteRow(function(e){return t.canRowInit(t.tm.isSub,t.tm.isSub?null:e)}):o.Modal.alert("不能删除有明细的主表数据")},e.prototype.getStatus=function(){return this.isEditing},e.prototype.onFocusChange=function(e){this.onFocusChangeHandler=e},e.prototype.reshowEditing=function(){this.ctm&&this.ctm.table.edit.reshowEditing()},e.prototype.rowData=function(e,t){return this.ctm&&this.ctm.table.edit.rowData(e,t)},e}();function s(e,t){if(e)for(var n=0,o=["update","insert","delete"];n<o.length;n++){var a=o[n];if(-1<t.indexOf(e[a+"Type"]))return!0}return!1}function b(e){var t={mainVarList:null,subVarList:null};return e&&Array.isArray(e.param)&&e.param.forEach(function(e){"sub"===e.type?t.subVarList=e:"main"===e.type&&(t.mainVarList=e)}),t}e.TableEdit=n}),define("TableModulePc",["require","exports","TableModule","Spinner","Modal","PcTable","Scrollbar","Affix","InputBox","Button","TextInput","DropDown"],function(N,e,t,H,I,n,q,P,W,O,F,z){"use strict";var j=G.tools,i=BW.sys,_=G.d;return function(B){function A(){var f,p,h,b,m,e,r,s,c,t,d,a,i,l,u,v,g,o,y,w,C,x,k,T,L,S,E,R,M,D=null!==B&&B.apply(this,arguments)||this;return D.onLoad=(f=D,h=p=null,b=function(){var e=f.tableConf.scrollEl,t=_.query(".topBtns",e),n=_.query(".aggr-wrapper",e),o=_.query(".breadcrumb",e),a=t?t.offsetHeight:0,i=n?n.offsetHeight:0,l=o?o.offsetHeight:0;t&&(t.style.width="100%"),t&&(t.style.backgroundColor="rgb(247,247,248)"),n&&(e.style.paddingTop=a+i+l+"px"),t&&n&&(new P.Affix({el:t,target:e,offsetTop:0}),o&&new P.Affix({el:o,target:e,offsetTop:0})),n&&new P.Affix({el:n,target:e,offsetTop:t?24:0})},m=function(e,t){var n=e.style;n.backgroundColor="rgb(247,247,248)",n.textAlign="center",n.width="100%";var o=t.classList.contains("main-table")||t.classList.contains("sub-table")||t.classList.contains("privilege-select-content")?e.offsetHeight+9:e.offsetHeight+14;t.style.paddingBottom=o+"px"},{getscrollBar:function(){return p},init:function(){if(!p&&!f.isDrill||!h&&!f.isDrill){var n=f.tableConf.scrollEl,e=_.query(".sbarWrapper",n);e&&n.removeChild(e);var o=f.table.tableMiddle,t=_.query(".table-out-bottom",f.wrapper),a=t?t.offsetHeight+23:23;if(n.classList.contains("main-table")){var i=_.query(".topBtns",n).offsetHeight,l=_.query(".aggr-wrapper",n);setTimeout(function(){var e=_.query(".mobileTableWrapper",n).offsetHeight,t=l?n.offsetHeight-e-38-12:n.offsetHeight-i-e-12;o.style.paddingBottom=t+"px"},0)}var r={el:o,Container:n,marginBottom:a};t?(r.bottom=t.offsetHeight+10,p=new q.Scrollbar(r),m(t,n),h=new P.Affix({el:t,target:n})):p=new q.Scrollbar(r),c=(s=n).offsetWidth,d=s.offsetHeight,u=s.innerHTML,setInterval(function(){u!==s.innerHTML&&(p.updateStyle(),u=s.innerHTML),c===s.offsetWidth&&d===s.offsetHeight||(p.updateStyle(),c=s.offsetWidth,d=s.offsetHeight)},100),b()}var s,c,d,u},getBottomPaging:function(){return h}}),D.rightBtns=(e=D.wrapper.querySelector(".topBtns .btn-group.btnsRight"),c=s=r=null,t=new W.InputBox({container:e}),{init:function(){if(!D.para.isSub){var e=null,t=[{content:"导出",icon:"daochu2",type:"default"},{content:"统计",icon:"tongji",type:"default"}],n=[{content:"列统计",icon:"pinlei",type:"default",onClick:function(){D.statistic.initCount(e.wrapper)}},{content:"数据统计",icon:"statistic",type:"default",onClick:function(){D.statistic.initStatistic(e.wrapper)}},{content:"图形报表",icon:"bingzhuangtu",type:"default",onClick:function(){D.statistic.initChart(e.wrapper)}},{content:"交叉制表",icon:"shejiqijiaohuanxinglie",type:"default",onClick:function(){D.statistic.initCrosstab(e.wrapper)}},{content:"abc分析",icon:"tongji",type:"default",onClick:function(){D.statistic.initAnalysis(e.wrapper)}}],o=[{content:"csv",icon:"csv1",type:"default",onClick:function(){return D.export("csv")}},{content:"excel",icon:"excel",type:"default",onClick:function(){return D.export("xls")}},{content:"word",icon:"word",type:"default",onClick:function(){return D.export("doc")}},{content:"pdf",icon:"pdf",type:"default",onClick:function(){D.export("pdf")}},{content:"png",icon:"png",type:"default",onClick:function(){D.export("image")}}];r=new O.Button(t[0]),s=new O.Button(t[1]),r.dropDown=new z.DropDown({el:r.wrapper,inline:!1,data:[],multi:null,className:"input-box-morebtn"}),s.dropDown=new z.DropDown({el:s.wrapper,inline:!1,data:[],multi:null,className:"input-box-morebtn"});for(var a=0,i=n.length;a<i;a++)e=new O.Button(n[a]),s.dropDown.getUlDom().appendChild(e.wrapper);for(a=0,i=o.length;a<i;a++)r.dropDown.getUlDom().appendChild(new O.Button(o[a]).wrapper);D.para.printList&&0<D.para.printList.length&&(D.labelBtn=new O.Button({content:"标签打印",type:"default",icon:"label",onClick:function(){D.labelPrint.show(D.labelBtn.wrapper)}}),d(D.labelBtn)),c=new O.Button({content:"报表打印",type:"default",icon:"label",onClick:function(){D.formPrint.show(c.wrapper)}})}var l;D.para.querier&&3===D.para.querier.queryType&&(l=new O.Button({content:"查询器",type:"default",icon:"shaixuan",onClick:function(){D.queryModule.show()}}),d(l)),D.para.isSub&&!l||(d(new O.Button({icon:"wangyuanjing",content:"本地查找",onClick:function(){D.searchReplace.show()}})),d(new O.Button({icon:"sousuo",content:"本地过滤",onClick:function(){D.localSearch.show()}}))),d(c),d(s),d(r),_.on(D.wrapper,"editChange",function(e){var t=e.detail.status;r.isDisabled=t,s.isDisabled=t,l&&(l.isDisabled=t),D.labelBtn&&(D.labelBtn.isDisabled=t)})},add:d=function(e){e&&t.addItem(e)}}),D.labelPrint=(a=D,i=null,{show:function(e,t,n){null===i?function(e,t,n){if(a.para.printList){var o=new H.Spinner({el:e,size:14,type:H.Spinner.SHOW_TYPE.replace});o.show(),N(["LabelPrintModule"],function(e){(i=new e({printList:t||a.para.printList,container:_.closest(a.wrapper,"div.page-container"),cols:a.table.getVisibleCol(),getData:function(){return a.table.dataGet()},selectedData:function(){return a.table.rowSelectDataGet()},callBack:function(){n&&n()}})).modal.isShow=!0,o.hide()})}}(e,t,n):i.modal.isShow=!0}}),D.formPrint=(l=D,u=null,{show:function(e,t,n){null===u?function(e,t,n){if(l.para.printList){var o=new H.Spinner({el:e,size:14,type:H.Spinner.SHOW_TYPE.replace});o.show(),N(["FormPrintModule"],function(e){(u=new e({container:_.closest(l.wrapper,"div.page-container"),cols:l.para.cols,middleTable:l.table.tableELGet(),tableData:function(){return l.table.dataGet()}})).modal.isShow=!0,o.hide()})}}(e):u.modal.isShow=!0}}),D.searchReplace=(w=null,C={},k="",T=!(x={}),v=-1,g=function(e){return _.queryAll('tbody td[data-high-index="'+e+'"]',D.table.wrapperGet())},L={next:o=function(e){void 0===e&&(e=k);var t=!1,n=D.tableConf.scrollEl,o=null;if(D.subTable&&(o=D.subTable),e!=k&&(D.table.highlight(e),o&&(o.table.highlight(e),o.searchReplace.search.setSearchStr(e)),y(e),T=!(t=!0)),o&&T)return!(T=o.searchReplace.search.next(e));t&&(_.queryAll("tbody td.searched",D.table.wrapperGet()).forEach(function(e){e.classList.remove("searched")}),v=-1),g(v).forEach(function(e){e.classList.remove("searched")});var a=g(++v);if(a[0]){a.forEach(function(e){e.classList.add("searched"),"scrollIntoViewIfNeeded"in e?e.scrollIntoViewIfNeeded(!1):e.scrollIntoView(!1)});var i=n.getBoundingClientRect().bottom-a[0].getBoundingClientRect().bottom;return i<80&&(n.scrollTop=n.scrollTop+(80-i)),o&&(T=!1),!0}return v=-1,o&&(T=!0,o.searchReplace.search.next()),!1},clear:function(n){void 0===n&&(n=v),_.queryAll("tbody td[data-high-index]",D.table.wrapperGet()).forEach(function(e){var t=parseInt(e.dataset.highIndex);n<=t&&(t===n?delete e.dataset.highIndex:e.dataset.highIndex=t-1+"")}),n<=v&&v--,o()},clearAll:function(){_.queryAll("tbody td.searched",D.table.wrapperGet()).forEach(function(e){e.classList.remove("searched")}),v=-1,k=""},setSearchStr:y=function(e){k=e}},S=function(e,t){if(e!=k&&C.next&&C.next.onClick)return C.next.onClick(null),!0;var n=null;if(D.subTable&&(n=D.subTable),T)return n.searchReplace.replace(e,t);if(!_.query("tbody td[data-high-index]",D.table.wrapperGet()))return C.next&&C.next.onClick?(C.next.onClick(null),!0):(L.next(e),!!_.query("tbody td[data-high-index]",D.table.wrapperGet()));var o=_.query("tbody td.searched",D.table.wrapperGet());if(!o)return!D.para.isSub;var a=j.str.removeHtmlTags(o.innerHTML);o.click();var i=_.query("input",o);if(i){var l=new RegExp("("+j.escapeRegExp(e)+")","ig");return i.value=a.replace(l,t),L.clear(parseInt(o.dataset.highIndex)),o.classList.remove("searched"),D.tableEdit.reshowEditing(),!0}return L.next(),!0},E=function(e,t){for(;S(e,t););L.clearAll()},{show:function(){w||function(){if(!w){var e,n={search:function(e){x.search=new F.TextInput({container:e,placeholder:"查找..."})},replace:function(e){x.replace=new F.TextInput({container:e,placeholder:"替换为..."})}},o={next:function(e){C.next=new O.Button({container:e,content:"查找下一个",onClick:function(){var e=x.search.get();L.next(e)}})},replace:function(e){C.replace=new O.Button({container:e,content:"替换",onClick:function(){var e=x.replace.get(),t=x.search.get();S(t,e)}})},replaceAll:function(e){C.replaceAll=new O.Button({container:e,content:"替换全部",onClick:function(){E(x.search.get(),x.replace.get())}})}},a=_.create('<div class="rows"><div class="col-xs-6 search"><div data-input="search"></div><div data-btn="next"></div></div><div class="col-xs-6 replace"><div class="rows"><div data-input="replace"></div></div><div class="rows"><div class="col-xs-4"><div data-btn="replace"></div></div><div class="col-xs-6"><div data-btn="replaceAll"></div></div></div>'),t=!!D.tableEdit&&D.tableEdit.getStatus();t||i(t),e=_.queryAll("[data-input], [data-btn]",a),Array.isArray(e)&&e.forEach(function(e){var t=e.dataset;t.input&&n[t.input]?n[t.input](e):t.btn&&o[t.btn]&&o[t.btn](e)}),w=new I.Modal({className:"search-replace",header:"查找/替换",body:a,isBackground:!1,isShow:!1}),_.on(D.wrapper,"editChange",function(e){i(e.detail.status)})}function i(e){var t=_.query(".replace",a),n=_.query(".search",a);t.classList[e?"remove":"add"]("hide"),n.classList[e?"remove":"add"]("col-xs-12"),n.classList[e?"add":"remove"]("col-xs-6")}}(),w.isShow=!0},search:L,replace:S,replaceAll:E}),D.handleSubTable=(R=_.create('<div class="table-module-wrapper sub-table"></div>'),M=_.create('<table class="subTable"><tbody></tbody></table>'),function(e,t,n,o){if(null===D.subTable){_.closest(D.wrapper,".tablePage").classList.add("has-subTable"),D.wrapper.classList.add("main-table"),_.append(R,M),_.after(D.wrapper,R),D.subTableData.tableAddr=D.para.tableAddr;var a=R.getBoundingClientRect().top;D.subTable=new A({tableEl:M,scrollEl:R,ajaxData:t,fixTop:a},D.subTableData),j.event.fire("subTableInit",null,D.wrapper)}else D.subTable.refresher(t);n();var i=D.table.rowSelectDataGet();D.subTable.aggregate.get(i&&i[0]?i[0]:null)}),D}return __extends(A,B),A.prototype.initWrapper=function(e){var t=_.create('<div class="table-module-wrapper"></div>'),n=_.create('<div class="topBtns"><div class="btn-group btnsRight"></div><div style="clear:both"></div></div>');if(_.replace(t,e),_.append(t,n),_.append(t,e),this.wrapper=t,!this.para.isSub){var o=_.create('<div class="btn-group btnsLeft"></div>'),a=_.create('<div class="btn-group btnsMiddle"></div>');_.prepend(n,a),_.prepend(n,o),this.subTableData&&(this.tableConf.scrollEl=t)}},A.prototype.onComplete=function(){var a=this;this.para.isSub||(this.isDrill?this.initDrillBut.init(this.wrapper):(this.editBtns.init(_.query(".topBtns .btn-group.btnsMiddle",this.wrapper)),this.initSubBtns(_.query(".topBtns .btn-group.btnsLeft",this.wrapper)))),setTimeout(function(){a.rightBtns.init()},0),_.on(this.wrapper,"pageToggle",function(e){if(e.detail.isShow){var t=_.query(".table-out-bottom",a.wrapper),n=void 0;if(t){n=t.offsetHeight,a.onLoad.getscrollBar().setConfBottom(n);var o=_.closest(a.wrapper,"div.modal-body")||_.closest(a.wrapper,"div.page-container");j.event.fire("scroll",{},o)}}else a.onLoad.getscrollBar()&&a.onLoad.getscrollBar().setConfBottom(0)}),this.showDetailBut()},A.prototype.showDetailBut=function(){var c=this.table,d=this,u=null;function f(){u.classList.remove("hide")}function p(){u.classList.add("hide")}_.on(c.wrapperGet(),"mouseover","tbody td .detail-more",function(e){!function(e){u&&(_.remove(u),_.off(u,"mouseover",f),_.off(u,"mouseout",p));switch(e){case"string":case"html":u=_.create('<div class="hide showDetail"></div>');break;case"multiText":u=_.create('<pre class="hide showDetail"></pre>')}_.append(d.wrapper,u),_.on(u,"mouseover",f),_.on(u,"mouseout",p)}(this.dataset.textType);var t=parseInt(_.closest(this,"tr").dataset.index),n=_.closest(this,"td").dataset.col,o=this.getBoundingClientRect(),a=d.para.isSub||d.subTableData?d.wrapper.getBoundingClientRect():document.body.getBoundingClientRect();u.classList.remove("hide"),u.innerHTML=""+c.rowDataGet(t)[n];var i=u.offsetHeight,l=u.offsetWidth,r=o.bottom+i,s=o.left+l;u.style.top=(r>a.bottom?o.top-i:o.bottom)+"px",u.style.left=(s>o.right?o.left-(s-o.right):o.left-40)+"px"}),_.on(c.wrapperGet(),"mouseout","tbody td .detail-more",function(e){u.classList.add("hide")})},A.prototype.tableConfGet=function(e){var r=this,t=B.prototype.tableConfGet.call(this,e),n={colResize:!0,move:!0,colGroup:this.isDrill,cellMaxWidth:200,onComplete:function(){"function"==typeof t.onComplete&&t.onComplete()}},o=[];return this.para.cols.forEach(function(a){var e=a.title;o.push({multi:!1,title:e,callback:function(e,t,n){if(t&&t[0]){var o=_.query('[data-col="'+a.name+'"]',t[0]);i.window.copy(o.innerHTML)}}})}),t.rowMenu.push({multi:!1,title:"列复制",callback:function(e,t,n){},children:o}),t.rowMenu.push({multi:!1,title:"复制单元格",callback:function(e,t,n){i.window.copy(_.closest(n,"td").innerHTML)}}),t.rowMenu.push({multi:!0,title:"复制选中区域",callback:function(e,t){for(var n=[],o=[],a=r.table.drag.getData(),i=0,l=a.cols.length;i<l;i++)n.push(a.cols[i].name);for(i=a.indexes[0];i<=a.indexes[1];i++)o.push(i);r.table.copy.row(o,!1,n)}}),j.obj.merge(!0,t,n)},A.prototype.initTable=function(e){return new n.PcTable(e)},A.prototype.imgHtmlGet=function(e){return'<img style="max-height: 100%" src="'+e+'" alt="">'},A}(t.TableModule)}),define("TableModule",["require","exports","paging","Modal","Spinner","Button","QueryBuilder","InputBox","ButtonAction","TableEdit","TableDataModule","TableImgEdit","ImgModal","BwRule"],function(ne,e,oe,ae,ie,le,re,se,a,ce,de,u,c,ue){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var fe=G.tools,pe=BW.CONF,he=BW.sys,be=G.d,t=function(){function e(e,n){var t,o,i,s,c,d,f,p,b,m,a,l,r,u,v,g,y,w,C,x,k,T,L,S,E,R,M,D,B,A,N,H,I,G,q,P,W,O,F,z,j=this;this.tableConf=e,this.para=n,this.wrapper=null,this.refresher=null,this.table=null,this.subTable=null,this.isSub=!1,this.defaultData={},this.pageUrl="",this.maxCellWidth=fe.isMb?600<document.body.offsetWidth?30:15:30,this.cols=[],this.tableData=null,this.aggregate=(t=null,o=j.para.aggrList,i=null,{get:function(e){(null!==t||Array.isArray(o)&&o[0]&&(t=h("div",{className:"aggr-wrapper"}),be.before(j.table.wrapperGet(),t),1))&&(e&&(i=e),t.innerHTML="",o.forEach(function(o){var a=h("span",null,o.caption,":");be.append(t,a),ue.BwRule.Ajax.fetch(pe.siteUrl+ue.BwRule.reqAddr(o.dataAddr,i)).then(function(e){var t=e.response,n=fe.keysVal(t,"data",0,fe.keysVal(t,"meta",0));a.innerHTML=o.caption+":"+(n||0)+" &nbsp;&nbsp;"})}))}}),this.initTableEvent=(s=j,c=[],d={},{init:function(r){if(r.clickEvent.add("td[data-href], td[data-click-type]",function(e){if("file"===this.dataset.hrefType)ue.BwRule.link({link:this.dataset.href,dataType:ue.BwRule.DT_FILE,callback:function(e,t,n){he&&he.window.download(t.DOWNADDR)}});else if("btn"===this.dataset.clickType){var t=s.subBtn.children||[],n=this.dataset.col;s.table.rowSelect(this.parentElement);for(var o=0,a=t;o<a.length;o++){var i=a[o],l=i.data;l&&l.linkName&&l.linkName===n&&i.onClick.call(i,null)}}else he&&he.window.open({url:pe.siteUrl+this.dataset.href,gps:!!parseInt(this.dataset.gps)},s.pageUrl);e.stopPropagation()}),r.clickEvent.add("tr td.td-img, tr[data-click-type]",function(e){var t="TD"===this.tagName,n=parseInt(t?this.parentElement.dataset.index:this.dataset.index),o=s.para.pictureAddrList.map(function(e){return pe.siteUrl+ue.BwRule.reqAddr(e,r.rowDataGet(n))});s.handleImg(o,n)}),fe.isMb&&r.clickEvent.add("td > .more-text-button",function(e){var t=be.closest(this,"td").dataset.col,n=parseInt(be.closest(this,"tr").dataset.index),o=s.table.rowDataGet(n)[t];ae.Modal.alert(fe.str.removeHtmlTags(o))}),j.subTableData){var t=function(e){var t=this,n=parseInt(this.dataset.index),o=ue.BwRule.varList(s.subTableData.dataAddr.varList,r.rowDataGet(n)),a=s.tableData.getQueryPara();delete(o=fe.obj.merge(a,o)).queryoptionsparam,s.handleSubTable(this.dataset.subUrl,o,function(){r.rowSelect(t)},function(){r.rowDeselect(this)})};r.clickEvent.add("tr[data-sub-url]",t),be.on(j.wrapper,"editChange",function(e){r.clickEvent[1===e.detail.status?"remove":"add"]("tr[data-sub-url]",t)})}1===j.para.multPage&&r.clickEvent.add("thead th[data-col]",function(e){var t=function(e){for(var t=s.para.cols,n=0,o=t.length;n<o;n++)if(t[n].name===e)return t[n].dataType}(this.dataset.col);if(ue.BwRule.DT_IMAGE!==t&&ue.BwRule.DT_HTML!==t&&ue.BwRule.DT_MULTI_TEXT!==t&&ue.BwRule.DT_FILE!==t&&!(this.classList.contains("disabled")||r.colResize.dragging||r.moving)){var n=null,o=this.dataset.col;fe.isMb&&(n=new ie.Spinner({el:document.body,type:ie.Spinner.SHOW_TYPE.cover,className:"text-center"})),n&&n.show(),s.pagination.setParam(1);var a=s.tableData.getQueryPara();if(d[o]||(d[o]="asc"),e.ctrlKey||e.shiftKey)for(var i=0;i<c.length;i++)c[i]===o+","+d[o]&&c.splice(i,1);else{var l=void 0;c=[],d[o]&&(l=d[o]),(d={})[o]=l||"asc"}d[o]="asc"===d[o]?"desc":"asc",c.push(o+","+d[o]),a.pagesortparams=JSON.stringify(c),s.pagination.setParam(1),s.tableData.refresh(a,function(e){var t=e.head.totalNum?e.head.totalNum:e.data.length;0!==s.para.multPage&&t>s.pagination.pageLen&&s.pagination.reset({offset:0,recordTotal:e.head.totalNum?e.head.totalNum:e.data.length}),n&&n.hide()})}}),r.clickEvent.on()},getPageSortParams:function(){return{pagesortparams:JSON.stringify(c)}}}),this.pagination=function(){var l=null,t={},r=j,s={count:1,current:0,size:50,offset:0};function n(){return{pageparams:'{"index"=1 , "size"='+(1===r.para.multPage?50:3e3)+' ,"total"=1}'}}t=n();var c=function(e){t={pageparams:'{"index"='+e+' , "size"='+(1===r.para.multPage?s.size:3e3)+' ,"total"=1}'}},a=function(e){var t=be.query(".table-out-bottom",j.wrapper);t&&(t.style.display=e?"block":"none"),fe.event.fire("pageToggle",{isShow:e},j.wrapper)};return{reset:function(e){var t,n,a,o,i;null===l?(t=e,n=h("div",{className:"table-out-bottom"}),a=j.table,o=a.wrapperGet(),i=j.tableConf.scrollEl,o.appendChild(n),(l=new oe.Paging({el:fe.isMb?j.para.isSub?j.wrapper:o:n,pageOption:fe.isMb?null:[50,200,500],pageSize:50,recordTotal:t.recordTotal,change:function(e){e.count;var t=e.current,n=(e.offset,e.size);if(!fe.isMb){var o=j.tableConf.scrollEl;o&&(o.scrollTop=0)}1===r.para.multPage?(s=e,c(t),r.tableData.ajax(null,function(e){e&&(r.tableData.dealTable(e.data,!fe.isMb),r.localSearch.setOriginData(r.table.data.get())),fe.isMb&&l.reset({last:!1}),setTimeout(function(){r.onLoad&&r.onLoad.getscrollBar()&&r.onLoad.getscrollBar().updateStyle()},0)})):fe.isMb?setTimeout(function(){a.render((t-1)*n,t*n,!1),fe.isMb&&l.reset({last:!1})},500):(a.render((t-1)*n,t*n),setTimeout(function(){r.onLoad&&r.onLoad.getscrollBar()&&r.onLoad.getscrollBar().updateStyle()},0))},scroll:fe.isMb?{Container:j.para.isSub?j.wrapper:i===window?null:i,auto:!0,content:"加载中...",nomore:"已加载完全部数据"}:null})).go(1)):l.reset(e)},getParam:function(e){return void 0===e&&(e=!1),e&&(t=n()),t},getCurrentState:function(){return s},setParam:c,isShow:function(e){var t,n=e.data?e.data:e;e.head&&(t=e.head.totalNum);var o=t?t>r.pagination.pageLen:n.length>r.pagination.pageLen;a(o)},pageLen:50,show:a}}(),this.getMulitPara=(f=[],p=[],b=0,m=[],{getMulitCols:function(t,e){if(m=[],f=[],p=[],!e){var n=t;t=[];for(var o=0,a=n.length;o<a;o++)if(n[o].subcols)for(var i=0,l=n[o].subcols.length;i<l;i++)t.push({name:n[o].subcols[i].name,title:n[o].title+"."+n[o].subcols[i].caption});else t.push({name:n[o].name,title:n[o].title})}var r,s;function c(e){for(r=0;r<t.length;r++)e(t[r],r)}function d(e){for(r=0;r<p.length;r++)e(p[r])}function u(e){for(r=0;r<f.length;r++)for(s=0;s<f[r].length;s++)e(f[r][s])}for(c(function(e,t){p[t]=e.title.split("."),p[t][p[t].length-1]+="|"+e.name,m.push(e)}),d(function(e){b<e.length&&(b=e.length)}),c(function(e,t){var n=e.title.split(".");p[t][p[t].length-1]+="|"+(b-(n.length-1))}),r=0;r<b;r++)f[r]=[];return d(function(e){!function(e){function t(e){for(var t=0;t<f.length;t++)for(var n=0;n<f[t].length;n++)if(f[t][n].title===e)return!0;return!1}if(e instanceof Array)for(var n=0;n<e.length;n++)!t(e[n])&&f[n].push({title:0<e[n].indexOf("|")?e[n].split("|")[0]:e[n],name:0<e[n].indexOf("|")?e[n].split("|")[1]:null,rowspan:parseInt(0<e[n].indexOf("|")?e[n].split("|")[2]:1),parent:0===n?null:e[n-1]})}(e)}),u(function(e){e.colspan=function(e){var t,n,o=0;for(t=0;t<f.length;t++)for(n=0;n<f[t].length;n++)f[t][n].parent===e&&o++;return 0===o?1:o}(e.title)}),u(function(e){delete e.parent}),f},getColsIndex:function(){return m}}),this.localSearch=(a=this,g=function(){a.para.multPage=v,a.tableData.dealTable(u,!0),0!==v&&u.length>a.pagination.pageLen&&a.pagination.reset({offset:0,recordTotal:u.length}),a.pagination.isShow(u)},{show:(l=y=v=u=null,r=function(){w(),l.isShow=!1},function(){!function(){if(null===y){var e=fe.isMb?h("div",{className:"mui-content"},h("ul",{className:"mui-table-view","data-query-name":"local"}),h("div",{"data-action":"add","data-name":"local",className:"mui-btn mui-btn-block mui-btn-primary"},h("span",{className:"mui-icon mui-icon-plusempty"})," 添加条件")):h("form",{className:"filter-form","data-query-name":"local"},h("span",{"data-action":"add",className:"iconfont blue icon-jiahao"}));(l=new ae.Modal({container:be.closest(j.wrapper,".page-container"),header:"本地过滤",body:e,position:fe.isMb?"full":"",width:"730px",className:"local queryBuilder"})).className="",l.className="",fe.isMb?(l.modalHeader.rightPanel=(o=new se.InputBox,a=new le.Button({content:"清除",onClick:function(){g(),l.isShow=!1}}),i=new le.Button({icon:"sousuo",onClick:r}),o.addItem(a),o.addItem(i),o),mui(e).on("tap",'[data-action="add"]',function(){y.rowAdd();var e=this.previousElementSibling;e.scrollTop=e.scrollHeight})):l.footer={rightPanel:(n=new se.InputBox,n.addItem(new le.Button({content:"取消",type:"default",key:"cancelBtn"})),n.addItem(new le.Button({content:"清除",type:"default",key:"clearBtn",onClick:function(){g(),l.isShow=!1}})),n.addItem(new le.Button({content:"查询",type:"primary",onClick:r,key:"queryBtn"})),n)},y=new re.QueryBuilder({queryConfigs:(t=j.cols,t.map(function(e){return{caption:e.title,field_name:e.name,dynamic:0,link:"",type:"",atrrs:e.atrrs}})),resultDom:fe.isMb?be.query("ul.mui-table-view",e):e,setting:null})}var t,n,o,a,i}(),l.isShow=!0}),search:w=function(){var e=y.dataGet();if(e&&e.params){var t=function(o){var a=u,i=[];function e(e){for(var t=0;t<i.length;t++){var n=i[t][e.field];e.not?l(n,e)&&(i.splice(t,1),t--):l(n,e)||(i.splice(t,1),t--)}}function l(e,t){switch(t.op){case 2:if(e==t.values[0])return!0;break;case 3:if(e>t.values[0])return!0;break;case 4:if(e>=t.values[0])return!0;break;case 5:if(e<t.values[0])return!0;break;case 6:if(e<=t.values[0])return!0;break;case 7:if(e>=t.values[0]&&e<=t.values[1])return!0;break;case 9:if("string"==typeof e&&-1<e.indexOf(t.values[0]))return!0;break;case 10:if(!e&&0!==e)return!0}return!1}!function(){for(var e=0,t=a.length;e<t;e++){var n=a[e][o[0].field];o[0].not?l(n,o[0])||i.push(a[e]):l(n,o[0])&&i.push(a[e])}}();for(var t=1,n=o.length;t<n;t++)e(o[t]);return i}(e.params);j.para.multPage=2,j.pagination.setParam(1),j.tableData.dealTable(t,!0),0!==v&&t.length>j.pagination.pageLen&&j.pagination.reset({offset:0,recordTotal:t.length}),j.pagination.isShow(t)}},queryDataGet:function(){return y?y.dataGet():null},setOriginData:function(e){u=e},setOriginMultPage:function(e){v=e},getOriginMultPage:function(){return v}}),this.statistic=(L=T=k=x=C=null,S=function(){for(var e=0;e<j.cols.length;e++)if(ue.BwRule.isNumber(j.cols[e].dataType))return!0;return!1},{initStatistic:function(e){if(!S())return ae.Modal.alert("无可统计字段"),!1;var t=function(){new T({container:be.closest(j.wrapper,"div.page-container"),cols:j.cols,colDataGet:function(e){return j.table.colDataGet(e)},paraGet:function(){var e=j.tableConfGet({tmPara:j.para,btPara:{}});return delete e.cellMaxWidth,delete e.onComplete,e},getVisibleCol:function(){return j.table.getVisibleCol()}}).getModal().isShow=!0};if(!T&&S()){var n=null;e&&(n=new ie.Spinner({el:e,size:14,type:ie.Spinner.SHOW_TYPE.replace})),n&&n.show(),ne(["StatisticBasic"],function(e){T=e,t(),n&&n.hide()})}else t()},initChart:function(e){if(!S())return ae.Modal.alert("无可统计字段"),!1;var t=function(){new C({container:be.closest(j.wrapper,"div.page-container"),cols:j.cols,allData:function(){return j.table.data.get()},selectedData:function(){return j.table.rowSelectDataGet()},colDataGet:function(e){return j.table.colDataGet(e)},getTablePara:function(){return j.para},getWrapper:function(){return j.wrapper},getVisibleCol:function(){return j.table.getVisibleCol()}}).getModal().isShow=!0};if(!C&&S()){var n=null;e&&(n=new ie.Spinner({el:e,size:14,type:ie.Spinner.SHOW_TYPE.replace})),n&&n.show(),ne(["ChartBasic"],function(e){C=e,t(),n&&n.hide()})}else t()},initCrosstab:function(e){if(!S())return ae.Modal.alert("无可统计字段"),!1;var t=function(){new x({container:be.closest(j.wrapper,"div.page-container"),cols:j.cols,allData:function(){return j.table.data.get()},selectedData:function(){return j.table.rowSelectDataGet()},paraGet:function(){var e=j.tableConfGet({tmPara:j.para,btPara:{}});return delete e.cellMaxWidth,delete e.onComplete,e},getVisibleCol:function(){return j.table.getVisibleCol()}}).getModal().isShow=!0};if(!x&&S()){var n=null;e&&(n=new ie.Spinner({el:e,size:14,type:ie.Spinner.SHOW_TYPE.replace})),n&&n.show(),ne(["CrossTabBasic"],function(e){x=e,t(),n&&n.hide()})}else t()},initAnalysis:function(e){if(!S())return ae.Modal.alert("无可统计字段"),!1;var t=function(){new k({container:be.closest(j.wrapper,"div.page-container"),cols:j.cols,allData:function(){return j.table.data.get()},selectedData:function(){return j.table.rowSelectDataGet()},paraGet:function(){var e=j.tableConfGet({tmPara:j.para,btPara:{}});return delete e.cellMaxWidth,delete e.onComplete,e},getVisibleCol:function(){return j.table.getVisibleCol()}}).getModal().isShow=!0};if(!k&&S()){var n=null;e&&(n=new ie.Spinner({el:e,size:14,type:ie.Spinner.SHOW_TYPE.replace})),n&&n.show(),ne(["AnalysisBasic"],function(e){k=e,t(),n&&n.hide()})}else t()},initCount:function(e){var t=function(){new L({container:be.closest(j.wrapper,"div.page-container"),cols:j.cols,colDataGet:function(e){return j.table.colDataGet(e)},getVisibleCol:function(){return j.table.getVisibleCol()}}).getModal().isShow=!0};L?t():ne(["Count"],function(e){L=e,t()})}}),this.initDrillBut=(E=this,D=M=R=null,{init:function(n){R=h("div",null),M=h("div",null),D=h("div",null),M.style.display="inline-block",D.style.display="none",new le.Button({container:M,icon:"bingzhuangtu",size:"large",type:"text",onClick:function(e){E.statistic.initChart(M)}}),new le.Button({container:D,size:"large",icon:"biaoge",type:"text",onClick:function(e){var t=be.query(".Echart_body",n);t&&(t.style.display="none"),be.query(".mobileTableWrapper",n).style.display="block",D.style.display="none"}}),R.classList.add("statisticsChart"),R.appendChild(M),R.appendChild(D);var e=be.closest(n,"li");be.append(fe.isMb?e.firstElementChild:n.parentElement,R)},getChartBut:function(){return M},getTableBut:function(){return D}}),this.tableEdit=null,this.editBtns=(N=!1,H={},I=[],q=G=null,B=j,A=function(){var e=this;N=!0,B.tableEdit.init(function(){O(),e.click()})},P={on:function(){be.on(j.wrapper.parentNode,"dblclick",".table-module-wrapper tbody td",A)},off:function(){be.off(j.wrapper.parentNode,"dblclick",".table-module-wrapper tbody td",A)}},W={end:function(e){var t=e?q:G,n={edit:me(q,["update"])||me(G,["update"]),insert:me(t,["insert"]),del:me(t,["delete"]),save:!1,cancel:!1};for(var o in H)H[o]&&(H[o].isDisabled=!n[o])},start:function(e,t){void 0===t&&(t=!1);var n=e?q:G,o={edit:!1,insert:me(n,["insert"]),del:me(n,["delete"]),save:!0,cancel:!0};for(var a in H)!H[a]||t&&"edit"===a||(H[a].isDisabled=!o[a])}},F=function(){N=!1,W.end(!0),j.pagination.show(!0),fe.isMb||P.on()},z={insert:function(){N?j.tableEdit.add():j.tableEdit.init(function(){N=!0,O(),j.tableEdit.add()})},del:function(){var e=fe.isEmpty,t=j.subTable&&j.subTable.table;e(j.table.rowSelectDataGet())&&e(t&&t.rowSelectDataGet())||(O(!0),j.tableEdit.del())},save:function(){j.tableEdit.save(function(){return F()})},cancel:function(){j.tableEdit.cancel(),F()},edit:function(){j.tableEdit.init(function(){O(),N=!0})}},{init:function(e){!function(e){var t=j.para.tableAddr,n=ve(t);if(G=n.subVarList,(q=n.mainVarList)||G){j.tableEdit=new ce.TableEdit({tm:j,tableAddr:t,cols:j.para.cols}),j.tableEdit.onFocusChange(function(e){W[N?"start":"end"](e)}),be.once(j.wrapper,"subTableInit",function(){j.tableEdit.subTm=j.subTable}),I=[{content:"编辑",subType:"edit"},{content:"新增",subType:"insert"},{content:"删除",subType:"del"},{content:"保存",subType:"save"},{content:"取消",subType:"cancel"}];var o=new se.InputBox({container:e});I.forEach(function(e){var t=new le.Button({content:e.content,data:e});t.onClick=function(){var e=t.data.subType;z[e]&&z[e]()},o.addItem(t),H[e.subType]=t})}}(e),W.end(!0),fe.isMb||P.on()},edit:function(){return z.edit()},has:function(){var e=ve(j.para.tableAddr),t=e.mainVarList,n=e.subVarList;return t||n},btnStart:O=function(e){void 0===e&&(e=!1),W.start(!0,e),j.pagination.show(!1),fe.isMb||P.off(),N=!0},btnSave:function(){return z.save()}});var _=this,U=e.tableEl,V=this.para.dataAddr?pe.siteUrl+ue.BwRule.reqAddr(this.para.dataAddr):null,Y=n.subTableList;this.colsInit(),this.isSub=this.para.isSub,this.isDrill=-1<["web","webdrill","drill"].indexOf(this.para.uiType),Y&&Y[0]&&(Y[0].isSub=!0,this.subTableData=Y[0],this.subTableData.tableAddr=this.para.tableAddr),this.initWrapper(U),this.wrapper||(this.wrapper=U.parentElement),this.pageUrl=function(){if(fe.isMb)return location.href;var e=be.closest(j.wrapper,".page-container[data-src]");return e?e.dataset.src:""}(),this.tableData=new de.TableDataModule({tableModule:this,tableConf:e,para:n,pageUrl:this.pageUrl});var X=n.querier&&3===n.querier.queryType;if("P"===n.relateType)X?_.refresher=function(e,t){_.initPivotTable(U,n,e,t)}:_.initPivotTable(U,n,null);else{for(var Q=!1,K=0;K<this.cols.length;K++)if(this.cols[K].subcols){Q=!0;break}var J={table:U,cols:this.cols};if(Q&&(J.multi={enabled:!0,cols:this.getMulitPara.getMulitCols(this.cols,!1)},J.cols=this.getMulitPara.getColsIndex()),this.initTableModule(J,n,function(){_.onComplete()}),_.initTableEvent.init(_.table),_.para.isSub||_.aggregate.get(),_.refresher=function(e,t,n){j.tableData.innerRefresher(e,t,n)},V&&!X){var $=_.pagination.getParam(!0);"object"==typeof e.ajaxData&&($=fe.obj.merge($,e.ajaxData)),setTimeout(function(){j.tableData.innerRefresher($,j.tableData.cbFun.getOuterAfter(),j.tableData.cbFun.getOuterBefore())})}else if(_.para.data){var Z=_.para.data;this.tableData.dealData(Z,Z.length)}else this.tableData.dealData([],0)}if(X){var ee=fe.isMb?"QueryModuleMb":"QueryModulePc",te=be.closest(this.wrapper,"div.modal-wrapper");1===n.querier.autTag&&te&&te.classList.add("hide"),ne([ee],function(e){j.queryModule=new e({qm:j.para.querier,refresher:function(e,t,n){j.refresher(e,t,n),te&&te.classList.remove("hide")},cols:j.cols,url:V,container:be.closest(U,".page-container"),tableGet:function(){return _.table}}),fe.isMb&&be.on(be.query('body > header [data-action="showQuery"]'),"click",function(){j.queryModule.show()}),0===n.querier.autTag?j.queryModule.hide():te&&te.classList.add("hide")})}}return e.prototype.colsInit=function(){var e=this.para.cols;e.forEach(function(e){-1<ue.BwRule.NoShowFields.indexOf(e.name)&&(e.noShow=!0),e.dataType!==ue.BwRule.DT_DATETIME||e.displayFormat||(e.displayFormat="yyyy-MM-dd HH:mm:ss"),e.dataType!==ue.BwRule.DT_TIME||e.displayFormat||(e.displayFormat="HH:mm:ss")}),this.defaultData=ue.BwRule.getDefaultByFields(e),this.cols=e.filter(function(e){return!e.noShow})},e.prototype.initTableModule=function(e,t,n){this.table=this.initTable(this.tableConfGet({tmPara:t,btPara:e})),n()},e.prototype.tableConfGet=function(n){var u=this,f=this,e=n.tmPara,t=n.btPara,o={lockColNum:e.fixedNum,move:!1,indexCol:"number",indexColMulti:!("multiSelect"in e)||e.multiSelect,cols:t.cols||e.cols};"fixTop"in this.tableConf&&(o.lockRow=!0,o.lockRowTop=this.tableConf.fixTop);var a={sort:1===f.para.multPage?2:1,thead:!0,Container:this.tableConf.scrollEl,colMenu:[{multi:!0,title:"复制列",callback:function(e,t){he&&he.window.copy(u.table.copy.col(t[0].dataset.col,!0))}}],rowMenu:[{multi:!0,title:"复制行",callback:function(e,t){he&&he.window.copy(u.table.copy.selectedRow(!0))}}],textFormat:function(e,t,n){var o,a=e[t.name];if(t.dataType===ue.BwRule.DT_IMAGE&&t.link)o=f.imgHtmlGet(fe.url.addObj(pe.siteUrl+ue.BwRule.reqAddr(t.link,e),u.tableData.getQueryPara()));else if("STDCOLORVALUE"===t.name){var i=fe.val2RGB(a);o='<div style="background-color:rgb('+i.r+","+i.g+","+i.b+');height: 100%;"></div>'}else if("lookup"===t.elementType)for(var l=0,r=u.tableData.lookUpData[t.name]||[];l<r.length;l++){var s=r[l];s.value==a&&(o=s.text)}else o=ue.BwRule.formatTableText(a,t);var c=u.maxCellWidth,d="";(t.dataType?t.dataType===ue.BwRule.DT_HTML?d="html":t.dataType===ue.BwRule.DT_MULTI_TEXT&&(d="multiText"):d="string",d)&&((o=fe.str.toEmpty(o))!==(o=fe.str.cut(o.toString(),c))&&(o+=(fe.isMb?"　　":"")+'<div class="more-text-button detail-more"  data-text-type="'+d+'">...</div>'));return o},beforeShow:function(e,t){return f.dataFormat(n.tmPara,e,t)}};t.multi||a.colMenu.push({multi:!0,title:"锁定/解锁列",callback:function(e,t){u.table.colToggleLock(t[0].dataset.col)}});var s=f.para.pictureAddrList;Array.isArray(s)&&this.para.cols.some(function(e){return e.atrrs&&"20"==e.atrrs.dataType&&e.noShow})&&(a.rowMenu.push({multi:!1,title:"查看图片",callback:function(e,t){var n=u.table,o=n.trSelected[0];if(o){var a=parseInt(o.dataset.index),i=s.map(function(e){return pe.siteUrl+ue.BwRule.reqAddr(e,n.rowDataGet(a))});f.handleImg(i,a)}}}),a.rowMenu.push({multi:!0,title:"并列图片",callback:function(e,t){var a=[],i=[],l=u.table,n=l.trSelected,r=s&&s[0];n&&r&&(n.forEach(function(e){var t=parseInt(e.dataset.index),n=l.rowDataGet(t);a.push(pe.siteUrl+ue.BwRule.reqAddr(r,n));var o=n.PATTERN||"";i.push(o)}),c.ImgModal.show({img:a,isThumbnail:!0,textArr:i}))}}));var i=this.tableConf.tablePara?this.tableConf.tablePara:{};return Array.isArray(i.rowMenu)&&(a.rowMenu=a.rowMenu.concat(i.rowMenu),delete i.rowMenu),Array.isArray(i.colMenu)&&(a.colMenu=a.colMenu.concat(i.colMenu),delete i.colMenu),fe.obj.merge(a,i,o,t)},e.prototype.dataFormat=function(f,p,e){var h={tr:{},td:[]},t=f.pictureAddrList&&f.pictureAddrList[0];f.subTableList&&f.subTableList[0]&&(h.tr["data-sub-url"]=f.subTableList[0].dataAddr.dataAddr),["GRIDBACKCOLOR","GRIDFORECOLOR"].forEach(function(e,t){var n=p[e];if(n){var o=fe.val2RGB(n),a=o.r,i=o.g,l=o.b;h.tr.style=(0===t?"background-color":"color")+":rgb("+a+","+i+","+l+");",1===t&&(h.tr.class="tr-color")}}),t&&!this.cols.some(function(e){return ue.BwRule.DT_IMAGE===e.atrrs.dataType})&&(h.tr["data-click-type"]="img");var n=this.para.subButtons,b=Array.isArray(n)?n.map(function(e){return e.linkName}):[];return e.forEach(function(t,e){p[t.name]&&ue.BwRule.isTime(t.dataType)&&(p[t.name]=ue.BwRule.strDateFormat(p[t.name],t.displayFormat));var n=[],o=p[t.name],a={},i=t.dataType===ue.BwRule.DT_IMAGE;if("number"==typeof o&&n.push("text-right"),i?n.push("td-img"):t.dataType===ue.BwRule.DT_MULTI_TEXT&&n.push("td-multi-text"),t.drillAddr&&t.drillAddr.dataAddr){var l=ue.BwRule.drillAddr(t.drillAddr,p,f.keyField);l&&(a["data-href"]=l,a["data-gps"]=t.drillAddr.needGps,n.push("blue"))}if(t.webDrillAddr&&t.webDrillAddr.dataAddr){var r=ue.BwRule.webDrillAddr(t.webDrillAddr,p,f.keyField);r&&(a["data-href"]=r,a["data-gps"]=t.webDrillAddr.needGps,n.push("blue"))}if(t.webDrillAddrWithNull&&t.webDrillAddrWithNull.dataAddr){var s=ue.BwRule.webDrillAddrWithNull(t.webDrillAddrWithNull,p,f.keyField);s&&(a["data-href"]=s,a["data-gps"]=t.webDrillAddrWithNull.needGps,n.push("blue"))}if(t.link&&!i&&(!t.endField||1===p[t.endField])){var c=ue.BwRule.reqAddrFull(t.link,p),d=c.addr,u=c.data;if(!fe.isEmpty(u))switch(a["data-href"]=fe.url.addObj(d,u),a["data-gps"]=t.link.needGps,n.push("blue"),t.link.type){case"file":a["data-href-type"]="file"}}b.some(function(e){return e===t.name})&&(a["data-click-type"]="btn",n.push("blue")),n[0]&&(a.class=n.join(" ")),h.td.push(a)}),h},e.prototype.lockBottom=function(e){if(void 0===e&&(e=!1),!fe.isMb){var t=this.tableConf.scrollEl;0!==t.getBoundingClientRect().width&&(!e&&t&&(t.scrollTop=0),this.onLoad.getscrollBar()&&this.onLoad.getBottomPaging()?this.onLoad.getscrollBar().updateStyle():this.onLoad.init()),this.subTable&&this.subTable.lockBottom(e)}},e.prototype.initPivotTable=function(c,d,e,u){var f=this;void 0===e&&(e={});var p=c.classList.contains("mobileTable");null!==this.localSearch.getOriginMultPage()&&(this.para.multPage=this.localSearch.getOriginMultPage()),this.tableData.ajax(e,function(e){if(u&&u(e),e){for(var t=e.data,n=ue.BwRule.getCrossTableCols(e.meta,d.cols),o=[],a=[],i=0;i<n.cols.length;i++){var l=n.cols[i];-1<l.title.indexOf(".")&&-1<l.name.indexOf("小计")||-1===l.title.indexOf(".")?o.push(n.cols[i]):a.push(n.cols[i])}n.cols=o.concat(a),d.fixedNum=2<=n.lockNum?2:n.lockNum,c.classList.add("min-width");var r={table:c,multi:{enabled:!0,cols:f.getMulitPara.getMulitCols(n.cols,!0)},cols:f.getMulitPara.getColsIndex()};f.initTableModule(r,d,function(){p&&f.onComplete(),f.initTableEvent.init(f.table)}),f.tableData.dealTable(t,!0);var s=e.head.totalNum?e.head.totalNum:e.data.length;0!==f.para.multPage&&s>f.pagination.pageLen&&f.pagination.reset({offset:0,recordTotal:s}),f.lockBottom(),f.refresher=function(e,t,n){f.table.destroy();var o=h("table",null);f.wrapper.appendChild(o),f.initPivotTable(o,d,e,t)},f.localSearch.setOriginMultPage(f.para.multPage),f.localSearch.setOriginData(f.table.data.get())}})},e.prototype.autoSubTable=function(){if(!this.para.isSub&&this.subTableData){var e=be.query("table tbody tr",this.table.wrapperGet());e?(e.click(),this.subTable&&this.subTable.wrapper.classList.remove("hide")):this.subTable&&this.subTable.wrapper.classList.add("hide")}},e.prototype.initSubBtns=function(e){var i=this,o=this.table,t=i.para.subButtons;i.subBtn=new se.InputBox({container:e,isResponsive:!fe.isMb}),t&&t[0]&&t.forEach(function(e){var n=new le.Button({icon:e.icon,content:e.title,isDisabled:!(0===e.multiselect||2===e.multiselect&&e.selectionFlag),data:e});n.onClick=function(){var e=n.data,t=2===e.multiselect&&e.selectionFlag?o.rowUnselectDataGet():o.rowSelectDataGet();a.ButtonAction.get().clickHandle(n.data,1===n.data.multiselect?t[0]:t,function(e){},i.pageUrl)},i.subBtn.addItem(n)}),i.table.on("rowSelect",function(){var o=i.table.rowSelectDataGet().length,a=i.table.rowGetAll().length;i.subBtn.children.forEach(function(e){var t=e.data.selectionFlag,n=t?a-o:o;e.isDisabled=0===n?!t&&0<e.data.multiselect:1!==o&&2!==e.data.multiselect})})},e.prototype.handleImg=function(e,t){var n=this;if(!this.tableImgEdit){var o=[],a="";this.para.cols.forEach(function(e){"20"===e.atrrs.dataType&&(e.noShow?o.push(e):a=e.name)});var i=ve(this.para.tableAddr).mainVarList,l=o.map(function(e){return e.name}),r=i&&i[i.deleteType]||[],s=i&&i[i.updateType]||[];this.tableImgEdit=new u.TableImgEdit({thumbField:a,fields:o,deletable:r.some(function(e){return l.includes(e.varName)}),updatable:s.some(function(e){return l.includes(e.varName)}),onUploaded:function(e){n.editBtns.btnStart(!0),n.tableEdit.rowData(t,e)},onSave:function(){n.editBtns&&n.editBtns.btnSave()}})}this.tableImgEdit.isShow=!0;var c=this.tableEdit?this.tableEdit.rowData(t):{},d=[];this.tableImgEdit.fields.forEach(function(e){d.push(c[e.name])}),this.tableImgEdit.showImg(e.map(function(e){return fe.url.addObj(e,n.tableData.getQueryPara())}),d)},e.prototype.destroy=function(){be.remove(this.table.wrapperGet()),this.table.destroy(),this.table=null,be.remove(this.wrapper),this.subTable&&(this.subTable.table.destroy(),be.remove(this.subTable.table.wrapperGet()),be.remove(this.subTable.wrapper),this.subTable=null,this.subTableData=null,this.para=null,this.tableEdit=null,this.table=null)},e.prototype.getKeyField=function(){return this.para.keyField},e.prototype.getDefAddr=function(){return this.para.defDataAddrList},e.prototype.export=function(o){var a=this;ne(["tableExport"],function(e){var t=a.tableConf.tableEl,n=t.style.backgroundColor;t.style.backgroundColor="#fff",e(t,a.para.caption,o),t.style.backgroundColor=n})},e}();function me(e,t){if(e)for(var n=0,o=["update","insert","delete"];n<o.length;n++){var a=o[n];if(-1<t.indexOf(e[a+"Type"]))return!0}return!1}function ve(e){var t={mainVarList:null,subVarList:null};return e&&Array.isArray(e.param)&&e.param.forEach(function(e){"sub"===e.type?t.subVarList=e:"main"===e.type&&(t.mainVarList=e)}),t}e.TableModule=t}),define("TableDataModule",["require","exports","Loading","Spinner","BwRule"],function(e,t,c,i,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=BW.CONF,u=G.tools,n=function(){function e(e){var t,n;this.modulePara=e,this.ajaxAfterHandlers=[],this.ajaxBeforeHandlers=[],this._lookUpData={},this.cbFun=(n=t=null,{setOuterAfter:function(e){t=e},getOuterAfter:function(){return t},setOuterBefore:function(e){n=e},getOuterBefore:function(){return n}}),this.ajaxUrl=this.modulePara.para.dataAddr?o.siteUrl+d.BwRule.reqAddr(this.modulePara.para.dataAddr):null,this.queryPara={},this.isQuery=this.modulePara.para.querier&&3===this.modulePara.para.querier.queryType}return e.prototype.ajaxAfterAdd=function(e){this.ajaxAfterHandlers.push(e)},e.prototype.ajaxAfterRemove=function(e){this.ajaxAfterHandlers.indexOf(e)},e.prototype.ajaxBeforeAdd=function(e){this.ajaxBeforeHandlers.push(e)},e.prototype.ajaxBeforeRemove=function(e){this.ajaxBeforeHandlers.indexOf(e)},Object.defineProperty(e.prototype,"lookUpData",{get:function(){return this._lookUpData||{}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lookup",{get:function(){var n=this;if(u.isEmpty(this._lookUpData)){var e=this.modulePara.para.cols.filter(function(e){return"lookup"===e.elementType}).map(function(t){return d.BwRule.getLookUpOpts(t).then(function(e){n._lookUpData=n._lookUpData||{},n._lookUpData[t.name]=e})});return Promise.all(e).then(function(){})}return Promise.resolve()},enumerable:!0,configurable:!0}),e.prototype.ajax=function(e,i,t){var l=this;void 0===t&&(t=!1);var n=!1,o=null,r=function(){n=!0,o&&o.destroy(),l.modulePara.tableModule.wrapper.classList.remove("disabled")};if(setTimeout(function(){n||l.modulePara.tableModule.wrapper.classList.add("disabled")},0),e){var a;this.queryPara=e,a=u.obj.merge(this.queryPara,this.modulePara.tableModule.pagination.getParam()),e=u.obj.merge(e,a)}else e=u.obj.merge(this.queryPara,this.modulePara.tableModule.pagination.getParam());if(1===this.modulePara.para.multPage&&(e=u.obj.merge(e,this.modulePara.tableModule.initTableEvent.getPageSortParams())),!0===this.modulePara.para.isAsyn){var s=this.modulePara.pageUrl;e.uiurl=s.substring(function(e,t,n){for(var o=e.indexOf(t),a=0;a<n;a++)o=e.indexOf(t,o+1);return o}(s,"/",5),s.length)}(this.isQuery||!e||e.pagesortparams)&&(u.isMb&&!t||(o=new c.Loading({msg:"加载中..."}))),this.lookup.then(function(){d.BwRule.Ajax.fetch(l.ajaxUrl,{timeout:3e4,data:e,needGps:l.modulePara.para.dataAddr.needGps}).then(function(e){var t=e.response;if(r(),t.data){var o,n=l.modulePara.para.tableAddr;if(n&&Array.isArray(n.param)&&n.param.forEach(function(e){e&&e.itemId===l.modulePara.para.itemId&&(o=e)}),o){var a=[];["insert","update","delete"].forEach(function(e){var t=-1<["update","delete"].indexOf(o[e+"Type"]),n=o[e];t&&Array.isArray(n)&&(a=a.concat(n))}),d.BwRule.addOldField(d.BwRule.getOldField(a),t.data)}}i(t)}).catch(function(e){}).finally(function(){r(),i()})}).catch(function(e){})},e.prototype.refresh=function(e,t,n){var o=this,a=this.modulePara.tableModule;e&&(this.queryPara=e),this.ajax(e,function(e){e&&("function"==typeof n&&n(e),o.dealTable(e.data,!0),a.pagination.isShow(e),a.autoSubTable(),a.localSearch.setOriginData(a.table.data.get()),a.localSearch.queryDataGet()&&a.localSearch.search(),"function"==typeof t&&t(e))},!0)},e.prototype.dealTable=function(e,t){var n=this.modulePara.tableModule,o=n.pagination.getCurrentState();t?n.table.data.set(e):n.table.data.add(e),0===this.modulePara.para.multPage&&n.table.render(0,e.length),1===this.modulePara.para.multPage&&n.table.render(t?0:o.offset,t?o.size:o.offset+o.size,t),2===this.modulePara.para.multPage&&n.table.render(0,50),u.event.fire("table-module-render",null,n.wrapper)},e.prototype.getQueryPara=function(){return this.queryPara},e.prototype.setNewData=function(e,t){void 0===t&&(t=!0);var n=this.modulePara.tableModule;this.modulePara.para.multPage=2,this.dealTable(e,t);var o=n.table.data.get().length,a=o||e.length;0!==this.modulePara.para.multPage&&a>n.pagination.pageLen&&n.pagination.reset({offset:0,recordTotal:a}),n.pagination.isShow(e),n.lockBottom()},e.prototype.innerRefresher=function(e,n,t){var o=this,a=this.modulePara.tableModule,l=new i.Spinner({el:this.modulePara.tableConf.tableEl,type:i.Spinner.SHOW_TYPE.append,className:"text-center padding-30"});null!==a.localSearch.getOriginMultPage()&&(this.modulePara.para.multPage=a.localSearch.getOriginMultPage()),a.pagination.setParam(1),!this.isQuery&&l.show(),this.refresh(e,function(e){var t=e.head.totalNum?e.head.totalNum:e.data.length;0!==o.modulePara.para.multPage&&t>a.pagination.pageLen&&a.pagination.reset({offset:0,recordTotal:t});var i=e.meta;Array.isArray(i)&&i[0]&&a.subBtn&&a.subBtn.children&&a.subBtn.children.forEach(function(e){if(Array.isArray(e.data.actionAddr&&e.data.actionAddr.varList))for(var t=0,n=e.data.actionAddr.varList;t<n.length;t++){var o=n[t],a=o.varName.replace(/^OLD_/,"");0!==e.data.multiselect&&u.isEmpty(o.varValue)&&(e.isShow=-1!==i.indexOf(a))}}),"function"==typeof n&&n(e),setTimeout(function(){a.lockBottom(),a.localSearch.setOriginData(a.table.data.get()),a.localSearch.setOriginMultPage(o.modulePara.para.multPage),!o.isQuery&&l.hide()},0)},t)},e.prototype.dealData=function(e,t){var n=this,o=this.modulePara.tableModule;0!==this.modulePara.para.multPage&&t>o.pagination.pageLen&&o.pagination.reset({offset:0,recordTotal:t}),this.dealTable(e,!u.isMb),o.autoSubTable(),setTimeout(function(){o.lockBottom(),o.localSearch.setOriginData(o.table.data.get()),o.localSearch.setOriginMultPage(n.modulePara.para.multPage)},0)},e}();t.TableDataModule=n});