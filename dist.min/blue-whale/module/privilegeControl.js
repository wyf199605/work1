define("PrivilegeControl",["require","exports","PrivilegeConfigure","PrivilegeQuery"],function(e,t,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=G.d,i=function(){function e(e){this.container=e.dom,this.url=n.closest(this.container,"[data-src]").dataset.src,this.initPage(e)}return e.prototype.initPage=function(e){switch(G.tools.url.getPara("uiTypeTest",this.url)){case"privilegeConfigure":new o.PrivilegeConfigure({container:this.container,title:"权限配置",dom:this.container,url:e.url,controllUrl:e.controllUrl});break;case"privilegeSearch":new a.PrivilegeQuery({container:this.container,title:"权限查询",dom:this.container,url:e.url,iurl:e.iurl})}},e}();t.PrivilegeControl=i}),define("PrivilegeConfigure",["require","exports","BasicPage","PrivilegeDefault","PrivilegePersonal"],function(e,t,o,l,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=BW.CONF,s=G.d,c=G.tools,n=function(o){function e(e){var t=o.call(this,e)||this;return t.para=e,t.ajaxUrl=e.url,t.controllUrl=e.controllUrl,t.url=c.isNotEmpty(e.url)?e.url:a.ajaxUrl.rmprivsSelect,t.generate(),t}return __extends(e,o),e.prototype.generate=function(){var e=this;this.dpConfMenuDom=s.create('<ul class="df-conf-menu"></ul>');var t=s.create('<div class="default-content"></div>'),o=s.create('<div class="personal-content"></div>'),a=s.create('<div class="df-conf-content"></div>'),n=s.create("<li>缺省权限配置</li>"),i=s.create("<li>个性权限配置</li>");this.dpConfMenuDom.appendChild(n),this.dpConfMenuDom.appendChild(i),a.appendChild(t),a.appendChild(o),this.para.container.appendChild(this.dpConfMenuDom),this.para.container.appendChild(a),o.style.display="none",n.classList.add("li-select"),this.privilegeDefault=c.isNotEmpty(this.ajaxUrl)?new l.PrivilegeDefault(t,this.url):new l.PrivilegeDefault(t),s.on(n,"click",function(){i.classList.remove("li-select"),n.classList.add("li-select"),o.style.display="none",t.style.display="block"}),s.on(i,"click",function(){e.privilegePersonal||(e.privilegePersonal=c.isNotEmpty(e.ajaxUrl)?new r.PrivilegePersonal(o,e.url,e.controllUrl):new r.PrivilegePersonal(o)),n.classList.remove("li-select"),i.classList.add("li-select"),t.style.display="none",o.style.display="block"})},e}(o.default);t.PrivilegeConfigure=n}),define("PrivilegeQuery",["require","exports","BasicPage","SelectInput","TableModulePc","BwRule","TextInput","Modal","Button","SearchInput","InputBox","Tab","Tree","Spinner","Loading"],function(e,t,o,l,r,n,s,u,v,c,a,h,i,d,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var f=BW.CONF,y=G.d,D=G.tools,m=function(o){function e(e){var t=o.call(this,e)||this;return t.para=e,t.userId=[],t.ajaxUrl=D.isNotEmpty(e.url)?e.url:"",t.iurl=D.isNotEmpty(e.iurl)?e.iurl:"",t.init(),t}return __extends(e,o),e.prototype.init=function(){var c=this,d=this.initTpl();this.para.dom.appendChild(d);var e=y.query(".priv-user-drop",d),a=new s.TextInput({container:y.query(".priv-node",d),readonly:!0,icons:["iconfont icon-arrow-down"],iconHandle:function(e){if(c.nodeModal)c.nodeModal.isShow=!0;else{var t=c.clearBtn(a,function(){c.nodeModal.isShow=!1});t.addItem(new v.Button({content:"确定",onClick:function(){var e=c.tree.getSelectedNodes(),t=[],o="";e&&(t=e.map(function(e){return e.content})),c.nodeData="",t.forEach(function(e){o+=e.title+"；",c.nodeData+=e.nodeId+","}),c.nodeData=c.nodeData.substring(0,c.nodeData.length-1),a.set(o),c.nodeModal.isShow=!1}})),c.nodeModal=new u.Modal({container:c.para.dom,className:"priv-query-modal",body:y.create("<div></div>"),footer:{rightPanel:t},width:"250px"}),c.nodeSuccess(c.nodeModal.body)}}}),t=new l.SelectInput({container:y.query(".priv-user",d),data:[{text:"用户",value:"USER"},{text:"用户组",value:"GROUP"}],onSet:function(e){}});t.set("USER");var p,o=D.isNotEmpty(this.iurl)?this.iurl:D.url.addObj(f.siteAppVerUrl+"/ui/pick/n1174_data-4/pick-4",{isMb:!0},!1),n=y.create('<iframe class="pageIframe" src="'+o+'"></iframe>'),i=new s.TextInput({container:e,readonly:!0,icons:["iconfont icon-arrow-down"],className:"user-drop",iconHandle:function(){c.textClick(t,a,n,i)}});new v.Button({content:"查询",type:"primary",container:y.query(".priv-query-btn",d),onClick:function(e){var r,s=t.get();c.ajaxLoad([{select_type:"getoperprivsbynodeidoruser",user_id:c.userId.join(","),user_type:s,node_id:c.nodeData}]).then(function(e){console.log(e,"user"),r=-1<e.meta.indexOf("USER_ID")?"USER_ID":"GROUP_ID";var t=y.query(".parent-table",d),o=y.query(".child-table",d),a=y.create("<table><tbody></tbody></table>");t.innerHTML=null,t.appendChild(a),(p=c.createTable(a,t,e.data,c.resetCols(e.head.cols),108)).table.clickEvent.add("tbody tr",function(e){var a=p.table.rowDataGet(y.closest(e.target,"tr").dataset.index),n=y.query(".oper-priv",d),i=y.query(".prop-priv",d),l=y.query(".level-priv",d);console.log(a),c.tab||(c.tab=new h.Tab({tabParent:o,panelParent:o,tabs:[{title:"功能",dom:n,name:"OPER_PRIVS"},{title:"属性",dom:i,name:"PROP_PRIVS"},{title:"层级",dom:l,name:"LEVEL_PRIVS"}],onClick:function(e){var t,o;switch(e){case 0:t=n,o="OPER_PRIVS";break;case 1:t=i,o="PROP_PRIVS";break;case 2:t=l,o="LEVEL_PRIVS"}c.tabLoad(o,t,a[r],s,a)}})),c.tabLoad("OPER_PRIVS",n,a[r],s,a)})})}})},e.prototype.tabLoad=function(e,o,t,a,n){var i=this;console.log(n),this.ajaxLoad([{select_type:"getprivsinfo",user_input:t,input_type:a,node_id:n.NODE_ID,privs_type:e}]).then(function(e){var t=y.create("<table><tbody></tbody></table>");o.innerHTML=null,o.appendChild(t),i.createTable(t,o,e.data,i.resetCols(e.head.cols))})},e.prototype.createTable=function(e,t,o,a,n){var i={tableEl:e,scrollEl:t};return n&&(i.fixTop=n),new r(i,{cols:a,multPage:2,isSub:!0,data:o})},e.prototype.clearBtn=function(e,t){var o=new a.InputBox;return o.addItem(new v.Button({content:"清除",onClick:function(){e.set(""),t()}})),o},e.prototype.textClick=function(e,t,o,a){switch(e.get()){case"USER":this.userUi(o,a);break;case"GROUP":this.groupUi(a)}},e.prototype.groupUi=function(n){var i,l=this;this.ajaxLoad([{select_type:"getusergroupbyuserinput",user_input:""}],!1).then(function(e){if(l.groupModal)l.groupModal.isShow=!0;else{var t=l.clearBtn(n,function(){l.userId=[],l.groupModal.isShow=!1});t.addItem(new v.Button({content:"确定",onClick:function(){var t="";l.userId=[],i.table.rowSelectDataGet().forEach(function(e){t+=e.GROUP_NAME+";",l.userId.push(e.GROUP_ID)}),n.set(t),l.groupModal.isShow=!1}})),l.groupModal=new u.Modal({header:"用户组",container:l.para.dom,body:y.create('<div><div class="group-search"></div><div class="scroll-el"><table><tbody></tbody></table></div></div>'),className:"priv-query-group-modal",width:"435px",footer:{rightPanel:t}}),l.groupSearch=new c.SearchInput({container:y.query(".group-search",l.groupModal.body),placeholder:"搜索...",ajax:{fun:function(e,t,o,a){l.ajaxLoad([{select_type:"getusergroupbyuserinput",user_input:o}]).then(function(e){i.tableData.setNewData(e.data)})}}});var o=y.query("table",l.groupModal.bodyWrapper),a=y.query(".scroll-el",l.groupModal.bodyWrapper);i=l.createTable(o,a,e.data,l.resetCols(e.head.cols))}})},e.prototype.userUi=function(e,o){var n=this;this.userModal?this.userModal.isShow=!0:(this.userModal=new u.Modal({body:e,className:"priv-modal",container:this.para.dom,footer:{rightPanel:this.clearBtn(o,function(){n.userId=[],n.userModal.isShow=!1})}}),e.onload=function(){var e=n.userModal.body,t=e.contentDocument.body,o=t.querySelector("#list .mui-scroll"),a=(t.querySelector("#list"),document.createElement("div"),G.d.create("<style>header a.sys-action-back{display: none} .ulOverFlow{ height:424px; overflow-y : auto} #list{height: 100vh}</style>"));e.contentDocument.head.appendChild(a),o.classList.add("ulOverFlow"),t.querySelector("header .mui-title").innerHTML="用户名"}),y.once(window,"selectContact",function(e){n.userModal&&(n.userModal.isShow=!1);var t="";n.userId=[],e.detail.data.forEach(function(e){t+=e.USERID+";",n.userId.push(e.USERID)}),o.set(t)})},e.prototype.resetCols=function(e){var t=[];return e.forEach(function(e){t.push({name:e.name,title:e.caption})}),t},e.prototype.initTpl=function(){return y.create('<div class="priv-query">\n        <div class="priv-condition">\n            <div class="width-50">节点：</div>\n            <div class="priv-node"></div>\n            <div class="priv-user"></div>\n            <div class="priv-user-drop"></div> \n            <div class="priv-query-btn"></div>\n        </div>\n        <div class="parent-table"></div>\n        <div class="child-table">\n            <div class="oper-priv"></div>\n            <div class="prop-priv"></div>\n            <div class="level-priv"></div>\n        </div>\n        </div>')},e.prototype.ajaxLoad=function(e,o){var a=this;void 0===o&&(o=!0),o&&(this.loading?this.loading.show():this.loading=new p.Loading({duration:30}));var t=D.isNotEmpty(this.ajaxUrl)?this.ajaxUrl+"?deal_type=select":f.ajaxUrl.rmprivsSelect;return n.BwRule.Ajax.fetch(t,{type:"POST",data:JSON.stringify(e),timeout:3e4}).then(function(e){var t=e.response;return o&&a.loading.hide(),t})},e.prototype.childData=function(e){var t=[];return e.data.forEach(function(e){t.push({text:e.CAPTION_EXPLAIN,icon:e.ICON_NAME,content:{nodeId:e.NODE_ID,title:e.CAPTION_EXPLAIN},isLeaf:1===e.IS_END})}),t},e.prototype.nodeSuccess=function(e){var t=this;this.spinner||(this.spinner=new d.Spinner({el:e,type:d.Spinner.SHOW_TYPE.cover})),this.spinner.show(),this.tree=new i.Tree({container:e,isAccordion:!1,expand:!0,isLeaf:!1,multiSelect:!0,toggleSelect:!0,ajax:function(e){return t.spinner.hide(),t.ajaxLoad([{select_type:"getnextnodeinfo",current_node_id:e.content&&e.content.nodeId}],!1).then(function(e){return t.childData(e)})}})},e}(o.default);t.PrivilegeQuery=m}),define("PrivilegeDefault",["require","exports","PrivilegeDP","Modal"],function(e,t,o,v){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=G.d,a=function(a){function e(e,t){var o=a.call(this,e,t)||this;return o.dom=e,o.pageType="DEFAULT",o.urls=[o.confUrl("/col/reset",t),o.confUrl("/col/save",t),o.confUrl("/col/del",t),o.confUrl("/level/reset",t),o.confUrl("/level/save",t),o.confUrl("/level/del",t)],o.generate(),o}return __extends(e,a),e.prototype.generate=function(){var e=l.create('<div class="priv-group"></div>'),t=l.create('<div class="priv-wrapper"></div>');this.dom.appendChild(e),this.dom.appendChild(t),this.generatePrivGroup(e),this.confSearchDom=l.create('<div class="conf-search"></div>'),this.confSaveDom=l.create('<div class="conf-save"></div>'),this.confContentDom=l.create('<div class="conf-content"></div>'),t.appendChild(this.confSearchDom),t.appendChild(this.confSaveDom),t.appendChild(this.confContentDom),this.generateSave(),this.generateFieldSearch(),this.generatePLSwitchMenu()},e.prototype.generatePLSwitchMenu=function(){var e=this,t=l.create('<div class="nav-content"></div>'),o=l.create('<div class="switch-menu"></div>'),a=l.create('<div class="pl-content"></div>'),n=l.create('<li class="li-select"><i class="iconfont icon-tongji"></i>属性</li>'),i=l.create('<li><i class="iconfont icon-function"></i>层级</li>');o.appendChild(n),o.appendChild(i),t.appendChild(o),this.confContentDom.appendChild(t),this.confContentDom.appendChild(a),this.generateConfSavaSelectBox(t),this.fieldContentDom||(this.fieldContentDom=l.create('<div class="field-content"></div>'),a.appendChild(this.fieldContentDom),this.switchType="FIELD"),this.generateFieldContent(),l.on(n,"click",function(){i.classList.remove("li-select"),n.classList.add("li-select"),e.levelContentDom&&(e.levelContentDom.style.display="none"),e.fieldContentDom.style.display="block",e.switchType="FIELD",e.generateFieldContent()}),l.on(i,"click",function(){n.classList.remove("li-select"),i.classList.add("li-select"),e.levelContentDom||(e.levelContentDom=l.create('<div class="level-content"></div>'),a.appendChild(e.levelContentDom)),e.generateLGContent(),e.fieldContentDom.style.display="none",e.levelContentDom.style.display="block",e.switchType="LEVEL"})},e.prototype.judgeControl=function(){this.generateLGContent()},e.prototype.saveBtnCb=function(){var o=this,e=o.privGroupTable.rowSelectDataGet(),t=e.length,a=o.fieldTable.rowSelectDataGet();if(1===t&&o.privGroudId){var n=[],i=[];if("FIELD"===o.switchType){if(a.length<1)return void v.Modal.alert("请选择要新增/删除的字段行");if(a.forEach(function(e){e.IS_CHECKED&&e.FIELD_NAME?n.push(e.FIELD_NAME):e.FIELD_NAME&&i.push(e.FIELD_NAME)}),n[0]){var l=[{privGroupId:o.privGroudId,operType:"1",operId:"1",fieldName:n.join(",")}];o.saveResponse(o.urls[2],l,!i[0])}if(i[0]){l=[{privGroupId:o.privGroudId,operType:"1",operId:"1",fieldName:i.join(",")}];o.saveResponse(o.urls[1],l)}}else if("LEVEL"===o.switchType){if(!o.delLevelData[0]&&!o.resLevelData[0])return void v.Modal.alert("请对层级权限进行配置！");if(o.delLevelData[0]){var r=[];console.log(o.delLevelData,"delLevelData"),o.delLevelData.forEach(function(e){var t={privGroupId:o.privGroudId,operType:"1",operId:"1",levelId:e.LEVEL_ID,insType:e.INS_TYPE,insValue:e.INS_VALUE};r.push(t)});var s=!o.resLevelData[0];o.saveResponse(o.urls[5],r,s)}if(o.resLevelData[0]){var c=[];console.log(o.resLevelData,"resLevelData"),o.resLevelData.forEach(function(e){var t={privGroupId:o.privGroudId,operType:"1",operId:"1",levelId:e.LEVEL_ID,insType:e.INS_TYPE,insValue:e.INS_VALUE};c.push(t)}),o.saveResponse(o.urls[4],c)}}}else if(1<t&&o.confSaveSelectBox){var d=[];if(e.forEach(function(e){d.push(e.PRIV_GROUP_ID)}),"FIELD"===o.switchType){l=[];var p=[];if(a.length<1)return void v.Modal.alert("请选择要新增/删除的字段行");a.forEach(function(e){p.push(e.FIELD_NAME)}),l=[{privGroupId:d.join(","),operType:"1",operId:"1",fieldName:p.join(",")}],o.saveResponse(o.urls[o.confSaveSelectBox.get()[0]],l)}else if("LEVEL"===o.switchType){if(!o.delLevelData[0]&&!o.resLevelData[0])return void v.Modal.alert("请对层级权限进行配置！");var u=[];o.delLevelData[0]&&o.delLevelData.forEach(function(e){var t={privGroupId:d.join(","),operType:"1",operId:"1",levelId:e.LEVEL_ID,insType:e.INS_TYPE,insValue:e.INS_VALUE};u.push(t)}),o.resLevelData[0]&&o.resLevelData.forEach(function(e){var t={privGroupId:d.join(","),operType:"1",operId:"1",levelId:e.LEVEL_ID,insType:e.INS_TYPE,insValue:e.INS_VALUE};u.push(t)}),o.saveResponse(o.urls[o.confSaveSelectBox.get()[0]+3],u)}}else v.Modal.alert("请选择权限组！")},e}(o.PrivilegeDP);t.PrivilegeDefault=a}),define("PrivilegePersonal",["require","exports","PrivilegeDP","TableModulePc","SearchInput","Button","Modal","Tree","BwRule"],function(e,t,o,f,a,l,g,i,y){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var D=G.d,s=G.tools,n=function(n){function e(e,t,o){var a=n.call(this,e,t)||this;return a.dom=e,a.controllUrl=o,a.pageType="PERSONAL",a.urls=[a.confUrl("function/reset",t),a.confUrl("function/save",t),a.confUrl("function/del",t),a.confUrl("col/reset",t),a.confUrl("col/save",t),a.confUrl("col/del",t),a.confUrl("level/reset",t),a.confUrl("level/save",t),a.confUrl("level/del",t)],a.generate(),a}return __extends(e,n),e.prototype.generate=function(){var e=D.create('<div class="info-platform"></div>'),t=D.create('<div class="priv-group"></div>'),o=D.create('<div class="priv-wrapper"></div>'),a=D.create('<div class="control-area"></div>'),n=D.create('<div class="priv-tip">请先选中一个节点</div>');this.dom.appendChild(e),this.dom.appendChild(a),a.appendChild(n),a.appendChild(t),a.appendChild(o),this.generateInfoPlatform(e),this.generatePrivGroup(t),this.confSearchDom=D.create('<div class="conf-search"></div>'),this.confSaveDom=D.create('<div class="conf-save"></div>'),this.confContentDom=D.create('<div class="conf-content"></div>'),o.appendChild(this.confSearchDom),o.appendChild(this.confSaveDom),o.appendChild(this.confContentDom),this.generateSave(),this.generateFunctionSearch(),this.generatePLSwitchMenu()},e.prototype.generatePLSwitchMenu=function(){var a=this,e=D.create('<div class="nav-content"></div>'),t=D.create('<div class="switch-menu"></div>'),o=D.create('<div class="pl-content"></div>'),n=D.create('<li><i class="iconfont icon-tongji"></i>属性</li>'),i=D.create('<li><i class="iconfont icon-function"></i>层级</li>');this.functionLi=D.create('<li class="li-select"><i class="iconfont icon-tongji"></i>功能</li>'),t.appendChild(this.functionLi),t.appendChild(n),t.appendChild(i),e.appendChild(t),this.confContentDom.appendChild(e),this.confContentDom.appendChild(o),this.generateConfSavaSelectBox(e),this.operateContentDom||(this.operateContentDom=D.create('<div class="operate-content"></div>'),o.appendChild(this.operateContentDom),this.generateOperateContent(),this.lastSwitchLi=this.functionLi,this.switchType="FUNCTION"),D.on(this.functionLi,"click",function(){if(i.classList.remove("li-select"),n.classList.remove("li-select"),a.functionLi.classList.add("li-select"),a.levelContentDom&&(a.levelContentDom.style.display="none"),a.operateContentDom.style.display="block",a.fieldContentDom&&(a.fieldContentDom.style.display="none",a.fieldSearchDom.style.display="none"),a.functionSearchDom.style.display="block",a.switchType="FUNCTION",a.lastSwitchLi=a.functionLi,a.operateContentDom&&a.lastOperTable&&a.operType){var e=D.query(".operate-conf",a.operateContentDom),t=a.operTypeArr.indexOf(a.operType),o=a.operateListString[t];e&&a.getActionType(e,o.type,o.name,o.title,a.operType)}}),D.on(n,"click",function(){i.classList.remove("li-select"),a.functionLi.classList.remove("li-select"),n.classList.add("li-select"),a.fieldContentDom||(a.fieldContentDom=D.create('<div class="field-content"></div>'),o.appendChild(a.fieldContentDom)),a.generateFieldContent(),a.levelContentDom&&(a.levelContentDom.style.display="none"),a.operateContentDom.style.display="none",a.fieldContentDom.style.display="block",a.fieldSearchDom||a.generateFieldSearch(),a.functionSearchDom.style.display="none",a.fieldSearchDom.style.display="block",a.switchType="FIELD",a.lastSwitchLi=n}),D.on(i,"click",function(){n.classList.remove("li-select"),a.functionLi.classList.remove("li-select"),i.classList.add("li-select"),a.levelContentDom||(a.levelContentDom=D.create('<div class="level-content"></div>'),o.appendChild(a.levelContentDom)),a.generateLGContent(),a.fieldContentDom&&(a.fieldContentDom.style.display="none"),a.operateContentDom.style.display="none",a.levelContentDom.style.display="block",a.switchType="LEVEL",a.lastSwitchLi=i})},e.prototype.generateOperateContent=function(){var a=this,n=D.create('<ul class="operate-menu select-box-small"></ul>'),i=D.create('<div class="operate-conf select-box-small"></div>');this.operateContentDom.appendChild(n),this.operateContentDom.appendChild(i),this.operateListString.forEach(function(e){var t=e.typeName,o=D.create('<li class="menu-item">'+t+"</li>");n.appendChild(o),D.on(o,"click",function(){switch(a.lastLi&&a.lastLi!==o&&a.lastLi.classList.remove("li-select"),(a.lastLi=o).classList.add("li-select"),t){case"标准操作":a.getActionType(i,"STANDARD","OPER_ID","OPER_NAME",1);break;case"数据操作":a.getActionType(i,"ACTION","ELEMENT_ID","CAPTION",2);break;case"全局操作":a.getActionType(i,"HANDLE","ELEMENT_ID","CAPTION",3);break;case"关联操作":a.getActionType(i,"ASSOCIATE","ELEMENT_ID","CAPTION",4);break;case"操作组":a.getActionType(i,"OPERGROUP","OPER_GROUP_ID","OPER_GROUP_NAME",0)}})}),n&&n.firstChild&&(n.firstChild.classList.add("li-select"),this.standardLi=n.firstChild,this.lastLi=n.firstChild,this.getActionType(i,"STANDARD","OPER_ID","OPER_NAME",1))},e.prototype.getActionType=function(r,s,c,d,p,e){void 0===e&&(e=""),r.innerHTML="";var u=D.create("<table><tbody></tbody></table>"),t=[{select_type:"getoperidbyuserinput",input_type:s,user_input:e,node_id:1===this.infoPlatSelected.length?this.infoPlatSelected[0]:"",priv_group_id:this.privGroudId}],v=[],h=this;r.appendChild(u),y.BwRule.Ajax.fetch(this.url,{type:"Post",data:JSON.stringify(t)}).then(function(e){var t=e.response,n=t&&t.body&&t.body.bodyList&&t.body.bodyList[0],i=[];if(n&&n.meta){var l=n.meta.indexOf("IS_CHECKED");n.dataList[0]&&n.dataList.forEach(function(o,e){var a={};n.meta[0]&&n.meta.forEach(function(e,t){a[e]=o[t]}),v.push(a),-1<l&&o[l]&&i.push(e)})}(h.infoPlatSelected.length<1||!h.privGroupTable||h.privGroupTable.rowSelectDataGet().length<1)&&(v=[]);var o={cols:[{title:"操作名称",name:d},{title:"操作编号",name:c}],multPage:2,isSub:!0,data:v};switch(s){case"STANDARD":a(h.standardTable);break;case"ACTION":a(h.actiondTable);break;case"HANDLE":a(h.handleTable);break;case"ASSOCIATE":a(h.associateTable);break;case"OPERGROUP":a(h.opergroupTable)}function a(e){e=new f({tableEl:u,scrollEl:r,fixTop:0},o).table,h.lastOperTable&&h.lastOperTable!==e&&(h.lastOperTable.wrapperGet().style.display="none"),h.lastOperTable=e,h.privEcho(t,u),e.on("render",function(){h.privEcho(t,u)})}h.operType=p})},e.prototype.generateFunctionSearch=function(){var r=this;this.functionSearchDom=D.create('<div class="function-search"></div>'),this.confSearchDom.appendChild(this.functionSearchDom),this.functionSearchInput=new a.SearchInput({container:r.functionSearchDom,className:"w",placeholder:"搜索...",ajax:{url:r.url,fun:function(e,t,o,a){var n=D.query(".operate-conf",r.operateContentDom),i=r.operTypeArr.indexOf(r.operType),l=r.operateListString[i];n&&r.getActionType(n,l.type,l.name,l.title,r.operType,o)}}})},e.prototype.generateInfoPlatform=function(e){var n=this;if(!s.isEmpty(e)){this.infoPFSearchDom=D.create('<div class="info-platform-search"></div>');var i=D.create('<div class="info-platform-content"></div>');e.appendChild(this.infoPFSearchDom),e.appendChild(i);var l=this;this.infoPFSearchInput=new a.SearchInput({container:this.infoPFSearchDom,className:"w",placeholder:"搜索...",ajax:{url:l.url,fun:function(e,t,o,a){""!==o?n.infoPlatFormInit(i,function(e){return n.ajaxLoad(l.url,[{select_type:"getnodeinfobyuserinput",user_input:o}]).then(function(e){return n.childData(e,!0)})}):r(i)}}}),r(i)}function r(e){l.infoPlatFormInit(e,function(e){return l.ajaxLoad(l.url,[{select_type:"getnextnodeinfo",current_node_id:e.content&&e.content.nodeId}]).then(function(e){return l.childData(e)})})}},e.prototype.childData=function(e,t){void 0===t&&(t=!1);var o=[];return e.data.forEach(function(e){o.push({text:e.CAPTION_EXPLAIN,icon:e.ICON_NAME,content:{nodeId:e.NODE_ID,title:e.CAPTION_EXPLAIN},isAccordion:!0,isLeaf:!0===t?t:1===e.IS_END})}),o},e.prototype.infoPlatFormInit=function(e,t){var o=this;this.tree&&this.tree.destroy(),this.tree=new i.Tree({container:e,isAccordion:!0,expand:!0,isLeaf:!1,multiSelect:!0,toggleSelect:!0,ajax:function(e){return t(e)}}),this.tree.onSelect=function(e){o.judgeControl()}},e.prototype.judgeControl=function(e){var o=this,t=this.tree.getSelectedNodes(),n=this,a=D.query(".priv-tip",this.dom);function i(e){if(e.classList.add("hide"),n.initMultiPage(),"FIELD"===n.switchType)n.generateFieldContent();else if(n.operateContentDom&&n.lastOperTable&&n.operType&&"FUNCTION"===n.switchType){var t=D.query(".operate-conf",n.operateContentDom),o=n.operTypeArr.indexOf(n.operType),a=n.operateListString[o];n.getActionType(t,a.type,a.name,a.title,n.operType)}else"LEVEL"===n.switchType&&n.levelContentDom&&n.generateLGContent()}this.infoPlatSelected=t?t.map(function(e){return e.content.nodeId}):[],t&&1===t.length?this.ajaxLoad(this.url,[{select_type:"getNodeIdIsPrivCtl",node_id:this.infoPlatSelected.join(",")}],!1).then(function(e){t&&t[0]&&(e.body.bodyList[0]?i(a):(a.classList.remove("hide"),a.innerHTML="该节点不可受控！",new l.Button({content:"添加受控",container:a,type:"primary",onClick:function(e){var t=s.isNotEmpty(o.controllUrl)?o.controllUrl:o.url;o.ajaxLoad(t,[{node_id:o.infoPlatSelected.join(",")}],!1).then(function(e){g.Modal.alert(e.msg),i(a)})}})))}):i(a),t||(a.innerHTML="请先选中一个节点",a.classList.remove("hide"))},e.prototype.initMultiPage=function(){1<this.infoPlatSelected.length?(this.dom.classList.add("hide-field-function"),this.lastSwitchLi.classList.remove("li-select"),this.functionLi.classList.add("li-select"),this.levelContentDom&&(this.levelContentDom.style.display="none"),this.fieldContentDom&&(this.fieldSearchDom.style.display="none",this.fieldContentDom.style.display="none"),this.operateContentDom.style.display="block",this.functionSearchDom.style.display="block",this.switchType="FUNCTION",this.lastOperTable&&this.standardTable&&this.lastOperTable!==this.standardTable&&(this.lastOperTable.wrapperGet().style.display="none",this.standardTable.wrapperGet().style.display="block",this.lastOperTable=this.standardTable,this.lastLi.classList.remove("li-select"),this.standardLi.classList.add("li-select"),this.operType=1)):this.dom.classList.remove("hide-field-function")},e.prototype.saveBtnCb=function(){var e,n,i,l=this,t=l.privGroupTable.rowSelectDataGet(),o=t.length,a=l.fieldTable&&l.fieldTable.rowSelectDataGet();if(1===this.infoPlatSelected.length)if(1===o&&l.privGroudId){var r=[],s=[];if("FUNCTION"===l.switchType){if(!(d=l.lastOperTable&&l.lastOperTable.rowSelectDataGet())||!d[0])return void g.Modal.alert("请选择要配置的操作行！");d.forEach(function(e){var t=Object.keys(e)[0],o=e[t];if(t&&o){var a={privGroupId:l.privGroudId,nodeId:l.infoPlatSelected[0],operType:l.operType,operId:o};e.IS_CHECKED?r.push(a):s.push(a)}}),r[0]&&s[0],r[0]&&l.saveResponse(l.urls[2],r,!s[0]),s[0]&&l.saveResponse(l.urls[1],s)}else if("FIELD"===l.switchType){if(a.length<1)return void g.Modal.alert("请选择要新增/删除的字段行");a.forEach(function(e){e.IS_CHECKED&&e.FIELD_NAME?r.push(e.FIELD_NAME):e.FIELD_NAME&&s.push(e.FIELD_NAME)}),r[0]&&D(l.urls[5],r,!s[0]),s[0]&&D(l.urls[4],s)}else if("LEVEL"===l.switchType){if(!l.delLevelData[0]&&!l.resLevelData[0])return void g.Modal.alert("请对层级权限进行配置！");l.delLevelData[0]&&l.saveResponse(l.urls[8],m(l.delLevelData,l.privGroudId),!s[0]),l.resLevelData[0]&&l.saveResponse(l.urls[7],m(l.resLevelData,l.privGroudId))}}else if(1<o&&l.confSaveSelectBox){var c=[];if(t.forEach(function(e){c.push(e.PRIV_GROUP_ID)}),"FUNCTION"===l.switchType){var d=l.lastOperTable&&l.lastOperTable.rowSelectDataGet(),p=[];if(!d||!d[0])return void g.Modal.alert("请选择要配置的操作行！");d.forEach(function(e){var t=Object.keys(e)[0],o=e[t];if(t&&o){var a={privGroupId:c.join(","),nodeId:l.infoPlatSelected[0],operType:l.operType,operId:o};p.push(a)}}),l.saveResponse(l.urls[l.confSaveSelectBox.get()[0]],p)}else if("FIELD"===l.switchType){var u=[],v=[];if(a.length<1)return void g.Modal.alert("请选择要新增/删除的字段行");a.forEach(function(e){v.push(e.FIELD_NAME)}),u=[{privGroupId:c.join(","),operType:"1",operId:"1",fieldName:v.join(",")}],l.saveResponse(l.urls[l.confSaveSelectBox.get()[0]+3],u)}else if("LEVEL"===l.switchType){if(!l.delLevelData[0]&&!l.resLevelData[0])return void g.Modal.alert("请对层级权限进行配置！");u=void 0;(l.delLevelData[0]||l.resLevelData[0])&&(u=m(l.delLevelData,c.join(","))),l.saveResponse(l.urls[l.confSaveSelectBox.get()[0]+6],u)}}else g.Modal.alert("请选择权限组！");else if(1<this.infoPlatSelected.length){if(!(d=l.standardTable&&l.standardTable.rowSelectDataGet())||!d[0])return void g.Modal.alert("请选择要配置的操作行！");if(1===o&&l.privGroudId){var h=[],f=[];d.forEach(function(e){var t=Object.keys(e)[0],o=e[t];if(t&&o){var a=[{privGroupId:l.privGroudId,nodeId:l.infoPlatSelected.join(","),operType:l.operType,operId:o}];e.IS_CHECKED?h.push(a):f.push(a)}}),h[0]&&l.saveResponse(l.urls[2],h),f[0]&&l.saveResponse(l.urls[1],f)}else if(1<o&&l.confSaveSelectBox){var y=[];t.forEach(function(e){y.push(e.PRIV_GROUP_ID)}),l.saveResponse(l.urls[l.confSaveSelectBox.get()[0]],(e=d,n=y.join(","),i=[],e.forEach(function(e){var t=Object.keys(e)[0],o=e[t];if(t&&o){var a=[{privGroupId:n,nodeId:l.infoPlatSelected.join(","),operType:l.operType,operId:o}];i.push(a)}}),i))}else g.Modal.alert("请选择权限组！")}else g.Modal.alert("请选择节点！");function D(e,t,o){l.saveResponse(e,[{privGroupId:l.privGroudId,operType:"1",operId:"1",fieldName:t.join(","),nodeId:l.infoPlatSelected[0]}],o)}function m(e,o){var a=[];return e.forEach(function(e){var t={privGroupId:o,operType:"1",operId:"1",levelId:e.LEVEL_ID,insType:e.INS_TYPE,insValue:e.INS_VALUE,nodeId:l.infoPlatSelected[0]};a.push(t)}),a}},e.prototype.ajaxLoad=function(e,t,o){return void 0===o&&(o=!0),y.BwRule.Ajax.fetch(e,{type:"Post",data:JSON.stringify(t),cache:o}).then(function(e){return e.response})},e}(o.PrivilegeDP);t.PrivilegePersonal=n}),define("PrivilegeDP",["require","exports","SearchInput","TableModulePc","BwRule","Button","SelectBox","Spinner","Modal","Tree"],function(e,t,o,c,p,d,u,h,f,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=BW.CONF,y=G.d,D=G.tools,n=function(){function e(e,t){this.dom=e,this.operateListString=[{type:"STANDARD",name:"OPER_ID",title:"OPER_NAME",typeName:"标准操作"},{type:"ACTION",name:"ELEMENT_ID",title:"CAPTION",typeName:"数据操作"},{type:"HANDLE",name:"ELEMENT_ID",title:"CAPTION",typeName:"全局操作"},{type:"ASSOCIATE",name:"ELEMENT_ID",title:"CAPTION",typeName:"关联操作"},{type:"OPERGROUP",name:"OPER_GROUP_ID",title:"OPER_GROUP_NAME",typeName:"操作组"}],this.operTypeArr=[1,2,3,4,0],this.privGroudId="",this.infoPlatSelected=[],this.localeLevelId="1",this.goodLevelId="1",this.localeCaption="地区",this.goodCaption="分部",this.ajax=new p.BwRule.Ajax,this.url=D.isNotEmpty(t)?t+"?deal_type=select":a.ajaxUrl.rmprivsSelect}return e.prototype.generatePrivGroup=function(e){if(!D.isEmpty(e)){this.privGroupSearchDom=y.create('<div class="priv-group-search"></div>');var n=y.create('<div class="priv-group-content"></div>');e.appendChild(this.privGroupSearchDom),e.appendChild(n);var i=this;this.privGroupSearchInput=new o.SearchInput({container:i.privGroupSearchDom,className:"w",placeholder:"搜索...",ajax:{url:i.url,fun:function(e,t,o,a){i.getPrivGroupData(n,o)}}}),this.getPrivGroupData(n,"")}},e.prototype.getPrivGroupData=function(e,t){var i=y.create("<table><tbody></tbody></table>"),l=this;e.innerHTML="",e.appendChild(i);var r=[];p.BwRule.Ajax.fetch(this.url,{type:"Post",defaultCallback:!1,data:'[{ "select_type":"getprivgroupbyuserinput","user_input":"'+t+'"}]',cache:!0}).then(function(e){var t=e.response,o=t&&t.body&&t.body.bodyList&&t.body.bodyList[0];o&&o.forEach(function(e){var t={PRIV_GROUP_ID:e.privGroupId,PRIV_GROUP_NAME:e.privGroupName};r.push(t)});var a={cols:[{title:"权限组",name:"PRIV_GROUP_NAME"},{title:"权限编号",name:"PRIV_GROUP_ID"}],multPage:2,isSub:!0,data:r},n=y.query(".priv-group-content",l.dom);l.privGroupTable=new c({tableEl:i,scrollEl:n},a).table,l.privGroupTable.on("rowSelect",function(e){var t=l.privGroupTable.rowSelectDataGet();if(1===t.length?l.privGroudId=t[0].PRIV_GROUP_ID:l.privGroudId="",1<t.length&&l.confSaveSelectBox?l.confSaveSelectBox.show():l.confSaveSelectBox&&l.confSaveSelectBox.hide(),"FIELD"===l.switchType)l.generateFieldContent();else if(l.operateContentDom&&l.lastOperTable&&l.operType&&"FUNCTION"===l.switchType){var o=y.query(".operate-conf",l.operateContentDom),a=l.operTypeArr.indexOf(l.operType),n=l.operateListString[a];l.getActionType(o,n.type,n.name,n.title,l.operType)}else"LEVEL"===l.switchType&&l.levelContentDom&&l.generateLGContent()})})},e.prototype.getActionType=function(e,t,o,a,n){},e.prototype.generateConfSavaSelectBox=function(e){var t=y.create('<div class="conf-save-content"></div>');e.appendChild(t),this.confSaveSelectBox=new u.SelectBox({container:t,select:{multi:!1},data:[{value:"reset",text:"重置授权"},{value:"grant",text:"增量授权"},{value:"back",text:"增量收回"}]}),this.confSaveSelectBox.hide()},e.prototype.generateFieldSearch=function(){var n=this;this.fieldSearchDom=y.create('<div class="field-search"></div>'),this.confSearchDom.appendChild(this.fieldSearchDom),this.fieldSearchInput=new o.SearchInput({container:n.fieldSearchDom,className:"w",placeholder:"搜索...",ajax:{url:n.url,fun:function(e,t,o,a){n.generateFieldContent(o)}}})},e.prototype.generateFieldContent=function(e){void 0===e&&(e="");var a=y.create("<table><tbody></tbody></table>"),r=[],s=this;if(this.fieldContentDom){this.fieldContentDom.innerHTML="",this.fieldContentDom.appendChild(a);var t=[{select_type:"getpropbyuserinput",user_input:e,node_id:1===s.infoPlatSelected.length?s.infoPlatSelected[0]:"",priv_group_id:s.privGroudId}];p.BwRule.Ajax.fetch(this.url,{type:"Post",data:JSON.stringify(t)}).then(function(e){var t=e.response;console.log(t);var n=t&&t.body&&t.body.bodyList&&t.body.bodyList[0],i=[];if(n&&n.meta){var l=n.meta.indexOf("IS_CHECKED");n.dataList[0]&&n.dataList.forEach(function(o,e){var a={};n.meta[0]&&n.meta.forEach(function(e,t){a[e]=o[t]}),r.push(a),-1<l&&o[l]&&i.push(e)})}("PERSONAL"===s.pageType&&s.infoPlatSelected.length<1||!s.privGroupTable||s.privGroupTable.rowSelectDataGet().length<1)&&(r=[]);var o={cols:[{title:"字段名",name:"CAPTION"},{title:"字段编号",name:"FIELD_NAME"}],multPage:2,isSub:!0,data:r};s.fieldTable=new c({tableEl:a,scrollEl:s.fieldContentDom,fixTop:190},o).table,s.privEcho(t,a),s.fieldTable.on("render",function(){s.privEcho(t,a)})})}},e.prototype.privEcho=function(e,a){var t=e&&e.body&&e.body.bodyList&&e.body.bodyList[0];t.meta&&-1<t.meta.indexOf("IS_CHECKED")&&e.data.forEach(function(e,t){var o=y.query('[data-index="'+t+'"]',a);o&&(o.dataset.checked="true",1===e.IS_CONTROL&&o.classList.add("bg-yellow"),1===e.IS_CHECKED&&(o.dataset.checked="true",o.classList.add("bg-blue")))})},e.prototype.generateLGContent=function(){var e,u=this,t=y.create('<div class="conf-btn"></div>'),o=y.create('<div class="table-wrapper"></div>'),r=y.create('<div class="child-table-wrapper"></div>'),a=y.create("<table><tbody></tbody></table>"),v=this,n=new h.Spinner({el:v.levelContentDom,type:h.Spinner.SHOW_TYPE.cover}),s=null;o.appendChild(a),v.levelContentDom.innerHTML="",v.levelContentDom.appendChild(o),v.levelContentDom.appendChild(r),v.levelContentDom.appendChild(t),n.show(),v.resLevelData=[],v.delLevelData=[];var i={select_type:"getprivsbyprivgroupid",node_id:1===v.infoPlatSelected.length?v.infoPlatSelected[0]:"",priv_group_id:v.privGroudId,privs_type:"LEVEL_PRIVS"};this.dataAjax([i],function(e){u.databaseData=e.data});var l=i;l.privs_sub_type=2,this.dataAjax([l],function(e){console.log(e,"主表数据"),n.hide();var t=[];(s=new c({tableEl:a,scrollEl:o,fixTop:200,tablePara:{rowMenu:[{title:"删除行",callback:function(e,t,o){var a=y.closest(o,"tr").dataset.index,n=s.table.rowSelectDataGet()[0],i=n.TREE_ID,l=n.TREE_NAME;s.table.rowHide(a),u.databaseData.forEach(function(e){e.TREE_ID===i&&e.TREE_NAME===l&&(-1<u.delLevelData.indexOf(e)||u.delLevelData.push(e))}),r.innerHTML=null}}]}},u.tableConf(u.resetCols(e.head.cols),e.data))).table.clickEvent.add("tbody tr",function(e){u.subTable(s.table.rowDataGet(y.closest(e.target,"tr").dataset.index),r,null)}),!D.isEmpty(t[0])&&t.forEach(function(e){y.query('[data-index="'+e+'"]',a).classList.add("selected")})}),this.levelModal||(e=y.create('<div class="privilege-modal" style="height:450px;"></div>'),v.levelModal=new f.Modal({header:"权限定值配置",body:e,isShow:!1,width:"800px",className:"privilege-modal",footer:{}}),this.generateLGModalSwitch(e)),this.levelModal.onOk=function(){var e=u.localeVariateSelectBox&&u.localeVariateSelectBox.getSelect(),t=u.goodVariateSelectBox&&u.goodVariateSelectBox.getSelect(),o=[],a=u.goodSelectBox&&u.goodSelectBox.getSelect()[0],n=u.localSelectBox&&u.localSelectBox.getSelect()[0],i=u.localTree&&u.localTree.getCheckedNodes(),l=u.goodTree&&u.goodTree.getCheckedNodes(),r=p(i,n),s=p(l,a),c=u.localeCaption,d="1";function p(e,t){var o=[],a=!1;return e&&e.forEach(function(e){0===e.deep&&(o=[],e.content.text="当前层级所有"+t.text,o.push(e.content),a=!0),a||e.deep!==t.levelNo||o.push(e.content)}),o}o=(o=o.concat(u.restarData(e,n.value,n.levelNo,"LOCALE","地点层级",c,d))).concat(u.restarData(r,n.value,n.levelNo,"LOCALE","地点层级",c,d)),a&&(c=u.goodCaption,d="1",o=(o=o.concat(u.restarData(t,a.value,a.levelNo,"GOOD","商品层级",c,d))).concat(u.restarData(s,a.value,a.levelNo,"GOOD","商品层级",c,d)),console.log(s,"商品定值")),console.log(o,"22"),o[0]?f.Modal.confirm({msg:"是否保存",title:"提示",btns:["取消","保存"],callback:function(e){e&&(u.resLevelData=o,u.generateSave(),v.levelModal.isShow=!1)}}):f.Modal.alert("请选择一条数据")},new d.Button({content:"配置",container:t,type:"primary",onClick:function(){u.delLevelData[0]?f.Modal.confirm({msg:"已执行删除操作，是否保存？",title:"提示",btns:["取消","保存"],callback:function(e){e&&(u.generateSave(),v.levelModal.isShow=!0)}}):v.levelModal.isShow=!0}})},e.prototype.generateSave=function(){var e=this;this.saveBtn?this.saveBtnCb():this.saveBtn=new d.Button({content:"保存",type:"primary",container:this.confSaveDom,onClick:function(){e.saveBtnCb()}})},e.prototype.saveBtnCb=function(){},e.prototype.subTable=function(a,o,n){var i=this;this.delLevelData=[];var e={select_type:"getprivsbyprivgroupid",node_id:1===this.infoPlatSelected.length?this.infoPlatSelected[0]:"",priv_group_id:this.privGroudId,privs_type:"LEVEL_PRIVS",privs_sub_type:3};e.privs_sub_type_param=a.TREE_ID;var l=new h.Spinner({el:o,type:h.Spinner.SHOW_TYPE.cover});l.show(),this.dataAjax([e],function(e){var t=y.create("<table><tbody></tbody></table>");o.innerHTML=null,o.appendChild(t),n=new c({tableEl:t,scrollEl:o,tablePara:{rowMenu:[{title:"删除选中行",multi:!0,callback:function(e,t,o){i.rowDelete(n,t,a)}}]}},i.tableConf(i.resetCols(e.head.cols),e.data,!0)),l.hide()})},e.prototype.rowDelete=function(a,e,n){var i=this,l=[];e.forEach(function(e){var t=e.dataset.index,o=a.table.rowDataGet(t);a.table.rowHide(t),i.delLevelData.push(Object.assign(o,n)),l.push(parseInt(t))});var t=a.table.data.get(),o=[];t.forEach(function(e,t){-1<l.indexOf(t)||o.push(e)}),a.tableData.setNewData(o),console.log(this.delLevelData,"deldata")},e.prototype.tableConf=function(e,t,o){return void 0===o&&(o=!1),{cols:e,multPage:2,isSub:!0,data:t,multiSelect:o}},e.prototype.dataAjax=function(e,o){p.BwRule.Ajax.fetch(this.url,{type:"post",data:JSON.stringify(e)}).then(function(e){var t=e.response;"function"==typeof o&&o(t)})},e.prototype.restarData=function(e,o,a,n,i,l,r){var s=this,c=[];return e&&e.forEach(function(e){var t={LEVEL_ID:o,TREE_ID:n,LEVEL_NO:a,TREE_NAME:i,CAPTION:l,INS_TYPE:r,INS_VALUE:e.value,INS_VALUE_NAME:e.text};-1<s.databaseData.indexOf(t)||c.push(t)}),c},e.prototype.generateLGModalSwitch=function(e){var t=this,o=y.create('<ul class="nav nav-tabs nav-tabs-line"></ul>'),a=y.create('<div class="lg-content"></div>'),n=y.create('<li class="active"><a><i class="iconfont icon-tongji"></i>地区</a></li>'),i=y.create('<li><a><i class="iconfont icon-function"></i>商品</a></li>');o.appendChild(n),o.appendChild(i),e.appendChild(o),e.appendChild(a),this.levelTreeType="LOCALE",this.localeContentDom?this.localeContentDom.style.display="block":(this.localeContentDom=y.create('<div class="locale-wrapper"></div>'),a.appendChild(this.localeContentDom),this.generateLGModalContent(this.localeContentDom,"LOCALE")),y.on(n,"click",function(){i.classList.remove("active"),n.classList.add("active"),t.goodContentDom&&(t.goodContentDom.style.display="none"),t.localeContentDom.style.display="block",t.levelTreeType="LOCALE"}),y.on(i,"click",function(){n.classList.remove("active"),i.classList.add("active"),t.goodContentDom?t.goodContentDom.style.display="block":(t.goodContentDom=y.create('<div class="good-wrapper"></div>'),a.appendChild(t.goodContentDom),t.generateLGModalContent(t.goodContentDom,"GOOD")),t.localeContentDom.style.display="none",t.goodContentDom.style.display="block",t.levelTreeType="GOOD"})},e.prototype.generateLGModalContent=function(e,t){var o=this,a=y.create('<ul class="vc-menu"></ul>'),n=y.create('<div class="vc-content"></div>'),i=y.create('<li class="li-select"><a>变量</a></li>'),l=y.create("<li><a>定值</a></li>");a.appendChild(i),a.appendChild(l),e.appendChild(a),e.appendChild(n),"LOCALE"===t?(this.localeVariateDom=y.create('<div class="locale-variate"></div>'),this.getConsValueData(this.localeVariateDom,t,n,!1),this.localeInsType="1",y.on(i,"click",function(){l.classList.remove("li-select"),i.classList.add("li-select"),o.localeVariateDom.style.display="inline-block",o.localeConsValueDom&&(o.localeConsValueDom.style.display="none"),o.localeInsType="1"}),this.localeConsValueDom=y.create('<div class="locale-consvalue"></div>'),n.appendChild(this.localeConsValueDom),this.getConsValueData(this.localeConsValueDom,"LOCALE"),y.on(l,"click",function(){i.classList.remove("li-select"),l.classList.add("li-select"),o.localeVariateDom.style.display="none",o.localeConsValueDom.style.display="block",o.localeInsType="0"})):"GOOD"===t&&(this.goodVariateDom=y.create('<div class="good-variate"></div>'),this.getConsValueData(this.goodVariateDom,t,n,!1),this.goodInsType="1",y.on(i,"click",function(){l.classList.remove("li-select"),i.classList.add("li-select"),o.goodVariateDom.style.display="block",o.goodConsValueDom&&(o.goodConsValueDom.style.display="none"),o.goodInsType="1"}),this.goodConsValueDom=y.create('<div class="good-consvalue"></div>'),n.appendChild(this.goodConsValueDom),this.getConsValueData(this.goodConsValueDom,"GOOD"),y.on(l,"click",function(){i.classList.remove("li-select"),l.classList.add("li-select"),o.goodVariateDom.style.display="none",o.goodConsValueDom.style.display="block",o.goodInsType="0"}))},e.prototype.getVariateData=function(i,l){var r=this,s=new h.Spinner({el:i,type:h.Spinner.SHOW_TYPE.cover});s.show(),p.BwRule.Ajax.fetch(r.url,{type:"Post",data:' [{"select_type":"getinsparaminfo"}]',cache:!0}).then(function(e){var t=e.response,o=t&&t.body&&t.body.bodyList&&t.body.bodyList[0];if(o&&o.dataList){var a=[];o.dataList[0]&&o.dataList.forEach(function(e){e[0]&&e[1]&&a.push({value:e[0],text:e[1]})}),s.hide(),"LOCALE"===l?r.localeVariateSelectBox=n(i,a):"GOOD"===l&&(r.goodVariateSelectBox=n(i,a))}function n(e,t){return new u.SelectBox({container:e,select:{multi:!0,callback:function(e){}},data:t})}})},e.prototype.getConsValueData=function(e,t,o,a){void 0===a&&(a=!0);var n=y.create('<div class="level-select"></div>'),i=y.create("<div><span>层级</span></div>"),l=y.create('<div class="lg-conf-content"></div>'),r=y.create('<div><span class="priv-conf">可配置权限</span></div>'),s=y.create('<div data-level="1" class="level-conf select-box-small menu"></div>');o&&o.appendChild(e),n.appendChild(i),l.appendChild(r),r.appendChild(s),e.appendChild(n),e.appendChild(l),a?"LOCALE"===t?this.localTree=this.createTree(s,t):this.goodTree=this.createTree(s,t):this.getVariateData(s,t),this.getLevelData(t,i)},e.prototype.getLevelData=function(s,c){var d=this;p.BwRule.Ajax.fetch(this.url,{type:"POST",data:[{select_type:"getlevelinfo"}],cache:!0}).then(function(e){var t,o=e.response.data,a=[],n=function(e){e.deep>=t+1?(e.expand=!1,e.isLeaf=!0):e.isLeaf=!1};if(o[0]){o.forEach(function(e){e.TREE_ID===s&&a.push({value:e.LEVEL_ID,text:e.CAPTION,levelNo:e.LEVEL_NO})});var i=a.length;if("GOOD"===s?d.goodSelectBox=r(function(e){t=e,d.goodTree.each(n)}):"LOCALE"===s&&(d.localSelectBox=r(function(e){t=e,d.localTree.each(n)})),"LOCALE"!==s||d.localeSelectd){if("GOOD"===s&&!d.goodSelectd){d.goodSelectd=[];for(l=0;l<=i;l++)d.goodSelectd[l]=[]}}else{d.localeSelectd=[];for(var l=0;l<=i;l++)d.localeSelectd[l]=[]}}function r(o){return new u.SelectBox({container:c,select:{multi:!1,callback:function(e,t){o(e)}},data:a})}})},e.prototype.treeChild=function(e){var t=[],o=e.meta;return e.data.forEach(function(e){t.push({text:e[o[1]],content:{value:e[o[0]],isLeaf:e.IS_LEAF,text:e[o[1]]},isAccordion:!0,isLeaf:!0})}),t},e.prototype.createTree=function(e,t){var a=this,n=new i.Tree({text:"当前层级所有",container:e,content:{value:"0",isLeaf:0,text:"当前层级所有"},isAccordion:!1,isVirtual:!1,isLeaf:!1,isShowCheckBox:!0,ajax:function(e){return p.BwRule.Ajax.fetch(a.url,{type:"Post",data:JSON.stringify([{select_type:"getinsvalueinfo",tree_id:t,level_no:e.deep+1,current_id:e.content.value}]),cache:!0}).then(function(e){var t=e.response;return a.treeChild(t)})}});return n.onExpand=function(e,t){if(t){var o=a.localSelectBox.get()[0]+1;n.each(function(e){e.deep>=o||1===e.content.isLeaf?e.isLeaf=!0:e.isLeaf=!1})}},n},e.prototype.saveResponse=function(e,t,o){var a=this;void 0===o&&(o=!0),p.BwRule.Ajax.fetch(e,{type:"POST",data:t}).then(function(){o&&(f.Modal.alert("保存成功!"),a.judgeControl())})},e.prototype.judgeControl=function(){},e.prototype.resetCols=function(e){var t=[];return e.forEach(function(e){t.push({name:e.name,title:e.caption})}),t},e.prototype.confUrl=function(e,t){return D.isNotEmpty(t)?t+"/"+e+"?deal_type=select":a.siteAppVerUrl+"/rmprivs/"+e},e}();t.PrivilegeDP=n});