define("SqlMonitor",["require","exports","BasicPage","Button","TextInput","BwRule","SelectInput","Modal"],function(e,t,a,n,i,u,o,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var p=G.d,m=BW.CONF,s=function(a){function d(e){var t=a.call(this,e)||this;return t.para=e,t.btns={},t.coms={},t.container=e.dom,t.initPage(),t}return __extends(d,a),d.prototype.initPage=function(){var n=this;p.append(this.container,h("div",{className:"sqlTop"},h("div",{className:"sql-input"},h("div",{"data-name":"appid",className:"inputArea"},h("span",null,"APPID:")),h("div",{"data-name":"clientIp",className:"inputArea"},h("span",null,"数据库:")),h("div",{"data-name":"clientUser",className:"inputArea"},h("span",null,"用户工号:")),h("div",{"data-name":"deviceType",className:"inputArea"},h("span",null,"设备类型:")),h("div",{"data-name":"urlAddr",className:"inputArea"},h("span",null,"地址:")),h("div",{"data-name":"uuid",className:"inputArea"},h("span",null,"MAC地址:")),h("div",{"data-name":"nodeId",className:"inputArea"},h("span",null,"节点:")),h("div",{"data-name":"monitorType",className:"inputArea"},h("span",null,"显示类型:")),h("div",{"data-name":"sqlType",className:"inputArea"},h("span",null,"SQL类型:"))),h("div",{"data-name":"search",className:"inputArea searchInp"},h("span",null,"查找:")),h("div",{style:"clear: both;"}),h("div",{"data-name":"clearBut",className:"clearBut",style:"margin-right: 70px;"}),h("div",{"data-name":"end",className:"end"}),h("div",{"data-name":"start",className:"start"}))),p.append(this.container,h("div",{id:"sqlMonitorContent",className:"content"})),this.replaceType(),this.btns.end.wrapper.classList.add("disabled");var s=p.query(".content",this.container),e=p.query(".sqlTop",this.container),t=p.closest(this.container,".page-container"),a=p.query(".breadcrumb",t);s.style.marginTop=e.offsetHeight+a.offsetHeight+"px",t.style.backgroundColor="white",a.style.position="fixed",a.style.top="40px";var r=p.query(".searchInp",this.container),c=p.query("input",r);p.on(c,"keydown",function(e){13===e.keyCode&&function(){var e=n.coms.search.get(),t=s.innerText,a=new RegExp("("+e+")","g");if(-1===t.indexOf(e)||""===e)return l.Modal.toast("没有查到相关数据");t=(t=(t=(t=t.replace(/<span style="color:red;">([\s\S]*?)<\/span>/g,"$1")).replace(a,"<span style='color:red;'>$1</span>")).replace(/([\n]+)/g,"</br></br>")).slice(5,t.length),s.innerHTML=t}()});var i=p.query(".end > .btn",this.container);i.classList.remove("disabled"),i.click()},d.prototype.replaceType=function(){var a=this,c=this;p.queryAll("[data-name]",document.body).forEach(function(e){switch(e.dataset.name){case"start":a.btns.start=new n.Button({container:e,content:"开始",type:"primary",onClick:function(e){c.coms.clientUser,p.query(".searchInp",c.container);var t=p.query(".sql-input",c.container);c.startSqlMonitor(),t.classList.add("disabled"),c.btns.start.wrapper.classList.add("disabled"),c.btns.end.wrapper.classList.remove("disabled")}});break;case"end":a.btns.end=new n.Button({container:e,content:"停止",type:"primary",onClick:function(e){p.query(".searchInp",c.container);var t=p.query(".sql-input",c.container);c.stopSqlMonitor(),t.classList.remove("disabled"),c.btns.start.wrapper.classList.remove("disabled"),c.btns.end.wrapper.classList.add("disabled")}});break;case"clearBut":a.btns.clearBut=new n.Button({container:e,content:"清空",type:"primary",onClick:function(e){var t=p.query(".content",c.container),a=p.closest(c.container,".page-container");t.innerHTML="",a.scrollTop=0}});break;case"search":a.coms.search=new i.TextInput({container:e,className:"text",placeholder:"请输入查找关键字"});break;case"appid":a.coms.appid=new i.TextInput({container:e,className:"text"}),a.coms.appid.set(m.appid);break;case"appserver":break;case"clientIp":t="/lookup/n1000_monitor-01/monitor-02",s="clientIp",r=e,u.BwRule.Ajax.fetch(m.siteAppVerUrl+t,{type:"POST"}).then(function(e){var t=e.response,a=[],n=t.meta[0];t.data.forEach(function(e){e[n]?a.push({value:e[n],text:e[n]}):a.unshift({value:"",text:"--- ---"})}),c.coms[s]=new o.SelectInput({container:r,data:a,readonly:!0,placeholder:"默认",onSet:function(e,t){console.log(e)},className:"selectInput",clickType:0}),c.coms[s].set("")});break;case"clientUser":a.coms.clientUser=new i.TextInput({container:e,className:"text"});break;case"deviceType":a.coms.deviceType=new o.SelectInput({container:e,readonly:!0,data:d.deviceType,className:"selectInput",clickType:0}),a.coms.deviceType.set(0);break;case"uuid":a.coms.uuid=new i.TextInput({container:e,className:"text"});break;case"nodeId":a.coms.nodeId=new i.TextInput({container:e,className:"text"});break;case"urlAddr":a.coms.urlAddr=new i.TextInput({container:e,placeholder:"可输入部分地址",className:"text"});break;case"monitorType":a.coms.monitorType=new o.SelectInput({container:e,readonly:!0,data:[{value:2,text:"--- ---"},{value:0,text:"平台"},{value:1,text:"业务"}],placeholder:"默认",onSet:function(e,t){},className:"selectInput",clickType:0}),a.coms.monitorType.set(2);break;case"sqlType":a.coms.sqlType=new o.SelectInput({container:e,readonly:!0,data:[{value:0,text:"原始sql"},{value:1,text:"带参sql"}],className:"selectInput",clickType:0}),a.coms.sqlType.set(0)}var t,s,r})},d.prototype.stopSqlMonitor=function(){u.BwRule.Ajax.fetch(m.siteAppVerUrl+"/monitor/log/stop",{defaultCallback:!1})},d.prototype.startSqlMonitor=function(){var e=this.coms.appid,t=this.coms.clientIp,a=this.coms.clientUser,n=this.coms.deviceType,s=this.coms.uuid,r=this.coms.urlAddr,c=this.coms.nodeId,i=this.coms.monitorType,o=this.coms.sqlType,l={appId:e.get(),dataSource:t.get(),clientUser:a.get(),deviceType:0===d.deviceType[n.get()].value?"":d.deviceType[n.get()].text,uuid:s.get(),urlAddr:r.get(),nodeId:c.get(),monitorType:i.get()};for(var p in 2!==o.get()&&(l.sqlType=o.get()),l)""===l[p]&&delete l[p];u.BwRule.Ajax.fetch(m.siteAppVerUrl+"/monitor/log/start",{type:"POST",defaultCallback:!1,data:l})},d.deviceType=[{value:0,text:"--- ---"},{value:1,text:"Android"},{value:2,text:"IOS"},{value:3,text:"PC"}],d}(a.default);t.SqlMonitor=s});