define("BugList",["require","exports","BugReport","DataManager","BwRule"],function(t,e,v,w,b){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=G.Component,E=BW.CONF,T=BW.sys,I=G.d,_=G.tools,n=function(g){function m(r){var t,o,i,u,s,p,c,l,e,a,d=g.call(this)||this;d.noData={toggle:function(t){d.wrapper.classList.toggle(m.BUGLISt_NOT_DATA_CLASS,t)}},d.detailEvent=(t=function(t){var e=I.closest(t.target,".bug-item").dataset.id;T.window.open({url:_.url.addObj(E.url.bugDetail,{bugid:e,isself:d.allowUpdate})})},{on:function(){return I.on(d.wrapper,"click",".bug-item",t)},off:function(){return I.off(d.wrapper,"click",".bug-item",t)}}),d.swipeEvent=(o=null,p=s=u=i=0,l=c=!1,e=function(t){d.currentItem&&d.currentItem.classList.remove("active");var e=I.closest(t.target,".bug-item");if(e.classList.add("active"),d.currentItem=e,d.allowUpdate){i=t.changedTouches[0].pageX,u=t.changedTouches[0].pageY,l=c=!0,o&&o.classList.remove("swipeleft");var a,n=function(t){t.stopPropagation(),s=t.changedTouches[0].pageX,p=t.changedTouches[0].pageY;var e=I.closest(t.target,".bug-item"),a=I.query(".swipeout",e);c&&0<Math.abs(s-i)-Math.abs(p-u)&&(t.stopPropagation(),10<s-i&&a.classList.remove("swipeleft"),10<i-s&&(a.classList.add("swipeleft"),o=a),l=!1),l&&Math.abs(s-i)-Math.abs(p-u)<0&&(c=!1)};I.on(d.wrapper,"touchmove",".bug-item",n),I.on(d.wrapper,"touchend",".bug-item",a=function(){I.off(d.wrapper,"touchmove",".bug-item",n),I.off(d.wrapper,"touchend",".bug-item",a)})}else{var r;I.on(d.wrapper,"touchend",".bug-item",r=function(){I.off(d.wrapper,"touchend",".bug-item",r)})}},{on:function(){return I.on(d.wrapper,"touchstart",".bug-item",e)},off:function(){return I.off(d.wrapper,"touchstart",".bug-item",e)}}),d.updateEvent=(a=function(t){t.stopPropagation();var e=I.closest(t.target,".bug-item");new v.BugReportModal(parseInt(e.dataset.id),!0)},{on:function(){return I.on(d.wrapper,"touchstart",".swipeout",a)},off:function(){return I.off(d.wrapper,"touchstart",".swipeout",a)}}),d.currentBugItemId=-1,d.noData.toggle(!0);var n=I.query(".mui-content"),f=new w.DataManager({loading:{msg:"正在加载，请稍后...",disableEl:n,container:document.body},ajax:{fun:function(t){var e=t.current,a=t.pageSize,n=(t.isRefresh,'{"index"='+(e+1)+',"size"='+a+',"total"=1}');return b.BwRule.Ajax.fetch(r.ajaxUrl,{data:{pageparams:n}}).then(function(t){var e=t.response;return{data:e.data,total:e.head.totalNum}})},auto:!0},page:{size:20,options:[20],container:d.wrapper.parentElement},render:function(t,e){var a=f.data.slice(t,e);d.noData.toggle(0===a.length),d.initDom(a)}});return d.dataManager=f,d.detailEvent.on(),d.allowUpdate=!!_.isNotEmpty(r.allowUpdate)&&r.allowUpdate,d.swipeEvent.on(),d.updateEvent.on(),d}return __extends(m,g),m.prototype.wrapperInit=function(){return h("div",{className:"bug-container"})},Object.defineProperty(m.prototype,"currentItem",{get:function(){return this._currentItem},set:function(t){this._currentItem=t},enumerable:!0,configurable:!0}),m.prototype.initDom=function(t){var n=this;this.wrapper.innerHTML="";var r=["未处理","处理中","已解决","重新申报"],o=["open","close","doing","redo"];t.forEach(function(t){var e=t.MESSAGE;e=_.isNotEmpty(e)?e:"用户未描述";var a=h("div",{className:"bug-item","data-id":t.BUG_ID},h("div",{className:"title-wrapper"},h("div",{className:"title"},t.TITLE),h("div",{className:"status "+o[t.BUG_STATUS]},r[t.BUG_STATUS]),h("div",{className:"time"},n.handlerTime(t.UPDATE_TIME))),h("div",{className:"content"},e),h("div",{className:"line"}),h("div",{className:"swipeout"},"修改"));n.wrapper.appendChild(a)})},m.prototype.handlerTime=function(t){var e=new Date(1e3*t),a=e.getFullYear(),n=e.getMonth()+1,r=e.getDate();return a+"/"+(n<10?"0"+n:n)+"/"+(r<10?"0"+r:r)},m.prototype.destory=function(){this.updateEvent.off(),this.swipeEvent.off(),this.detailEvent.off(),this.currentBugItemId=-1},m.BUGLISt_NOT_DATA_CLASS="buglist-nodata",m}(a);e.BugList=n});