define("BasicTable",["require","exports","CheckBox"],function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var E=G.tools,R=G.d,o=function(){function t(t){var w,l,e,h,p,n,o,a,i,r,s,c,d,u,f,b,m,v,g,y,C=this;this.tbodyLength=0,this.startIndex=0,this.trSelected=[],this.draging=!1,this.styleList={},this.styleListReady=!1,this.theadHeight=0,this.cellHeight=30,this.lockCol={table:null,Container:null},this.lockRow={table:null,fixed:null,Container:null,ContainInner:null,fixedContainer:null,fixedTable:null},this.indexCol={width:0,show:!0,col:null},this.pseudoCol={width:30,show:!0,Container:null,fixedCol:null,confList:[]},this.colResize={dragging:!1,column:null,resizeProxy:null},this.move={col:null,hoverCol:null,hoverRow:null,moving:!1,timeout:null},this.colHide={ready:!1,status:{}},this.treegrid={data:[]},this.movingColumn=null,this.movingHoverColumn=null,this.movingHoverRow=null,this.moving=!1,this.dragSelect={selected:{}},this.dragRows={selected:{}},this.dragControl={dragging:!1},this.expand={toggler:{},Container:null},this.tableStatus=!0,this.treegridFunc=function(u){var f={hitInfo:function(t){return{hit:R.query(".tree-hit",t),icon:u.conf.treegrid.icon}},iconOpen:function(t){var e=this.hitInfo(t);e.hit.classList.remove(c(!1)),e.hit.classList.add(c(!0)),e.hit.classList.remove(c("loading"))},iconClose:function(t){var e=this.hitInfo(t);e.hit.classList.remove(c(!0)),e.hit.classList.add(c(!1)),e.hit.classList.remove(c("loading"))},iconLoading:function(t){var e=this.hitInfo(t);e.hit.classList.remove(c(!1)),e.hit.classList.add(c("loading"))},sysOpen:function(t){var e=p.getRootIndex(t);if(null!=e){var n,o=R.query('tr[data-index="'+e+'"]',u.table),a=R.query('tr[data-index="'+(e+1)+'"]',u.table),i=o.offsetTop;n=(a?a.offsetTop:u.table.offsetHeight)-i,u.sysColOpen(e,n)}},sysClose:function(t){if(/^\d+$/.test(t)){var e=p.getRootIndex(t);null!=e&&u.sysColClose(e)}else this.sysOpen(t)}},h={getNodeIndex:function(t){return function t(e,n){if(1===e.length)return n[e[0]];var o=e.shift();return n[o]&&n[o].children?t(e,n[o].children):null}(t.split("-"),u.treegrid.data)},addNodes:function(t,e,n){var o=[];e.forEach(function(t){o.push({data:t,level:n,open:!1})}),t.children=o},init:function(t){u.treegrid.data=[],t.forEach(function(t,e){u.treegrid.data[e]={open:!1,level:0,data:t}})}},p={addChilds:function(a,t){var e,i,n=R.query('tr[data-index="'+a+'"]',u.table),l=n.nextSibling?n.nextSibling:null;0<u.conf.lockColNum&&(e=R.query('tr[data-index="'+a+'"]',u.lockCol.table),i=e.nextSibling?e.nextSibling:null),t.forEach(function(t,e){var n=u.rowCreate(t,a+"-"+e);if(l?u.table.tBodies[0].insertBefore(n,l):u.table.tBodies[0].appendChild(n),0<u.conf.lockColNum){var o=u.lock.rowCreate(n);i?u.lockCol.table.tBodies[0].insertBefore(o,i):u.lockCol.table.tBodies[0].appendChild(o)}})},getRootIndex:function(t){var e,n=t.indexOf("-");return e=~n?t.substring(0,n):t,parseInt(e)},getParentIndex:function(t){var e=t.toString().lastIndexOf("-");return~e?t.substring(0,e):t},getNextIndex:function(t){var e,n=t.toString().match(/(.*)-(\d+)/);n?e=n[1]+"-"+(parseInt(n[2])+1):e=parseInt(t)+1;if(R.query('tr[data-index="'+e+'"]',u.table))return e;if(n){var o=this.getParentIndex(e);return this.getNextIndex(o)}return""},hideChilds:function(t,e){if(void 0===e&&(e=!1),t)for(var n=R.query('tr[data-index="'+t+'"]',u.table),o=this.getNextIndex(t),a=n;a=e?a.nextSibling:n.nextSibling;){var i=a.dataset.index;if(i===o.toString())break;if(e){if(a.style.display="none",0<u.conf.lockColNum)(l=R.query('tr[data-index="'+i+'"]',u.lockCol.table)).style.display="none"}else if(R.remove(a),0<u.conf.lockColNum){var l=R.query('tr[data-index="'+i+'"]',u.lockCol.table);R.remove(l)}}}};function t(t){var e,n,o,a,i,l,r,s=u.getEvent(t),c=R.closest(s.target,"tr").dataset.index;if(c){var d=R.closest(s.target,"td");h.getNodeIndex(c).open?(a=d,i=c,l=h.getNodeIndex(i),r=u.conf.treegrid.cache,l.open=!1,f.iconClose(a),p.hideChilds(i,r),f.sysClose(i)):(e=d,n=c,o=h.getNodeIndex(n),f.iconLoading(e),u.conf.treegrid.render(o,n,function(t){o.open=!0,t&&0<t.length&&(h.addNodes(o,t,o.level+1),p.addChilds(n,t),f.sysOpen(n)),f.iconOpen(e)}))}}function c(t){var e;switch(t){case!1:e=u.conf.treegrid.icon[0];break;case!0:e=u.conf.treegrid.icon[1];break;case"loading":e="shuaxin1"}return"icon-"+e}function n(t,e){if(u.conf.treegrid.enabled&&e&&"TD"===e.tagName){var n=h.getNodeIndex(t.toString());if(n){for(var o="",a=parseInt(n.level),i=e.innerHTML,l=c(n.open),r="",s=0;s<a;s++)o+='<span class="tree-indent"></span>';r=u.conf.treegrid.expand(n,t)?'<i class="tree-hit iconfont '+l+'"></i>':'<i class="tree-hit-blank"></i>',e.innerHTML='<div class="treegrid">'+o+r+'<span class="tree-title">'+i+"</span></div>"}}}function e(t){if(u.conf.treegrid.enabled&&R.query(".treegrid",t)){var e=R.query(".tree-title");t.innerHTML=e.innerHTML}}function o(t){void 0===t&&(t=u.tableData),h.init(t)}return{init:function(){o(),R.on(u.tableContainer,u.mousedownName,".treegrid",t)},addBtn:n,add:function(t){u.conf.treegrid.enabled&&(t[1]&&R.query(".treegrid",t[1])||t.forEach(function(t,e){n(e,t)}))},removeBtn:e,remove:function(t){u.conf.treegrid.enabled&&t[1]&&R.query(".treegrid",t[1])&&t.forEach(function(t){e(t)})},update:o,exchangeTd:function(t,e){if(u.conf.treegrid.enabled&&e&&"TD"===e.tagName){var n=e.innerHTML;e.innerHTML=t.innerHTML,t.innerHTML=e.querySelector(".tree-title").innerHTML,e.querySelector(".tree-title").innerHTML=n}}}}(this),this.expandFunc=function(h){var i="icon-arrow-right",l="icon-arrow-down",e="icon-shuaxin1",c={show:function(t){t.classList.remove(i),t.classList.add(l),t.dataset.status="1"},hide:function(t,e,n){var o,a=u(e);a&&(o=f(e),a.style.display="none",o.forEach(function(t){t.style.display="none"}),n.classList.add(i),n.classList.remove(l),n.dataset.status="0",h.sysColClose(e),c.ContainerUpdate())},loading:function(t){t.classList.remove(i,l),t.classList.add(e)},unloading:function(t){t.classList.remove(e),t.classList.add(l)},ContainerUpdate:function(){R.queryAll(".tableExpandContainer").forEach(function(t){var e=t.dataset.expandIndex,n=R.query('tr[data-index="'+e+'"]',h.table),o=E.offset.top(n)+n.offsetHeight-E.offset.top(h.tableContainer);t.style.top=o+"px"})}};function d(t,e,n){void 0===n&&(n=h.table);var o=h.rowGet(t+1,n);o?n.tBodies[0].insertBefore(e,o):n.tBodies[0].appendChild(e)}function u(t){return R.query('div[data-expand-index="'+t+'"]',h.tableContainer)}function f(t){return R.queryAll('tr[data-expand-index="'+t+'"]',h.tableContainer)}function p(t,e,n){var o,a,i=f(e),l=u(e);if(0<i.length)i.forEach(function(t){t.style.display="table-row"}),l.style.display="block";else{var r=document.createElement("tr");if(r.setAttribute("data-expand-index",e),d(e,r),l=R.create('<div class="tableExpandContainer" data-expand-index="'+e+'"></div>'),h.tableContainer.appendChild(l),i.push(r),0<h.conf.lockColNum){var s=r.cloneNode(!0);d(e,s,h.lockCol.table),i.push(s)}}l.innerHTML=n,h.expand.toggler[e]=n,a=(o=l.offsetHeight)+h.cellHeight,i.forEach(function(t){t.style.height=o+"px"}),h.sysColOpen(e,a),c.ContainerUpdate()}function b(t,e,n){var o,a,i,l,r,s;o=e,a=n,i=function(){c.show(n)},r=h.conf.expand,s=h.tableData[o],r.cache&&(l=h.expand.toggler[o]),void 0===l?r.render?(c.loading(a),r.render(s,o,function(t,e){if(t||(t=s),"object"==typeof t){var n=function(t,e){void 0===e&&(e="dl");var n="null";switch(e){case"dl":n=function(t){var e=[];for(var n in t)t.hasOwnProperty(n)&&e.push('<dl class="tableExpandDl"><dt>'+n+"</dt><dd>"+t[n]+"</dd></dl>");return e.join("")}(t)}return n}(t,e);p(0,o,n)}else p(0,o,t);i(),c.unloading(a)})):p(0,o,"error"):(p(0,o,l),i())}function m(t,e,n){c.hide(t,e,n)}function t(t,e){var n,o,a,i,l,r,s,c,d,u=h.getEvent(e),f=R.closest(u.target,".pseudoCol");if(f)switch(n=f.dataset.pseudo,t=parseInt(t),h.conf.expand.mode){case"toggler":r=n,s=t,(d=(c=u).target.dataset.status)&&("0"===d?b(0,s,c.target):m(r,s,c.target));break;case"accordion":o=n,a=t,l=(i=u).target.dataset.status,R.queryAll('.pseudoCol[data-pseudo="'+o+'"] [data-status="1"]',h.pseudoCol.Container).forEach(function(t){var e=R.closest(t,".pseudoCol-item"),n=parseInt(e.dataset.index);n!=a&&e&&m(o,n,R.query(".tableExpand",e))}),l&&("0"===l?b(0,a,i.target):m(o,a,i.target))}}return{init:function(){var e;e=h.conf.expand,h.pseudoColFun.init({render:function(t){return'<i class="iconfont tableExpand icon-'+e.icon[0]+'" data-status="0"></i>'},click:t})}}}(this),this.moveEvent=(w=this,{col:function(){R.on(w.tableContainer,w.mousedownName,"th",function(t){var e,n,l,r,o,a=this,i=t.target,s=document.body.scrollWidth,c=null,d=null,u=!1,f=!1,h=0,p=0;if(1===t.which){var b=function(){R.queryAll(".col-disabled",a.tableWrapper).forEach(function(t){t.classList.remove("col-disabled")}),y(),R.remove(w.movingHoverColumn),R.off(document,w.mousemoveName,C),R.off(document,w.mouseupName,b),document.onselectstart=null,document.ondragstart=null,w.movingColumn=null,w.moving=!1,d=c=null,w.unlockScreen(),w.conf.colGroup&&w.colGroup.on()};w.conf.Container?(h=E.offset.left(w.conf.Container),p=h+w.conf.Container.offsetWidth):(h=E.offset.left(w.tableWrapper),p=h+w.tableWrapper.offsetWidth),w.movingHoverColumn=R.query(".tableMovingContainer")||R.create('<div class="tableMovingContainer"></div>'),w.lockScreen(),document.onselectstart=function(){return!1},document.ondragstart=function(){return!1},w.timeOut=setTimeout(function(){if(!w.colResize.dragging){for(;i&&"TH"!==i.tagName;)i=i.parentNode;var o,a;w.movingColumn=i,w.movingColumn&&(d=m(),n=w.colName2index(w.movingColumn.dataset.col),w.colGet(n,w.table).forEach(function(t){t.classList.add("col-disabled")}),0<w.conf.lockColNum&&w.colGet(n,w.lockCol.table).forEach(function(t){t.classList.add("col-disabled")}),w.conf.lockRow&&w.colGet(n,w.lockRow.table).forEach(function(t){t.classList.add("col-disabled")}),0<w.conf.lockColNum&&w.conf.lockRow&&w.colGet(n,w.lockRow.fixedTable).forEach(function(t){t.classList.add("col-disabled")}),o=w.table.tHead.cloneNode(),a=w.table.tBodies.item(0).cloneNode(),(e=w.table.cloneNode()).removeAttribute("id"),e.classList.remove("hideLock"),e.appendChild(o),e.appendChild(a),w.movingHoverColumn.appendChild(e),w.tableWrapper.appendChild(w.movingHoverColumn),w.colGet(n,w.table).forEach(function(t){var e=document.createElement("tr"),n=t.cloneNode(!0);n.classList.remove("col-disabled"),e.appendChild(n),"TH"===t.tagName?o.appendChild(e):"TD"===t.tagName&&a.appendChild(e),c||((c={}).left=E.offset.left(t),c.right=c.left+t.offsetWidth,c.width=t.offsetWidth),w.movingHoverColumn.setAttribute("data-index",w.colName2index(t.dataset.col)+"")}),w.moving=!0,R.on(document,w.mousemoveName,C),R.on(document,w.mouseupName,b))}},300)}function m(){var n={locktable:[],table:[]};return 0<w.conf.lockColNum&&R.queryAll("th",w.lockCol.table.tHead).forEach(function(t){var e=t.getBoundingClientRect();n.locktable.push([e.left,e.right])}),R.queryAll("th",w.table.tHead).forEach(function(t){var e=t.getBoundingClientRect();n.table.push([e.left,e.right])}),n}function v(){var t=w.tableMiddle.scrollLeft;w.tableMiddle.scrollLeft=0<t?t-5:0,y(),o=setTimeout(v)}function g(){w.tableMiddle.scrollLeft+=5,y(),o=setTimeout(g)}function y(){o&&clearTimeout(o)}function C(t){var e;t.preventDefault(),t=w.getEvent(t),clearTimeout(w.move.timeout),(e=t).clientX<h?v():e.clientX>p?g():y();var n,o=t.clientX-10-h,a=parseInt(w.movingHoverColumn.dataset.index),i=s-c.width-10;t.clientX>i&&(o=i),n=function(t,e){var n=0,o=null;if(t>e.left&&t<e.right||!d||t<d.table[0][0]||t>d.table[d.table.length-1][1]||s<t)return null;for(var a=0,i=d.locktable.length;a<i;a++)if(n=d.locktable[a][1],t>d.locktable[a][0]&&t<d.locktable[a][1])return o=a;if(null===o){for(a=o=0,i=d.table.length;a<i;a++)if(d.table[a][1]>n&&t>d.table[a][0]&&t<d.table[a][1])return o=a;if(0===o)return null}return o}(t.clientX,c),w.movingHoverColumn.style.top="0px",w.movingHoverColumn.style.left=o+"px",!u&&(w.movingHoverColumn.style.display="block"),u=!0,null===a||null===n||l===n&&f||(l=a,f=!0,r&&clearTimeout(r),r=setTimeout(function(){f=!1},1e3),w.colInsertTo(a,n),w.movingHoverColumn.dataset.index=n,d=m(),(c={left:d.table[n][0],right:d.table[n][1]}).width=c.right-c.left)}}),R.on(w.tableContainer,w.mouseupName,"th",function(){document.onselectstart=null,document.ondragstart=null,w.timeOut&&clearTimeout(w.timeOut)})},row:function(){var r,s,c,d,u,f,h=0,p=0,b=0,m=0,v=function(){var t,e=parseInt(w.trMoveSelected.dataset.index);w.trMoveSelected.classList.add("col-disabled"),(t=w.rowGet(e,w.lockCol.table))&&t.classList.add("col-disabled"),(t=w.rowGet(e,w.lockRow.fixedTable))&&t.classList.add("col-disabled"),(t=w.rowGet(e,w.lockRow.table))&&t.classList.add("col-disabled")};R.on(w.tableWrapper,w.mousedownName,"div.indexCol-item",function(){var a=this;function i(t){var e,n=(t=w.getEvent(t)).pageY-d-15,o=w.movingHoverRow.dataset.index;m=0,clearTimeout(w.move.timeout),w.conf.Container&&(n+=m=w.conf.Container.scrollTop),t.pageY>h-m&&(n=h-d-m),t.pageY<b-m&&(n=b-d-m),e=function(t,e){var n=0,o=null,a=w.conf.colGroup?-1:0;if(e){if(t>e.top&&t<e.bottom||!c||t<c.table[0][0]||t>c.table[c.table.length-1][1]||f<t)return null;for(var i=0,l=c.locktable.length;i<l;i++)if(n=c.locktable[i][1],t>c.locktable[i][0]&&t<c.locktable[i][1])return(o=i)+a;if(null===o){for(i=o=0,l=c.table.length;i<l;i++)if(c.table[i][1]>n&&t>c.table[i][0]&&t<c.table[i][1])return(o=i)+a;if(0===o)return null}return o+a}}(t.pageY+m,s),w.movingHoverRow.style.left=p-u+"px",w.movingHoverRow.style.top=n+"px",w.movingHoverRow.style.display="block",null!==e&&(w.rowInsertTo(parseInt(o),e),w.movingHoverRow.dataset.index=e,s={top:c.table[e][0],bottom:c.table[e][1]})}function l(){w.unlockScreen(),R.queryAll(".col-disabled",w.tableWrapper).forEach(function(t){t.classList.remove("col-disabled")}),R.remove(w.movingHoverRow),R.off(document,w.mousemoveName,i),R.off(document,w.mouseupName,l),document.onselectstart=null,document.ondragstart=null,w.trMoveSelected=null,c=s=null,setTimeout(function(){w.moving=!1},10)}b=w.table.tHead.getBoundingClientRect().bottom,w.conf.colGroup&&(b+=30),w.conf.Container?(d=E.offset.top(w.conf.Container),b-=m):d=E.offset.top(w.tableContainer),w.lockScreen(),u=E.offset.left(w.tableContainer),w.movingHoverRow=document.querySelector(".tableMovingContainer")||R.create('<div class="tableMovingContainer"></div>'),document.onselectstart=function(){return!1},document.ondragstart=function(){return!1},w.timeOut=setTimeout(function(){var o,t,e,n=a.dataset.index?parseInt(a.dataset.index):-1;w.trMoveSelected=w.rowGet(n),f=document.body.scrollHeight,o={locktable:[],table:[]},R.queryAll("tr",w.table.tBodies.item(0)).forEach(function(t){var e=E.offset.top(t),n=E.offset.left(t);o.table.push([e,e+t.offsetHeight]),h=e+m,p=n}),c=o,v(),t=w.trMoveSelected.cloneNode(!0),(e=w.table.tBodies.item(0).cloneNode()).appendChild(t),(r=w.table.cloneNode()).removeAttribute("id"),r.classList.remove("hideLock"),r.appendChild(e),w.movingHoverRow.appendChild(r),w.tableContainer.appendChild(w.movingHoverRow),s||(s={top:E.offset.top(w.trMoveSelected),bottom:w.trMoveSelected.offsetHeight}),w.movingHoverRow.setAttribute("data-index",t.dataset.index),w.moving=!0,R.on(document,w.mousemoveName,i),R.on(document,w.mouseupName,l)},300)}),R.on(w.tableWrapper,w.mouseupName,"div.indexCol-item",function(){document.onselectstart=null,document.ondragstart=null,w.timeOut&&clearTimeout(w.timeOut)})}}),this.unlockScreen=function(){var t=this.conf.Container,e=document.body;t&&(t.style.overflowY="auto"),this.tableMiddle.style.overflowX="auto",this.tableMiddle.style.width="",e.style.overflow="",e.style.height=""},this.indexColFun=(e=null,{render:function(t,e,n){var o=t;n&&(l.indexCol.col.innerHTML="",t=0);var a="select"===l.conf.indexCol?function(){return M(l.ssid)}:null,i=l.createSysCol({Container:l.indexCol.col,offset:o,len:e,start:t,colType:"index",childNode:a});null!==l.table.tBodies.item(0).firstElementChild&&(l.indexCol.show=!0),l.indexCol.col.appendChild(i)},refreshIndex:function(){R.queryAll("div:not(.hide)",l.indexCol.col).forEach(function(t,e){t.innerHTML=0===e?"":e.toString()})},init:function(){function a(t,e){var n=R.query(".select-box input",t);n&&(n.checked=e)}l.indexCol.col=R.create('<div class="indexCol"></div>'),l.tableWrapper.appendChild(l.indexCol.col),l.tableWrapper.classList.add("hasIndexCol"),l.indexCol.width=l.indexCol.col.getBoundingClientRect().width,R.on(l.tableWrapper,l.eventClickName,"div.indexCol > div",function(){var t=this.dataset.index?parseInt(this.dataset.index):-1,e=l.rowGetAll();if(-1===t&&l.conf.indexColMulti){var n=e.length===l.trSelected.length;return"select"===l.conf.indexCol&&a(this,!n),e.forEach(function(t){n?l.rowDeselect(t):l.rowSelect(t,!0)}),void(this.innerHTML=n?"全选":"取消")}var o=l.rowGet(t);l.conf.indexColMulti?l.rowToggle(o):l.trSelected[0]===o?l.rowDeselect(o):l.rowSelect(o),a(l.indexCol.col.firstChild,e.length===l.trSelected.length)}),"select"===l.conf.indexCol&&l.on("rowSelect",function(t){var e=t.detail;setTimeout(function(){e.indexes.forEach(function(t){a(R.query('div[data-index="'+t+'"]',l.indexCol.col),e.select)})},10)})},show:function(t){l.indexCol.col&&(l.indexCol.show=t,l.indexCol.col.classList[t?"remove":"add"]("hide"),l.tableWrapper.classList[t?"add":"remove"]("hasIndexCol"),l.pseudoColFun.resize(),l.resize())},fixedRender:function(){var t=R.create("<div>全选</div>");e||(e=l.indexCol.col.cloneNode()),e.innerHTML="",e.appendChild(t),l.lockRow.fixed.querySelector(".Container").appendChild(e)},divGet:(l=this).indexColDivGet}),this.pseudoColFun=function(r){function n(){var t=0,e=0;return r.indexCol.show&&r.indexCol.col&&(t=r.indexCol.col.offsetWidth),r.pseudoCol.show&&r.pseudoCol.Container&&(e=r.pseudoCol.Container.offsetWidth),{indexWidth:t,pseudoWidth:e,tableLeft:t+e}}function s(){var t=n();if(r.tableContainer.style.left=0===t.tableLeft?"":t.tableLeft+"px",r.tableContainer.style.width=0===t.tableLeft?"":"calc(100% - "+t.tableLeft+"px)",r.pseudoCol.Container&&(r.pseudoCol.Container.style.left=t.indexWidth+"px"),r.lockRow.fixedTable&&r.lockRow.Container){var e=R.query(".pseudoContainer",r.lockRow.Container);e&&(e.style.left=t.indexWidth+"px")}r.lockRow.Container&&(r.lockRow.Container.style.width=r.tableContainer.offsetWidth-t.tableLeft+"px")}return{init:function(t){var e=r.conf;!t&&(t=e.pseudoCol),t.width||(t.width=r.pseudoCol.width),t.index=r.pseudoCol.confList.length,r.pseudoCol.confList.push(t),r.pseudoCol.Container||(r.pseudoCol.Container=R.create('<div class="pseudoContainer"></div>'),r.tableWrapper.appendChild(r.pseudoCol.Container),r.tableWrapper.classList.add("hasPseudoCol"),R.on(r.tableWrapper,r.mousedownName,"div.pseudoCol-item",function(t){var e=r.getEvent(t),n=parseInt(R.closest(e.target,".pseudoCol").dataset.pseudo),o=r.pseudoCol.confList[n].click;o&&o(this.dataset.index,t)})),t.col=R.create('<div class="pseudoCol" data-pseudo="'+t.index+'"></div>'),t.col.style.width=t.width+"px",r.pseudoCol.Container.appendChild(t.col),s(),this.fixedRender(),r.theadSizeSync()},fixedRender:function(){if(r.lockRow.fixed){var t=r.pseudoCol.confList.length;r.pseudoCol.fixedCol||(r.pseudoCol.fixedCol=r.pseudoCol.Container.cloneNode(),r.lockRow.fixed.querySelector(".Container").appendChild(r.pseudoCol.fixedCol)),r.pseudoCol.fixedCol.innerHTML="";for(var e=0;e<t;e++){var n=R.create('<div class="pseudoCol"><div></div></div>');r.pseudoCol.fixedCol.appendChild(n)}}},width:n,render:function(o,a,i){var l=o;r.pseudoCol.confList.forEach(function(t){var e=t.render;i&&(t.col.innerHTML="",l=0);var n=r.createSysCol({Container:t.col,offset:l,len:a,start:o,colType:"pseudo",childNode:e});t.col.appendChild(n)}),s()},destroy:function(){R.remove(r.pseudoCol.fixedCol),r.pseudoCol.fixedCol=null},resize:s}}(this),this.menu=(p=(h=this).menuConfGet(),{row:(n=function(){var u=function(){},f=function(){};return{on:u,off:f,init:function(t,e){void 0===e&&(e=function(t){});var n="row"===t?p.rowConfGet():p.colConfGet();if(n.btns[0]){var o,a,i,l,r,s,c,d=(a=e,r=(o=n).identifier,s=o.btns,c=function(t){a(this),"eventHandle"in o&&o.eventHandle(this,t),i=o.targetGet(this),l=t.target,h.popMenuDom.dataset.identifier===r?h.popMenu.show(r):(h.popMenu.show(r,s,function(t,e){"function"==typeof t.callback&&t.callback(t,i,l)}),h.popMenuDom.dataset.identifier=r)},{on:function(){R.on(h.tableWrapper,h.menuEventName,o.targetSelector,c)},off:function(){R.off(h.tableWrapper,h.menuEventName,o.targetSelector,c)}});f=d.off,(u=d.on)()}}}})(),col:n(),popInit:function(){var l,r=null,s=[],c='data-action="tableMenuBtn"';h.popMenuDom=p.popDomGet(),r=p.listDomGet(h.popMenuDom),p.init();var t=function(){var t,e=parseInt(this.dataset.index),o=[];!function t(e){var n=e.parentElement.parentElement;n.classList.contains("listItem")&&(o.unshift(parseInt(n.dataset.index)),t(n))}(this),o.push(e),t=s[o[0]];for(var n=1;n<o.length;n++)t.children&&(t=t.children[o[n]]);this.classList.contains("disabled")||(l(t,this),p.hide())};R.on(r,h.eventClickName,"["+c+"]",t),h.popMenu={show:function(t,e,n){var o,a;void 0===e&&(e=null),void 0===n&&(n=null),Array.isArray(e)&&"function"==typeof n&&(o=e,a=p.btnHtmlGet(o),r.innerHTML=a,l=n,s=e);var i=h.trSelected[1];s.forEach(function(t,e){if(!t.multi){var n=r.querySelector("["+c+'][data-index="'+e+'"]');i?n.classList.add("disabled"):n.classList.remove("disabled")}}),p.show()},hide:function(){p.hide()}}}}),this.noData=(o=null,a=function(t){C.pseudoCol.show&&C.indexCol.col&&C.pseudoCol.Container&&(C.pseudoCol.Container.classList[t?"remove":"add"]("hide"),C.tableWrapper.classList[t?"add":"remove"]("hasPseudoCol"))},{isShow:function(){null===C.table.tBodies.item(0).firstElementChild?o||(o=R.create('<div class="nodata no-padding"><span class="iconfont icon-gongyongwushuju"></span></div>'),R.after(C.table,o),a(!1)):o&&(R.remove(o),a(!(o=null)))}}),this.colGroup=(i={},r={},s=[],c=function(t,e){if(Array.isArray(e)){var o=document.createElement("select");return e.sort(function(t,e){return e-t}),o.appendChild(R.create("<option></option>")),e.forEach(function(t){if(""!=t){var e=document.createElement("option"),n=document.createTextNode(t);e.appendChild(n),e.setAttribute("value",t),o.appendChild(e)}}),o.setAttribute("data-col",t),o}},{on:function(){var t=R.queryAll(".colGroup select",C.tableWrapper),n=C;function o(){var t=this.dataset.col,o=[];i[t]=this.value,s.forEach(function(t){var e=!0;for(var n in i)t[n]&&""!=i[n]&&t[n].toString()!=i[n]&&(e=!1);e&&o.push(E.obj.merge({},t))});var e=o.length;n.tableData=o,n.indexColFun.render(0,e,!0),n.pseudoColFun.render(0,e,!0),n.tbodyRender(n.tableData,!0)}t.forEach(function(t){var e=t.dataset.col;t.selectedIndex=-1,R.off(t,"change",o),R.on(t,"change",o),i&&e in i&&E.selVal(t,i[e])})},clear:function(){s=[],i={},r={}},rowCreate:function(t){var e,i,l;return e=t,s[0]||(e.forEach(function(t){for(var e in t)r[e]=r[e]||[],~r[e].indexOf(t[e])||r[e].push(t[e])}),s=e),i=r,(l=document.createElement("tr")).classList.add("colGroup"),C.conf.cols.forEach(function(t){var e=t.name;if(!C.colHide.ready||C.colHide.status[t.name]){e in i||(i[e]=null);var n=i[e],o=document.createElement("td"),a=c(e,n);o.dataset.col=e,o.classList.add("td-select",C.cellClass(e)),a&&o.appendChild(a),l.appendChild(o)}}),l}}),this.colSort=function(){var r=[],s={};function c(t){return t||0===t?t:"number"===typeof t?-1/0:""}return{sort:function(t,e){var n,o,a=C,i=s[e];a.tableData[0]&&(i=i&&"desc"===i?"asc":"desc",t?(s[e]=i,~r.indexOf(e)||r.push(e)):(o=".sort-desc,.sort-asc",R.queryAll(o,C.table).forEach(function(t){t.classList.remove("sort-desc","sort-asc")}),0<C.conf.lockColNum&&R.queryAll(o,C.lockCol.table).forEach(function(t){t.classList.remove("sort-desc","sort-asc")}),C.conf.lockRow&&R.queryAll(o,C.lockRow.table).forEach(function(t){t.classList.remove("sort-desc","sort-asc")}),E.keysVal(C.conf,"multi","enabled")||0<C.conf.lockColNum&&C.conf.lockRow&&C.lockRow.fixedTable&&R.queryAll(o,C.lockRow.fixedTable).forEach(function(t){t.classList.remove("sort-desc","sort-asc")}),(n={})[e]=i,s=n,r=[e]),function(t,e){var n,o,a=C,i=a.table.querySelector('th[data-col="'+t+'"]');if("desc"===e?(n="sort-desc",o="sort-asc"):(n="sort-asc",o="sort-desc"),i.classList.remove(o),i.classList.add(n),0<a.conf.lockColNum){var l=a.lockCol.table.querySelector('th[data-col="'+t+'"]');l&&(l.classList.remove(o),l.classList.add(n))}if(a.conf.lockRow){var r=a.lockRow.table.querySelector('th[data-col="'+t+'"]');r.classList.remove(o),r.classList.add(n)}if(!E.keysVal(C.conf,"multi","enabled")&&0<a.conf.lockColNum&&a.conf.lockRow){var s=a.lockRow.fixedTable.querySelector('th[data-col="'+t+'"]');s&&(s.classList.remove(o),s.classList.add(n))}}(e,i),1===a.conf.sort&&(a.tableData.sort(function(t,e){return function t(e,n,o){var a;void 0===o&&(o=0);var i=c(e[r[o]]),l=c(n[r[o]]);return i="--"===i?Number.NEGATIVE_INFINITY:i,0==(a=(l="--"===l?Number.NEGATIVE_INFINITY:l)<i?1:i===l?0:-1)&&o<r.length-1?t(e,n,++o):"desc"===s[r[o]]?-a:a}(t,e)}),a.render(C.startIndex,C.tbodyLength+C.startIndex,!0)))}}}(),this.theadSort=function(e){var t=null;function n(){null===t&&(t=function(t){this.classList.contains("disabled")||e.colResize.dragging||e.moving||e.colSort.sort(t.ctrlKey||t.shiftKey,this.dataset.col)}),R.on(e.tableWrapper,e.eventClickName,"th",t)}var o=function(){R.queryAll("tr th",e.table.tHead).forEach(function(t){t.classList.add("sort")}),n(),o=n};return{on:o,off:function(){t&&(R.off(e.tableWrapper,e.eventClickName,"th",t),t=null)}}}(this),this.lock=function(r){var s=null,c=null,d=null;function o(){s=r.table,c=s.cloneNode();var t=s.tHead.cloneNode(!0),e=t.querySelector("tr"),n=R.queryAll("th",e),o=R.queryAll("tr",s.tBodies.item(0)),a=n.length,i=r.conf.lockColNum;c.classList.add("mobileTableLock","hide"),c.removeAttribute("id");for(var l=0;l<a;l++)i<=l&&R.remove(n[l]);c.tHead?c.replaceChild(t,c.tHead):c.appendChild(t),c.appendChild(function(){for(var t=s.tBodies.item(0).cloneNode(),e=0,n=null;n=o[e];e++)t.appendChild(n.cloneNode());return t}()),null===d?(d=R.create('<div class="mobileTableLeftLock"></div>'),r.tableContainer.insertBefore(d,r.tableContainer.firstElementChild)):d.innerHTML="",d.appendChild(c),r.lockCol.table=c,r.lockCol.Container=d,s.dataset.lockNum=r.conf.lockColNum.toString()}function n(t){var e=t.cloneNode(!0);return R.queryAll("td",e).forEach(function(t,e){e>=r.conf.lockColNum&&R.remove(t)}),e}function a(t){var e=r.colInsertTo(t,r.conf.lockColNum,!0);r.colAdd(r.conf.lockColNum,e,c),r.conf.lockColNum++,r.theadSizeSync(),r.theadSizeCache(t)}function i(t){r.colInsertTo(t,r.conf.lockColNum-1,!0),r.colDel(t,c),r.lockRow.fixedTable&&r.colDel(t,r.lockRow.fixedTable),r.theadSizeSync(),r.theadSizeCache(t),r.conf.lockColNum--}return{init:o,render:function(t,e){s&&c&&(s.classList.remove("hideLock"),c.classList.add("hide"),e&&(c.tBodies.item(0).innerHTML=""),t.forEach(function(t){c.tBodies.item(0).appendChild(n(t))}),c&&c.classList.remove("hide"),s.classList.add("hideLock"))},rowCreate:n,rowGet:function(t){return c?c.querySelector('tr[data-index="'+t.dataset.index+'"]'):null},hide:function(){d.classList.add("hide"),s.dataset.lockNum="0"},show:function(){d.classList.remove("hide"),s.dataset.lockNum=r.conf.lockColNum+""},destroy:function(){R.remove(d),d=c=null,s.dataset.lockNum="0"},colToggle:function(t){var e=-1,n=-1;if(-1!==(e="string"==typeof t?r.colName2index(t):t))return null===c&&(o(),s.classList.add("hideLock"),c.classList.remove("hide")),e>r.conf.lockColNum-1?(a(e),n=1):(i(e),n=0),s.dataset.lockNum=r.conf.lockColNum.toString(),n},colLock:a,colUnlock:i}}(this),this.col=function(u){function e(t){return t in u.colHide.status&&u.colHide.status[t]}function n(t,e){!function(t,e){var n,o=h(t),a=f(t);e?(l=p(i=o),b(r=function(t){for(var e=0,n=u.conf.cols,o=0;o<=t;o++)u.colHide.status[n[o].name]&&e++;return e}(i),l),u.conf.lockRow&&b(r,l,u.lockRow.table)):(u.colDel(a),u.conf.lockRow&&u.colDel(a,u.lockRow.table));var i,l,r;0<(n=u.colGet(0))&&u.resize(!0);if(0<u.conf.lockColNum&&a<u.conf.lockColNum){if(0===n.length)return u.colDel(a,u.lockCol.table),u.lockRow.fixedTable&&u.colDel(a,u.lockRow.fixedTable);var s=u.lockCol.table.querySelectorAll("th").length;if(0!==s)return u.lockColReplace(a,u.colGet(a));for(var c=0;c<u.conf.lockColNum;c++){var d=p(o);b(a,d,u.lockCol.table),u.lockRow.fixedTable&&b(a,d,u.lockRow.fixedTable)}}u.theadSizeSync()}(t,e),u.colHide.status[t]=e}function f(t){l();for(var e=0,n=u.conf.cols,o=0,a=n.length;o<a;o++){var i=n[o].name;if(t===i)return e;u.colHide.status[i]&&e++}return-1}function h(t){for(var e=0,n=void 0;n=u.conf.cols[e];e++)if(n.name===t)return e;return-1}function l(){u.colHide.ready||(u.conf.cols.forEach(function(t){u.colHide.status[t.name]=!0}),u.colHide.ready=!0)}function p(t){var n=u.conf.cols[t],o=[];return o.push(u.col.theadCell(n)),u.tableData.forEach(function(t,e){o.push(function(t,e,n){var o="function"==typeof u.conf.textFormat?u.conf.textFormat:null,a={},i=o?o(t,e,n):t[e.name],l=document.createElement("td");for(var r in a["data-col"]=e.name,a.class=a.class?a.class+" "+u.cellClass(e.name):u.cellClass(e.name),a)a.hasOwnProperty(r)&&l.setAttribute(r,a[r]);return l.innerHTML=i,l}(t,n,e))}),o}function b(t,n,e){void 0===e&&(e=u.table);var o=u.colGet(0===t?0:t,e);o[0]?o.forEach(function(t,e){R.before(t,n[e].cloneNode(!0))}):R.queryAll("tr",e).forEach(function(t,e){t.appendChild(n[e].cloneNode(!0))})}u.colHide.ready=!1;return{show:function(t){l(),!1===e(t)&&n(t,!0)},hide:function(t){l(),!0===e(t)&&n(t,!1)},getIndex:h,getHideIndex:f,hideIndex2Index:function(t){for(var e=0,n=u.conf.cols,o=0,a=n.length;o<a;o++)if(u.colHide.status[n[o].name]){if(t===e)return o;e++}},theadCell:function(t){var e=u.cellClass(t.name),n={"data-col":t.name};return u.conf.sort&&(n.class="sort"),t.colspan&&(n.colspan=t.colspan,delete t.width,delete t.name),t.rowspan&&(n.rowspan=t.rowspan),t.name||(t.name=(new Date).getTime().toString()),!t.colspan&&t.width&&u.conf.colResize&&(u.styleList[e]=t.width),R.create("<th"+E.obj.toAttr(n)+">"+function(t,e,n){void 0===n&&(n=!0);var o=document.createElement("div");return n&&o.classList.add("td-content",u.cellClass(t)),o.innerHTML=E.str.toEmpty(e),o}(t.name,t.title,!t.colspan).outerHTML+"</th>","tr")},titleSet:function(t,e){R.queryAll('thead th[data-col="'+t+'"]').forEach(function(t){t.querySelector("div").innerText=e});for(var n=0,o=void 0;o=u.conf.cols[n];n++)if(o.name===t){o.title=e;break}u.resize(!0)}}}(this),this.tableStyle=(d=this,f="tableTempStyle",{add:function(n){var o="."+f+"-"+d.ssid;u||((u=document.createElement("style")).setAttribute("type","text/css"),d.tableContainer.classList.add(f+"-"+d.ssid),d.tableContainer.appendChild(u)),n.forEach(function(t,e){n[e]=o+" "+t,n[e]=n[e].replace(/,/g,","+o+" ")}),u.innerHTML=n.join("")},del:function(){R.remove(u),u=null}}),this.colResizeFun=function(m){function e(){m.resize(!0)}function n(t){var e,n=t.target;for(m.styleListReady||m.initStyleList(),R.queryAll("th",m.table.tHead).forEach(function(t){m.styleList[m.cellClass(t.dataset.name)]=t.offsetWidth});n&&"TH"!==n.tagName;)n=n.parentNode;12<(e=n.getBoundingClientRect()).width&&e.right-t.pageX<15&&!m.colResize.dragging?(n.style.cursor="col-resize",m.colResize.column=n,m.colResize.column=n):m.colResize.dragging||(n.style.cursor="",m.colResize.column=null)}function o(t){var l,r,s,e=m.tableMiddle.scrollLeft,c=m.table.getBoundingClientRect().left+e,n=function(t){var e=t.clientX-s.startMouseLeft,n=s.startLeft-s.tableLeft+e,o=r.left-c+m.conf.cellWidth,a=Math.max(o,n),i=a-(r.left-s.tableLeft);m.colResize.resizeProxy.style.left=a+"px",function(t,e,n){var o,a=0,i=m.cellClass(e.dataset.col);for(var l in m.styleList)m.styleList[l];if(m.table.offsetWidth===m.tableContainer.offsetWidth){var r=m.colName2index(e.dataset.col),s=m.table.tHead.querySelector("tr > *:nth-child("+(r+1)+")"),c=s.nextElementSibling,d=m.styleList[i],u=void 0;if(s.style.width=t+"px",s.offsetWidth>t&&(t=d),s.style.width="",c){var f,h=m.table.tHead.querySelector('tr th[data-col="'+c.dataset.col+'"]');o=c.dataset.col,f=m.cellClass(o),a=(u=m.styleList[f])+(d-t),h.style.width=a+"px",h.offsetWidth>a+1&&(a=u),h.style.width="",m.styleList[f]=a}}m.styleList[i]=t;for(var p=0,b=m.conf.cols.length;p<b;p++)m.conf.cols[p].name===e.dataset.col&&(m.conf.cols[p].width=t),o&&m.conf.cols[p].name===o&&(m.conf.cols[p].width=a)}(i,l),m.theadSizeSync()},o=function(t){m.colResize.resizeProxy.style.display="none",R.off(document,m.mousemoveName,n),R.off(document,m.mouseupName,o),R.queryAll("th",m.table.tHead).forEach(function(t,e){t.style.cursor=""}),document.onselectstart=null,document.ondragstart=null,s=null,setTimeout(function(){m.colResize.dragging=!1},10)};m.colResize.column&&(m.colResize.dragging=!0,document.onselectstart=function(){return!1},document.ondragstart=function(){return!1},l=m.colResize.column,r=l.getBoundingClientRect(),s={startMouseLeft:t.clientX,startLeft:r.right,startColumnLeft:r.left,tableLeft:c},m.colResize.resizeProxy.style.display="block",m.colResize.resizeProxy.style.left=s.startLeft-s.tableLeft+"px",R.on(document,m.mousemoveName,n),R.on(document,m.mouseupName,o))}return{init:function(){var t=document.createElement("div");t.classList.add("resize-proxy"),m.tableContainer.appendChild(t),m.colResize.resizeProxy=t,R.on(m.tableContainer,m.mousedownName,"th",o),R.on(m.tableContainer,m.mousemoveName,"th",n),R.on(window,"resize",e)},off:function(){R.off(window,"resize",e)}}}(this),this.theadLock=function(l){var t,e,n=null,o=null,r=!1,s=null;function a(){if(l.lockRow.Container){var t=l.lockRow.Container.style,e=E.offset.top(l.tableWrapper),n=l.scrollTop()+E.offset.top(l.conf.Container),o=n+l.theadHeight+l.conf.lockRowTop,a=l.tableWrapper.offsetHeight+e;if(e<n?(t.position="fixed",t.width=l.tableContainer.offsetWidth+"px",l.conf.Container?0<s.lockRowTop?t.top=s.lockRowTop+"px":t.top="initial":t.top=s.lockRowTop+"px",l.indexCol.col||l.pseudoCol.Container||(t.overflow="hidden"),t.left=E.offset.left(l.table)+"px"):(t.position="absolute",t.top="",t.left="0px"),a<o){var i=l.theadHeight-(o-a);i=i<0?0:i,l.lockRow.fixedContainer&&(l.lockRow.fixedContainer.style.height=i+1+"px"),l.lockRow.ContainInner.style.height=i+"px",r=!0}else r&&(l.lockRow.fixedContainer&&(l.lockRow.fixedContainer.style.height=l.theadHeight+1+"px"),l.lockRow.ContainInner.style.height=l.theadHeight+"px",r=!1)}}function i(){l.lockRow.ContainInner.scrollLeft=l.tableMiddle.scrollLeft}function c(){n=l.table,s=l.conf,(o=n.cloneNode()).removeAttribute("id"),t=n.tHead.cloneNode(!0),e=n.tBodies.item(0).cloneNode(),o.classList.add("mobileTableRowLock"),o.classList.remove("hideLock"),o.tHead?o.replaceChild(t,o.tHead):o.appendChild(t),o.tBodies.item(0)?o.replaceChild(e,o.tBodies.item(0)):o.appendChild(e),null===l.lockRow.Container&&(l.lockRow.Container=R.create('<div class="mobileTableTopLock"></div>'),l.lockRow.ContainInner=R.create('<div class="mobileTableTopLock-inner"></div>'),l.lockRow.Container.appendChild(l.lockRow.ContainInner)),l.lockRow.ContainInner.appendChild(o),l.tableContainer.insertBefore(l.lockRow.Container,l.tableContainer.firstElementChild),l.lockRow.table=o,R.on(window,"scroll",a),l.conf.Container&&R.on(l.conf.Container,"scroll",a),R.on(l.tableMiddle,"scroll",i)}function d(){l.lockCol.table&&(l.lockRow.fixedTable&&R.remove(l.lockRow.fixedTable),l.lockRow&&l.lockRow.fixedContainer&&(l.lockRow.fixedTable=l.lockCol.table.cloneNode(!0),l.lockRow.fixedTable.removeAttribute("id"),l.lockRow.fixedContainer.appendChild(l.lockRow.fixedTable),l.lockRow.fixedTable.tBodies.item(0).innerHTML=""))}function u(){n&&(!l.lockRow.fixed&&l.lockRow.Container&&(l.lockRow.fixedContainer=R.create('<div class="Container"></div>'),l.lockRow.fixed=R.create('<div class="mobileTableTopFixedLock"></div>'),l.lockRow.fixed.appendChild(l.lockRow.fixedContainer),l.lockRow.Container.insertBefore(l.lockRow.fixed,l.lockRow.Container.firstElementChild),d(),l.indexCol.col&&l.indexColFun.fixedRender(),l.pseudoCol.Container&&l.pseudoColFun.fixedRender(),l.theadSizeSync()),l.lockRow.fixedContainer.style.height=t.offsetHeight+1+"px")}function f(){c(),u()}function h(){p()}function p(){R.off(window,"scroll",a),l.pseudoColFun.destroy(),l.conf.Container&&R.off(l.conf.Container,"scroll",a),R.off(l.tableMiddle,"scroll",i),R.remove(l.lockRow.Container),R.remove(l.lockRow.fixed),o=null,l.lockRow.Container=null,l.lockRow.fixed=null}return{init:c,render:u,rowCreate:function(t){return t.cloneNode(!0)},hide:function(){l.lockRow.table.classList.add("hideLock")},show:function(){l.lockRow.table.classList.remove("hideLock")},destroy:p,rowToggle:function(){return l.conf.lockRow=!l.conf.lockRow,l.conf.lockRow?f():h(),l.conf.lockRow},rowLock:f,rowUnlock:h,fixedTableRefresh:d}}(this),this.cell={setText:function(t,e,n){R.queryAll('table tr[data-index="'+e+'"] td[data-col="'+t+'"]',C.tableWrapper).forEach(function(t){t.innerText=E.str.toEmpty(n)})}},this.data={get:function(t,e){return void 0===t&&(t=0),C.tableData.slice(t,e)},add:function(t){Array.isArray(t)&&(C.tableData=C.tableData.concat(t))},set:function(t){Array.isArray(t)&&(C.tableData=t)}},this.clickEvent=(m=!(b={}),{add:function(t,e){b[t]||(b[t]=[]),b[t].push(e),m&&R.on(C.tableContainer,"click",t,e)},remove:function(t,e){if(e&&b[t]){for(var n=0;n<b[t].length;n++)if(b[t][n]===e){b[t].splice(n,1);break}0===b[t].length&&delete b[t],m&&R.off(C.tableContainer,"click",t,e)}},off:v=function(){m=!1;var t=function(e){b[e].forEach(function(t){R.off(C.tableContainer,"click",e,t)})};for(var e in b)t(e)},on:function(){v(),m=!0;var t=function(e){b[e].forEach(function(t){R.on(C.tableContainer,"click",e,t)})};for(var e in b)t(e)}}),this.copy=(g="__BasicTableCopyLocal__",y="__BasicTableCopyLocalOrigin__",{col:function(t,e){void 0===e&&(e=!1);var n,o,a=C.colDataGet(t).map(function(t){return E.str.toEmpty(t)});n=[],o={},a.forEach(function(t){o[t]||(o[t]=!0,n.push(t))}),a=n;var i=Array.isArray(a)?a.join("\r\n"):"";if(e)return i;E.copy(i)},row:function(t,e,n){void 0===e&&(e=!1),void 0===n&&(n=null);var o=null;o=Array.isArray(n)?n.map(function(t){return C.nameCol[t]}):C.conf.cols;var a=t.map(function(t){return C.rowDataGet(t)}),i=a.map(function(e){return o.map(function(t){return E.str.toEmpty(e[t.name])}).join("\t")});i[0]&&i.unshift(o.map(function(t){return t.title}).join("\t"));var l,r,s=i.join("\r\n");if(l=s,r=a,window.localStorage.setItem(g,l),window.localStorage.setItem(y,JSON.stringify(r)),e)return s;E.copy(s)},selectedRow:function(t){void 0===t&&(t=!1);var e=C.trSelected.map(function(t){return parseInt(t.dataset.index)});return C.copy.row(e,t)},match:function(t,n){void 0===n&&(n=[]);var e,i,o,l,a=function(t){if(t===window.localStorage.getItem(g)){var e=window.localStorage.getItem(y);return JSON.parse(e)}return null}(t);return null===a&&(e=t,i=C.conf.cols,o=e.split("\r\n").filter(function(t){return!!t}),l=[],a=o.length<=1?null:(o.shift().split("\t").forEach(function(t,e){for(var n=0,o=i;n<o.length;n++){var a=o[n];if(a.title===t){l[e]=a.name;break}}}),0===l.length?null:o.map(function(t){var o={};return t.split("\t").forEach(function(t,e){var n=l[e];n&&(o[n]=t)}),o}))),Array.isArray(a)&&a.forEach(function(t){for(var e in t)(E.isEmpty(t[e])||0<=n.indexOf(e))&&delete t[e]}),a}}),this.edit=function(){var r,t,s=null,c={td:null,col:null,index:-1,data:null},i=[],o=0,d=[],e=(r=C,t=function(){var t=s.canInit,e=s.canRowInit,n=r.nameCol[this.dataset.col],o=R.closest(this,"tr"),a=parseInt(o.dataset.index),i=r.rowDataGet(a);if(p(),"function"==typeof e&&!e(i))return!1;if("function"!=typeof t||t(n,o.classList.contains("added")?1:0)){var l=E.obj.merge(i,d[a]);this.classList.add("editing"),s.comInit(this,l,n),c.td=this,c.index=a,c.col=n,c.data=l}},{on:function(){R.on(C.tableWrapper,"click","tr td:not(.editing)",t)},off:function(){R.off(C.tableWrapper,"click","tr td:not(.editing)",t)}});function a(t){t&&t.classList.add("col-disabled")}var n,l,u=function(t){var e=s.defData;o=0<o?o:C.tableData.length,t=t?E.obj.merge(e,t):e;var n=C.rowCreate(t,o);n.classList.add("added"),C.conf.cols.forEach(function(t){s.canInit(t,1)||a(R.query('td[data-col="'+t.name+'"]',n))}),R.prepend(C.table.tBodies[0],n),C.indexCol.col&&(R.after(C.indexCol.col.firstElementChild,C.indexColFun.divGet(o)),C.indexColFun.refreshIndex()),d[o]=t,o++,C.noData.isShow(),1===o&&C.resize(!0)},f=function(t,e){var n,o,a=R.closest(t,"tr"),i=t.dataset.col,l=parseInt(a.dataset.index),r=C.nameCol[i],s="function"==typeof C.conf.textFormat?C.conf.textFormat:null,c=C.rowDataGet(l)[i];t.innerHTML=s?s(((n={})[i]=e,n),r,l):e,t.classList.remove("editing"),E.str.toEmpty(c)!=E.str.toEmpty(e)?(h(l,((o={})[i]=e,o)),t.classList.add("edited")):t.classList.remove("edited")},h=function(t,e){var n=d[t]||{};if(!e)return n;d[t]=E.obj.merge(n,e)},p=function(){if(c.col){var t=E.obj.merge,e=c.data,n=s.valGet(c.col);s.validate&&s.validate(c.td,c.col,t(e,n),function(t,e){e?t.classList.remove("error"):t.classList.add("error")}),s.comDestroy(c.col),f(c.td,n[c.col.name]),c={td:null,col:null,index:-1,data:null}}},b=(n=function(t){var e=t.clipboardData.getData("Text"),n=C.copy.match(e,s.pasteExceptCols);Array.isArray(n)&&n.forEach(function(t){u(t)})},{on:function(){return R.on(C.tableWrapper,"paste",n)},off:function(){return R.off(C.tableWrapper,"paste",n)}}),m=(l=function(t){if(t.ctrlKey&&"I"===String.fromCharCode(t.keyCode)){var e=C.rowSelectDataGet();e[0]||(e=[s.defData]),e.forEach(function(t){return u(t)})}},{on:function(){return R.on(C.tableWrapper,"keydown",l)},off:function(){return R.off(C.tableWrapper,"keydown",l)}});return{errorLen:function(){return R.queryAll("td.edited.error",C.table).length},init:function(){C.theadSort.off(),C.conf.lockColNum&&C.lock.destroy(),C.conf.lockRow&&C.theadLock.rowUnlock(),C.clickEvent.off(),C.menu&&(C.menu.col.off(),C.menu.row.off()),C.fire("editChange",{status:1}),C.tableWrapper.classList.add("stand-text")},initModify:function(t){s=t,e.on(),b.on(),m.on(),C.conf.cols.forEach(function(t,e){s.canInit(t,0)||C.colGet(e).forEach(function(t,e){0<e&&a(t)})}),C.colGet(0).forEach(function(t,e){0!==e&&(s.canRowInit(C.rowDataGet(e-1))?t.parentElement.classList.remove("col-disabled"):t.parentElement.classList.add("col-disabled"))})},addRow:u,deleteRow:function(n){var o=null;s&&(o=s.canRowInit),C.trSelected.forEach(function(t){var e=parseInt(t.dataset.index);return!(n&&!n(C.rowDataGet(e)))&&!(o&&!o(C.rowDataGet(e)))&&(C.rowHide(e),C.tableData[e]&&i.push(e),void delete d[e])})},reshowEditing:p,cancel:function(){C.conf.lockRow&&C.theadLock.rowLock(),o=0,i=[],d=[],c={td:s=null,col:null,index:-1,data:null},C.theadSort.on(),C.conf.lockColNum&&(C.lock.init(),C.lock.render(R.queryAll("tbody tr",C.table),!0)),C.clickEvent.on(),C.menu&&(C.menu.col.on(),C.menu.row.on()),m.off(),b.off(),C.theadSizeCache(),C.theadSizeSync(),C.tableWrapper.classList.remove("stand-text"),e.off(),C.render(C.startIndex,C.startIndex+C.tbodyLength,!0)},getData:function(){var o=C.tableData.length,a={update:[],insert:[],delete:[]};return d.forEach(function(t,e){var n=C.tableData[e];E.isEmpty(n)&&E.isEmpty(t)||(e<=o-1?a.update.push(E.obj.merge(n,t)):E.isEmpty(t)||a.insert.push(E.obj.merge(n,t)))}),i.forEach(function(t){a.delete.push(C.tableData[t])}),a},modifyTd:f,rowData:h,getEditing:function(){return c}}}();var x={Container:null,cols:[],data:[],table:null,sort:1,move:!1,indexColMulti:!0,indexCol:null,pseudoCol:null,lockColNum:0,lockRow:!1,lockRowTop:0,colResize:!1,dragRows:!1,expand:{enabled:!1,cache:!1,icon:["arrow-right","arrow-down"],mode:"toggler",render:function(t,e,n){n()}},multi:{enabled:!1,cols:[]},treegrid:{enabled:!1,cache:!1,icon:["arrow-right","arrow-down"],expand:function(t,e){return!0},render:function(t,e,n){n([])}},thead:!1,colMenu:[],rowMenu:[],colGroup:!1,textFormat:null,beforeShow:null,onComplete:function(){},cellWidth:70,cellMaxWidth:null};this.ssid=E.getGuid(""),t.expand&&(t.expand=E.obj.merge(x.expand,t.expand)),t.treegrid&&(t.treegrid=E.obj.merge(x.treegrid,t.treegrid)),this.conf=E.obj.merge(x,t);var k=this.conf;this.table=k.table,this.tableData=[],this.tableWrapper=null,this.lockCol.table=null,this.table.classList.add("mobileTable"),this.table.tBodies.item(0)||R.append(this.table,document.createElement("tbody"));var T=this.getEventConf();this.menuEventName=T.menuName,this.eventClickName=T.clickName,this.mousemoveName=T.mousemoveName,this.mouseoutName=T.mouseoutName,this.mousedownName=T.mousedownName,this.mouseupName=T.mouseupName,this.nameCol={},E.keysVal(k,"multi","enabled")?k.multi.cols.forEach(function(t){t.forEach(function(t){C.nameCol[t.name]=t})}):k.cols.forEach(function(t){C.nameCol[t.name]=t}),(k.thead||null===this.table.tHead)&&this.theadRender(),this.wrapperInit(),k.indexCol&&this.indexColFun.init(),k.expand.enabled&&this.expandFunc.init(),k.pseudoCol&&this.pseudoColFun.init(),k.treegrid.enabled&&this.treegridFunc.init(),k.sort&&0!==k.sort&&this.theadSort.on(),0<k.lockColNum&&this.lock.init(),k.lockRow&&this.theadLock.init(),k.colResize&&this.colResizeFun.init(),this.conf.move&&this.moveOn();var L=k.colMenu,S=k.rowMenu;(L&&L[0]||S&&S[0])&&(this.menu.popInit(),this.menu.col.init("col"),E.isMb||this.menu.row.init("row",function(t){C.trSelected[0]&&C.trSelected[1]||C.rowSelect(t)})),Array.isArray(k.data)&&k.data[0]&&(this.data.set(k.data),this.render(0,k.data.length))}return t.prototype.getVisibleCol=function(){for(var t=[],e=this.colHide.status,n=0,o=this.conf.cols;n<o.length;n++){var a=o[n].name;a in e?e[a]&&t.push(a):t.push(a)}return t},t.prototype.sysColOpen=function(t,e){if(R.queryAll('div[data-index="'+t+'"]',this.pseudoCol.Container).forEach(function(t){t.style.height=e+"px"}),this.conf.indexCol){var n=R.query('div[data-index="'+t+'"]',this.indexCol.col);n&&(n.style.height=e+"px")}},t.prototype.sysColClose=function(t){var e=this;if(R.queryAll('div[data-index="'+t+'"]',this.pseudoCol.Container).forEach(function(t){t.style.height=e.cellHeight+"px"}),this.conf.indexCol){var n=R.query('div[data-index="'+t+'"]',this.indexCol.col);n&&(n.style.height=this.cellHeight+"px")}},t.prototype.getEvent=function(t){return t.changedTouches?t.changedTouches[0]:t},t.prototype.checkHidden=function(){return this.tableStatus=0!==this.table.offsetWidth,this.tableStatus},t.prototype.moveOn=function(){this.moveEvent.col(),this.moveEvent.row()},t.prototype.createSysCol=function(t){var e=this,n=document.createDocumentFragment();if(null===t.Container.firstElementChild){var o=R.create("<div>全选</div>");e.theadHeight&&(o.style.height=e.theadHeight+"px",o.style.lineHeight=e.theadHeight+"px"),n.appendChild(o),"select"===this.conf.indexCol&&R.append(o,M(e.ssid)),e.conf.colGroup&&n.appendChild(document.createElement("div"))}for(var a=0;a<t.len;a++){var i=a,l=void 0;if(t.childNode)if(i+=t.start,"function"==typeof t.childNode)l=t.childNode(i);else l=t.childNode.toString();else l=((i+=t.offset)+1).toString();n.appendChild(e.indexColDivGet(i,l,t.colType))}return n},t.prototype.indexColDivGet=function(t,e,n){void 0===e&&(e=""),void 0===n&&(n="index");var o=document.createElement("div");return o.classList.add(n+"Col-item"),"string"==typeof e?(o.innerHTML=e,o.title=e):o.appendChild(e),o.dataset.index=t+"",o},t.prototype.tbodyRender=function(t,e,n,o){var a=this;void 0===n&&(n=0),void 0===o&&(o="");var i=[],l=document.createDocumentFragment();e&&(this.table.tBodies[0].innerHTML=""),(t=Array.isArray(t)?t:[]).forEach(function(t,e){i.push(a.rowCreate(t,e+n,o))}),this.conf.colGroup&&i.unshift(this.colGroup.rowCreate(t)),i.forEach(function(t){l.appendChild(t)});var r=0;R.queryAll("td > span.red",l).forEach(function(t){var e=R.closest(t,"td");!e||"highIndex"in e.dataset||(e.dataset.highIndex=r+"",r++)}),this.table.tBodies[0].appendChild(l),E.keysVal(this.conf,"multi","enabled")||(0<this.conf.lockColNum&&this.lock.render(i,e),this.conf.lockRow&&this.theadLock.render()),this.conf.colGroup&&this.colGroup.on(),this.noData.isShow(),this.theadSizeSync()},t.prototype.wrapperInit=function(){var t=this.table,e=R.create('<div class="mobileTableWrapper" tabindex="'+this.ssid+'"><div class="tableContainer"><div class="mobileTableMiddle"></div></div></div>');this.table.parentNode.replaceChild(e,this.table),this.tableContainer=e.querySelector(".tableContainer"),this.tableMiddle=this.tableContainer.querySelector(".mobileTableMiddle"),this.tableMiddle.appendChild(t),this.tableWrapper=e},t.prototype.colGet=function(t,e){return void 0===e&&(e=this.conf.table),e?R.queryAll("tr > *:nth-child("+(t+1)+")",e):null},t.prototype.colDel=function(t,e){void 0===e&&(e=this.table);for(var n=this.colGet(t,e),o=0,a=n;o<a.length;o++){var i=a[o];R.remove(i)}return n},t.prototype.colAdd=function(t,n,e){void 0===e&&(e=this.table);var o=this.colGet(t+1,e);o[0]?o.forEach(function(t,e){t.parentNode.insertBefore(t.cloneNode(!0),n[e])}):Array.prototype.forEach.call(e.querySelectorAll("tr"),function(t,e){t.appendChild(n[e].cloneNode(!0))})},t.prototype.colInsertTo=function(n,o,t){void 0===t&&(t=!1);var a=this,e=this.conf.cols,i=e.length;if(this.colHide.ready){var l=0,r=this.colHide.status;for(var s in r)r.hasOwnProperty(s)&&r[s]&&l++;i=l}if(!(0<=n&&n<i&&0<=o&&o<i))return[];var c=this.colGet(n);if(n==o)return c;var d,u=this.colGet(n,this.lockRow.table),f=this.col.hideIndex2Index(n),h=this.col.hideIndex2Index(o),p=e.splice(f,1);a.conf.treegrid.enabled&&(d=this.colGet(0)),e.splice(h,0,p[0]);var b=this.colGet(o+(n<o?1:0)),m=this.colGet(o+(n<o?1:0),this.lockRow.table);return o===i-1?(c.forEach(function(t,e){t.parentNode.appendChild(t),a.conf.treegrid.enabled&&(0!==n&&0!==o||a.treegridFunc.exchangeTd(d[e],t.parentNode.firstChild))}),Array.isArray(u)&&u.forEach(function(t){t.parentNode.appendChild(t)})):(b.forEach(function(t,e){t.parentNode.insertBefore(c[e],t),a.conf.treegrid.enabled&&(0!==n&&0!==o||a.treegridFunc.exchangeTd(d[e],t.parentNode.firstChild))}),Array.isArray(m)&&m.forEach(function(t,e){t.parentNode.insertBefore(u[e],t)})),t?n<this.conf.lockColNum-1&&o<this.conf.lockColNum-1&&(this.lockColReplace(n,this.colGet(n)),this.lockColReplace(o,this.colGet(o)),this.theadSizeSync()):(n<this.conf.lockColNum&&this.lockColReplace(n,this.colGet(n)),o<this.conf.lockColNum&&this.lockColReplace(o,this.colGet(o)),this.theadSizeSync()),c},t.prototype.lockColReplace=function(t,e){var n=this.colGet(t,this.lockCol.table),o=this.colGet(t,this.lockRow.fixedTable),a=e;n.forEach(function(t,e){t.parentNode.replaceChild(a[e].cloneNode(!0),t)}),Array.isArray(o)&&o.forEach(function(t,e){t.parentNode.replaceChild(a[e].cloneNode(!0),t)}),this.theadSizeSync()},t.prototype.colName2index=function(t){return this.col.getHideIndex(t)},t.prototype.colToggleLock=function(t){var e=this.lock.colToggle(t);return this.theadLock.fixedTableRefresh(),e},t.prototype.rowToggleLock=function(){this.theadLock.rowToggle()},t.prototype.theadSizeSync=function(){var o=this,t=R.queryAll("tr th",this.table.tHead),a=g(t[0]),e=this.indexCol,n=this.lockRow,i=this.lockCol.table;if(this.initStyleList(),this.updateStyle(),this.theadSizeCache(),!E.keysVal(this.conf,"multi","enabled")&&e.col&&e.show&&e.col.firstChild){var l=e.col.firstChild,r=this.theadHeight+1;if(l.style.height=r+"px",l.style.lineHeight=r+"px",this.conf.lockRow&&n.fixed){var s=n.fixed.querySelector(".indexCol").firstChild;s&&(s.style.height=r+"px",s.style.lineHeight=r+"px")}}if(0<this.pseudoCol.confList.length&&this.pseudoCol.show){var c=this.theadHeight+1;this.pseudoCol.confList.forEach(function(t){t.col.firstChild&&(t.col.firstChild.style.height=c+"px",t.col.firstChild.style.lineHeight=c+"px")}),this.conf.lockRow&&n.fixed&&(n.fixed.querySelector(".pseudoCol")||(this.pseudoColFun.fixedRender(),this.theadSizeSync()),R.queryAll(".pseudoCol div",n.fixed).forEach(function(t){t.style.height=c+"px"}))}if((e.col||this.pseudoCol.Container)&&n.fixed){var d=R.query(".Container",n.fixed),u=this.tableContainer.offsetLeft;d.style.left=-1*u+"px",d.style.paddingLeft=u+"px"}if(!E.keysVal(this.conf,"multi","enabled")&&0<this.conf.lockColNum&&i){var f=R.queryAll("tr th div",i.tHead);R.queryAll("tr th",this.table.tHead).forEach(function(t,e){var n=f[e];n&&(n.style.width=t.offsetWidth-a+"px",o.theadHeight&&(n.style.height=o.theadHeight-12+"px"))}),i.classList.remove("hide")}if(this.conf.lockRow){if(n.table){var h=R.queryAll("tr th div",n.table.tHead);(t=t||R.queryAll("tr th",this.table.tHead)).forEach(function(t,e){var n=h[e];n&&(n.style.width=t.offsetWidth-a+"px")})}if(n.fixedTable){var p=n.fixedTable.tHead,b=R.query("tr th",p),m=R.queryAll("tr th div",p);t=t||R.queryAll("tr th",this.table.tHead),b&&(b.style.height=this.theadHeight+"px"),t.forEach(function(t,e){var n=m[e];n&&(n.style.width=t.offsetWidth-a+"px")})}var v=this.theadHeight+1+"px";n.fixedContainer&&(n.fixedContainer.style.height=v),n.ContainInner&&(n.ContainInner.style.height=v)}},t.prototype.theadSizeCache=function(t){void 0===t&&(t=-1);this.theadHeight=this.table.tHead.offsetHeight},t.prototype.theadRender=function(){var e,n,o=this,t=o.conf;if(null===(e=this.table.tHead)&&(e=R.create("<thead></thead>","table"),this.table.insertBefore(e,this.table.tBodies.item(0))),e.innerHTML="",E.keysVal(t,"multi","enabled")){(a=this.conf.multi.cols).forEach(function(t){n=document.createElement("tr"),t.forEach(function(t){n.appendChild(o.col.theadCell(t))}),e.appendChild(n)})}else{var a=this.conf.cols;n=document.createElement("tr"),a.forEach(function(t){o.colHide.ready&&!o.colHide.status[t.name]||(n.appendChild(o.col.theadCell(t)),e.appendChild(n))})}},t.prototype.rowsGetWithLock=function(t){var e=this.tableWrapper||this.table;return R.queryAll('tr[data-index="'+t.dataset.index+'"]',e)},t.prototype.rowSelect=function(t,e){void 0===e&&(e=!1),e||this.rowDeselect(null,!0),t=this.getMainTr(t),-1<this.trSelected.indexOf(t)||(this.lockRowApply(t,function(t){t.classList.add("selected")}),this.trSelected.push(t),this.fire("rowSelect",{indexes:[parseInt(t.dataset.index)],select:!0}))},t.prototype.getMainTr=function(t){return this.table.contains(t)?t:R.query('tbody tr[data-index="'+t.dataset.index+'"]',this.table)},t.prototype.rowToggle=function(t){t=this.getMainTr(t),-1<this.trSelected.indexOf(t)?this.rowDeselect(t):this.rowSelect(t,!0)},t.prototype.rowDeselect=function(t,e){void 0===t&&(t=null),void 0===e&&(e=!1);var n=this;if(null===t){var o=[];n.trSelected.forEach(function(t){n.lockRowApply(t,function(t){t.classList.remove("selected")}),o.push(parseInt(t.dataset.index))}),n.trSelected=[],e||this.fire("rowSelect",{indexes:o,select:!1})}else{t=this.getMainTr(t),n.lockRowApply(t,function(t){t.classList.remove("selected")});for(var a=0,i=null;i=n.trSelected[a];a++)if(i===t){n.trSelected.splice(a,1);break}e||this.fire("rowSelect",{indexes:[parseInt(t.dataset.index)],select:!1})}},t.prototype.rowSelectDataGet=function(){var e=this;return this.trSelected.map(function(t){return e.rowDataGet(parseInt(t.dataset.index))})},t.prototype.rowUnselectDataGet=function(){var e=this;return R.queryAll("tbody tr",this.table).filter(function(t){return!e.trSelected.includes(t)}).map(function(t){return e.rowDataGet(parseInt(t.dataset.index))})},t.prototype.rowCreate=function(l,r,s){void 0===s&&(s="");var c,d=this;(c="function"==typeof d.conf.beforeShow?d.conf.beforeShow(l,d.conf.cols):{tr:{},td:[]}).tr["data-index"]=r;var u=document.createElement("tr");for(var t in c.tr)u.setAttribute(t,c.tr[t]);var f="function"==typeof d.conf.textFormat?d.conf.textFormat:null;return d.conf.cols.forEach(function(t,e){if(!d.colHide.ready||d.colHide.status[t.name]){t.name in l||(l[t.name]=null);var n=c.td[e]||{},o=f?f(l,t,r):l[t.name],a=document.createElement("td");for(var i in o=E.highlight(o,s,"red"),n["data-col"]=t.name,n.class=n.class?n.class+" "+d.cellClass(t.name):d.cellClass(t.name),n)a.setAttribute(i,n[i]);a.innerHTML=o,u.appendChild(a),0===e&&d.treegridFunc.addBtn(r,a)}}),u},t.prototype.rowHide=function(t){R.queryAll('table tbody > tr[data-index="'+t+'"]',this.tableWrapper).forEach(function(t){return t.classList.add("hide")});var e=this.indexCol.col;e&&(R.query('div[data-index="'+t+'"]',e).classList.add("hide"),"number"===this.conf.indexCol&&this.indexColFun.refreshIndex())},t.prototype.cellClass=function(t){return"td-"+this.ssid+"-"+t},t.prototype.groutCreate=function(t,e){var n=document.createElement("div"),o=document.createElement("select");return e.sort(function(t,e){return e-t}),n.classList.add("td-content","td-select",this.cellClass(t)),o.appendChild(R.create("<option></option>")),e.forEach(function(t){if(""!=t){var e=document.createElement("option"),n=document.createTextNode(t);e.appendChild(n),e.setAttribute("value",t),o.appendChild(e)}}),o.setAttribute("data-col",t),n.appendChild(o),n},t.prototype.rowReplace=function(t,e){this.lockCol.table&&this.lockCol.table.tBodies[0].replaceChild(this.lock.rowCreate(t),this.lock.rowGet(e)),this.table.tBodies[0].replaceChild(t,e)},t.prototype.rowGet=function(t,e){return void 0===e&&(e=this.table),e?e.tBodies.item(0).querySelector('[data-index="'+t+'"]'):null},t.prototype.rowGetAll=function(t){return void 0===t&&(t=this.table),R.queryAll("tbody > tr:not(.hide)",t)},t.prototype.dataGet=function(t){void 0===t&&(t="data");var e=null;switch(t){case"data":case"display":e=this.tableData}return e},t.prototype.onLoad=function(t){},t.prototype.lockRowApply=function(t,n){this.rowsGetWithLock(t).forEach(function(t,e){n(t,e)})},t.prototype.attr=function(t,e){if(void 0===e)return this.conf[t];this.conf[t]=e},t.prototype.wrapperGet=function(){return this.tableWrapper},t.prototype.updateStyle=function(){var t=this;if(this.conf.colResize&&t.tableContainer&&t.checkHidden()){var e=[],n=document.querySelector('style[y-ui="table-'+t.ssid+'"]');for(var o in n||((n=document.createElement("style")).setAttribute("type","text/css"),n.setAttribute("y-ui","table-"+t.ssid),t.tableContainer.appendChild(n)),t.styleList){var a=t.styleList[o];e.push("."+o+"{ width: "+(a-1)+"px; max-width: "+(a-1)+"px;}")}n.innerHTML=e.join("")}},t.prototype.scrollTop=function(){return this.conf.Container?this.conf.Container.scrollTop||window.scrollY:E.scrollTop()},t.prototype.initStyleList=function(){var e=this;if(!e.styleListReady){var t=R.queryAll("th",e.table.tHead);if(!t[0])return;var n=g(t[0]);if(E.keysVal(e.conf,"multi","enabled")){var o=[];t.forEach(function(t){t.getAttribute("colspan")||o.push(t)}),t=o}e.conf.cellMaxWidth&&e.tableStyle.add(["table th, table td{width:${self.conf.cellMaxWidth - padding}px;max-width:"+(e.conf.cellMaxWidth-n)+"px;}"]),e.conf.cellMaxWidth&&!e.conf.colResize?t[0].offsetWidth>e.conf.cellMaxWidth&&e.tableStyle.del():e.conf.colResize&&(t.forEach(function(t){e.styleList[e.cellClass(t.dataset.col)]=t.offsetWidth-n}),e.conf.cellMaxWidth&&e.tableStyle.del()),e.styleListReady=!0}},t.prototype.resize=function(t){void 0===t&&(t=!1);var e=this;function n(){e.styleListReady=!1,e.styleList={},e.updateStyle(),e.initStyleList(),e.updateStyle(),e.lockRow.Container&&(e.lockRow.Container.style.width=e.tableContainer.offsetWidth+"px"),e.theadSizeSync()}e.tableStatus||t?t&&e.checkHidden()&&n():n()},t.prototype.setTableWidth=function(t){this.table.style.width=t+"px",this.lockRow.table.style.width=t+"px"},t.prototype.rowInsertTo=function(t,e){var n,o=this,a=o.tbodyLength;if(!(0<=t&&t<a&&0<=e&&e<a))return null;var i=o.rowGet(t);if(t==e)return i;var l=o.rowGet(t,o.lockCol.table);n=e+(t<e?1:0);var r=o.rowGet(n),s=o.rowGet(n,o.lockCol.table);e===a-1?(o.table.tBodies[0].appendChild(i),o.lockCol.table&&o.lockCol.table.tBodies[0].appendChild(l)):(o.table.tBodies[0].insertBefore(i,r),o.lockCol.table&&o.lockCol.table.tBodies[0].insertBefore(l,s)),o.updateRowIndex(o.table),o.updateRowIndex(o.lockCol.table)},t.prototype.updateRowIndex=function(t){var n=this;t&&R.queryAll("tbody tr",t).forEach(function(t,e){n.conf.colGroup?t.dataset.index=0<e?(e-1).toString():"":t.dataset.index=e.toString()})},t.prototype.destroy=function(){this.theadLock.destroy(),this.colResizeFun.off(),R.remove(this.tableWrapper)},t.prototype.colDataGet=function(t,e){void 0===e&&(e="data");var n,o=null;return"string"==typeof t&&(t=this.col.getIndex(t)),(n=this.conf.cols[t])&&("data"===e?o=this.dataGet().map(function(t){return t[n.name]}):"display"===e&&(o=this.colGet(t).map(function(t){return E.str.removeHtmlTags(t.innerHTML)}))),o},t.prototype.rowDataGet=function(t){return E.obj.copy(this.dataGet()[t])},t.prototype.on=function(t,e){R.on(this.tableWrapper,"bt."+t,e)},t.prototype.fire=function(t,e){E.event.fire("bt."+t,e,this.tableWrapper)},t.prototype.getSearchData=function(a,t){var i=this;void 0===t&&(t=this.tableData);var l=this.conf,r=[],s=this.getVisibleCol();if(!E.isEmpty(a))return t.forEach(function(t,e){for(var n in r.push({}),t){var o=l.cols[i.col.getIndex(n)];o&&-1<s.indexOf(n)&&(r[e][n]=l.textFormat(t,o,e))}}),t.filter(function(t,e){var n=r[e];for(var o in n){if(-1<E.str.removeHtmlTags(n[o]+"").toLowerCase().indexOf(a.toLowerCase()))return!0}return!1});this.render(0,this.tbodyLength)},t.prototype.search=function(t,e){void 0===e&&(e=this.tableData);var n=this.getSearchData(t,e);if(!E.isEmpty(n)){var o=n.length,a=o<this.tbodyLength?o:this.tbodyLength;this.tbodyRender(n,!0,0,t),this.indexColFun.render(0,a,!0),this.pseudoColFun.render(0,a,!0),this.resize(!0)}},t.prototype.render=function(t,e,n){void 0===n&&(n=!0);var o=this.tableData.slice(t,e),a=o.length;n&&(this.trSelected=[],this.colGroup.clear()),this.tbodyRender(o,n,t),this.indexColFun.render(t,a,n),this.pseudoColFun.render(t,a,n),this.startIndex=n?t:this.startIndex,this.tbodyLength=n?a:this.tbodyLength+a,this.resize(!0),this.fire("render")},t.prototype.highlight=function(i){var l=this,r=0;R.queryAll("tbody td",this.table).forEach(function(t){var e,n,o,a=!1;(e=t,n=e.parentElement.dataset.index,o=e.dataset.col,R.queryAll('tbody tr[data-index="'+n+'"] td[data-col="'+o+'"]',l.tableWrapper)).forEach(function(t){t.dataset.highIndex&&(delete t.dataset.highIndex,t.innerHTML=E.str.removeHtmlTags(t.innerHTML));var e=t.innerHTML,n=E.highlight(e,i,"red");e!==n&&(t.innerHTML=n,t.dataset.highIndex=r+"",a=!0)}),a&&r++})},t.prototype.tableELGet=function(){return this.table},t}();function g(t){var e=getComputedStyle(t,null);return parseInt(e.paddingLeft.replace("px",""))+parseInt(e.paddingRight.replace("px",""))}function M(t){var e=n.CheckBox.initCom(t);return e.classList.add("circle"),R.off(R.query(".check-span",e)),e}e.BasicTable=o}),define("MbTable",["require","exports","BasicTable"],function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=G.d,o=function(e){function t(t){var l=e.call(this,t)||this;return l.reorderPanel=null,l.isPanelShowed=!1,l.allCol=null,l.cellHeight=40,l.colReorder=function(){var i=null,m=null,t=!1,e=function(){var d=null,o=i.querySelector(".colList"),u=0,f=null,a=l,h=o.offsetTop+10,p=0,b=0;mui(i).on("dragstart",".colList>li",function(t){0===u&&(u=this.offsetHeight);var e=t.detail.touches[0],n=this.getBoundingClientRect();b=n.width-(e.clientX-n.left),p=n.height-(e.clientY-n.top),(d=this.cloneNode(!0)).classList.add("draging"),o.appendChild(d),this.classList.add("placeholder")}),mui(i).on("drag",".colList>li",function(t){if(d){var e=0,n=t.detail.touches[0],o=(parseInt(this.dataset.width),n.clientY-h-p),a=n.clientX-10-b;f&&(f.classList.remove("before"),f=null),d.style.left=a+"px",d.style.top=o+"px";for(var i=0,l=void 0;l=m[i];i++){var r=parseInt(l.dataset.width)/2,s=parseInt(l.dataset.top);if(s+u<o+u/2)e=r;else{var c=parseInt(l.dataset.left);if(o<s||c-e<=a&&a<=c+r){(f=l).classList.add("before");break}e=r}}}}),mui(i).on("dragend",".colList>li",function(){o.removeChild(d),d=null,this.classList.remove("placeholder"),o.insertBefore(this,f),f&&f.classList.remove("before"),n(m,null,!0)}),r.on(r.query(".buttons",i),"tap",".mui-btn",function(){switch(this.dataset.action){case"cancel":i.style.display="none";break;case"sure":i.style.display="none";for(var t=[],e=0,n=void 0;n=m[e];e++)t.push(a.conf.cols[parseInt(n.dataset.colIndex)]);a.conf.cols=t,a.theadRender(),a.render(a.startIndex,a.tbodyLength+a.startIndex,!0)}})};function n(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);for(var o=0,a=void 0;(a=t[o])&&!a.isEqualNode(e);o++)n||(a.dataset.width=a.offsetWidth.toString(),a.style.width=a.offsetWidth+"px"),a.dataset.top=a.offsetTop.toString(),a.dataset.left=a.offsetLeft.toString()}return{show:function(){t||(function(){i=G.d.create('<div class="mobileTableReorderPanel"><div class="buttons"><button class="mui-btn mui-btn-link cancel" data-action="cancel">取消</button><button class="mui-pull-right mui-btn-link mui-btn" data-action="sure">确定</button></div></div>');var t=G.d.create('<ul class="colList"></ul>');i.appendChild(t),document.body.appendChild(i),e()}(),t=!0);var o=i.querySelector(".colList");o.innerHTML="",m=[],l.conf.cols.forEach(function(t,e){var n=G.d.create('<li data-col-index="'+e+'"><span>'+t.title+"</span></li>");m.push(n),o.appendChild(n)}),i.style.display="block",n(m)}}}(),l.conf.onComplete&&l.conf.onComplete(),l}return __extends(t,e),t.prototype.getEventConf=function(){return{menuName:"longtap",clickName:"tap",mousemoveName:"touchmove",mouseoutName:"",mousedownName:"touchstart",mouseupName:"touchend"}},t.prototype.menuConfGet=function(){var e=this;return{colConfGet:function(){return{identifier:"col",targetGet:function(t){return[t]},targetSelector:"thead tr th",btns:e.conf.colMenu}},rowConfGet:function(){return{identifier:"row",targetGet:function(t){return e.trSelected},targetSelector:"tbody tr",btns:e.conf.rowMenu,eventHandle:function(t){}}},popDomGet:function(){var t=(new Date).getTime(),e='<div id="mobileTable_popMenu_'+t+'" class="mui-popover mui-popover-bottom mui-popover-action"><ul class="mui-table-view"></ul><ul class="mui-table-view"><li class="mui-table-view-cell"><a data-action="cancel" href="#mobileTable_popMenu_'+t+'" style="color: red">取消</a></li></ul></div>';return G.d.create(e)},listDomGet:function(t){return t.firstElementChild},btnHtmlGet:function(t){var n="";return t.forEach(function(t,e){t&&(n+='<li class="mui-table-view-cell" '+('data-index="'+e+'" data-action="tableMenuBtn"')+">"+t.title+"</li>")}),n},show:function(t){mui(e.popMenuDom).popover("toggle")},hide:function(t){mui(e.popMenuDom).popover("toggle")},init:function(){document.body.appendChild(e.popMenuDom),e.popMenuDom.querySelector("[data-action]").addEventListener("tap",function(){e.rowDeselect()})}}},t.prototype.initColReorder=function(){var t=G.d.create('<div class="mobileTableReorderPanel"><div class="buttons"><button class="mui-btn mui-btn-link cancel" data-action="cancel">取消</button><button class="mui-pull-right mui-btn-link mui-btn" data-action="sure">确定</button></div></div>'),e=G.d.create('<ul class="colList"></ul>');t.appendChild(e),document.body.appendChild(t),this.initColReorderDragEvent(t),this.reorderPanel=t},t.prototype.initColReorderDragEvent=function(i){var d=null,o=i.querySelector(".colList"),u=0,f=null,h=this,p=o.offsetTop+10,b=0,m=0;mui(i).on("dragstart",".colList>li",function(t){0===u&&(u=this.offsetHeight);var e=t.detail.touches[0],n=this.getBoundingClientRect();m=n.width-(e.clientX-n.left),b=n.height-(e.clientY-n.top),(d=this.cloneNode(!0)).classList.add("draging"),o.appendChild(d),this.classList.add("placeholder")}),mui(i).on("drag",".colList>li",function(t){if(d){var e=0,n=t.detail.touches[0],o=(parseInt(this.dataset.width),n.clientY-p-b),a=n.clientX-10-m;f&&(f.classList.remove("before"),f=null),d.style.left=a+"px",d.style.top=o+"px";for(var i=0,l=void 0;l=h.allCol[i];i++){var r=parseInt(l.dataset.width)/2,s=parseInt(l.dataset.top);if(s+u<o+u/2)e=r;else{var c=parseInt(l.dataset.left);if(o<s||c-e<=a&&a<=c+r){(f=l).classList.add("before");break}e=r}}}}),mui(i).on("dragend",".colList>li",function(){o.removeChild(d),d=null,this.classList.remove("placeholder"),o.insertBefore(this,f),f&&f.classList.remove("before"),t.calcReorderColsPos(h.allCol,null,!0)}),r.on(r.query(".buttons",i),"click",".mui-btn",function(t){switch(t.stopPropagation(),this.dataset.action){case"cancel":i.style.display="none";break;case"sure":i.style.display="none";for(var e=[],n=r.queryAll(".colList li",i),o=0,a=void 0;a=n[o];o++)e.push(h.conf.cols[parseInt(a.dataset.colIndex)]);h.conf.cols=e,h.theadRender(),h.lock.destroy(),h.lock.init(),h.render(h.startIndex,h.tbodyLength+h.startIndex,!0)}})},t.calcReorderColsPos=function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);for(var o=0,a=void 0;(a=t[o])&&!a.isEqualNode(e);o++)n||(a.dataset.width=a.offsetWidth.toString(),a.style.width=a.offsetWidth+"px"),a.dataset.top=a.offsetTop.toString(),a.dataset.left=a.offsetLeft.toString()},t.prototype.showColReorder=function(){var o=this;this.isPanelShowed||(this.initColReorder(),this.isPanelShowed=!0);var a=this.reorderPanel.querySelector(".colList");a.innerHTML="",this.allCol=[],this.conf.cols.forEach(function(t,e){var n=G.d.create('<li data-col-index="'+e+'"><span>'+t.title+"</span></li>");o.allCol.push(n),a.appendChild(n)}),this.reorderPanel.style.display="block",t.calcReorderColsPos(r.queryAll("li",a))},t.prototype.lockScreen=function(){var t=this,e=this.conf.Container,n=document.body;e&&(e.style.overflowY="hidden"),this.tableMiddle.style.overflowX="hidden",this.tableMiddle.style.width="100%",n.style.overflow="hidden",n.style.height="100%",this.move.timeout=setTimeout(function(){t.unlockScreen()},1e3)},t.prototype.destroy=function(){e.prototype.destroy.call(this)},t}(n.BasicTable);e.MbTable=o}),define("TableEdit",["require","exports","Modal","Tooltip","Loading","BwRule"],function(e,t,o,u,a,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=G.d,h=G.tools,p=BW.CONF,i=BW.sys,n=function(){function t(t){this.p=t,this.isEditing=!1,this.inMain=!0,this.tm=t.tm}return t.prototype.canRowInit=function(t,e){if(t)return!(e&&0===e.EDITEXPRESS);var n=this.tm.table.rowSelectDataGet()[0];return this.canRowInit(!0,n)},Object.defineProperty(t.prototype,"subTm",{get:function(){return this._subTm},set:function(t){var n=this;t&&(this._subTm=t,this.mainSub(function(t,e){r.on(t.table.wrapperGet(),"click",function(){n.inMain=e,"function"==typeof n.onFocusChangeHandler&&n.onFocusChangeHandler(e)})}))},enumerable:!0,configurable:!0}),t.prototype.init=function(t){var e=b(this.p.tableAddr),n=e.mainVarList,o=e.subVarList;s(n,["update","insert"])||s(o,["update","insert"])?this.editModuleLoad(t):"function"==typeof t&&t()},t.prototype.editModuleLoad=function(t){var l=this;this.mainSub(function(t){t.table.edit.init(),t.table.wrapperGet().classList.add("disabled")}),e(["EditModule"],function(a){var i=[];l.mainSub(function(t,e,n,o){i.push(l.initEditModule(a.EditModule,t).then(function(){t.table.wrapperGet().classList.remove("disabled")}))}),Promise.all(i).then(function(){"function"==typeof t&&t()}),h.event.fire("editChange",{status:1},l.tm.wrapper),l.isEditing=!0})},t.prototype.initEditModule=function(s,e){var n=this,c=e.table,o=e.defaultData,a=[e.getKeyField()],i=e.getDefAddr(),l=function(t){var r=new s({auto:!1,type:"table",fields:n.p.cols.map(function(t){return{dom:null,field:t}})});c.edit.initModify({defData:t,pasteExceptCols:a,comInit:function(i,t,l){var e;i.innerHTML="",r.init(l.name,{dom:i,data:t,field:l,onExtra:function(a,t,e){void 0===e&&(e=!1),h.isEmpty(a)&&e?c.edit.modifyTd(i,""):t.forEach(function(t){var e;if(t!==l.name){var n=d(i,t),o=h.str.toEmpty(a[t]);n?c.edit.modifyTd(n,o):c.edit.rowData(parseInt(i.parentElement.dataset.index),((e={})[t]=o,e))}})}}),r.set(((e={})[l.name]=t[l.name],e));var n=i.querySelector("input");n&&n.select()},validate:function(n,t,e,o){var a=t.name,i=r.validate.start(a),l=function(t,e,n){var o=c.getVisibleCol(),a=o.indexOf(t)>o.length/2;new u.Tooltip({visible:!1,errorMsg:n,el:e,length:"medium",pos:a?"left":"right"})};i&&i[a]?(l(a,d(n,a),i[a].errMsg),o(n,!1)):t.chkAddr&&!h.isEmpty(e[t.name])?s.checkValue(t,e,function(){return c.edit.modifyTd(n,"")}).then(function(t){t.errors&&t.errors.forEach(function(t){var e=d(n,t.name);e&&(l(t.name,e,t.msg),o(e,!1))}),t.okNames&&t.okNames.forEach(function(t){var e=d(n,t);e&&(u.Tooltip.clear(e),o(e,!0))})}):o(n,!0)},comDestroy:function(t){var e,n=t.name;r.set(((e={})[n]=r.get(n)[n],e)),r.destroy(n)},valGet:function(t){return r.get(t.name)},canInit:function(t,e){return 1===e?!t.noModify:!t.noEdit},canRowInit:function(t){return n.canRowInit(!e.isSub,e.isSub?null:t)}})};function d(t,e){return r.query('td[data-col="'+e+'"]',t.parentElement)}return new Promise(function(t,e){if(h.isNotEmpty(i)){var n={};Promise.all(i.map(function(t){return f.BwRule.Ajax.fetch(p.siteUrl+f.BwRule.reqAddr(t)).then(function(t){var e=t.response;n=Object.assign(n,o,e.data[0]||{})})})).then(function(){l(n),t()})}else l(o),t()})},t.prototype.mainSub=function(t,e){void 0===e&&(e=!0);var n=0,o=!1,a=!1,i=e?b(this.p.tableAddr):{mainVarList:null,subVarList:null},l=i.mainVarList,r=i.subVarList;!this.tm||e&&!s(l,["insert","update"])||(o=!0,n++),!this.subTm||e&&!s(r,["insert","update"])||(n++,a=!0),o&&t(this.tm,!0,0,n),a&&t(this.subTm,!1,o?1:0,n)},t.prototype.checkError=function(){var t=this.tm.table,e=this.subTm?this.subTm.table:null,n=t.edit.errorLen();return 0<n?(o.Modal.alert((e?"主表":"")+"有"+n+"个错误需要修改"),!1):!(e&&0<(n=e.edit.errorLen()))||(o.Modal.alert("从表有"+n+"个错误需要修改"),!1)},t.prototype.getData=function(o,a){var i={};return a&&["update","delete","insert"].forEach(function(t){var e=a[t+"Type"];if(a[t]&&o[e][0]){var n=f.BwRule.varList(a[t],o[e],!0);n&&(i[t]=n)}}),h.isEmpty(i)||(i.itemId=a.itemId),i},Object.defineProperty(t.prototype,"ctm",{get:function(){return this.inMain?this.tm:this.subTm},enumerable:!0,configurable:!0}),t.prototype.cancel=function(){this.isEditing&&(this.mainSub(function(t){return t.table.edit.cancel()}),this.isEditing=!1,this.tm.wrapper.classList.remove("disabled"),h.event.fire("editChange",{status:0},this.tm.wrapper))},t.prototype.save=function(n){var r=this,s={param:[]},t=b(this.p.tableAddr),c=t.mainVarList,d=t.subVarList;if(this.mainSub(function(t){return t.table.edit.reshowEditing()}),this.checkError()){var e=new a.Loading({msg:"保存中",disableEl:this.tm.wrapper});setTimeout(function(){r.mainSub(function(t,e){var o=r.tm.table.rowSelectDataGet()[0],a=t.table.edit.getData();if(!e){var n=function(n){a[n][0]&&a[n].forEach(function(t,e){a[n][e]=h.obj.merge(o,t)})};for(var i in a)n(i)}var l=r.getData(a,e?c:d);t.table.edit.reshowEditing(),h.isEmpty(l)||s.param.push(l)},!1),h.isEmpty(s.param)?(e.destroy(),r.cancel(),o.Modal.toast("没有数据改变"),n&&n()):f.BwRule.Ajax.fetch(p.siteUrl+r.p.tableAddr.dataAddr,{type:"POST",data:s}).then(function(t){var e=t.response;f.BwRule.checkValue(e,s,function(){r.mainSub(function(t){document.body.classList.contains("mui-android-4")?i.window.load(location.href):t.tableData.refresh(null,function(){t.aggregate.get(),h.event.fire("table-edit-saved",null,r.tm.wrapper)})}),o.Modal.toast(e.msg),n&&n(),r.cancel()})}).finally(function(){e.destroy()})},1800)}},t.prototype.add=function(t){this.inMain?this.tm.table.edit.addRow(t):this.subTm.table.edit.addRow(t)},t.prototype.del=function(){var e=this,t=this.subTm?this.subTm.table:null;!t||h.isEmpty(t.data.get())?this.tm.table.edit.deleteRow(function(t){return e.canRowInit(e.tm.isSub,e.tm.isSub?null:t)}):t&&!h.isEmpty(t.rowSelectDataGet())?t.edit.deleteRow(function(t){return e.canRowInit(e.tm.isSub,e.tm.isSub?null:t)}):o.Modal.alert("不能删除有明细的主表数据")},t.prototype.getStatus=function(){return this.isEditing},t.prototype.onFocusChange=function(t){this.onFocusChangeHandler=t},t.prototype.reshowEditing=function(){this.ctm&&this.ctm.table.edit.reshowEditing()},t.prototype.rowData=function(t,e){return this.ctm&&this.ctm.table.edit.rowData(t,e)},t}();function s(t,e){if(t)for(var n=0,o=["update","insert","delete"];n<o.length;n++){var a=o[n];if(-1<e.indexOf(t[a+"Type"]))return!0}return!1}function b(t){var e={mainVarList:null,subVarList:null};return t&&Array.isArray(t.param)&&t.param.forEach(function(t){"sub"===t.type?e.subVarList=t:"main"===t.type&&(e.mainVarList=t)}),e}t.TableEdit=n}),define("TableImgEdit",["require","exports","Modal","UploadModule","Button"],function(t,e,a,s,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var d=G.d,u=G.tools,f=BW.CONF,n=function(){function t(t){this.modal=null,this.imgs=[],this.fields=t.fields,this.thumbField=t.thumbField,this.deletable=t.deletable,this.updatable=t.updatable,this.onUploaded=t.onUploaded,this.onSave=t.onSave,this.modalInit()}return t.prototype.modalInit=function(){var n=this,o=document.createDocumentFragment();this.fields.forEach(function(t,e){o.appendChild(n.imgWrapperGet(t,e))}),this.imgs=d.queryAll("img",o),this.modal=new a.Modal({header:"图片查看",width:"700px",body:o})},t.prototype.imgWrapperGet=function(t,e){var i=this,l=t.name,n=d.create('<div class="table-img-wrapper" data-field="'+l+'"><div class="table-img-wrapper-btns"></div><div class="table-img"><img data-index="'+e+'" style="max-height:500px;max-width:700px"></div></div>');if(!this.updatable&&!this.deletable)return n;var o=d.query(".table-img-wrapper-btns",n),r=d.query("img",n);if(this.updatable){var a=d.create('<div class="table-img-uploader"></div>');d.append(o,a),new s.default({nameField:l,thumbField:this.thumbField,container:a,text:"选择图片",accept:{title:"图片",extensions:"jpg,png,gif",mimeTypes:"image/*"},uploadUrl:f.ajaxUrl.fileUpload,showNameOnComplete:!1,onComplete:function(t,e){var n=t.data,o={};for(var a in n)o[n[a].key]=n[a].value;r.src=i.imgUrlCreate(o[l]),u.isFunction(i.onUploaded)&&i.onUploaded(o)}})}return this.deletable&&new c.Button({content:"删除图片",container:o,onClick:function(){var t;r.src="",u.isFunction(i.onUploaded)&&i.onUploaded(((t={})[l]="",t))}}),n},t.prototype.imgUrlCreate=function(t){return u.url.addObj(f.ajaxUrl.fileDownload,{md5_field:"FILE_ID",file_id:t,down:"allow"})},Object.defineProperty(t.prototype,"isShow",{get:function(){return this._isShow},set:function(t){this._isShow=!!t,this.modal&&(this.modal.isShow=this._isShow)},enumerable:!0,configurable:!0}),t.prototype.showImg=function(n,o){var a=this;this.imgs.forEach(function(t,e){t.src=o[e]?a.imgUrlCreate(o[e]):n[e]})},t}();e.TableImgEdit=n}),define("TableModuleMb",["require","exports","TableModule","MbTable","SubPage","CheckBox","SelectBox","InputBox","Button","Modal","Popover"],function(t,e,n,o,u,f,l,r,s,p,b){"use strict";var m=G.tools,v=G.d;return function(c){function d(){var e,t,n,o,a,i,l,r,s=null!==c&&c.apply(this,arguments)||this;return s.frontBtnsInit=(t=v.query('[data-target="popover"]'),o=s,a=(n=[{title:"本地搜索",action:"localSearch"},{title:"图表统计",action:"chartStatistic"},{title:"交叉制表",action:"anaStatistic"},{title:"数据统计",action:"dataStatistic"},{title:"abc分析",action:"analysisStatistic"},{title:"导出报表",action:"export"}]).map(function(t){return{title:t.title,icon:t.icon}}),{init:function(){e=new b.Popover({target:t,items:a,onClick:function(t){!function(t){switch(n[t].action){case"localSearch":o.localSearch.show(),e.show=!1;break;case"chartStatistic":o.statistic.initChart(),e.show=!1;break;case"anaStatistic":o.statistic.initCrosstab(),e.show=!1;break;case"dataStatistic":o.statistic.initStatistic(),e.show=!1;break;case"analysisStatistic":o.statistic.initAnalysis(),e.show=!1;break;case"export":o.doExport(),e.show=!1}}(t)}})},destroy:function(){m.isEmpty(e)||e.destroy()}}),s.indexColShowBtn=(i=null,{init:function(){if(!s.para.isSub){var t=v.query('body > header.mui-bar.mui-bar-nav > [data-action="indexCol"]');i=new f.CheckBox({container:t,text:"",status:1,onSet:function(t){s.table.indexColFun.show(t),s.subTable&&s.subTable.table&&s.subTable.table.indexColFun.show(t)}})}},destroy:function(){i.destroy()}}),s.handleSubTable=(r=l=null,function(t,e,n,o){null===l&&(l=u.SubPage.create(),r=h("table",{className:"mobileTable subTable"}),l.appendChild(r)),u.SubPage.show(function(){null===s.subTable?(s.subTable=new d({tableEl:r,scrollEl:l,ajaxData:e},s.subTableData),m.event.fire("subTableInit",null,s.wrapper)):(u.SubPage.getLoading().classList.remove("hide"),s.subTable.refresher(e,function(){u.SubPage.getLoading().classList.add("hide")}))}),n(),setTimeout(function(){var t=s.table.rowSelectDataGet();s.subTable.aggregate.get(t&&t[0]?t[0]:null)},100),u.SubPage.onClose(o)}),s}return __extends(d,c),d.prototype.initWrapper=function(t){this.wrapper=h("div",{className:"table-module-wrapper"}),v.append(t.parentElement,this.wrapper),v.append(this.wrapper,t)},d.prototype.onComplete=function(){var t=this;this.isDrill&&this.initDrillBut.init(this.wrapper),this.footerBtnsInit(),this.mobileScan(),this.isDrill||this.para.isSub||this.para.isInModal||(this.initSearch(),setTimeout(function(){t.indexColShowBtn.init(),t.frontBtnsInit.init()},0))},d.prototype.initSearch=function(){var t=this,e=this.table.wrapperGet(),n=h("div",{className:"search-input mui-input-row"},h("label",null,h("span",{className:"mui-icon mui-icon-search grey"})),h("input",{type:"text",placeholder:"请输入...",className:"mui-input-clear mui-input",autocapitalize:"off",autocorrect:"off"}));v.before(e,n);var o=n.clientHeight;this.para.isSub?e.parentElement.scrollTop=o:window.scrollTo(0,o);var a,i,l,r,s=v.query("input",n);mui(s).input(),a=function(){return t.table.search(s.value)},i=null,r=l=0,v.on(s,"input",function(){l=(new Date).getTime(),0===r&&(r=l),l-r<300&&(i&&clearTimeout(i),i=setTimeout(function(){a(),r=0,i=null},500)),r=l}),setTimeout(function(){v.on(s.nextElementSibling,"tap",function(t){a(),s.blur(),s.focus()})},1e3)},d.prototype.mobileScan=function(){var e=this,n=this.para.scannableField;n&&t(["MobileScan"],function(t){new t.MobileScan({container:e.wrapper,cols:e.para.cols,scannableField:n.toUpperCase(),scannableType:e.para.scannableType,scannableTime:e.para.scannableTime,callback:function(t){return e.queryModule?(e.queryModule.hide(),e.queryModule.search(t,!0)):e.refresher(t)}})})},d.prototype.footerBtnsInit=function(){var t=!m.isEmpty(this.para.subButtons),e=this.editBtns.has();if(t||e){this.subBtnWrapper=h("footer",{className:"mui-bar mui-bar-footer"});var n=null;if(t&&e){n=h("div",{className:"all-btn"});var o=null,a=null;new f.CheckBox({className:"edit-toggle",container:this.subBtnWrapper,onClick:function(t){o.classList[t?"add":"remove"]("hide"),a.classList[t?"remove":"add"]("hide")}}),v.append(this.subBtnWrapper,n),setTimeout(function(){var t;t=v.queryAll(".input-box",n),o=t[0],(a=t[1]).classList.add("hide")},50)}else n=this.subBtnWrapper;t&&this.initSubBtns(n),e&&this.editBtns.init(n),this.wrapper.style.paddingBottom="35px",v.append(this.wrapper,this.subBtnWrapper)}},d.prototype.doExport=function(){var t=this,e=h("div",{"data-name":"export"}),n=[{value:"csv",text:"导出csv"},{value:"xls",text:"导出excel"},{value:"doc",text:"导出word"},{value:"pdf",text:"导出pdf"},{value:"image",text:"导出png"}],o=new l.SelectBox({container:e,select:{multi:!1,isRadioNotchecked:!1},data:n}),a=new r.InputBox,i=new s.Button({key:"okBtn",content:"确定",type:"primary",onClick:function(){t.export(n[o.get()[0]].value)}});a.addItem(i),new p.Modal({header:"导出报表",body:e,position:"center",container:this.wrapper,isOnceDestroy:!0,footer:{rightPanel:a}})},d.prototype.tableConfGet=function(t){var n=this,e=c.prototype.tableConfGet.call(this,t);t.btPara.multi||e.colMenu.push({multi:!0,title:"列排序",callback:function(t,e){n.table.showColReorder()}});var o={onComplete:e.onComplete};return m.obj.merge(!0,e,o)},d.prototype.initTable=function(t){return new o.MbTable(t)},d.prototype.imgHtmlGet=function(t){return'<img src="'+t+'" alt=""/>'},d.prototype.destroy=function(){this.table.destroy(),this.frontBtnsInit.destroy(),this.indexColShowBtn.destroy(),v.remove(this.table.wrapperGet()),v.remove(this.wrapper)},d}(n.TableModule)}),define("TableModule",["require","exports","paging","Modal","Spinner","Button","QueryBuilder","InputBox","ButtonAction","TableEdit","TableDataModule","TableImgEdit","ImgModal","BwRule"],function(nt,t,ot,at,it,lt,rt,st,a,ct,dt,u,c,ut){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var ft=G.tools,ht=BW.CONF,pt=BW.sys,bt=G.d,e=function(){function t(t,n){var e,o,i,s,c,d,f,p,b,m,a,l,r,u,v,g,y,C,w,x,k,T,L,S,E,R,M,D,N,A,B,I,H,G,P,q,W,O,F,z,j=this;this.tableConf=t,this.para=n,this.wrapper=null,this.refresher=null,this.table=null,this.subTable=null,this.isSub=!1,this.defaultData={},this.pageUrl="",this.maxCellWidth=ft.isMb?600<document.body.offsetWidth?30:15:30,this.cols=[],this.tableData=null,this.aggregate=(e=null,o=j.para.aggrList,i=null,{get:function(t){(null!==e||Array.isArray(o)&&o[0]&&(e=h("div",{className:"aggr-wrapper"}),bt.before(j.table.wrapperGet(),e),1))&&(t&&(i=t),e.innerHTML="",o.forEach(function(o){var a=h("span",null,o.caption,":");bt.append(e,a),ut.BwRule.Ajax.fetch(ht.siteUrl+ut.BwRule.reqAddr(o.dataAddr,i)).then(function(t){var e=t.response,n=ft.keysVal(e,"data",0,ft.keysVal(e,"meta",0));a.innerHTML=o.caption+":"+(n||0)+" &nbsp;&nbsp;"})}))}}),this.initTableEvent=(s=j,c=[],d={},{init:function(r){if(r.clickEvent.add("td[data-href], td[data-click-type]",function(t){if("file"===this.dataset.hrefType)ut.BwRule.link({link:this.dataset.href,dataType:ut.BwRule.DT_FILE,callback:function(t,e,n){pt&&pt.window.download(e.DOWNADDR)}});else if("btn"===this.dataset.clickType){var e=s.subBtn.children||[],n=this.dataset.col;s.table.rowSelect(this.parentElement);for(var o=0,a=e;o<a.length;o++){var i=a[o],l=i.data;l&&l.linkName&&l.linkName===n&&i.onClick.call(i,null)}}else pt&&pt.window.open({url:ht.siteUrl+this.dataset.href,gps:!!parseInt(this.dataset.gps)},s.pageUrl);t.stopPropagation()}),r.clickEvent.add("tr td.td-img, tr[data-click-type]",function(t){var e="TD"===this.tagName,n=parseInt(e?this.parentElement.dataset.index:this.dataset.index),o=s.para.pictureAddrList.map(function(t){return ht.siteUrl+ut.BwRule.reqAddr(t,r.rowDataGet(n))});s.handleImg(o,n)}),ft.isMb&&r.clickEvent.add("td > .more-text-button",function(t){var e=bt.closest(this,"td").dataset.col,n=parseInt(bt.closest(this,"tr").dataset.index),o=s.table.rowDataGet(n)[e];at.Modal.alert(ft.str.removeHtmlTags(o))}),j.subTableData){var e=function(t){var e=this,n=parseInt(this.dataset.index),o=ut.BwRule.varList(s.subTableData.dataAddr.varList,r.rowDataGet(n)),a=s.tableData.getQueryPara();delete(o=ft.obj.merge(a,o)).queryoptionsparam,s.handleSubTable(this.dataset.subUrl,o,function(){r.rowSelect(e)},function(){r.rowDeselect(this)})};r.clickEvent.add("tr[data-sub-url]",e),bt.on(j.wrapper,"editChange",function(t){r.clickEvent[1===t.detail.status?"remove":"add"]("tr[data-sub-url]",e)})}1===j.para.multPage&&r.clickEvent.add("thead th[data-col]",function(t){var e=function(t){for(var e=s.para.cols,n=0,o=e.length;n<o;n++)if(e[n].name===t)return e[n].dataType}(this.dataset.col);if(ut.BwRule.DT_IMAGE!==e&&ut.BwRule.DT_HTML!==e&&ut.BwRule.DT_MULTI_TEXT!==e&&ut.BwRule.DT_FILE!==e&&!(this.classList.contains("disabled")||r.colResize.dragging||r.moving)){var n=null,o=this.dataset.col;ft.isMb&&(n=new it.Spinner({el:document.body,type:it.Spinner.SHOW_TYPE.cover,className:"text-center"})),n&&n.show(),s.pagination.setParam(1);var a=s.tableData.getQueryPara();if(d[o]||(d[o]="asc"),t.ctrlKey||t.shiftKey)for(var i=0;i<c.length;i++)c[i]===o+","+d[o]&&c.splice(i,1);else{var l=void 0;c=[],d[o]&&(l=d[o]),(d={})[o]=l||"asc"}d[o]="asc"===d[o]?"desc":"asc",c.push(o+","+d[o]),a.pagesortparams=JSON.stringify(c),s.pagination.setParam(1),s.tableData.refresh(a,function(t){var e=t.head.totalNum?t.head.totalNum:t.data.length;0!==s.para.multPage&&e>s.pagination.pageLen&&s.pagination.reset({offset:0,recordTotal:t.head.totalNum?t.head.totalNum:t.data.length}),n&&n.hide()})}}),r.clickEvent.on()},getPageSortParams:function(){return{pagesortparams:JSON.stringify(c)}}}),this.pagination=function(){var l=null,e={},r=j,s={count:1,current:0,size:50,offset:0};function n(){return{pageparams:'{"index"=1 , "size"='+(1===r.para.multPage?50:3e3)+' ,"total"=1}'}}e=n();var c=function(t){e={pageparams:'{"index"='+t+' , "size"='+(1===r.para.multPage?s.size:3e3)+' ,"total"=1}'}},a=function(t){var e=bt.query(".table-out-bottom",j.wrapper);e&&(e.style.display=t?"block":"none"),ft.event.fire("pageToggle",{isShow:t},j.wrapper)};return{reset:function(t){var e,n,a,o,i;null===l?(e=t,n=h("div",{className:"table-out-bottom"}),a=j.table,o=a.wrapperGet(),i=j.tableConf.scrollEl,o.appendChild(n),(l=new ot.Paging({el:ft.isMb?j.para.isSub?j.wrapper:o:n,pageOption:ft.isMb?null:[50,200,500],pageSize:50,recordTotal:e.recordTotal,change:function(t){t.count;var e=t.current,n=(t.offset,t.size);if(!ft.isMb){var o=j.tableConf.scrollEl;o&&(o.scrollTop=0)}1===r.para.multPage?(s=t,c(e),r.tableData.ajax(null,function(t){t&&(r.tableData.dealTable(t.data,!ft.isMb),r.localSearch.setOriginData(r.table.data.get())),ft.isMb&&l.reset({last:!1}),setTimeout(function(){r.onLoad&&r.onLoad.getscrollBar()&&r.onLoad.getscrollBar().updateStyle()},0)})):ft.isMb?setTimeout(function(){a.render((e-1)*n,e*n,!1),ft.isMb&&l.reset({last:!1})},500):(a.render((e-1)*n,e*n),setTimeout(function(){r.onLoad&&r.onLoad.getscrollBar()&&r.onLoad.getscrollBar().updateStyle()},0))},scroll:ft.isMb?{Container:j.para.isSub?j.wrapper:i===window?null:i,auto:!0,content:"加载中...",nomore:"已加载完全部数据"}:null})).go(1)):l.reset(t)},getParam:function(t){return void 0===t&&(t=!1),t&&(e=n()),e},getCurrentState:function(){return s},setParam:c,isShow:function(t){var e,n=t.data?t.data:t;t.head&&(e=t.head.totalNum);var o=e?e>r.pagination.pageLen:n.length>r.pagination.pageLen;a(o)},pageLen:50,show:a}}(),this.getMulitPara=(f=[],p=[],b=0,m=[],{getMulitCols:function(e,t){if(m=[],f=[],p=[],!t){var n=e;e=[];for(var o=0,a=n.length;o<a;o++)if(n[o].subcols)for(var i=0,l=n[o].subcols.length;i<l;i++)e.push({name:n[o].subcols[i].name,title:n[o].title+"."+n[o].subcols[i].caption});else e.push({name:n[o].name,title:n[o].title})}var r,s;function c(t){for(r=0;r<e.length;r++)t(e[r],r)}function d(t){for(r=0;r<p.length;r++)t(p[r])}function u(t){for(r=0;r<f.length;r++)for(s=0;s<f[r].length;s++)t(f[r][s])}for(c(function(t,e){p[e]=t.title.split("."),p[e][p[e].length-1]+="|"+t.name,m.push(t)}),d(function(t){b<t.length&&(b=t.length)}),c(function(t,e){var n=t.title.split(".");p[e][p[e].length-1]+="|"+(b-(n.length-1))}),r=0;r<b;r++)f[r]=[];return d(function(t){!function(t){function e(t){for(var e=0;e<f.length;e++)for(var n=0;n<f[e].length;n++)if(f[e][n].title===t)return!0;return!1}if(t instanceof Array)for(var n=0;n<t.length;n++)!e(t[n])&&f[n].push({title:0<t[n].indexOf("|")?t[n].split("|")[0]:t[n],name:0<t[n].indexOf("|")?t[n].split("|")[1]:null,rowspan:parseInt(0<t[n].indexOf("|")?t[n].split("|")[2]:1),parent:0===n?null:t[n-1]})}(t)}),u(function(t){t.colspan=function(t){var e,n,o=0;for(e=0;e<f.length;e++)for(n=0;n<f[e].length;n++)f[e][n].parent===t&&o++;return 0===o?1:o}(t.title)}),u(function(t){delete t.parent}),f},getColsIndex:function(){return m}}),this.localSearch=(a=this,g=function(){a.para.multPage=v,a.tableData.dealTable(u,!0),0!==v&&u.length>a.pagination.pageLen&&a.pagination.reset({offset:0,recordTotal:u.length}),a.pagination.isShow(u)},{show:(l=y=v=u=null,r=function(){C(),l.isShow=!1},function(){!function(){if(null===y){var t=ft.isMb?h("div",{className:"mui-content"},h("ul",{className:"mui-table-view","data-query-name":"local"}),h("div",{"data-action":"add","data-name":"local",className:"mui-btn mui-btn-block mui-btn-primary"},h("span",{className:"mui-icon mui-icon-plusempty"})," 添加条件")):h("form",{className:"filter-form","data-query-name":"local"},h("span",{"data-action":"add",className:"iconfont blue icon-jiahao"}));(l=new at.Modal({container:bt.closest(j.wrapper,".page-container"),header:"本地过滤",body:t,position:ft.isMb?"full":"",width:"730px",className:"local queryBuilder"})).className="",l.className="",ft.isMb?(l.modalHeader.rightPanel=(o=new st.InputBox,a=new lt.Button({content:"清除",onClick:function(){g(),l.isShow=!1}}),i=new lt.Button({icon:"sousuo",onClick:r}),o.addItem(a),o.addItem(i),o),mui(t).on("tap",'[data-action="add"]',function(){y.rowAdd();var t=this.previousElementSibling;t.scrollTop=t.scrollHeight})):l.footer={rightPanel:(n=new st.InputBox,n.addItem(new lt.Button({content:"取消",type:"default",key:"cancelBtn"})),n.addItem(new lt.Button({content:"清除",type:"default",key:"clearBtn",onClick:function(){g(),l.isShow=!1}})),n.addItem(new lt.Button({content:"查询",type:"primary",onClick:r,key:"queryBtn"})),n)},y=new rt.QueryBuilder({queryConfigs:(e=j.cols,e.map(function(t){return{caption:t.title,field_name:t.name,dynamic:0,link:"",type:"",atrrs:t.atrrs}})),resultDom:ft.isMb?bt.query("ul.mui-table-view",t):t,setting:null})}var e,n,o,a,i}(),l.isShow=!0}),search:C=function(){var t=y.dataGet();if(t&&t.params){var e=function(o){var a=u,i=[];function t(t){for(var e=0;e<i.length;e++){var n=i[e][t.field];t.not?l(n,t)&&(i.splice(e,1),e--):l(n,t)||(i.splice(e,1),e--)}}function l(t,e){switch(e.op){case 2:if(t==e.values[0])return!0;break;case 3:if(t>e.values[0])return!0;break;case 4:if(t>=e.values[0])return!0;break;case 5:if(t<e.values[0])return!0;break;case 6:if(t<=e.values[0])return!0;break;case 7:if(t>=e.values[0]&&t<=e.values[1])return!0;break;case 9:if("string"==typeof t&&-1<t.indexOf(e.values[0]))return!0;break;case 10:if(!t&&0!==t)return!0}return!1}!function(){for(var t=0,e=a.length;t<e;t++){var n=a[t][o[0].field];o[0].not?l(n,o[0])||i.push(a[t]):l(n,o[0])&&i.push(a[t])}}();for(var e=1,n=o.length;e<n;e++)t(o[e]);return i}(t.params);j.para.multPage=2,j.pagination.setParam(1),j.tableData.dealTable(e,!0),0!==v&&e.length>j.pagination.pageLen&&j.pagination.reset({offset:0,recordTotal:e.length}),j.pagination.isShow(e)}},queryDataGet:function(){return y?y.dataGet():null},setOriginData:function(t){u=t},setOriginMultPage:function(t){v=t},getOriginMultPage:function(){return v}}),this.statistic=(L=T=k=x=w=null,S=function(){for(var t=0;t<j.cols.length;t++)if(ut.BwRule.isNumber(j.cols[t].dataType))return!0;return!1},{initStatistic:function(t){if(!S())return at.Modal.alert("无可统计字段"),!1;var e=function(){new T({container:bt.closest(j.wrapper,"div.page-container"),cols:j.cols,colDataGet:function(t){return j.table.colDataGet(t)},paraGet:function(){var t=j.tableConfGet({tmPara:j.para,btPara:{}});return delete t.cellMaxWidth,delete t.onComplete,t},getVisibleCol:function(){return j.table.getVisibleCol()}}).getModal().isShow=!0};if(!T&&S()){var n=null;t&&(n=new it.Spinner({el:t,size:14,type:it.Spinner.SHOW_TYPE.replace})),n&&n.show(),nt(["StatisticBasic"],function(t){T=t,e(),n&&n.hide()})}else e()},initChart:function(t){if(!S())return at.Modal.alert("无可统计字段"),!1;var e=function(){new w({container:bt.closest(j.wrapper,"div.page-container"),cols:j.cols,allData:function(){return j.table.data.get()},selectedData:function(){return j.table.rowSelectDataGet()},colDataGet:function(t){return j.table.colDataGet(t)},getTablePara:function(){return j.para},getWrapper:function(){return j.wrapper},getVisibleCol:function(){return j.table.getVisibleCol()}}).getModal().isShow=!0};if(!w&&S()){var n=null;t&&(n=new it.Spinner({el:t,size:14,type:it.Spinner.SHOW_TYPE.replace})),n&&n.show(),nt(["ChartBasic"],function(t){w=t,e(),n&&n.hide()})}else e()},initCrosstab:function(t){if(!S())return at.Modal.alert("无可统计字段"),!1;var e=function(){new x({container:bt.closest(j.wrapper,"div.page-container"),cols:j.cols,allData:function(){return j.table.data.get()},selectedData:function(){return j.table.rowSelectDataGet()},paraGet:function(){var t=j.tableConfGet({tmPara:j.para,btPara:{}});return delete t.cellMaxWidth,delete t.onComplete,t},getVisibleCol:function(){return j.table.getVisibleCol()}}).getModal().isShow=!0};if(!x&&S()){var n=null;t&&(n=new it.Spinner({el:t,size:14,type:it.Spinner.SHOW_TYPE.replace})),n&&n.show(),nt(["CrossTabBasic"],function(t){x=t,e(),n&&n.hide()})}else e()},initAnalysis:function(t){if(!S())return at.Modal.alert("无可统计字段"),!1;var e=function(){new k({container:bt.closest(j.wrapper,"div.page-container"),cols:j.cols,allData:function(){return j.table.data.get()},selectedData:function(){return j.table.rowSelectDataGet()},paraGet:function(){var t=j.tableConfGet({tmPara:j.para,btPara:{}});return delete t.cellMaxWidth,delete t.onComplete,t},getVisibleCol:function(){return j.table.getVisibleCol()}}).getModal().isShow=!0};if(!k&&S()){var n=null;t&&(n=new it.Spinner({el:t,size:14,type:it.Spinner.SHOW_TYPE.replace})),n&&n.show(),nt(["AnalysisBasic"],function(t){k=t,e(),n&&n.hide()})}else e()},initCount:function(t){var e=function(){new L({container:bt.closest(j.wrapper,"div.page-container"),cols:j.cols,colDataGet:function(t){return j.table.colDataGet(t)},getVisibleCol:function(){return j.table.getVisibleCol()}}).getModal().isShow=!0};L?e():nt(["Count"],function(t){L=t,e()})}}),this.initDrillBut=(E=this,D=M=R=null,{init:function(n){R=h("div",null),M=h("div",null),D=h("div",null),M.style.display="inline-block",D.style.display="none",new lt.Button({container:M,icon:"bingzhuangtu",size:"large",type:"text",onClick:function(t){E.statistic.initChart(M)}}),new lt.Button({container:D,size:"large",icon:"biaoge",type:"text",onClick:function(t){var e=bt.query(".Echart_body",n);e&&(e.style.display="none"),bt.query(".mobileTableWrapper",n).style.display="block",D.style.display="none"}}),R.classList.add("statisticsChart"),R.appendChild(M),R.appendChild(D);var t=bt.closest(n,"li");bt.append(ft.isMb?t.firstElementChild:n.parentElement,R)},getChartBut:function(){return M},getTableBut:function(){return D}}),this.tableEdit=null,this.editBtns=(B=!1,I={},H=[],P=G=null,N=j,A=function(){var t=this;B=!0,N.tableEdit.init(function(){O(),t.click()})},q={on:function(){bt.on(j.wrapper.parentNode,"dblclick",".table-module-wrapper tbody td",A)},off:function(){bt.off(j.wrapper.parentNode,"dblclick",".table-module-wrapper tbody td",A)}},W={end:function(t){var e=t?P:G,n={edit:mt(P,["update"])||mt(G,["update"]),insert:mt(e,["insert"]),del:mt(e,["delete"]),save:!1,cancel:!1};for(var o in I)I[o]&&(I[o].isDisabled=!n[o])},start:function(t,e){void 0===e&&(e=!1);var n=t?P:G,o={edit:!1,insert:mt(n,["insert"]),del:mt(n,["delete"]),save:!0,cancel:!0};for(var a in I)!I[a]||e&&"edit"===a||(I[a].isDisabled=!o[a])}},F=function(){B=!1,W.end(!0),j.pagination.show(!0),ft.isMb||q.on()},z={insert:function(){B?j.tableEdit.add():j.tableEdit.init(function(){B=!0,O(),j.tableEdit.add()})},del:function(){var t=ft.isEmpty,e=j.subTable&&j.subTable.table;t(j.table.rowSelectDataGet())&&t(e&&e.rowSelectDataGet())||(O(!0),j.tableEdit.del())},save:function(){j.tableEdit.save(function(){return F()})},cancel:function(){j.tableEdit.cancel(),F()},edit:function(){j.tableEdit.init(function(){O(),B=!0})}},{init:function(t){!function(t){var e=j.para.tableAddr,n=vt(e);if(G=n.subVarList,(P=n.mainVarList)||G){j.tableEdit=new ct.TableEdit({tm:j,tableAddr:e,cols:j.para.cols}),j.tableEdit.onFocusChange(function(t){W[B?"start":"end"](t)}),bt.once(j.wrapper,"subTableInit",function(){j.tableEdit.subTm=j.subTable}),H=[{content:"编辑",subType:"edit"},{content:"新增",subType:"insert"},{content:"删除",subType:"del"},{content:"保存",subType:"save"},{content:"取消",subType:"cancel"}];var o=new st.InputBox({container:t});H.forEach(function(t){var e=new lt.Button({content:t.content,data:t});e.onClick=function(){var t=e.data.subType;z[t]&&z[t]()},o.addItem(e),I[t.subType]=e})}}(t),W.end(!0),ft.isMb||q.on()},edit:function(){return z.edit()},has:function(){var t=vt(j.para.tableAddr),e=t.mainVarList,n=t.subVarList;return e||n},btnStart:O=function(t){void 0===t&&(t=!1),W.start(!0,t),j.pagination.show(!1),ft.isMb||q.off(),B=!0},btnSave:function(){return z.save()}});var _=this,U=t.tableEl,V=this.para.dataAddr?ht.siteUrl+ut.BwRule.reqAddr(this.para.dataAddr):null,Y=n.subTableList;this.colsInit(),this.isSub=this.para.isSub,this.isDrill=-1<["web","webdrill","drill"].indexOf(this.para.uiType),Y&&Y[0]&&(Y[0].isSub=!0,this.subTableData=Y[0],this.subTableData.tableAddr=this.para.tableAddr),this.initWrapper(U),this.wrapper||(this.wrapper=U.parentElement),this.pageUrl=function(){if(ft.isMb)return location.href;var t=bt.closest(j.wrapper,".page-container[data-src]");return t?t.dataset.src:""}(),this.tableData=new dt.TableDataModule({tableModule:this,tableConf:t,para:n,pageUrl:this.pageUrl});var X=n.querier&&3===n.querier.queryType;if("P"===n.relateType)X?_.refresher=function(t,e){_.initPivotTable(U,n,t,e)}:_.initPivotTable(U,n,null);else{for(var Q=!1,K=0;K<this.cols.length;K++)if(this.cols[K].subcols){Q=!0;break}var J={table:U,cols:this.cols};if(Q&&(J.multi={enabled:!0,cols:this.getMulitPara.getMulitCols(this.cols,!1)},J.cols=this.getMulitPara.getColsIndex()),this.initTableModule(J,n,function(){_.onComplete()}),_.initTableEvent.init(_.table),_.para.isSub||_.aggregate.get(),_.refresher=function(t,e,n){j.tableData.innerRefresher(t,e,n)},V&&!X){var $=_.pagination.getParam(!0);"object"==typeof t.ajaxData&&($=ft.obj.merge($,t.ajaxData)),setTimeout(function(){j.tableData.innerRefresher($,j.tableData.cbFun.getOuterAfter(),j.tableData.cbFun.getOuterBefore())})}else if(_.para.data){var Z=_.para.data;this.tableData.dealData(Z,Z.length)}else this.tableData.dealData([],0)}if(X){var tt=ft.isMb?"QueryModuleMb":"QueryModulePc",et=bt.closest(this.wrapper,"div.modal-wrapper");1===n.querier.autTag&&et&&et.classList.add("hide"),nt([tt],function(t){j.queryModule=new t({qm:j.para.querier,refresher:function(t,e,n){j.refresher(t,e,n),et&&et.classList.remove("hide")},cols:j.cols,url:V,container:bt.closest(U,".page-container"),tableGet:function(){return _.table}}),ft.isMb&&bt.on(bt.query('body > header [data-action="showQuery"]'),"click",function(){j.queryModule.show()}),0===n.querier.autTag?j.queryModule.hide():et&&et.classList.add("hide")})}}return t.prototype.colsInit=function(){var t=this.para.cols;t.forEach(function(t){-1<ut.BwRule.NoShowFields.indexOf(t.name)&&(t.noShow=!0),t.dataType!==ut.BwRule.DT_DATETIME||t.displayFormat||(t.displayFormat="yyyy-MM-dd HH:mm:ss"),t.dataType!==ut.BwRule.DT_TIME||t.displayFormat||(t.displayFormat="HH:mm:ss")}),this.defaultData=ut.BwRule.getDefaultByFields(t),this.cols=t.filter(function(t){return!t.noShow})},t.prototype.initTableModule=function(t,e,n){this.table=this.initTable(this.tableConfGet({tmPara:e,btPara:t})),n()},t.prototype.tableConfGet=function(n){var u=this,f=this,t=n.tmPara,e=n.btPara,o={lockColNum:t.fixedNum,move:!1,indexCol:"number",indexColMulti:!("multiSelect"in t)||t.multiSelect,cols:e.cols||t.cols};"fixTop"in this.tableConf&&(o.lockRow=!0,o.lockRowTop=this.tableConf.fixTop);var a={sort:1===f.para.multPage?2:1,thead:!0,Container:this.tableConf.scrollEl,colMenu:[{multi:!0,title:"复制列",callback:function(t,e){pt&&pt.window.copy(u.table.copy.col(e[0].dataset.col,!0))}}],rowMenu:[{multi:!0,title:"复制行",callback:function(t,e){pt&&pt.window.copy(u.table.copy.selectedRow(!0))}}],textFormat:function(t,e,n){var o,a=t[e.name];if(e.dataType===ut.BwRule.DT_IMAGE&&e.link)o=f.imgHtmlGet(ft.url.addObj(ht.siteUrl+ut.BwRule.reqAddr(e.link,t),u.tableData.getQueryPara()));else if("STDCOLORVALUE"===e.name){var i=ft.val2RGB(a);o='<div style="background-color:rgb('+i.r+","+i.g+","+i.b+');height: 100%;"></div>'}else if("lookup"===e.elementType)for(var l=0,r=u.tableData.lookUpData[e.name]||[];l<r.length;l++){var s=r[l];s.value==a&&(o=s.text)}else o=ut.BwRule.formatTableText(a,e);var c=u.maxCellWidth,d="";(e.dataType?e.dataType===ut.BwRule.DT_HTML?d="html":e.dataType===ut.BwRule.DT_MULTI_TEXT&&(d="multiText"):d="string",d)&&((o=ft.str.toEmpty(o))!==(o=ft.str.cut(o.toString(),c))&&(o+=(ft.isMb?"　　":"")+'<div class="more-text-button detail-more"  data-text-type="'+d+'">...</div>'));return o},beforeShow:function(t,e){return f.dataFormat(n.tmPara,t,e)}};e.multi||a.colMenu.push({multi:!0,title:"锁定/解锁列",callback:function(t,e){u.table.colToggleLock(e[0].dataset.col)}});var s=f.para.pictureAddrList;Array.isArray(s)&&this.para.cols.some(function(t){return t.atrrs&&"20"==t.atrrs.dataType&&t.noShow})&&(a.rowMenu.push({multi:!1,title:"查看图片",callback:function(t,e){var n=u.table,o=n.trSelected[0];if(o){var a=parseInt(o.dataset.index),i=s.map(function(t){return ht.siteUrl+ut.BwRule.reqAddr(t,n.rowDataGet(a))});f.handleImg(i,a)}}}),a.rowMenu.push({multi:!0,title:"并列图片",callback:function(t,e){var a=[],i=[],l=u.table,n=l.trSelected,r=s&&s[0];n&&r&&(n.forEach(function(t){var e=parseInt(t.dataset.index),n=l.rowDataGet(e);a.push(ht.siteUrl+ut.BwRule.reqAddr(r,n));var o=n.PATTERN||"";i.push(o)}),c.ImgModal.show({img:a,isThumbnail:!0,textArr:i}))}}));var i=this.tableConf.tablePara?this.tableConf.tablePara:{};return Array.isArray(i.rowMenu)&&(a.rowMenu=a.rowMenu.concat(i.rowMenu),delete i.rowMenu),Array.isArray(i.colMenu)&&(a.colMenu=a.colMenu.concat(i.colMenu),delete i.colMenu),ft.obj.merge(a,i,o,e)},t.prototype.dataFormat=function(f,h,t){var p={tr:{},td:[]},e=f.pictureAddrList&&f.pictureAddrList[0];f.subTableList&&f.subTableList[0]&&(p.tr["data-sub-url"]=f.subTableList[0].dataAddr.dataAddr),["GRIDBACKCOLOR","GRIDFORECOLOR"].forEach(function(t,e){var n=h[t];if(n){var o=ft.val2RGB(n),a=o.r,i=o.g,l=o.b;p.tr.style=(0===e?"background-color":"color")+":rgb("+a+","+i+","+l+");",1===e&&(p.tr.class="tr-color")}}),e&&!this.cols.some(function(t){return ut.BwRule.DT_IMAGE===t.atrrs.dataType})&&(p.tr["data-click-type"]="img");var n=this.para.subButtons,b=Array.isArray(n)?n.map(function(t){return t.linkName}):[];return t.forEach(function(e,t){h[e.name]&&ut.BwRule.isTime(e.dataType)&&(h[e.name]=ut.BwRule.strDateFormat(h[e.name],e.displayFormat));var n=[],o=h[e.name],a={},i=e.dataType===ut.BwRule.DT_IMAGE;if("number"==typeof o&&n.push("text-right"),i?n.push("td-img"):e.dataType===ut.BwRule.DT_MULTI_TEXT&&n.push("td-multi-text"),e.drillAddr&&e.drillAddr.dataAddr){var l=ut.BwRule.drillAddr(e.drillAddr,h,f.keyField);l&&(a["data-href"]=l,a["data-gps"]=e.drillAddr.needGps,n.push("blue"))}if(e.webDrillAddr&&e.webDrillAddr.dataAddr){var r=ut.BwRule.webDrillAddr(e.webDrillAddr,h,f.keyField);r&&(a["data-href"]=r,a["data-gps"]=e.webDrillAddr.needGps,n.push("blue"))}if(e.webDrillAddrWithNull&&e.webDrillAddrWithNull.dataAddr){var s=ut.BwRule.webDrillAddrWithNull(e.webDrillAddrWithNull,h,f.keyField);s&&(a["data-href"]=s,a["data-gps"]=e.webDrillAddrWithNull.needGps,n.push("blue"))}if(e.link&&!i&&(!e.endField||1===h[e.endField])){var c=ut.BwRule.reqAddrFull(e.link,h),d=c.addr,u=c.data;if(!ft.isEmpty(u))switch(a["data-href"]=ft.url.addObj(d,u),a["data-gps"]=e.link.needGps,n.push("blue"),e.link.type){case"file":a["data-href-type"]="file"}}b.some(function(t){return t===e.name})&&(a["data-click-type"]="btn",n.push("blue")),n[0]&&(a.class=n.join(" ")),p.td.push(a)}),p},t.prototype.lockBottom=function(t){if(void 0===t&&(t=!1),!ft.isMb){var e=this.tableConf.scrollEl;0!==e.getBoundingClientRect().width&&(!t&&e&&(e.scrollTop=0),this.onLoad.getscrollBar()&&this.onLoad.getBottomPaging()?this.onLoad.getscrollBar().updateStyle():this.onLoad.init()),this.subTable&&this.subTable.lockBottom(t)}},t.prototype.initPivotTable=function(c,d,t,u){var f=this;void 0===t&&(t={});var p=c.classList.contains("mobileTable");null!==this.localSearch.getOriginMultPage()&&(this.para.multPage=this.localSearch.getOriginMultPage()),this.tableData.ajax(t,function(t){if(u&&u(t),t){for(var e=t.data,n=ut.BwRule.getCrossTableCols(t.meta,d.cols),o=[],a=[],i=0;i<n.cols.length;i++){var l=n.cols[i];-1<l.title.indexOf(".")&&-1<l.name.indexOf("小计")||-1===l.title.indexOf(".")?o.push(n.cols[i]):a.push(n.cols[i])}n.cols=o.concat(a),d.fixedNum=2<=n.lockNum?2:n.lockNum,c.classList.add("min-width");var r={table:c,multi:{enabled:!0,cols:f.getMulitPara.getMulitCols(n.cols,!0)},cols:f.getMulitPara.getColsIndex()};f.initTableModule(r,d,function(){p&&f.onComplete(),f.initTableEvent.init(f.table)}),f.tableData.dealTable(e,!0);var s=t.head.totalNum?t.head.totalNum:t.data.length;0!==f.para.multPage&&s>f.pagination.pageLen&&f.pagination.reset({offset:0,recordTotal:s}),f.lockBottom(),f.refresher=function(t,e,n){f.table.destroy();var o=h("table",null);f.wrapper.appendChild(o),f.initPivotTable(o,d,t,e)},f.localSearch.setOriginMultPage(f.para.multPage),f.localSearch.setOriginData(f.table.data.get())}})},t.prototype.autoSubTable=function(){if(!this.para.isSub&&this.subTableData){var t=bt.query("table tbody tr",this.table.wrapperGet());t?(t.click(),this.subTable&&this.subTable.wrapper.classList.remove("hide")):this.subTable&&this.subTable.wrapper.classList.add("hide")}},t.prototype.initSubBtns=function(t){var i=this,o=this.table,e=i.para.subButtons;i.subBtn=new st.InputBox({container:t,isResponsive:!ft.isMb}),e&&e[0]&&e.forEach(function(t){var n=new lt.Button({icon:t.icon,content:t.title,isDisabled:!(0===t.multiselect||2===t.multiselect&&t.selectionFlag),data:t});n.onClick=function(){var t=n.data,e=2===t.multiselect&&t.selectionFlag?o.rowUnselectDataGet():o.rowSelectDataGet();a.ButtonAction.get().clickHandle(n.data,1===n.data.multiselect?e[0]:e,function(t){},i.pageUrl)},i.subBtn.addItem(n)}),i.table.on("rowSelect",function(){var o=i.table.rowSelectDataGet().length,a=i.table.rowGetAll().length;i.subBtn.children.forEach(function(t){var e=t.data.selectionFlag,n=e?a-o:o;t.isDisabled=0===n?!e&&0<t.data.multiselect:1!==o&&2!==t.data.multiselect})})},t.prototype.handleImg=function(t,e){var n=this;if(!this.tableImgEdit){var o=[],a="";this.para.cols.forEach(function(t){"20"===t.atrrs.dataType&&(t.noShow?o.push(t):a=t.name)});var i=vt(this.para.tableAddr).mainVarList,l=o.map(function(t){return t.name}),r=i&&i[i.deleteType]||[],s=i&&i[i.updateType]||[];this.tableImgEdit=new u.TableImgEdit({thumbField:a,fields:o,deletable:r.some(function(t){return l.includes(t.varName)}),updatable:s.some(function(t){return l.includes(t.varName)}),onUploaded:function(t){n.editBtns.btnStart(!0),n.tableEdit.rowData(e,t)},onSave:function(){n.editBtns&&n.editBtns.btnSave()}})}this.tableImgEdit.isShow=!0;var c=this.tableEdit?this.tableEdit.rowData(e):{},d=[];this.tableImgEdit.fields.forEach(function(t){d.push(c[t.name])}),this.tableImgEdit.showImg(t.map(function(t){return ft.url.addObj(t,n.tableData.getQueryPara())}),d)},t.prototype.destroy=function(){bt.remove(this.table.wrapperGet()),this.table.destroy(),this.table=null,bt.remove(this.wrapper),this.subTable&&(this.subTable.table.destroy(),bt.remove(this.subTable.table.wrapperGet()),bt.remove(this.subTable.wrapper),this.subTable=null,this.subTableData=null,this.para=null,this.tableEdit=null,this.table=null)},t.prototype.getKeyField=function(){return this.para.keyField},t.prototype.getDefAddr=function(){return this.para.defDataAddrList},t.prototype.export=function(o){var a=this;nt(["tableExport"],function(t){var e=a.tableConf.tableEl,n=e.style.backgroundColor;e.style.backgroundColor="#fff",t(e,a.para.caption,o),e.style.backgroundColor=n})},t}();function mt(t,e){if(t)for(var n=0,o=["update","insert","delete"];n<o.length;n++){var a=o[n];if(-1<e.indexOf(t[a+"Type"]))return!0}return!1}function vt(t){var e={mainVarList:null,subVarList:null};return t&&Array.isArray(t.param)&&t.param.forEach(function(t){"sub"===t.type?e.subVarList=t:"main"===t.type&&(e.mainVarList=t)}),e}t.TableModule=e}),define("TableDataModule",["require","exports","Loading","Spinner","BwRule"],function(t,e,c,i,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=BW.CONF,u=G.tools,n=function(){function t(t){var e,n;this.modulePara=t,this.ajaxAfterHandlers=[],this.ajaxBeforeHandlers=[],this._lookUpData={},this.cbFun=(n=e=null,{setOuterAfter:function(t){e=t},getOuterAfter:function(){return e},setOuterBefore:function(t){n=t},getOuterBefore:function(){return n}}),this.ajaxUrl=this.modulePara.para.dataAddr?o.siteUrl+d.BwRule.reqAddr(this.modulePara.para.dataAddr):null,this.queryPara={},this.isQuery=this.modulePara.para.querier&&3===this.modulePara.para.querier.queryType}return t.prototype.ajaxAfterAdd=function(t){this.ajaxAfterHandlers.push(t)},t.prototype.ajaxAfterRemove=function(t){this.ajaxAfterHandlers.indexOf(t)},t.prototype.ajaxBeforeAdd=function(t){this.ajaxBeforeHandlers.push(t)},t.prototype.ajaxBeforeRemove=function(t){this.ajaxBeforeHandlers.indexOf(t)},Object.defineProperty(t.prototype,"lookUpData",{get:function(){return this._lookUpData||{}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lookup",{get:function(){var n=this;if(u.isEmpty(this._lookUpData)){var t=this.modulePara.para.cols.filter(function(t){return"lookup"===t.elementType}).map(function(e){return d.BwRule.getLookUpOpts(e).then(function(t){n._lookUpData=n._lookUpData||{},n._lookUpData[e.name]=t})});return Promise.all(t).then(function(){})}return Promise.resolve()},enumerable:!0,configurable:!0}),t.prototype.ajax=function(t,i,e){var l=this;void 0===e&&(e=!1);var n=!1,o=null,r=function(){n=!0,o&&o.destroy(),l.modulePara.tableModule.wrapper.classList.remove("disabled")};if(setTimeout(function(){n||l.modulePara.tableModule.wrapper.classList.add("disabled")},0),t){var a;this.queryPara=t,a=u.obj.merge(this.queryPara,this.modulePara.tableModule.pagination.getParam()),t=u.obj.merge(t,a)}else t=u.obj.merge(this.queryPara,this.modulePara.tableModule.pagination.getParam());if(1===this.modulePara.para.multPage&&(t=u.obj.merge(t,this.modulePara.tableModule.initTableEvent.getPageSortParams())),!0===this.modulePara.para.isAsyn){var s=this.modulePara.pageUrl;t.uiurl=s.substring(function(t,e,n){for(var o=t.indexOf(e),a=0;a<n;a++)o=t.indexOf(e,o+1);return o}(s,"/",5),s.length)}(this.isQuery||!t||t.pagesortparams)&&(u.isMb&&!e||(o=new c.Loading({msg:"加载中..."}))),this.lookup.then(function(){d.BwRule.Ajax.fetch(l.ajaxUrl,{timeout:3e4,data:t,needGps:l.modulePara.para.dataAddr.needGps}).then(function(t){var e=t.response;if(r(),e.data){var o,n=l.modulePara.para.tableAddr;if(n&&Array.isArray(n.param)&&n.param.forEach(function(t){t&&t.itemId===l.modulePara.para.itemId&&(o=t)}),o){var a=[];["insert","update","delete"].forEach(function(t){var e=-1<["update","delete"].indexOf(o[t+"Type"]),n=o[t];e&&Array.isArray(n)&&(a=a.concat(n))}),d.BwRule.addOldField(d.BwRule.getOldField(a),e.data)}}i(e)}).catch(function(t){}).finally(function(){r(),i()})}).catch(function(t){})},t.prototype.refresh=function(t,e,n){var o=this,a=this.modulePara.tableModule;t&&(this.queryPara=t),this.ajax(t,function(t){t&&("function"==typeof n&&n(t),o.dealTable(t.data,!0),a.pagination.isShow(t),a.autoSubTable(),a.localSearch.setOriginData(a.table.data.get()),a.localSearch.queryDataGet()&&a.localSearch.search(),"function"==typeof e&&e(t))},!0)},t.prototype.dealTable=function(t,e){var n=this.modulePara.tableModule,o=n.pagination.getCurrentState();e?n.table.data.set(t):n.table.data.add(t),0===this.modulePara.para.multPage&&n.table.render(0,t.length),1===this.modulePara.para.multPage&&n.table.render(e?0:o.offset,e?o.size:o.offset+o.size,e),2===this.modulePara.para.multPage&&n.table.render(0,50),u.event.fire("table-module-render",null,n.wrapper)},t.prototype.getQueryPara=function(){return this.queryPara},t.prototype.setNewData=function(t,e){void 0===e&&(e=!0);var n=this.modulePara.tableModule;this.modulePara.para.multPage=2,this.dealTable(t,e);var o=n.table.data.get().length,a=o||t.length;0!==this.modulePara.para.multPage&&a>n.pagination.pageLen&&n.pagination.reset({offset:0,recordTotal:a}),n.pagination.isShow(t),n.lockBottom()},t.prototype.innerRefresher=function(t,n,e){var o=this,a=this.modulePara.tableModule,l=new i.Spinner({el:this.modulePara.tableConf.tableEl,type:i.Spinner.SHOW_TYPE.append,className:"text-center padding-30"});null!==a.localSearch.getOriginMultPage()&&(this.modulePara.para.multPage=a.localSearch.getOriginMultPage()),a.pagination.setParam(1),!this.isQuery&&l.show(),this.refresh(t,function(t){var e=t.head.totalNum?t.head.totalNum:t.data.length;0!==o.modulePara.para.multPage&&e>a.pagination.pageLen&&a.pagination.reset({offset:0,recordTotal:e});var i=t.meta;Array.isArray(i)&&i[0]&&a.subBtn&&a.subBtn.children&&a.subBtn.children.forEach(function(t){if(Array.isArray(t.data.actionAddr&&t.data.actionAddr.varList))for(var e=0,n=t.data.actionAddr.varList;e<n.length;e++){var o=n[e],a=o.varName.replace(/^OLD_/,"");0!==t.data.multiselect&&u.isEmpty(o.varValue)&&(t.isShow=-1!==i.indexOf(a))}}),"function"==typeof n&&n(t),setTimeout(function(){a.lockBottom(),a.localSearch.setOriginData(a.table.data.get()),a.localSearch.setOriginMultPage(o.modulePara.para.multPage),!o.isQuery&&l.hide()},0)},e)},t.prototype.dealData=function(t,e){var n=this,o=this.modulePara.tableModule;0!==this.modulePara.para.multPage&&e>o.pagination.pageLen&&o.pagination.reset({offset:0,recordTotal:e}),this.dealTable(t,!u.isMb),o.autoSubTable(),setTimeout(function(){o.lockBottom(),o.localSearch.setOriginData(o.table.data.get()),o.localSearch.setOriginMultPage(n.modulePara.para.multPage)},0)},t}();e.TableDataModule=n});