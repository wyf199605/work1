define("StatisticBasic",["require","exports","BwRule","SelectBox","statistic","Modal","Button","InputBox","StatisticBase"],function(t,e,m,s,v,i,l,o,a){"use strict";var n,c=G.d,d=BW.sys;return(n=function(a){function r(t){var e=a.call(this)||this;return e.para=t,e.modal=null,e.coms={},e.statisticsContent=[],e.statisticsField=[],e.statisticsRange=[],e.groupingField=[],e.initModal(),e.getSelectData(),e.replaceDataName(),e}return __extends(r,a),r.prototype.getModal=function(){return this.modal},r.prototype.getSelectData=function(){var t,e=[],a=[],s=this.para.getVisibleCol();for(t=0;t<this.para.cols.length;t++)m.BwRule.isNumber(this.para.cols[t].dataType)&&-1<s.indexOf(this.para.cols[t].name)&&e.push({value:this.para.cols[t].name,text:this.para.cols[t].title});for(t=0;t<this.para.cols.length;t++)-1<s.indexOf(this.para.cols[t].name)&&a.push({value:this.para.cols[t].name,text:this.para.cols[t].title});this.groupingField=a,this.statisticsField=e,this.statisticsContent=[{value:"sum",text:"合计值"},{value:"avg",text:"平均值"},{value:"max",text:"最大值"},{value:"min",text:"最小值"},{value:"stDev",text:"标准差"},{value:"nullCount",text:"空值数"},{value:"percent",text:"百分比"},{value:"groupPercent",text:"组内百分比"}],this.statisticsRange=[{value:"0",text:"全部数据"},{value:"1",text:"选定数据"}]},r.prototype.initDataName=function(t,e){var l=this;switch(t){case"statisticsContent":this.coms.statisticsContent=new s.SelectBox({container:e,select:{multi:!0,callback:function(t){var a=l.coms.statisticsContent;6===t&&(a.unSet([7]),!function(t){for(var e=0;e<a.get().length;e++)if(a.get()[e]===t)return!0;return!1}(6)?a.setDisabled([7]):a.unsetDisabled([7]))}},data:this.statisticsContent});break;case"statisticsField":0<this.statisticsField.length?this.coms.statisticsField=new s.SelectBox({container:e,select:{multi:!0},data:this.statisticsField}):e.innerHTML="无可统计的字段";break;case"statisticsRange":this.coms.statisticsRange=new s.SelectBox({container:e,select:{multi:!1},data:this.statisticsRange});break;case"groupingField":0<this.statisticsField.length?this.coms.groupingField=new s.SelectBox({container:e,select:{multi:!1,isRadioNotchecked:!0,callback:function(e){function t(){for(var t=0;t<l.statisticsField.length;t++)if(l.statisticsField[t].value===l.groupingField[e].value)return t}var a=l.coms.statisticsField,s=l.coms.statisticsContent,i=l.coms.groupingField;0<=l.lastIndex&&a.unsetDisabled([l.lastIndex]),0<=t()&&(a.unSet([t()]),a.setDisabled([t()]),l.lastIndex=t()),s.unSet([1,2,3,4,5]),0<i.get().length?(s.setDisabled([1,2,3,4,5]),s.unsetDisabled([6])):(s.unSet([1,2,3,4,5,6,7]),s.unsetDisabled([1,2,3,4,5]),s.setDisabled([6]),0<=l.lastIndex&&a.unsetDisabled([l.lastIndex]))}},data:this.groupingField}):e.innerHTML="无可统计的字段"}},r.prototype.initModal=function(){var t,e,n=this,a=function(){if(0===n.statisticsField.length)return!1;var t,e=[],a=0,s=[],i=n.coms.statisticsContent.get(),l=n.coms.statisticsField.get(),o="";for(a=0;a<i.length;a++)7===i[a]&&i.splice(a,1);for(0<n.coms.groupingField.get().length&&(o=n.groupingField[n.coms.groupingField.get()[0]].value),a=0;a<i.length;a++)e.push({title:r.mathMethodCn[n.statisticsContent[i[a]].value],method:v.Statistic.math[n.statisticsContent[i[a]].value]});for(a=0;a<l.length;a++)s.push(n.statisticsField[n.coms.statisticsField.get()[a]].value);return t=n.colStatistic(s,e,o),n.tableRender(t,n.para.container),!1};d.isMb?(this.modal=new i.Modal({header:"统计",position:"full",isOnceDestroy:!0}),this.modal.modalHeader.rightPanel=(t=new o.InputBox,e=new l.Button({key:"okBtn",content:"确认",type:"primary",onClick:a}),t.addItem(e),t),this.modal.bodyWrapper.setAttribute("style","height:calc(100vh - 44px);"),this.modal.bodyWrapper.parentElement.classList.add("statistic")):this.modal=new i.Modal({header:"统计",className:"statistic",width:"560px",container:this.para.container,isBackground:!1,footer:{},isOnceDestroy:!0}),this.modal.onOk=a},r.prototype.replaceDataName=function(){var e=this;this.body=this.modal.bodyWrapper;var t=r.getDom();this.body.innerHTML=t,c.queryAll("[data-name]",this.body).forEach(function(t){e.initDataName(t.dataset.name,t)}),this.coms.statisticsContent.setDisabled([6,7])},r.prototype.colName2index=function(t){for(var e=0;e<this.para.cols.length;e++)if(this.para.cols[e].name===t)return e},r.prototype.colStatistic=function(i,l,e){var a,s,o=this,n=i.map(function(t){return o.para.cols[o.colName2index(t)]}),r=i.map(function(t){return o.para.colDataGet(t)}),c={},t={cols:null,data:null};if(e){var d=o.para.cols[o.colName2index(e)];o.para.colDataGet(e).forEach(function(t,a){var s=i.map(function(t,e){return r[e][a]});t in c||(c[t]=[]),c[t][0]?c[t].forEach(function(t,e){t.push(s[e])}):c[t]=s.map(function(t){return[t]})});var h=[],u=function(t){var e=0;c[t].map(function(t){h[e]||(h[e]=0),h[e]=h[e]+v.Statistic.math.sum(t),e++})};for(var p in c)u(p);var f=function(t){if(!c.hasOwnProperty(t))return"continue";var a=-1;c[t]=c[t].map(function(e){return l.map(function(t){return"百分比"!==t.title?t.method(e):(a++,v.Statistic.math.percent(e,h[a]))})})};for(var p in c)f(p);t.cols=[d].concat((s=[],n.forEach(function(a){l.forEach(function(t){var e=G.tools.obj.copy(a);e.title=e.title+t.title,e.name=e.name+t.title,e.name.match("百分比")&&(e.dataType=m.BwRule.DT_PERCENT),s.push(e)})}),s)),t.data=(a=[],Object.keys(c).forEach(function(t){var i={};i[e]=t,c[t].forEach(function(a,s){l.forEach(function(t,e){i[n[s].name+t.title]=a[e]})}),a.push(i)}),a)}else t.cols=[{title:"统计",name:"_method"}].concat(n),t.data=l.map(function(a){var s={_method:a.title};return r.forEach(function(t,e){s[i[e]]=a.method(t.slice(0))}),s});return t},r.getDom=function(){return'<div class="row"><div class="col-xs-5"><fieldset class="col-xs-12"><legend>内容</legend><div class="statisticsContent"><div data-name="statisticsContent"></div></div></fieldset><fieldset class="col-xs-12"><legend>范围</legend><div class="statisticsRange"><div data-name="statisticsRange"></div></div></fieldset></div><fieldset class="col-xs-3"><legend>统计字段</legend><div class="statisticsField"><div data-name="statisticsField"></div></div></fieldset><fieldset class="col-xs-3 groupingField_grouping"><legend>分组字段</legend><div class="groupingField"><div data-name="groupingField"></div></div></fieldset></div>'},r}(a.StatisticBase)).mathMethodCn={sum:"合计值",avg:"平均值",max:"最大值",min:"最小值",stDev:"标准差",nullCount:"空值数",percent:"百分比",groupPercent:"组内百分比"},n}),define("CrossTabBasic",["require","exports","Button","Modal","BwRule","SelectBox","statistic","InputBox","StatisticBase"],function(t,e,i,c,l,o,d,n,a){"use strict";var r=G.d,h=BW.sys;return function(a){function s(t){var e=a.call(this)||this;return e.conf=t,e.modal=null,e.coms={},e.statisticRow=[],e.statisticCol=[],e.statisticVal=[],e.initModal(),e.getSelectData(),e.replaceDataName(),e}return __extends(s,a),s.prototype.getModal=function(){return this.modal},s.prototype.getSelectData=function(){var t,e=[],a=[],s=this.conf.getVisibleCol();for(t=0;t<this.conf.cols.length;t++)l.BwRule.isNumber(this.conf.cols[t].dataType)&&-1<s.indexOf(this.conf.cols[t].name)&&a.push({value:this.conf.cols[t].name,text:this.conf.cols[t].title});for(t=0;t<this.conf.cols.length;t++)-1<s.indexOf(this.conf.cols[t].name)&&e.push({value:this.conf.cols[t].name,text:this.conf.cols[t].title});this.statisticRow=e,this.statisticCol=e,this.statisticVal=a},s.prototype.initDataName=function(t,e){var a=this;switch(t){case"row":this.coms.row=new o.SelectBox({container:e,select:{multi:!0,callback:function(t){a.cancleSame("row",t)}},data:this.statisticRow});break;case"col":this.coms.col=new o.SelectBox({container:e,select:{multi:!0,callback:function(t){a.cancleSame("col",t)}},data:this.statisticCol});break;case"val":this.coms.val=new o.SelectBox({container:e,select:{multi:!0,callback:function(t){a.cancleSame("val",t)}},data:this.statisticVal});break;case"statistic_select":this.coms.statistic_select=new o.SelectBox({container:e,select:{multi:!1,callback:function(t){}},data:[{value:0,text:"基于全部数据"},{value:1,text:"基于选定数据"}]});break;case"statistic_sum":this.coms.statistic_sum=new o.SelectBox({container:e,select:{multi:!0,callback:function(t){}},data:[{value:0,text:"生成合计值"}]})}},s.prototype.initModal=function(){var t,e,r=this,a=new n.InputBox,s=(new i.Button({key:"savaBtn",content:"设为默认值",type:"primary",onClick:function(){r.modal.isShow=!1}}),function(){var t,e,a=r.coms.row,s=r.coms.col,i=r.coms.val,l=[],o=[],n=[];if(0===a.get().length||0===s.get().length||0===i.get().length)return c.Modal.alert("行,列,值不允许为空"),!1;for(t=0;t<a.get().length;t++)l.push(r.statisticRow[a.get()[t]].value);for(t=0;t<s.get().length;t++)o.push(r.statisticCol[s.get()[t]].value);for(t=0;t<i.get().length;t++)n.push(r.statisticVal[i.get()[t]].value);if(1!==r.coms.statistic_select.get()[0]||0!==r.conf.selectedData().length)return e=(new d.Statistic).crossTab({row:l,col:o,val:n,cols:r.conf.cols,data:0===r.coms.statistic_select.get()[0]?r.conf.allData():r.conf.selectedData()}),r.tableRender(e,r.conf.container,!0),!1;c.Modal.alert("数据为空，无法统计")});h.isMb?(this.modal=new c.Modal({position:"full",isOnceDestroy:!0,header:"交叉制表"}),this.modal.modalHeader.rightPanel=(t=new n.InputBox,e=new i.Button({key:"okBtn",content:"确认",type:"primary",onClick:s}),t.addItem(e),t),this.modal.bodyWrapper.setAttribute("style","height:calc(100vh - 44px);"),this.modal.bodyWrapper.parentElement.classList.add("crossTab")):this.modal=new c.Modal({className:"crossTab",width:"560px",container:this.conf.container,header:"交叉制表",isBackground:!1,footer:{leftPanel:a},isOnceDestroy:!0}),this.modal.onOk=s},s.prototype.replaceDataName=function(){var e=this;this.body=this.modal.bodyWrapper;var t=s.getDom();this.body.innerHTML=t,r.queryAll("[data-name]",this.body).forEach(function(t){e.initDataName(t.dataset.name,t)})},s.prototype.cancleSame=function(t,e){var a,s=this.coms.row,i=this.coms.col,l=this.coms.val,o=G.tools.obj.merge(!0,[],s.get()),n=G.tools.obj.merge(!0,[],i.get()),r=G.tools.obj.merge(!0,[],l.get());if(o=G.tools.obj.toArr(o),n=G.tools.obj.toArr(n),r=G.tools.obj.toArr(r),"row"===t){for(i.set([]),l.set([]),a=0;a<n.length;a++)this.statisticRow[e].value===this.statisticCol[n[a]].value&&n.splice(a,1);for(a=0;a<r.length;a++)this.statisticRow[e].value===this.statisticVal[r[a]].value&&r.splice(a,1);i.set(n),l.set(r)}else if("col"===t){for(s.set([]),l.set([]),a=0;a<o.length;a++)this.statisticCol[e].value===this.statisticRow[o[a]].value&&o.splice(a,1);for(a=0;a<r.length;a++)this.statisticCol[e].value===this.statisticVal[r[a]].value&&r.splice(a,1);s.set(o),l.set(r)}else{for(s.set([]),i.set([]),a=0;a<o.length;a++)this.statisticVal[e].value===this.statisticRow[o[a]].value&&o.splice(a,1);for(a=0;a<n.length;a++)this.statisticVal[e].value===this.statisticCol[n[a]].value&&n.splice(a,1);s.set(o),i.set(n)}},s.getDom=function(){return'<div class="row"><div class="col-xs-4"><fieldset class="col-xs-12"><legend>行</legend><div class="statistic_row"><div data-name="row"></div></div></legend></fieldset></div><div class="col-xs-4"><fieldset class="col-xs-12"><legend>列</legend><div class="statistic_col"><div data-name="col"></div></div></legend></fieldset></div><div class="col-xs-4"><fieldset class="col-xs-12"><legend>值</legend><div class="statistic_val"><div data-name="val"></div></div></legend></fieldset></div></div><div class="row"><div class="col-xs-8"><div data-name="statistic_select" class="statistic_select"></div></div><div class="col-xs-4"><div data-name="statistic_sum" class="statistic_sum"></div></div></div>'},s}(a.StatisticBase)}),define("AnalysisBasic",["require","exports","SelectBox","statistic","TextInput","BwRule","Modal","Button","InputBox","StatisticBase"],function(t,e,s,r,i,l,c,d,h,a){"use strict";var o=G.d,u=G.tools;return function(a){function n(t){var e=a.call(this)||this;return e.conf=t,e.modal=null,e.coms={},e.statisticClassify=[],e.statisticValue=[],e.initModal(),e.getSelectData(),e.replaceDataName(),e}return __extends(n,a),n.prototype.getModal=function(){return this.modal},n.prototype.getSelectData=function(){var t,e=[],a=[],s=this.conf.getVisibleCol();for(t=0;t<this.conf.cols.length;t++)l.BwRule.isNumber(this.conf.cols[t].dataType)&&-1<s.indexOf(this.conf.cols[t].name)&&a.push({value:this.conf.cols[t].name,text:this.conf.cols[t].title});for(t=0;t<this.conf.cols.length;t++)-1<s.indexOf(this.conf.cols[t].name)&&e.push({value:this.conf.cols[t].name,text:this.conf.cols[t].title});this.statisticClassify=e,this.statisticValue=a},n.prototype.initModal=function(){var t=this,s=this,e=new h.InputBox,a=new d.Button({content:"设为默认值",key:"savaBtn",type:"primary",onClick:function(){t.modal.isShow=!1}});e.addItem(a);var i,l,o=function(){s.coms.proport;var t,e,a=s.coms.statistic_select;s.coms.statistic_showClass;return(e=s.getUserInput())&&1===a.get()[0]&&(e.data=s.conf.selectedData()),s.checkIsOk(e)&&(t=(new r.Statistic).abc(e),s.tableRender(t,s.conf.container)),!1};u.isMb?(this.modal=new c.Modal({position:"full",isOnceDestroy:!0,body:G.d.create("<div>"+n.getDom()+"</div>"),header:"abc分析"}),this.modal.modalHeader.rightPanel=(i=new h.InputBox,l=new d.Button({key:"okBtn",content:"确认",type:"primary",onClick:o}),i.addItem(l),i),this.modal.bodyWrapper.setAttribute("style","height:calc(100vh - 44px);"),this.modal.bodyWrapper.parentElement.classList.add("analysis")):this.modal=new c.Modal({className:"analysis",container:this.conf.container,header:"ABC分析",body:G.d.create("<div>"+n.getDom()+"</div>"),isBackground:!1,footer:{leftPanel:e},isOnceDestroy:!0}),this.modal.onOk=o},n.prototype.initDataName=function(t,e){switch(t){case"classify":this.coms.classify=new s.SelectBox({container:e,select:{multi:!1,callback:function(t){}},data:this.statisticClassify});break;case"value":this.coms.value=new s.SelectBox({container:e,select:{multi:!1,callback:function(t){}},data:this.statisticValue});break;case"proport":this.coms.proport=new s.SelectBox({container:e,select:{multi:!1,callback:function(t){}},data:[{value:0,text:"自动查找"},{value:1,text:"手工设置"}]});break;case"aClass":this.coms.aClass=new i.TextInput({container:e});break;case"bClass":this.coms.bClass=new i.TextInput({container:e});break;case"statistic_select":this.coms.statistic_select=new s.SelectBox({container:e,select:{multi:!1,callback:function(t){}},data:[{value:0,text:"基于全部数据"},{value:1,text:"基于选定数据"}]})}},n.prototype.checkIsOk=function(t){void 0===t&&(t={});var e=this.coms.aClass,a=this.coms.bClass;return isNaN(parseInt(e.get()))?(c.Modal.alert("A类不允许为空或字符串"),!1):99<parseInt(e.get())||parseInt(e.get())<0?(c.Modal.alert("A类输入范围为0-99"),!1):isNaN(parseInt(a.get()))?(c.Modal.alert("B类不允许为空或字符串"),!1):99<parseInt(a.get())||parseInt(a.get())<0?(c.Modal.alert("B类输入范围为0-99"),!1):parseInt(a.get())<parseInt(e.get())?(c.Modal.alert("B类范围不可小于A类"),!1):0===t.data.length?(c.Modal.alert("数据为空，无法统计"),!1):!(t.a>t.b)||(c.Modal.alert("A类不可高于B类"),!1)},n.prototype.replaceDataName=function(){var e=this;this.body=this.modal.bodyWrapper;var t=this;o.queryAll("[data-name]",this.body).forEach(function(t){e.initDataName(t.dataset.name,t)});var a=this.coms.aClass,s=this.coms.bClass,i=a.wrapper.firstChild,l=s.wrapper.firstChild;i.value="65",l.value="85",a.on("blur",function(){""!==a.get()&&(o.query(".bFirst",t.body).innerText=a.get())}),s.on("blur",function(){""!==s.get()&&(o.query(".cFirst",t.body).innerText=s.get())})},n.prototype.getUserInput=function(){var t=this.coms.classify,e=this.coms.value,a=this.coms.bClass,s=this.coms.aClass;return!!(0<e.get().length&&s.get()&&a.get())&&{classify:this.statisticClassify[t.get()[0]].value,val:this.statisticValue[e.get()[0]].value,a:parseInt(s.get()),b:parseInt(a.get()),cols:this.conf.cols,data:this.conf.allData()}},n.getDom=function(){return'<div class="row"><div class="col-xs-4"><fieldset class="col-xs-12"><legend>分类</legend><div class="statistic_classify"><div data-name="classify"></div></div></legend></fieldset></div><div class="col-xs-4"><fieldset class="col-xs-12"><legend>值</legend><div class="statistic_value"><div data-name="value"></div></div></legend></fieldset></div><div class="col-xs-4"><fieldset class="col-xs-12"><legend>占比段</legend><div class="statistic_proport"><div data-name="proport"></div><div class = "aClass" data-name="aClass"><span>A类:<span>0%-</span></span></div><div class = "bClass" data-name="bClass"><span>B类:<span><span class="bFirst">65</span>%-</span></span></div><div class = "cClass"><span>C类:<span><span class="cFirst">85</span>%-100%</span></span></div></div></legend></fieldset></div></div><div class="row"><div class="col-xs-8"><div data-name="statistic_select" class="statistic_select"></div></div></div>'},n}(a.StatisticBase)}),define("ChartBasic",["require","exports","echarts","Modal","SelectBox","SelectInput","Echart","Button","InputBox","BwRule"],function(p,t,l,f,i,o,m,a,s,v){"use strict";var e,g=G.tools,y=G.d,b=G.d,x=BW.sys,d=BW.CONF;return(e=function(){function u(t){var h,s;this.para=t,this.coms={},this.chartType=[],this.chartRow=[],this.chartCol=[],this.isPie=!1,this.isLarge=!0,this.hasLinkCol={},this.getCols=function(t){for(var e=this.para.cols,a=0,s=e.length;a<s;a++)if(e[a].title===t)return e[a]},this.generateChartOption=(h=this,(s=[])[0]=function(t){var e,a=[],s=-1,i=[],l=[],o=x.isMb?8:12;for(var n in t.ySeries)if(!g.isEmpty(t.ySeries[n])){for(var r in s++,t.ySeries[n])a.push({name:r,type:"line",yAxisIndex:s,symbolSize:12,data:t.ySeries[n][r]});i.push({name:u.yType[n],type:"时间"===u.yType[n]?"time":"value",axisLabel:{fontSize:o}})}(e=new m.Echart).legend=x.isMb?{type:"scroll",bottom:"0px",left:0,data:t.legend}:{type:"scroll",orient:"vertical",right:"3%",top:20,bottom:0,data:t.legend},e.xAxis={type:"category",boundaryGap:!1,data:t.xData,triggerEvent:!0};var c=-1<["web","webdrill","drill"].indexOf(h.para.getTablePara().uiType);(x.isMb&&!c||!x.isMb)&&(e.dataZoom=[{type:"inside",show:!0,xAxisIndex:[0]},{type:"inside",show:!0,yAxisIndex:[0]}]),x.isMb||(e.tooltip={trigger:"axis",show:!0,axisPointer:{type:"cross",crossStyle:{color:"#999"}},formatter:function(t){for(var e,a=t[0].name+"<br/>",s=0,i=t.length;s<i;s++)e=v.BwRule.formatText(t[s].value,h.getCols(t[s].seriesName),!1),a+=t[s].seriesName+"："+e+"<br/>";return a}}),e.yAxis=i,e.series=a;for(var d=0;d<t.legend.length;d++)l.push(u.getRandomCol());return e.color=l,e.getOption()},s[1]=function(t){var e,a=[],s=-1,i=[],l=[],o=x.isMb?8:12;for(var n in t.ySeries)if(!g.isEmpty(t.ySeries[n])){for(var r in s++,t.ySeries[n])a.push({name:r,type:"bar",yAxisIndex:s,data:t.ySeries[n][r]});i.push({name:u.yType[n],type:"时间"===u.yType[n]?"time":"value",axisLabel:{fontSize:o}})}(e=new m.Echart).legend=x.isMb?{type:"scroll",bottom:"0px",left:0,data:t.legend}:{type:"scroll",orient:"vertical",right:"3%",top:20,bottom:0,data:t.legend},e.xAxis={type:"category",data:t.xData,triggerEvent:!0,axisPointer:{type:"shadow"}};for(var c=0;c<t.legend.length;c++)l.push(u.getRandomCol());e.color=l,e.yAxis=i,e.series=a;var d=-1<["web","webdrill","drill"].indexOf(h.para.getTablePara().uiType);return(x.isMb&&!d||!x.isMb)&&(e.dataZoom=[{type:"inside",show:!0,xAxisIndex:[0]},{type:"inside",show:!0,yAxisIndex:[0]}]),x.isMb||(e.tooltip={trigger:"axis",show:!0,axisPointer:{type:"cross",crossStyle:{color:"#999"}},formatter:function(t){for(var e,a=t[0].name+"<br/>",s=0,i=t.length;s<i;s++)e=v.BwRule.formatText(t[s].value,h.getCols(t[s].seriesName),!1),a+=t[s].seriesName+"："+e+"<br/>";return a}}),e.getOption()},s[2]=function(t){var e,a=[],s=0,i=[];for(var l in t.ySeries)if(!g.isEmpty(t.ySeries[l]))for(var o in t.ySeries[l]){for(var n=[],r=0;r<t.xData.length;r++)n.push({value:t.ySeries[l][o][r],name:t.xData[r]});a.push({name:o,type:"pie",radius:x.isMb?"120px":"150px",center:["50%",400*s+200+"px"],label:{normal:{formatter:x.isMb?"{b}\n{d}%":"{a}\n {b}: {d}%"}},data:n}),s++}for((e=new m.Echart).title={text:"订单明细图",x:"center"},x.isMb||(e.tooltip={trigger:"item",show:!0,axisPointer:{type:"cross",crossStyle:{color:"#999"}},formatter:function(t){var e,a="";return e=v.BwRule.formatText(t.value,h.getCols(t.seriesName),!1),a+=t.seriesName+"："+e+"<br/>"}}),e.title=x.isMb?{text:"订单明细图",x:"center",top:"20px"}:{text:"订单明细图",x:"center"},e.legend=x.isMb?{type:"scroll",top:"0%",left:0,data:t.legend}:{type:"scroll",orient:"vertical",right:"3%",top:20,bottom:0,data:t.xData,pageIconColor:"red"},r=0;r<t.xData.length;r++)i.push(u.getRandomCol());return e.color=i,e.series=a,e.getOption()},s[3]=function(t){var e,a=s[0].call(this,t);for(e=0;e<a.series.length;e++)a.series[e].smooth=!0,a.series[e].areaStyle={normal:{color:new l.graphic.LinearGradient(0,0,0,1,[{offset:0,color:a.color[e],opacity:1},{offset:1,color:a.color[e],opacity:1}])}};return a},s),this.initModal(),this.getSelectData(),this.replaceDataName();for(var e=t.allData(),a=this.para.getTablePara().keyField,i=0;i<e.length;i++)this.getLinkCol(e[i],a)}return u.prototype.getSelectData=function(){var t,e=this.para.getVisibleCol(),a=[],s=[];for(t=0;t<this.para.cols.length;t++)v.BwRule.isNumber(this.para.cols[t].dataType)&&-1<e.indexOf(this.para.cols[t].name)&&s.push({value:this.para.cols[t].name,text:this.para.cols[t].title});for(t=0;t<this.para.cols.length;t++)-1<e.indexOf(this.para.cols[t].name)&&a.push({value:this.para.cols[t].name,text:this.para.cols[t].title});this.chartRow=a,this.chartCol=s,this.chartType=[{value:0,text:"折线图"},{value:1,text:"柱形图"},{value:2,text:"饼图"},{value:3,text:"面积图"}]},u.prototype.initModal=function(){var h=this,u=this,t=new s.InputBox,e=new a.Button({key:"okBtn",content:"确认",type:"primary",onClick:function(){var t=!0;if(0===h.chartCol.length&&(f.Modal.toast("纵坐标无统计字段，无法统计"),t=!1),0===h.coms.col.get().length&&(f.Modal.toast("请选择至少一个纵坐标"),t=!1),0===(h.coms.range.get()[0]?h.para.selectedData().length:h.para.allData().length)&&(f.Modal.toast("无可统计数据，请重新选择"),t=!1),t){h.modal.isShow=!1;var e=-1<["web","webdrill","drill"].indexOf(h.para.getTablePara().uiType);if(e){var l,a,s=h.para.getWrapper(),o=x.isMb?b.closest(s,"li"):s.parentElement;b.query(".mobileTableWrapper",s).style.display="none",(l=document.createElement("div")).className="Echart_body",l.style.height=x.isMb?"82vh":"450px",l.style.width=x.isMb?"700px":s.offsetWidth+"px";var i=b.query(".Echart_body",s);i&&s.removeChild(i),s.appendChild(l);var n=u.coms.type,r=u.getChartInput();u.generateGraph(l,n.get()[0],r),l.style.background="white",b.query(".statisticsChart",o).lastChild.style.display="inline-block";var c=o.offsetHeight;(a=b.query(".panel-tools",o.parentElement))&&b.on(a,"click",".panel-heading",function(t){setTimeout(function(){var t=o.parentElement,e=t.classList.contains("is-fullscreen"),a=c>t.offsetHeight?c:t.offsetHeight,s=t.offsetWidth+"px",i=e?a-b.query(".panel-heading",t).offsetHeight:c;l.style.width=s,l.style.height=i+"px",t.style.overflowY="scroll",t.style.overflowX="hidden",h.myChart.resize()},0)})}else if(!e&&x.isMb)p(["Modal","Button"],function(t,e){var a=b.create('<div class="Echart_body" style="width: 100vw; height: calc(100vh - 44px); overflow-x: hidden;"></div>'),s=new t.Modal({position:"full",body:a,isOnceDestroy:!0});s.body.parentElement.parentElement.classList.add("myChart"),s.body.parentElement.style.maxHeight="none",s.body.parentElement.setAttribute("style","height:calc(100vh - 44px);");var i=u.coms.type,l=u.getChartInput();u.generateGraph(s.body,i.get()[0],l)});else{var d=new f.Modal({className:"tempModal",body:y.create('<div class="Echart_body" style="height:450px; width: 700px;"></div>'),container:u.para.container,isOnceDestroy:!0,isBackground:!1,onLarge:function(){var t=b.query(".tempModal",document.body),e=b.query(".head-wrapper",t),a=b.query(".Echart_body",t),s=t.offsetHeight-e.offsetHeight,i=t.offsetWidth-40,l=a.style,o=a.parentElement.style;h.isLarge?(o.height=s+"px",o.maxHeight="none"):(l.width="700px",o.height="500px"),h.isLarge&&!h.isPie?(l.width=i+"px",l.height=s+"px",h.isLarge=!1):h.isLarge||h.isPie?h.isLarge&&h.isPie?(l.width=i+"px",h.isLarge=!1):!h.isLarge&&h.isPie&&(h.isLarge=!0):(l.height="450px",h.isLarge=!0),h.myChart.resize()},header:{title:"统计结果",isFullScreen:!0}});n=u.coms.type,r=u.getChartInput();u.generateGraph(d.body,n.get()[0],r)}}}});t.addItem(e),x.isMb?(this.modal=new f.Modal({header:"图表统计",position:"full",container:this.para.container,isOnceDestroy:!0}),this.modal.modalHeader.rightPanel=t,this.modal.bodyWrapper.parentElement.classList.add("myChart")):this.modal=new f.Modal({header:"图表统计",container:this.para.container,className:"echart",width:x.isMb?null:"500px",isBackground:!1,footer:{rightPanel:t}})},u.prototype.initHtmlTpl=function(t,e){var l=this;switch(t){case"type":this.coms.type=new i.SelectBox({container:e,select:{multi:!1,callback:function(t){}},data:this.chartType});break;case"row":this.coms.row=new o.SelectInput({container:e,data:this.chartRow,onSet:function(t,e){},className:"selectInput",clickType:1,readonly:!0});break;case"col":this.coms.col=new i.SelectBox({container:e,select:{multi:!0,callback:function(t){var e,a=l.getDataType(l.chartCol[t].text),s=l.coms.col;if(a===v.BwRule.DT_DATETIME||a===v.BwRule.DT_TIME)for(e=0;e<l.chartCol.length;e++){(i=l.getDataType(l.chartCol[e].text))!=v.BwRule.DT_DATETIME&&i!=v.BwRule.DT_TIME&&s.unSet([e])}else for(e=0;e<l.chartCol.length;e++){var i;(i=l.getDataType(l.chartCol[e].text))!==v.BwRule.DT_DATETIME&&i!==v.BwRule.DT_TIME||s.unSet([e])}}},data:this.chartCol});for(var a=[],s=0;s<this.chartCol.length;s++)l.getDataType(this.chartCol[s].text)===v.BwRule.DT_MONEY&&a.push(s);this.coms.col.set(a);break;case"range":this.coms.range=new i.SelectBox({container:e,select:{multi:!1,callback:function(t){}},data:[{value:0,text:"全部数据"},{value:1,text:"选定数据"}]})}},u.prototype.replaceDataName=function(){var e=this;this.body=this.modal.bodyWrapper;var t=this.htmlTpl();this.body.innerHTML=t,y.queryAll("[data-name]",this.body).forEach(function(t){e.initHtmlTpl(t.dataset.name,t)});var a=this.coms.row;this.chartRow[0]&&a.set(this.chartRow[0].value)},u.prototype.generateGraph=function(r,t,e){var c=this;this.myChart=l.init(r);var a=this.generateChartOption[t].call(this,e);a.series[0]&&"pie"===a.series[0].type?(r.parentElement.style.overflowY="scroll",r.parentElement.parentElement.style.overflowY="scroll",400,r.style.height=400*a.series.length+"px",this.isPie=!0,this.myChart.resize()):this.isPie=!1,this.isLarge=!0,this.myChart.setOption(a),this.myChart.on("click",function(s){var t=!1,e=function(t){var e,a;for(a in c.hasLinkCol)for(e=0;e<c.hasLinkCol[a].length;e++)if(c.hasLinkCol[a][e].name==s.value){t(c.hasLinkCol[a][e].src);break}};if(x.isMb){e(function(){t=!0});var a=b.query(".detailDiv",r);a&&r.removeChild(a);var i=s.value;s.seriesName&&(i=v.BwRule.formatText(s.value,c.getCols(s.seriesName),!1));var l=void 0;l="xAxis"===s.componentType?'<p style="color:white; margin:0 0;">'+s.value+"</p> ":'<p style="color:white; margin:0 0;">'+s.name+'</p>\n                            <p style="color:white; margin:0 0;">'+s.seriesName+":"+i+"</p>\n                            ";var o=document.createElement("div");if(o.className="detailDiv",o.setAttribute("style","top:"+(s.event.offsetY-55)+"px;left:"+(s.event.offsetX+10)+"px"),o.innerHTML=l,t){var n=document.createElement("p");n.setAttribute("style","color:white;text-align:center;"),n.innerHTML="点击查看>>",o.appendChild(n),b.on(n,"click",function(t){e(function(t){var e=d.siteUrl+t;x.window.open({url:e})})})}r.appendChild(o)}else e(function(t){var e=d.siteUrl+t;x.window.open({url:e})})})},u.prototype.htmlTpl=function(){return'<div class="EChart_tabFirst"><div class="row"><div class="col-xs-4"><fieldset><legend>类型</legend><div data-name="type"></div></fieldset></div><div class="col-xs-4"><fieldset><legend>纵坐标</legend><div class="colClass"><div data-name="col"></div></div></fieldset></div><div class="col-xs-4"><fieldset><legend>横坐标</legend><div class="rowClass"><div data-name="row"></div></div></fieldset><fieldset><legend>范围</legend><div data-name="range"></div></fieldset></div></div></div>'},u.prototype.getModal=function(){return this.modal},u.prototype.getChartInput=function(){var t,e,a,s=this.coms.row.get(),i=this.coms.col.get(),l=[],o=[],n=[],r={},c=this.coms.range.get()[0]?this.para.selectedData():this.para.allData();for(t=0;t<i.length;t++)l.push(this.chartCol[i[t]].value),o.push(this.chartCol[i[t]].text);for(-1<(n=function(t){var e,a=[],s={};for(e=0;e<t.length;e++)s[t[e]]||(a.push(t[e]),s[t[e]]=1);return a}(this.para.colDataGet(s))).indexOf(null)&&n.splice(n.indexOf(null),1),e=0;e<n.length;e++)for(t=0;t<c.length;t++)if(c[t][s]===n[e])for(a=0;a<l.length;a++)r[o[a]]||(r[o[a]]={}),r[o[a]][n[e]]||(r[o[a]][n[e]]=0),r[o[a]][n[e]]=r[o[a]][n[e]]+c[t][l[a]];var d={money:{},count:{},time:{}};for(var h in r){var u=this.getDataType(h);for(var p in u===v.BwRule.DT_MONEY?d.money[h]=[]:u===v.BwRule.DT_DATETIME||u===v.BwRule.DT_TIME?d.time[h]=[]:d.count[h]=[],n=[],r[h])n.push(p),u===v.BwRule.DT_MONEY?d.money[h].push(r[h][p]):u===v.BwRule.DT_DATETIME||u===v.BwRule.DT_TIME?d.time[h].push(r[h][p]):d.count[h].push(r[h][p])}var f={};return f.legend=o,f.ySeries=d,f.xData=n,f},u.prototype.getDataType=function(t){for(var e=0;e<this.para.cols.length;e++)if(this.para.cols[e].title===t)return this.para.cols[e].dataType},u.prototype.getLinkCol=function(l,o){var a=this,t=this.para.cols,n=function(t,e){a.hasLinkCol[t.caption]||(a.hasLinkCol[t.caption]=[]),a.hasLinkCol[t.caption].push({name:l[t.name],src:e})};t.forEach(function(t,e){if(t.drillAddr&&t.drillAddr.dataAddr){var a=v.BwRule.drillAddr(t.drillAddr.dataAddr,l,o);a&&n(t,a)}if(t.webDrillAddr&&t.webDrillAddr.dataAddr){var s=v.BwRule.webDrillAddr(t.webDrillAddr,l,o);s&&n(t,s)}if(t.webDrillAddrWithNull&&t.webDrillAddrWithNull.dataAddr){var i=v.BwRule.webDrillAddrWithNull(t.webDrillAddrWithNull,l,o);i&&n(t,i)}})},u}()).getRandomCol=function(){return"rgb("+Math.floor(256*Math.random())+","+Math.floor(256*Math.random())+","+Math.floor(256*Math.random())+")"},e.yType={money:"金额",count:"数量",time:"时间"},e}),define("StatisticBase",["require","exports","Modal"],function(d,t,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=G.d,p=BW.sys,e=function(){function t(){}return t.prototype.tableRender=function(a,t,s){void 0===s&&(s=!1);var i=u.create("<table><tbody></tbody></table>"),l={cols:s?a.colsIndex:a.cols,data:a.data,multPage:2,isSub:p.isMb,isInModal:!0};if(0<a.data.length)for(var e=0,o=a.data.length;e<o;e++)for(var n in a.data[e])"--"===a.data[e][n]&&(a.data[e][n]="");var r,c=s?a.cols[0].length:a.cols.length;r=c<=3?"300px":3<c&&c<=8?"600px":"1000px",p.isMb?new h.Modal({header:"统计结果",body:i,position:"full",container:t,isOnceDestroy:!0}):new h.Modal({body:i,isOnceDestroy:!0,isBackground:!1,container:t,width:r,header:{title:"统计结果",isFullScreen:!0}}),d([p.isMb?"TableModuleMb":"TableModulePc"],function(t){var e={tableEl:i,scrollEl:i.parentElement,tableConf:{indexCol:"number"}};s&&(e.tableConf.multi={enabled:!0,cols:a.cols}),new t(e,l)})},t}();t.StatisticBase=e}),define("Count",["require","exports","StatisticBase","SelectInput","Modal","SelectInputMb"],function(t,e,a,i,o,n){"use strict";var r=BW.sys,c=G.d,s=G.tools;return function(a){function t(t){var e=a.call(this)||this;return e.para=t,e.modal=null,e.initModal(),e}return __extends(t,a),t.prototype.count=function(t){var e=this.para.colDataGet(t),a={};return e.forEach(function(t){(t=s.isEmpty(t)?"-空-":t)in a?a[t]++:a[t]=1}),a},t.prototype.initModal=function(){var l=this;this.modal=new o.Modal({header:"统计",body:c.create("<span></span>"),className:"statistic",width:"220px",container:this.para.container,isBackground:!1,footer:{},onOk:function(){var t={cols:[{title:"列名",name:"colName"},{title:"数量",name:"count"}],data:[]},e=l.count(s.get());for(var a in e)t.data.push({colName:a,count:e[a]});l.tableRender(t,l.para.container)}});var t=this.para.getVisibleCol().map(function(t){for(var e=l.para.cols,a=-1,s=0,i=void 0;i=e[s];s++)if(i.name===t){a=s;break}return{text:e[a].title,value:t}}),s=new(r.isMb?n.SelectInputMb:i.SelectInput)({container:this.modal.bodyWrapper,data:t,readonly:!0,clickType:0});s.set(t[0].value)},t.prototype.getModal=function(){return this.modal},t}(a.StatisticBase)});