define("FormPrintModule",["require","exports","DrawSvg","Modal","Button","InputBox","Tab","SelectInput","TextInput","SelectBox","NumInput"],function(e,t,d,c,h,u,p,r,s,o,m){"use strict";var a,v=G.d,w=G.tools;return(a=function(){function l(e){var p;this.para=e,this.coms={},this.pageSvgArray=[],this.printUtil=(p=this,{getColsSize:function(){for(var e=v.queryAll(".section-inner-wrapper:not(.pseudo-table) th",p.para.middleTable),t={},a={},n=0,i=e.length;n<i;n++){var r=e[n].offsetWidth;t[n]=r<=150?r:150,a[n]=e[n].dataset.name}p.colSize=t,p.indexToName=a},getTableConf:function(e,t,a){var n,i,r=0,s=0;for(var o in p.colSize)if(r++,e<(s+=p.colSize[o])){r--,n=e-(s-p.colSize[o]);break}for(!n&&(n=e-s),s=0;s<t;)s+=a;return i=t-(s-a),{row:Math.floor(t/a),col:r,widthLeave:n,heightLeave:i}},getUserInput:function(){var e={paperWidth:3.78*p.coms.width.get(),paperHeight:3.78*p.coms.height.get(),up:3.78*p.coms.up.get(),down:3.78*p.coms.down.get(),left:3.78*p.coms.left.get(),right:3.78*p.coms.right.get(),rowSpace:3.78*p.coms.rowSpace.get(),colSpace:3.78*p.coms.colSpace.get()};return p.userInp=e},getPrinterList:function(){if("BlueWhaleShell"in window){var e=BlueWhaleShell.postMessage("getPrintDrive","{}").replace(/\\/g,""),t=void 0,a=JSON.parse(e);if(a.msg&&(t=a.msg.driveList),t&&(l.selectInputJson.printer=[],l.selectInputJson.printer.push({text:"默认",value:t[0].driveCode}),1<t.length))for(var n=1,i=t.length;n<i;n++)l.selectInputJson.printer.push({text:t[n].driveName,value:t[n].driveCode})}}}),this.printUtil.getPrinterList(),this.initModal()}return l.prototype.getVisableCols=function(){return this.para.cols},l.prototype.initModal=function(){var t=this,e=new u.InputBox,a=new u.InputBox,n=new h.Button({content:"设置默认值",type:"primary",onClick:function(){},key:"saveBtn"}),i=new h.Button({content:"取消",type:"default",key:"cancelBtn"}),r=new h.Button({content:"打印",type:"primary",onClick:function(){},key:"printBtn"}),s=new h.Button({content:"预览",type:"primary",onClick:function(){t.dealPreview()},key:"previewBtn"});e.addItem(n),a.addItem(r),a.addItem(s),a.addItem(i),this.modal=new c.Modal({container:this.para.container,header:"报表打印",body:document.createElement("div"),className:"formPrint",footer:{leftPanel:e,rightPanel:a}});var o=l.tpl();new p.Tab({tabParent:this.modal.bodyWrapper,panelParent:this.modal.bodyWrapper,tabs:[{title:"设置",dom:v.query(".setDom",o)},{title:"选项",dom:v.query(".optionDom",o)},{title:"数据",dom:v.query(".dataDom",o)},{title:"补充",dom:v.query(".suppleDom",o)}]}),v.queryAll("[data-name]",this.modal.bodyWrapper).forEach(function(e){t.replaceNameDom(e.dataset.name,e)}),this.modal.isShow=!0},l.prototype.drawTable=function(e,t,a,n,i){for(var r={brushColor:0,penColor:0,brushStyle:1,penStyle:0,penWidth:1},s=30+this.userInp.rowSpace,o=n-this.tableConf.widthLeave,p=i-this.tableConf.heightLeave,l=0;l<=this.tableConf.row;l++)e.graph(d.DrawSvg.graphKind.line,{x:t,y:l*s+a,w:o,h:1.5},r);e.graph(d.DrawSvg.graphKind.verticalLine,{x:t,y:a,w:1.5,h:p},r);var c=0;for(l=0;l<this.tableConf.col;l++)c+=this.colSize[l],e.graph(d.DrawSvg.graphKind.verticalLine,{x:c+t,y:a,w:1.5,h:p},r)},l.prototype.drawTop=function(e,t){var a={alignment:0,backColor:16777215,font:{fontColor:0,fontName:"宋体",fontSize:12,fontStyle:1},forFill:!1,autoSize:!1,stretch:!1,transparent:!1,wrapping:!1};e.icon(3,{x:this.userInp.left,y:this.userInp.up+7,w:60,h:60}),e.text(t,{x:this.userInp.left+60,y:this.userInp.up+30,w:0,h:0},a),e.text(t,{x:this.userInp.paperWidth/2-30,y:this.userInp.up+80,w:0,h:0},a)},l.prototype.drawBottom=function(e){var t={alignment:0,backColor:16777215,font:{fontColor:0,fontName:"宋体",fontSize:12,fontStyle:1},forFill:!1,autoSize:!1,stretch:!1,transparent:!1,wrapping:!1};e.graph(3,{x:this.userInp.left,y:this.userInp.paperHeight-this.userInp.down-20,w:this.userInp.paperWidth-this.userInp.left-this.userInp.right,h:1.5},{brushColor:0,penColor:0,brushStyle:1,penStyle:0,penWidth:1}),e.text("打印者：肖映崎",{x:this.userInp.left,y:this.userInp.paperHeight-this.userInp.down-10,w:0,h:0},t),e.text("打印时间："+G.tools.date.format(new Date,"yyyy-MM-dd HH:mm:ss"),{x:this.userInp.paperWidth/2-100,y:this.userInp.paperHeight-this.userInp.down-10,w:0,h:0},t),e.text("第 "+this.currentPage+" 页 共 "+this.totalPage+" 页",{x:this.userInp.paperWidth-this.userInp.right-90,y:this.userInp.paperHeight-this.userInp.down-10,w:0,h:0},t)},l.prototype.drawText=function(e){for(var i=this,t=function(e){for(var t=i.para.cols,a=0,n=t.length;a<n;a++)if(t[a].name===e)return a;return null},a=this.para.cols,n=this.userInp.left+this.tableConf.widthLeave/2,r=this.userInp.up+100,s={alignment:0,backColor:16777215,font:{fontColor:0,fontName:"宋体",fontSize:12,fontStyle:1},forFill:!1,autoSize:!1,stretch:!1,transparent:!1,wrapping:!0},o=(30+this.userInp.rowSpace-12)/2,p=0,l={x:10+n,y:o+r},c=-1;c<this.tableConf.col-1;c++){-1!==c&&(p+=this.colSize[c]);var d=t(this.indexToName[c+1]);console.log(d),null!==d&&e.text(a[d].title,{x:-1===c?l.x:p+l.x,y:l.y,w:0,h:0},s)}for(var h={x:10+n,y1:this.userInp.rowSpace+30,y2:o+r},u=1;u<this.tableConf.row;u++){var m=this.tableData.shift();if(p=0,!m)break;for(c=-1;c<this.tableConf.col-1;c++){-1!==c&&(p+=this.colSize[c]);var v=w.str.toEmpty(m[this.indexToName[c+1]]),g=this.colSize[c+1]-10;v='<span class="svgText" style="width: '+g+'px;">'+v+"</span>",e.text(v,{x:-1===c?h.x:p+h.x,y:u*h.y1+h.y2,w:g,h:0},s)}}},l.prototype.replaceNameDom=function(e,t){var n=this;switch(e){case"printer":this.coms.printer=new r.SelectInput({container:t,data:l.selectInputJson.printer,placeholder:"默认",onSet:function(e,t){},className:"selectInput",clickType:1});break;case"paper":this.coms.paper=new r.SelectInput({container:t,data:l.selectInputJson.paper,placeholder:"默认",onSet:function(e,t){if(n.coms.width&&n.coms.height){var a=n.coms.paper.get().split("*");n.coms.width.set(a[0]),n.coms.height.set(a[1])}},className:"selectInput",clickType:1}),this.coms.paper.set("210.0*297.0");break;case"width":if(this.coms.width=new s.TextInput({container:t,placeholder:"请输入",className:"text"}),this.coms.paper){var a=this.coms.paper.get().split("*");this.coms.width.set(a[0])}break;case"height":if(this.coms.height=new s.TextInput({container:t,placeholder:"请输入",className:"text"}),this.coms.paper){var i=this.coms.paper.get().split("*");this.coms.height.set(i[1])}break;case"pageRange":this.coms.pageRange=new o.SelectBox({container:t,select:{multi:!1,isRadioNotchecked:!1,callback:function(e){}},data:[{value:0,text:"所有页"},{value:1,text:"指定页"}]});break;case"from":this.coms.from=new m.NumInput({container:t,defaultNum:1,max:100,min:1,step:1,className:"numInput"});break;case"to":this.coms.to=new m.NumInput({container:t,defaultNum:1,max:100,min:1,step:1,className:"numInput"});break;case"up":this.coms.up=new s.TextInput({container:t,placeholder:"请输入",className:"text"}),this.coms.up.set(0);break;case"down":this.coms.down=new s.TextInput({container:t,placeholder:"请输入",className:"text"}),this.coms.down.set(10);break;case"left":this.coms.left=new s.TextInput({container:t,placeholder:"请输入",className:"text"}),this.coms.left.set(10);break;case"right":this.coms.right=new s.TextInput({container:t,placeholder:"请输入",className:"text"}),this.coms.right.set(10);break;case"direction":this.coms.direction=new o.SelectBox({container:t,select:{multi:!1,isRadioNotchecked:!1,callback:function(e){}},data:[{value:0,text:"横向"},{value:1,text:"纵向"}]});break;case"printData":this.coms.printData=new o.SelectBox({container:t,select:{multi:!1,isRadioNotchecked:!1,callback:function(e){}},data:[{value:0,text:"全部数据"},{value:1,text:"选定数据"}]});break;case"rowSpace":this.coms.rowSpace=new m.NumInput({container:t,defaultNum:1,max:100,min:1,step:1,className:"numInput"}),this.coms.rowSpace.set(1);break;case"colSpace":this.coms.colSpace=new m.NumInput({container:t,defaultNum:1,max:100,min:1,step:1,className:"numInput"}),this.coms.colSpace.set(1);break;case"lanNum":this.coms.lanNum=new m.NumInput({container:t,defaultNum:1,max:100,min:1,step:1,className:"numInput"});break;case"lanSpace":this.coms.lanSpace=new m.NumInput({container:t,defaultNum:1,max:100,min:1,step:1,className:"numInput"})}},l.prototype.dealPreview=function(){var a=this;this.currentPage=1;var e=new u.InputBox,t=new h.Button({content:"取消",key:"cancelBtn",type:"default"}),n=new h.Button({key:"okBtn",content:"上一页",type:"primary",onClick:function(){a.currentPage--;var e=a.previewModal.body;return a.currentPage<=1&&v.queryAll(".btn",a.previewModal.wrapper)[1].setAttribute("disabled","disabled"),a.currentPage==a.totalPage-1&&v.queryAll(".btn",a.previewModal.wrapper)[2].removeAttribute("disabled"),a.pageSvgArray[a.currentPage-1]&&(e.innerHTML="",e.appendChild(a.pageSvgArray[a.currentPage-1])),!1}}),i=new h.Button({content:"下一页",type:"primary",onClick:function(){a.currentPage++,a.currentPage>=a.totalPage&&v.queryAll(".btn",a.previewModal.wrapper)[2].setAttribute("disabled","disabled"),2==a.currentPage&&v.queryAll(".btn",a.previewModal.wrapper)[1].removeAttribute("disabled");var e=a.previewModal.body;if(a.pageSvgArray[a.currentPage-1])e.innerHTML="",e.appendChild(a.pageSvgArray[a.currentPage-1]);else{e.innerHTML="";var t=new d.DrawSvg({width:a.userInp.paperWidth,height:a.userInp.paperHeight});a.pageSvgArray.push(t.getSvg()),e.appendChild(t.getSvg()),a.drawTable(t,r.left+a.tableConf.widthLeave/2,r.up+100,o,p),a.drawTop(t,"条码库存表"),a.drawBottom(t),a.drawText(t)}return!1}});e.addItem(t),e.addItem(n),e.addItem(i);var r=this.printUtil.getUserInput();this.previewModal=new c.Modal({body:v.create('<div class="previewBody"></div>'),className:"preview",container:this.para.container,header:"预览",width:r.paperWidth+"px",footer:{rightPanel:e},top:0}),v.queryAll(".btn",this.previewModal.wrapper)[1].setAttribute("disabled","disabled"),this.printUtil.getColsSize();var s=new d.DrawSvg({width:this.userInp.paperWidth,height:this.userInp.paperHeight});this.pageSvgArray=[],this.pageSvgArray[0]=s.getSvg(),this.previewModal.body.appendChild(s.getSvg());var o=r.paperWidth-r.left-r.right,p=r.paperHeight-r.up-r.down-100-30;this.tableConf=this.printUtil.getTableConf(o,p,30+this.userInp.rowSpace),this.totalPage=Math.ceil(this.para.tableData().length/this.tableConf.row),this.tableData=JSON.parse(JSON.stringify(this.para.tableData())),this.drawTable(s,r.left+this.tableConf.widthLeave/2,r.up+100,o,p),this.drawTop(s,"条码库存表"),this.drawBottom(s),this.drawText(s)},l}()).tpl=function(){return v.create('<div><div class = "setDom">\n                      <div class = \'leftSet\'>\n                          <div class="printer" data-name="printer" ></div>\n                          <div class = "range">\n                                <fieldset>\n                                <legend>范围</legend>\n                                <div data-name="pageRange"></div>\n                                <div class = "inline" data-name="from"><span>从</span></div>\n                                <div class = "inline" data-name="to"><span>到</span></div>\n                                </fieldset>\n                          </div>\n                          <div class="direction">\n                                <fieldset class="col-xs-12">\n                                <legend>方向</legend>\n                                <div data-name="direction"></div>\n                                </fieldset>\n                          </div>\n                          <div class="content">\n                                <fieldset class="col-xs-12">\n                                <legend>内容</legend>\n                                <div data-name="printData"></div>\n                                </fieldset>\n                           </div>\n                      </div>\n                      <div class = \'rightSet\'>\n                          <div class="paper" data-name="paper" ></div>\n                          <div class = \'size\'>\n                               <div  data-name="width"><span>宽度</span></div>\n                               <div  data-name="height"><span>高度</span></div>\n                          </div>\n                          <div class = "pagePadding">                                               \n                                <div data-name="up"><span>上边距</span></div>\n                                <div data-name="down"><span>下边距</span></div>                         \n                                <div data-name="left"><span>左边距</span></div>\n                                <div data-name="right"><span>右边距</span></div>                      \n                          </div>   \n                           <div class = "otherSetting">                                               \n                                <div  data-name="lanNum"><span>栏数</span></div>\n                                <div  data-name="lanSpace"><span>栏距</span></div>\n                                <div  data-name="rowSpace"><span>行距</span></div>\n                                <div  data-name="colSpace"><span>列距</span></div>\n                          </div>              \n                      </div>\n             </div>\n            <div class = "optionDom">\n                               \n            </div>\n            <div class = "dataDom">\n                                \n            </div>\n            <div class = "suppleDom">\n                               \n            </div></div>')},a.selectInputJson={printer:[{text:"默认",value:0}],paper:[{value:"215.9*279.4",text:"信纸(215.9*279.4毫米)"},{value:"279.4*431.8",text:"小报(279.4*431.8毫米)"},{value:"215.9*355.6",text:"文书(215.9*355.6毫米)"},{value:"139.7*215.9",text:"申明(139.7*215.9毫米)"},{value:"190.5*254.0",text:"公函(190.5*254.0毫米)"},{value:"297.0*420.0",text:"A3(297.0*420.0毫米)"},{value:"210.0*297.0",text:"A4(210.0*297.0毫米)"},{value:"148.0*210.0",text:"A5(148.0*210.0毫米)"},{value:"250.0*354.0",text:"B4(250.0*354.0毫米)"},{value:"182.0*257.0",text:"B5(182.0*257.0毫米)"},{value:"215.9*330.2",text:"2开(215.9*330.2毫米)"},{value:"215.0*275.0",text:"4开(215.0*275.0毫米)"},{value:"254.0*355.6",text:"大4开(254.0*355.6毫米)"},{value:"215.9*279.0",text:"便条(215.9*279.0毫米)"},{value:"98.4*225.4",text:"9号信封(98.4*225.4毫米)"},{value:"104.8*241.3",text:"10号信封(104.8*241.3毫米)"},{value:"114.3*263.5",text:"11号信封(114.3*263.5毫米)"},{value:"101.6*279.4",text:"12号信封(101.6*279.4毫米)"},{value:"127.0*292.1",text:"14号信封(127.0*292.1毫米)"},{value:"100.0*100.0",text:"方纸(100.0*100.0毫米)"},{value:0,text:"自定义"}]},a});