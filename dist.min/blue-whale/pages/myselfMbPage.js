define(["require","exports","BwRule","Modal","User","ShellAction"],function(e,t,o,r,c,u){"use strict";var d=BW.sys,m=G.tools,p=BW.CONF,f=G.d,i=G.Ajax,a=G.Shell;return function(){function e(){var e=this,t=this,a=c.User.get();f.setHTML(f.query("#userid"),a.are_id+" "+a.department),f.setHTML(f.query("#name"),a.username+" "+a.userid);var i=f.query("#table-list");if(m.isMb&&(this.setFontSize(i),this.rfidSettingInit(i)),"ad"===d.os){var n=h("li",{className:"mui-table-view-cell","data-page-name":"powerManager"},h("a",{href:"#",className:"mui-navigate-right"}," ",h("i",{class:"iconfont icon-023tuceng-copy-copy",style:"color:#f15054;margin-right:10px"}),"权限管理")),l=h("li",{className:"mui-table-view-cell","data-page-name":"whiteBat"},h("a",{href:"#",className:"mui-navigate-right"}," ",h("i",{class:"iconfont icon-renyuan",style:"color:#4ea6f1;margin-right:10px"}),"电池白名单"));f.append(i,n),f.append(i,l),f.on(f.query("[data-page-name=powerManager]"),"click",function(){d.window.powerManager()}),f.on(f.query("[data-page-name=whiteBat]"),"click",function(){d.window.whiteBat()})}if("app_fastlion_retail"===p.appid){var s=h("li",{className:"mui-table-view-cell",id:"changePassword"},h("a",{href:"#",className:"mui-navigate-right"}," ",h("i",{className:"iconfont icon-renyuan",style:"color:#FFB741;margin-right:10px"}),"密码修改"));f.append(i,s)}f.on(f.query(".myselfMenuPage"),"click",".mui-table-view>.mui-table-view-cell[data-page-name]",function(e){var t=f.closest(e.target,".mui-table-view-cell[data-page-name]").dataset.pageName,i=BW.CONF.url[t];i&&("myself"===t?d.window.open({url:m.url.addObj(p.url.myself,{userid:a.userid})}):"bugReport"===t?d.window.open({url:p.url.bugList}):"myApplication"===t?d.window.open({url:p.url.myApplication}):"myApproval"===t?d.window.open({url:p.url.myApproval}):d.window.open({url:i}))}),f.on(f.query("#changPassword"),"click",function(){d.window.open({url:p.url.changePassword})}),f.on(f.query("#check"),"click",function(){d.window.update()}),f.on(f.query("#clear"),"click",function(){d.window.clear(),r.Modal.toast("清理成功")}),f.on(f.query("#scan"),"click",function(){u.ShellAction.get().device().scan({callback:function(e){alert(e.detail)}})}),f.on(f.query('[data-action="logout"]'),"click",function(){o.BwRule.Ajax.fetch(p.ajaxUrl.logout).then(function(e){r.Modal.toast("退出成功"),d.window.logout()})}),f.on(f.query("#testNetwork"),"click",function(){e.initModal();var u=[100,300,500,400].map(function(e){return m.url.addObj(p.ajaxUrl.speedTest,{size:e})}),d=!0;f.on(f.query("body"),"click",".mui-rotate-box",function(){var i=this;if(d){var a=f.query(".mui-progress-bar",this.parentElement),n=f.query(".mui-progress",this.parentElement).offsetWidth;a.style.width="0px",d=!1,this.className+=" animate_start";var l=null,s=null,o=0,r=0,c=function(){a.style.transition="0s",a.style.webkitTransition="0s",l=setInterval(function(){o++,i.querySelector(".box-content").innerHTML="测速中...",a.style.width=o+"px",r<=o/n&&clearInterval(l)},100)};c(),t.speedTest(u,function(e){if(clearInterval(l),clearInterval(s),r=(e.length+1)/u.length,a.style.transition="0.8s",a.style.webkitTransition="0.8s",o=n*(e.length/u.length),a.style.width=o+"px",s=setTimeout(function(){c()},800),e.length===u.length){clearInterval(l),clearInterval(s);var t=0;e.forEach(function(e){t+=e}),setTimeout(function(){i.className=i.classList[0],i.querySelector(".box-content").innerHTML=(t/e.length).toFixed(2)+"KB/s",d=!0},1e3)}})}})}),d.window.close=double_back}return e.prototype.rfidSettingInit=function(e){if(1==a.inventory.canRfid){var t=h("li",{className:"mui-table-view-cell",id:"rfidSettingIn"},h("a",{href:"#",className:"mui-navigate-right"},h("i",{className:"iconfont icon-pinlei",style:"color:#FFB741;margin-right:10px"}),"rfid设置配置"));f.after(e.children[1],t),f.on(t,"click",function(){d.window.open({url:p.siteAppVerUrl+"/commonui/pageroute?page=rfidSetting"})})}},e.prototype.initModal=function(){var e=h("div",{className:"test-module-wrapper"}),t=h("div",{className:"mui-content"},h("div",{className:"mui-rotate-box"},h("div",{className:"box-content"},"点击测速"),h("div",{className:"circle-box1"}),h("div",{className:"circle-box2"})),h("div",{className:"mui-progress"},h("div",{className:"mui-progress-bar"})));new r.Modal({container:f.closest(e,".page-container"),header:"网络测速",body:t,position:d.isMb?"full":"",width:"730px",isShow:!0})},e.prototype.speedTest=function(e,r){!function n(l,s){void 0===s&&(s=0);if(l.length===s)return;var o=(new Date).getTime();i.fetch(l[s]).then(function(e){var t=e.response,i=(new Date).getTime()-o;s++;var a=m.str.utf8Len(t);c.push(a/1024/(i/1e3)),r&&r(c),n(l,s)})}(e);var c=[]},e.prototype.setFontSize=function(e){var a=this,t=h("li",{className:"mui-table-view-cell",id:"setFontSize"},h("a",{href:"#",className:"mui-navigate-right"},h("i",{class:"iconfont icon-icon-test",style:"color:#4ea6f1;"})," 设置字体大小"));f.append(e,t);var i=h("div",{className:"select-panel hide"},h("div",{className:"fs-item small","data-index":"0"},"中(默认)"),h("div",{className:"fs-item middle","data-index":"1"},"大"),h("div",{className:"fs-item big","data-index":"2"},"特大"));f.append(e,i),f.on(f.query("#setFontSize"),"click",function(){f.query(".select-panel").classList.toggle("hide"),f.query("#setFontSize").classList.toggle("active")}),this.setFontSizeItemClass();var n=["defalut","big","super-fontsize"];f.on(f.query(".select-panel"),"click",".fs-item",function(e){var t=e.target,i=n[t.dataset.index];f.query(".select-panel").classList.add("hide"),f.query("#setFontSize").classList.remove("active"),i!==localStorage.getItem("bw-fontsize")&&r.Modal.confirm({msg:"需要重新登录，确认更改字体大小？",title:"温馨提示",callback:function(e){e?("default"===i&&(i=""),localStorage.setItem("bw-fontsize",i),d.window.logout()):a.setFontSizeItemClass()}})})},e.prototype.setFontSizeItemClass=function(){f.queryAll(".fs-item").forEach(function(e){e.classList.remove("active")});var e=localStorage.getItem("bw-fontsize");m.isEmpty(e)&&(e="defalut"),f.queryAll(".fs-item")[["defalut","big","super-fontsize"].indexOf(e)].classList.add("active")},e}()});