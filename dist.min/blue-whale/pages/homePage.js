define(["require","exports","menuMrg","BwRule","Search","SlideTab"],function(e,t,r,s,o,l){"use strict";var c=BW.sys,u=BW.CONF,a=G.tools,d=G.d;function m(e){return h("li",{style:"border-style: none","data-favid":e.favid,"data-href":e.url,"data-gps":e.gps,className:"mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3"},h("a",null,h("span",{className:"mui-icon"+e.icon}),h("div",{className:"mui-media-body"},e.caption)))}return function(){function i(e){var n=this;this.para=e,console.log(e);var t=h("div",{class:"slide-panel-wrapper"});d.append(e.container,t),this.slideTab=new l.SlideTab({tabParent:t,panelParent:t,onChange:function(e){console.log(e)},tabs:[{title:"首页",dom:this.homeList=h("ul",{class:"mui-table-view mui-grid-view mui-grid-9 full-height has-header has-search"})},{title:"收藏",dom:this.favoritesList=h("ul",{class:"mui-table-view mui-grid-view mui-grid-9 full-height has-header has-search"}),dataManager:{render:function(e,t,i,a){n.initFavorList(i.slice(e,e+t),a)},isPulldownRefresh:!0,ajaxFun:function(a){return new Promise(function(i,e){var t={pageparams:'{"index"='+a.current+', "size"='+a.pageSize+"}",action:"query"};s.BwRule.Ajax.fetch(u.ajaxUrl.menuFavor,{data:t}).then(function(e){var t=e.response;console.log(t),i({data:t.data||[],total:t.head&&t.head.totalNum||0})})})}}},{title:"最近",dom:this.recentList=h("ul",{class:"mui-table-view mui-grid-view mui-grid-9 full-height has-header has-search"}),dataManager:{render:function(e,t,i,a){n.initRecentList(i.slice(e,e+t),a)},isPulldownRefresh:!0,ajaxFun:function(a){return new Promise(function(i,e){var t={pageparams:'{"index"='+a.current+', "size"='+a.pageSize+"}",action:"query"};s.BwRule.Ajax.fetch(u.ajaxUrl.menuHistory,{data:t}).then(function(e){var t=e.response;console.log(t),i({data:t.data||[],total:t.head&&t.head.totalNum||0})})})}}}]});var i=this.slideTab.tabContainer,a=this.slideTab.panelContainer;i.className=i.className+" mui-slider-indicator mui-segmented-control mui-segmented-control-inverted",d.queryAll("li",i).forEach(function(e){e.classList.add("mui-control-item")}),a.classList.add("mui-slider-group"),d.queryAll(".tab-pane",a).forEach(function(e){e.className=e.className+" mui-slider-item mui-control-content mui-active"}),this.initHomeList(e.homeData),d.on(a,"click","li[data-href]",function(){c.window.open({url:this.dataset.href,gps:!!parseInt(this.dataset.gps)})}),d.on(d.query('.tab-pane[data-index="1"]',a),"press","li.mui-table-view-cell",function(){r.MENU_FAVORITE.toggleFavSheet(this,"cancel",{favid:this.dataset.favid,link:this.dataset.href})}),c.window.close=double_back,c.window.wake("refreshHomeData",null),new o.Search({nodeId:e.nodeId,baseUrl:e.baseUrl,searchBtn:e.searchBtn})}return i.prototype.initHomeList=function(e){var t=this;e&&a.toArray(e).forEach(function(e){d.append(t.homeList,i.createHomeList(e))}),this.homeList.classList.toggle("no-data",""===this.homeList.innerHTML)},i.prototype.initRecentList=function(e,t){var i=this;void 0===t&&(t=!1),t&&(this.recentList.innerHTML=""),e.forEach(function(e){e.url&&(e.url=u.siteUrl+e.url),d.append(i.recentList,m(e))}),this.recentList.classList.toggle("no-data",""===this.recentList.innerHTML)},i.prototype.initFavorList=function(e,t){var s=this;void 0===t&&(t=!1),t&&(this.favoritesList.innerHTML=""),e.forEach(function(e){var i=document.createElement("span"),t=document.createElement("div"),a=document.createElement("div"),n=document.createElement("span");""===e.tag?0!=e.favs.length&&(i.innerText="默认分组"):i.innerText=e.tag,i.setAttribute("class","conFavGroup"),n.setAttribute("class","editBook mui-icon mui-icon-compose"),n.setAttribute("data-edit",e.tag),a.appendChild(i),a.appendChild(n),t.appendChild(a),e.favs.forEach(function(e){e.url&&(e.url=u.siteUrl+e.url),t.appendChild(m(e))}),s.favoritesList.appendChild(t),t.querySelector(".editBook").addEventListener("click",function(){var e=document.querySelector(".txt_edit"),t=i.innerHTML;r.popoverToggle(r.MENU_FAVORITE.favEditDom),""===this.dataset.edit?e.value="默认分组":e.value=t,r.MENU_FAVORITE.valueObtain=t,r.MENU_FAVORITE.parentNode=this,r.MENU_FAVORITE.funcNumber&&(r.MENU_FAVORITE.toggleConGroup(),r.MENU_FAVORITE.toggleEditGroup(),r.MENU_FAVORITE.funcNumber=!1)})}),console.log(""===this.favoritesList.innerHTML),this.favoritesList.classList.toggle("no-data",""===this.favoritesList.innerHTML)},i.createHomeList=function(e){return h("li",{"data-href":BW.CONF.siteUrl+e.menuPath.dataAddr,"data-gps":e.menuPath.needGps,class:"mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3"},h("a",null,h("span",{className:"mui-icon "+e.menuIcon}),h("div",{class:"mui-media-body"},e.menuName)))},i}()});