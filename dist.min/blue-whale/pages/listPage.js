define(["require","exports","BwRule","BasicPage","ButtonAction","SwipeOut","DataManager"],function(e,t,b,a,c,v,d){"use strict";var f=BW.sys,y=G.tools,g=G.d;return function(o){function e(m){var e=o.call(this,{subButtons:m.subButtons})||this;e.para=m;g.query(".mui-scroll-wrapper .mui-scroll");var a,n,i,t=document.getElementById("searchInput"),r="",p=document.querySelector("#content ul.mui-table-view"),s=[];function l(u,o,e){var c,t=u.length;if(0!==t||e){e?(c=s.length,s=s.concat(u)):(c=0,p.innerHTML="",s=u);for(var d,a,n=function(t,e){var a=G.d.queryAll("a.mui-btn",G.d.query("#slideButtons")).map(function(e){return e.cloneNode(!0)});e=Object.keys(u[t]).map(function(e){return y.str.toEmpty(u[t][e])});var n=void 0,i=void 0,r=void 0,s=y.url.addObj(b.BwRule.parseURL(m.linkDataAddr,u[t]),b.BwRule.varList(m.linkVarList,u[t])),l=h("li",{className:"mui-table-view-cell","data-mail-id":e[0]},h("div",{className:"mui-slider-handle",style:"position: relative;"},h("div",{"data-index":c+t,className:"mui-table"},h("label",{className:"mui-table-cell mui-col-xs-1 mui-checkbox"},h("input",{name:"checkbox1",value:"Item 1",type:"checkbox"})),h("a",{"data-href":m.mgrPath+s,className:"mui-table-cell mui-col-xs-11"},h("h5",null,0==e[1]?h("span",{class:"mui-badge badge-dot mui-badge-primary unread"}):null,n=h("span",{class:"mail-title"}),h("span",{class:"mui-h5 pull-right"},""!=e[3]?h("span",{class:"mui-icon mui-icon-paperclip"}):null,h("span",{class:"mui-icon mui-icon-arrowright"}))),i=h("p",{class:"mui-h6 mui-ellipsis title"}),r=h("p",{class:"mui-h6 ellipsis-row2"})))));n.innerHTML=y.str.setHeightLight(e[2],o,"red"),i.innerHTML=y.str.setHeightLight(e[5],o,"red"),r.innerHTML=y.str.removeHtmlTags(e[6]),p.appendChild(l),new v.SwipeOut({target:l,right:a}),d=e},i=0;i<t;i++)n(i,a),a=d}else p.innerHTML=document.getElementById("empty_div").innerHTML}function u(e,t,a,n){var i=b.BwRule.varList(m.tableVarList,{});i.pageparams='{"index"='+e+', "size"='+t+"}",y.isEmpty(a)||(i.queryparam=a),b.BwRule.Ajax.fetch(m.tabledataAddr,{data:i}).then(function(e){var t=e.response;n(t)})}return g.queryAll("#slideButtons [data-button-type]").forEach(function(e){"delete"===e.dataset.subType?e.classList.add("mui-btn-red"):e.classList.add("mui-btn-yellow")}),new d.DataManager({render:function(){},page:{size:10,container:g.query("#content"),isPulldownRefresh:!0},ajax:{fun:function(a){return new Promise(function(t,e){u(a.current+1,a.pageSize,r,function(e){console.log(e),l(e.data,r,!a.isRefresh),t({data:e.data,total:e.head.totalNum})})})},auto:!0}}),t.addEventListener("keypress",function(e){13===e.charCode&&(r=t.value)}),a=!1,g.on(g.query(".mui-table-view"),"click",".mui-table-view-cell .mui-btn",function(e){var t=parseInt(this.parentNode.parentNode.querySelector("[data-index]").dataset.index),a=s[t],n=this;c.ButtonAction.get().clickHandle(c.ButtonAction.get().dom2Obj(n),a,function(){var e=n.parentNode.parentNode;e.parentNode.removeChild(e)}),e.stopPropagation()}),g.on(g.query("#content .mui-table-view"),"click",".mui-slider-handle .mui-table-cell.mui-col-xs-11",function(e){if(!a){f.window.open({url:this.dataset.href});var t=this.querySelector(".mui-badge.badge-dot.unread");t&&t.classList.add("hide")}}),document.addEventListener("click",function(){a&&(a=!1)}),n=0,i=null,g.on(g.query("#content .mui-table-view"),"click",".mui-checkbox",function(e){var t=this.querySelector("input[type=checkbox]");null!==i&&i.parentNode.parentNode.dataset.index!==t.parentNode.parentNode.dataset.index&&(i.checked=!1),n=null!==i&&t.checked?0:1;var a=document.querySelector("footer.mui-bar-footer");0===n?a.classList.add("vanish"):0<n&&a.classList.contains("vanish")&&a.classList.remove("vanish"),i=t}),g.on(g.query("body"),"click","[data-button-type]",function(e){var a=[];if("delete"===this.dataset.subType||"update"===this.dataset.subType){var t=parseInt(this.parentNode.parentNode.querySelector("[data-index]").dataset.index);a.push(s[t])}g.queryAll(".mui-table-view-cell .mui-checkbox input[type=checkbox]:checked").forEach(function(e){var t=parseInt(g.closest(e,"[data-index]").dataset.index);a.push(s[t])}),c.ButtonAction.get().clickHandle(c.ButtonAction.get().dom2Obj(this),a[0])}),e}return __extends(e,o),e}(a.default)});