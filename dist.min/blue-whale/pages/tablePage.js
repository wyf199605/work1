define("NewTablePage",["require","exports","BasicPage","BwRule","newTableModule","Modal","Loading","BwTableModule"],function(l,e,n,s,d,b,f,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var w=G.tools,y=BW.sys,M=BW.CONF,h=G.d,a=G.Component,r=y.isMb?"QueryModuleMb":"QueryModulePc",t=function(o){function e(e){var n=o.call(this,e)||this;h.classAdd(n.dom.parentElement,"table-page");var a=e.ui.body.elements[0],t=new i({container:w.isPc?n.dom:h.query("body > .mui-content"),tableEl:a,asynData:e.ui.body.elements[1]});return n.on(s.BwRule.EVT_REFRESH,function(){t.tableModule&&t.tableModule.refresh()}),n}return __extends(e,o),e}(n.default);e.NewTablePage=t;var i=function(o){function e(a){var i=o.call(this,a)||this,t=a.tableEl,e=w.isEmpty(t.cols),n=t.querier&&[3,13].includes(t.querier.queryType);if(e){var c=t;l([r],function(e){var u=!0,r=new e({qm:t,refresher:function(t,e,n){var a=c.uiPath,o=M.siteUrl+s.BwRule.reqAddr(a);if(t.output="json",!w.isEmpty(a)){var l=new f.Loading({msg:"查询中.."});return s.BwRule.Ajax.fetch(G.tools.url.addObj(o,t),{timeout:3e4,needGps:!!a.needGps}).then(function(e){var n=e.response;delete t.output,h.off(window,"wake"),i.tableModule&&i.tableModule.destroy();var a=n.body.elements[0];i.tableModule=new d.NewTableModule({bwEl:a,container:i.container,ajaxData:t}),y.isMb||(u&&r.toggleCancle(),i.tableModule.main.ftable.btnAdd("query",{content:"查询器",type:"default",icon:"shaixuan",onClick:function(){r.show()}},0)),u=!1,a.autoRefresh&&(y.window.wake("wake",null),h.on(window,"wake",function(){i.tableModule&&i.tableModule.refresh()}))}).catch(function(){}).finally(function(){l.destroy(),l=null})}b.Modal.alert("查询地址为空")},cols:[],url:null,container:i.container,tableGet:function(){return null}});if(!y.isMb&&r.toggleCancle(),y.isMb&&h.on(h.query('body > header [data-action="showQuery"]'),"click",function(){r.show()}),a.asynData){var n={query:r,qm:t,container:i.container,asynData:a.asynData};i.asynQuery(n)}})}else i.tableModule=new d.NewTableModule({bwEl:t,container:i.container}),n&&l([r],function(e){if(i.queryModule=new e({qm:t.querier,refresher:function(e){return i.tableModule.refresh(e)},cols:t.cols,url:M.siteUrl+s.BwRule.reqAddr(t.dataAddr),container:i.container,tableGet:function(){return i.tableModule.main}}),w.isMb)h.on(h.query('body > header [data-action="showQuery"]'),"click",function(){i.queryModule.show()});else{var n=i.tableModule.main,a=function(){n.ftable.btnAdd("query",{content:"查询器",type:"default",icon:"shaixuan",onClick:function(){i.queryModule.show()}},0)};n.ftable?a():n.on(u.BwTableModule.EVT_READY,function(){a()})}}),t.autoRefresh&&(y.window.wake("wake",null),h.on(window,"wake",function(){i.tableModule&&i.tableModule.refresh()}));return!e&&i.mobileScanInit(t),i.on(s.BwRule.EVT_REFRESH,function(){i.tableModule&&i.tableModule.refresh()}),i}return __extends(e,o),e.prototype.wrapperInit=function(e){},e.prototype.asynQuery=function(n){l(["AsynQuery"],function(e){new e.AsynQuery(n)})},e.prototype.mobileScanInit=function(n){var t=this,a=n.scannableField;!w.isPc&&a&&l(["MobileScan"],function(e){new e.MobileScan({container:t.container,cols:n.cols,scannableField:a.toUpperCase(),scannableType:n.scannableType,scannableTime:n.scannableTime,callback:function(e){var n=t.queryModule,a=t.tableModule;return n?(n.hide(),n.search(e,!0)):a.refresh(Object.assign(a.main.ajaxData,e))}})})},e}(a);e.BwTableElement=i});