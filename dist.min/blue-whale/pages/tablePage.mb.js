define("TablePage",["require","exports","BwRule","Button","BasicPage"],function(u,e,b,c,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=G.d,d=BW.CONF,f=BW.sys,a=function(a){function e(e,r){var i=a.call(this,e)||this;i.para=e;var s=i.para.mtPara;if(G.tools.isEmpty(s.cols)){var t=BW.sys.isMb?"QueryModuleMb":"QueryModulePc";u([t],function(e){var o=!0,t=n.closest(f.isMb?i.para.tableDom:i.para.dom,".page-container"),u=new e({qm:s,refresher:function(a,n,l){var e=d.siteUrl+b.BwRule.reqAddr(s.uiPath);a.output="json",b.BwRule.Ajax.fetch(G.tools.url.addObj(e,a),{timeout:3e4,defaultCallback:!1,needGps:s&&s.uiPath&&!!s.uiPath.needGps}).then(function(e){var t=e.response;delete a.output,i.tableModule&&i.tableModule.destroy(),i.tableModule=null,i.para.tableDom=null;i.requireTable(t.body.elements[0],a,function(){f.isMb||(o&&u.toggleCancle(),i.tableModule.rightBtns.add(new c.Button({content:"查询器",type:"default",icon:"shaixuan",onClick:function(){u.show()}}))),o=!1,"function"==typeof r&&r(),i.tableModule.tableData.cbFun.setOuterAfter(n),i.tableModule.tableData.cbFun.setOuterBefore(l)})}).catch(function(){})},cols:[],url:null,container:t,tableGet:function(){return null}});if(!f.isMb&&u.toggleCancle(),f.isMb&&n.on(n.query('body > header [data-action="showQuery"]'),"click",function(){u.show()}),s.asynData){var a={query:u,qm:s,container:t};i.asynQuery(a)}})}else i.requireTable(s,null,r);return i}return __extends(e,a),e.prototype.requireTable=function(a,n,l){var o=this;b.BwRule.beforeHandle.table(a);var e=this.isMb?"TableModuleMb":"TableModulePc";u([e],function(e){o.initTable(e,a,n);var t=o.tableModule;o.on(b.BwRule.EVT_REFRESH,function(){t&&t.refresher(null,function(){t.aggregate.get()})}),o.on("table-data-add",function(e){o.tableModule.editBtns.edit(),setTimeout(function(){o.tableModule.table.copy.match(e.detail).forEach(function(e){o.tableModule.tableEdit.add(e)})},800)}),"function"==typeof l&&l()})},e.prototype.asynQuery=function(t){var a=this;u(["AsynQuery"],function(e){new e.AsynQuery(G.tools.obj.merge(a.para,{asynData:t}))})},e}(t.default);e.TablePage=a}),define("TablePageMb",["require","exports","BwRule","ButtonAction","TablePage"],function(e,t,M,a,n){"use strict";var g=G.d;return function(t){function e(){var p,y,h,m,e=null!==t&&t.apply(this,arguments)||this;return e.dealConf=(y=p=null,h=function(){a.ButtonAction.get().clickHandle(p,null)},m=function(){y&&(g.off(y,"tap",h),g.remove(y))},{add:function(e){m();for(var t=G.tools.isEmpty(e.subButtons)?[]:e.subButtons,a=G.tools.isEmpty(e.subTableList)?[]:e.subTableList,n=[],l=0,o=t;l<o.length;l++)"insert"===(s=o[l]).subType?p=s:n.push(s);if(e.subButtons=n,p){for(var u="",r=0,i=[p];r<i.length;r++){var s,b=s=i[r];u+='<a class="mui-pull-right"><span class="mui-icon '+b.icon+'"></span>'+b.title+"</a>"}y=g.create(u),g.before(g.query("body > header > .mui-pull-right"),y),g.on(y,"tap",h)}for(var c=0,d=a;c<d.length;c++){var f=d[c];M.BwRule.beforeHandle.table(f)}}}),e}return __extends(e,t),e.prototype.initTable=function(e,t,a){if(this.dealConf.add(t),!this.para.tableDom){this.para.tableDom=g.create('<table class="mobileTable"><tbody></tbody></table>');var n=g.query("body > .mui-content");g.append(n,this.para.tableDom)}this.tableModule=new e({tableEl:this.para.tableDom,scrollEl:document.body,ajaxData:a},t)},e}(n.TablePage)});