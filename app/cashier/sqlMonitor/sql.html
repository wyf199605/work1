<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>收银sql监控</title>
    <link href="global.pc.css?v=0" rel="stylesheet">
    <link href="sqlMonitor.css" rel="stylesheet">

</head>
<body class="sqlPage">
<div class="sql">

</div>
<div id="sqlMonitorContent">

</div>
<script src="plugin/requirejs/require.js"></script>
<script src="global.js?v=0"></script>
<script>
    __setRequireBase('./sql', '0');
    function __setRequireBase(baseUrl, urlArg) {
        C.setRequire({
            baseUrl: baseUrl,
        }, urlArg);
    }
    let identification = 'CASHIER_SQL_' + new Date().getTime() + Math.random();
    require(['BwWebsocket'], function(e){
        new e.BwWebsocket({
            url : 'wss://bwd.sanfu.com/cashier/sql/websocket/' + identification,
            onMessage : r => {
                let data = JSON.parse(r && r.data);
                switch (data.respType){
                    case 'sql':
                        let content = C.d.query('#sqlMonitorContent',document.body);
                        if(content) {
                            // let pageContainer = C.d.closest(content, '.sql');
                            for (let i = 0, l = data.data.length; i < l; i++) {
                                C.d.append(content,document.createElement('br'));
                                C.d.append(content,data.data[i].replace(/\t/g, "\u00A0\u00A0\u00A0\u00A0").replace(/\n/g, ""));
                            }
                            C.d.append(content,document.createElement('br'));
                            content.scrollTop = content.scrollHeight;
                        }
                        break;
                }
            },
            onOpen : r => {
                console.log(r,'开启');
            },
            onClose : r => {
                console.log(r,'关闭')
            },
            onError : r => {
                console.log(r,'error')
            }
        });
    });
    require(['SqlMonitor'], function (e) {
        new e.SqlMonitor({
            container : C.d.query('.sql'),
            identification : identification
        })
    });
</script>
</body>
</html>